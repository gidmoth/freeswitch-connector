{"version":3,"file":"scripts.js","sources":["../../.tmp/concat/scripts/scripts.js"],"names":["createAudioMeter","audioContext","clipLevel","averaging","clipLag","processor","createScriptProcessor","onaudioprocess","volumeAudioProcess","clipping","lastClip","volume","connect","destination","checkClipping","this","window","performance","now","shutdown","disconnect","event","x","buf","inputBuffer","getChannelData","bufLength","length","sum","i","Math","abs","rms","sqrt","max","$","JsonRpcClient","options","self","extend","ajaxUrl","socketUrl","onmessage","login","passwd","sessid","loginParams","userVariables","getSocket","onmessage_cb","_getSocket","ws_cnt","wsOnMessage","_wsOnMessage","prototype","_ws_socket","_ws_callbacks","_current_id","speedTest","bytes","cb","socket","speedCB","speedBytes","send","loops","rem","data","Array","join","call","method","params","success_cb","error_cb","request","jsonrpc","id","e","console","log","_wsCall","ajax","type","url","toJSON","dataType","cache","success","error","result","jqXHR","textStatus","errorThrown","response","parseJSON","responseText","err","notify","batch","callback","all_done_cb","_batchObject","_execute","socketReady","readyState","closeSocket","onclose","w","close","loginData","connectSocket","to","clearTimeout","authing","WebSocket","ws_sleep","onWSClose","wsFallbackURL","setTimeout","onopen","onWSConnect","req","q","pop","stopRetrying","request_json","push","request_obj","orig_req","code","onWSLogin","eventData","reply","msg","up_dur","parseInt","substring","down_dur","up_kps","toFixed","down_kps","info","upDur","downDur","upKPS","downKPS","jsonrpcclient","_requests","batch_request","handlers","undefined","_batchCb","jQuery","findLine","sdpLines","prefix","substr","findLineInRange","startLine","endLine","realEndLine","indexOf","toLowerCase","getCodecPayloadType","sdpLine","pattern","RegExp","match","setCompat","checkCompat","onStreamError","doCallback","onStreamSuccess","stream","onRemoteStreamSuccess","onICE","candidate","mediaData","candidateList","func","arg","callbacks","onICEComplete","onChannelError","onICESDP","sdp","SDP","stereoHack","onRemoteStream","useVideo","style","display","iOS","navigator","platform","setAttribute","element","useAudio","FSRTCattachMediaStream","remoteStream","onOfferSDP","getMediaParams","obj","audio","useMic","videoParams","screenShare","audioParams","deviceId","assignMediaIdToConstraint","localVideo","useStream","getUserMedia","constraints","video","useCamera","useCameraLabel","useMicLabel","onsuccess","localVideoStream","onerror","bestFrameRate","vertoBestFrameRate","minFrameRate","mozGetUserMedia","dowin","confirm","width","min","minWidth","maxWidth","height","minHeight","maxHeight","mediaSource","opt","sourceId","maxFrameRate","mandatory","optional","frameRate","ideal","FSRTCPeerConnection","ice_handler","done","gathering","peer","localDescription","createOffer","sessionDescription","serializeSdp","setLocalDescription","onSdpError","createAnswer","setRemoteDescription","RTCSessionDescription","offerSDP","onSdpSuccess","onAnswerSDP","openOffererChannel","onChannelMessage","_openOffererChannel","channel","createDataChannel","reliable","setChannelEvents","onChannelOpened","onChannelClosed","warn","config","default_ice","urls","turnServer","iceServers","bundlePolicy","sdpSemantics","RTCPeerConnection","onicecandidate","attachStream","getAudioTracks","forEach","track","addTrack","getVideoTracks","attachStreams","streams","addStream","ontrack","remoteMediaStream","oninactive","onRemoteStreamEnded","addAnswerSDP","cbSuccess","cbError","addICE","addIceCandidate","RTCIceCandidate","sdpMLineIndex","sendData","message","stop","MediaStream","tracks","getTracks","activateLocalVideo","el","srcObject","deactivateLocalVideo","assureConstraintByLabel","constraint","fallbackLabel","Promise","resolve","assureMediaInputId","then","Object","assign","exact","trustyGetUserMedia","mediaDevices","mediaId","rest","video_constraints","all","assurances","FSRTC","useStereo","userData","audioEnabled","videoEnabled","profile","offerToReceiveAudio","useSpeak","offerToReceiveVideo","validRes","local","on","opusPayload","split","opusIndex","fmtpLineIndex","toString","concat","answer","onSuccess","onError","stopPeer","localStream","getMute","setMute","what","audioTracks","len","enabled","getVideoMute","setVideoMute","videoTracks","remoteSDP","debug","mediaParams","screen","offerToSendAudio","resSupported","h","bestResSupported","resList","resI","ttl","checkRes","cam","res","localStorage","setItem","getValidRes","cached","getItem","checkPerms","runtime","check_audio","check_video","drop_bad","verto","eventSUBS","mark_ready","j","ready","readyHandler","do_subscribe","subChannels","sparams","eventChannel","handler","serno","SERNO","isnew","createMainModeratorMethods","conf","listVideoLayouts","modCommand","play","file","deaf","memberID","undeaf","record","stopRecord","snapshot","hasVid","setVideoLayout","layout","canvasID","kick","muteMic","muteVideo","presenter","videoFloor","banner","text","escape","volumeDown","volumeUp","gainDown","gainUp","transfer","exten","sendChat","rpcClient","laData","chatChannel","action","checkStateChange","oldS","newS","state","purge","states","name","find_name","audioOutDevices","source","generateGUID","crypto","Uint16Array","getRandomValues","S4","num","ret","replace","c","r","random","v","saved","tag","localTag","deviceParams","onResCheck","ringSleep","dialogs","handleMessage","o","ringFile","ringer","logout","body","sendMethod","processReply","unauthorizedChannels","subscribedChannels","subscribe","subParams","unsubscribe","handle","unsubChannels","sendChannels","repl","u","broadcast","callID","setState","hangup","dialog","newCall","args","direction","outbound","invite","rtc","handleAnswer","handleMedia","handleDisplay","handleInfo","attach","inbound","recovering","wantVideo","list","key","onMessage","pvtEvent","sendMessage","sub","onEvent","from","clientReady","del_array","array","hashArray","vha","hash","reorder","a","clear","add","val","insertAt","redraw","n","del","get","order","arrayLen","asArray","each","dump","html","str","JSON","stringify","liveArray","context","la","lastSerno","binding","user_obj","userObj","_add","_del","_reorder","_clear","errs","onChange","checkSerno","onErr","bootstrap","init","index","bootObj","modify","ok","eventHandler","packet","wireSerno","hashKey","arrIndex","destroy","sendCommand","cmd","command","changepage","heartbeat","hb_pid","liveTable","jq","genRow","tmp","oldStatus","genArray","dt","lt","dataTable","fnDestroy","iserr","aoColumns","sTitle","fnClearTable","fnAddData","fnAdjustColumnSizing","fnUpdate","fnDeleteRow","hide","show","CONFMAN_SERNO","onBroadcast","onLaChange","onLaRow","modChannel","infoChannel","infoCallback","chatCallback","value","application","destroyed","modfuncs","confMan","genMainMod","play_id","stop_id","recording_id","snapshot_id","rec_stop_id","div_id","change_video_layout","canvas_id","canvasCount","vlayout_id","vlselect_id","vlhtml","append","click","prompt","genControls","rowid","kick_id","canvas_in_next_id","canvas_in_prev_id","canvas_out_next_id","canvas_out_prev_id","canvas_in_set_id","canvas_out_set_id","layer_set_id","layer_next_id","layer_prev_id","tmute_id","tvmute_id","vbanner_id","tvpresenter_id","tvfloor_id","box_id","gainup_id","gaindn_id","volup_id","voldn_id","transfer_id","mouseover","mouse","mouseout","xten","cid","tableID","statusID","mainModID","atitle","awidth","role","displayID","selectmenu","empty","Option","responseData","rdata","sort","b","ga","gb","lastTimeout","row_callback","nRow","aData","iDisplayIndex","iDisplayIndexFull","$row","laChannel","laName","confEvent","laChange","aaData","sWidth","bAutoWidth","bDestroy","bSort","bInfo","bFilter","bLengthChange","bPaginate","iDisplayLength","oLanguage","sEmptyTable","fnRowCallback","lastState","answered","audioStream","document","getElementById","videoStream","RTCcallbacks","display_direction","remote_caller_id_name","caller_id_name","remote_caller_id_number","caller_id_number","callee_id_name","callee_id_number","destination_number","requesting","answering","active","location","reload","onStream","permissionCallback","onGranted","onDenied","cause","ring","dialogParams","noDialogParams","setAudioPlaybackDevice","sinkId","devname","setSinkId","errorMessage","ringing","stopRinging","onDialogState","early","speaker","trying","remove","holdState","held","causeCode","indicateRing","attr","dtmf","digits","rtt","pobj","chars","txt","dest","replaceCallID","hold","unhold","toggleHold","gotAnswer","gotEarly","cidString","enc","party","display_name","display_number","ENUM","s","map","freeze","new","unloadJobs","unloadEventName","bind","f","haltClosure","warnOnUnload","videoDevices","audioInDevices","checkDevices","gotDevices","deviceInfos","deviceInfo","kind","label","aud_in","aud_out","vid","Xstream","handleError","checkTypes","devs","has_audio","has_video","enumerateDevices","refreshDevices","skipPermCheck","skipDeviceCheck","status","genUUID","exports","module","define","amd","g","global","adapter","t","require","Error","p",1,"_adapter_factory","adapterFactory","./adapter_factory.js",2,"_interopRequireWildcard","__esModule","newObj","hasOwnProperty","_ref","arguments","shimChrome","shimFirefox","shimEdge","shimSafari","logging","utils","browserDetails","detectBrowser","commonShim","extractVersion","disableLog","disableWarnings","browser","chromeShim","shimPeerConnection","browserShim","shimGetUserMedia","shimMediaStream","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimSenderReceiverGetStats","fixNegotiationNeeded","shimRTCIceCandidate","shimConnectionState","shimMaxMessageSize","shimSendThrowTypeError","removeAllowExtmapMixed","firefoxShim","shimRemoveStream","shimSenderGetStats","shimReceiverGetStats","shimRTCDataChannel","edgeShim","shimGetDisplayMedia","shimReplaceTrack","safariShim","shimRTCIceServerUrls","shimCreateOfferLegacy","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","defineProperty","_utils","_chrome_shim","_edge_shim","_firefox_shim","_safari_shim","_common_shim","./chrome/chrome_shim","./common_shim","./edge/edge_shim","./firefox/firefox_shim","./safari/safari_shim","./utils",3,"walkStats","stats","base","resultSet","has","set","keys","endsWith","filterStats","streamStatsType","filteredResult","Map","trackStats","trackIdentifier","trackStat","trackId","webkitMediaStream","_typeof","wrapPeerConnectionEvent","transceiver","receiver","_ontrack","removeEventListener","addEventListener","enumerable","configurable","origSetRemoteDescription","_this","_ontrackpoly","te","getReceivers","find","Event","dispatchEvent","apply","shimSenderWithDtmf","pc",{"end":{"file":"../../.tmp/concat/scripts/scripts.js","comments_before":[],"nlb":false,"endpos":159880,"endcol":16,"endline":5129,"pos":159876,"col":12,"line":5129,"value":"dtmf","type":"name"},"start":{"file":"../../.tmp/concat/scripts/scripts.js","comments_before":[],"nlb":false,"endpos":159880,"endcol":16,"endline":5129,"pos":159876,"col":12,"line":5129,"value":"dtmf","type":"name"},"name":"dtmf"},"_dtmf","createDTMFSender","_pc","getSenders","_senders","slice","origAddTrack","sender","origRemoveTrack","removeTrack","idx","splice","origAddStream","_this2","origRemoveStream","removeStream","_this3","RTCRtpSender","origGetSenders","_this4","senders","RTCRtpReceiver","_this5","getStats","origGetReceivers","_this6","receivers","srcElement","origGetStats","MediaStreamTrack","reject","DOMException","shimAddTrackRemoveTrackWithNative","getLocalStreams","_this7","_shimmedLocalStreams","streamId","_this8","alreadyExists","existingSenders","newSenders","filter","newSender","_this9","replaceInternalStreamId","description","_reverseStreams","internalId","externalStream","internalStream","_streams","replaceExternalStreamId","version","origGetLocalStreams","_this10","nativeStreams","_this11","newStream","_this12","signalingState","oldStream","nativeMethod","_this13","isLegacyCall","desc","origSetLocalDescription","origLocalDescription","getOwnPropertyDescriptor","_this14","isLocal","streamid","hasTrack","webkitRTCPeerConnection","selector","successCallback","errorCallback","_this15","fixChromeStats_","standardReport","reports","report","standardStats","timestamp","localcandidate","remotecandidate","names","stat","makeMapStats","successCallbackWrapper_","nativeAddIceCandidate","target","Symbol","iterator","constructor","_getusermedia","_getdisplaymedia","../utils.js","./getdisplaymedia","./getusermedia",4,"getSourceId","getDisplayMedia","widthSpecified","heightSpecified","frameRateSpecified","chromeMediaSource","chromeMediaSourceId",5,"constraintsToChrome_","cc","oldname_","charAt","toUpperCase","oc","mix","advanced","shimConstraints_","parse","remap","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","devices","d","dev","some","includes","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","constraintName","getUserMedia_","webkitGetUserMedia","origGetUserMedia","cs",6,"_interopRequireDefault","default","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","_sdp2","parseCandidate","augmentedCandidate","sdpMid","usernameFragment","writable","RTCSctpTransport","_sctp","sctpInDescription","sections","splitSections","shift","mediaSection","mLine","parseMLine","protocol","getRemoteFirefoxVersion","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","maxMessageSize","matchPrefix","isFirefox","canSendMMS","remoteMMS","Number","POSITIVE_INFINITY","sctp","wrapDcSend","dc","origDataChannelSend","size","byteLength","TypeError","origCreateDataChannel","dataChannel","proto","completed","checking","iceConnectionState","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","connectionState","newEvent","nativeSRD","line","trim","_sdp",7,"RTCIceGatherer","origMSTEnabled","ev","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","_rtcpeerconnectionShim2","_filtericeservers","filterIceServers","replaceTrack","setTrack","_rtcpeerconnectionShim","../utils","./filtericeservers","rtcpeerconnection-shim",8,"edgeVersion","hasTurn","server","deprecated","isString","validTurn","startsWith",9,10,11,"RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","inboundrtp","outboundrtp","candidatepair","nativeGetStats","onSucc","DataChannel","RTCDataChannel",12,"preferredMediaSource",13,"nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints",14,"_localStreams","_addTrack","getRemoteStreams","_remoteStreams","_onaddstream","_onaddstreampoly","failureCallback","promise","withCallback","_getUserMedia","shimConstraints","errcb","compactObject","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","generateCertificate","RTCTransceiver","origCreateOffer","offerOptions","audioTransceiver","getTransceivers","setDirection","addTransceiver","videoTransceiver",15,"_defineProperty","uastring","expr","pos","eventNameToWrap","wrapper","nativeAddEventListener","nativeEventName","wrappedCallback","modifiedEvent","_eventMap","nativeRemoveEventListener","unwrappedCb","bool","logDisabled_","deprecationWarnings_","oldMethod","newMethod","userAgent","reduce","accumulator","isObject","isEmptyObject",16,"fixStatsType","writeMediaSection","caps","dtlsRole","SDPUtils","writeRtpDescription","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","_initialTrackId","msid","sendEncodingParameters","ssrc","rtx","localCName","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","clockRate","numChannels","rtcpFeedback","fb","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","offer","maybeAddCandidate","iceTransport","alreadyAdded","getRemoteCandidates","remoteCandidate","foundation","ip","port","priority","addRemoteCandidate","makeError","NotSupportedError","InvalidAccessError","OperationError","addTrackToStreamAndFireEvent","MediaStreamTrackEvent","removeTrackFromStreamAndFireEvent","fireAddTrack","trackEvent","_dispatchEvent","_eventTarget","createDocumentFragment","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","_localDescription","_remoteDescription","iceGatheringState","usingBundle","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","onaddstream","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","getConfiguration","_createTransceiver","doNotAdd","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","_maybeFireNegotiationNeeded","clonedStream","clone","clonedTrack","_createIceGatherer","bufferedCandidateEvents","bufferCandidates","end","_gather","onlocalcandidate","evt","cand","component","ufrag","serializedCandidate","writeCandidate","getMediaSections","getDescription","complete","every","RTCIceTransport","onicestatechange","_updateIceConnectionState","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","_disposeIceAndDtlsTransports","_transceive","recv","encodings","rtcp","cname","compound","rtcpParameters","receive","sessionpart","parseRtpParameters","isIceLite","rejected","isRejected","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","start","_updateSignalingState","receiverList","iceOptions","lines","splitLines","getKind","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","setTransport","setRemoteCandidates","hasRtx","getCapabilities","codec","isNewTrack","nativeTrack","sid","item","newState","closed","connected","disconnected","failed","connecting","numAudioTracks","numVideoTracks","writeSessionBoilerplate","remoteCodec","hdrExt","remoteExtensions","rHdrExt","getLocalCandidates","mediaSectionsInOffer","localTrack","reducedSize","candidateString","senderOrReceiver","promises","allStats","results","ortcObjects","ortcObjectName","nativeGetstats","nativeStats","mapStats","methods",17,"blob","parts","part","address","relatedAddress","relatedPort","tcpType","parseIceOptions","parseRtpMap","parsed","channels","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseSsrcGroup","semantics","ssrcs","parseFingerprint","algorithm","fingerprints","setupType","fp","iceParameters","password","mline","rtpmapline","fmtps","maxptime","extension","secondarySsrc","encodingParameters","hasRed","hasUlpfec","primarySsrc","flows","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","remoteSsrc","rsize","mux","spec","planB","msidParts","sessId","sessVer","sessUser","sessionId","user","fmt","parseOLine","username","sessionVersion","netType","addressType","isValidSDP","getScreenConstraints","screen_constraints","postMessage","iframe","isLoaded","contentWindow","captureSourceId","loadIFrame","loadCallback","createElement","onload","src","documentElement","appendChild","getScreenId","onIFrameCallback","chromeExtensionStatus","mozMediaSource","domain","k","l","m","String","fromCharCode","charCodeAt","unescape","encodeURIComponent","md5","vertoApp","angular","constant","languages","dialects","en","en_GB","en_US","it","it_IT","fr","fr_FR","fr_CA","pt_BR","pt_PT","de","de_DE","es","es_ES","pl","pl_PL","ru","ru_RU","sv","sv_SV","sv_FI","da","da_DK","id_ID","zh","zh_CN","zh_TW","zh_HK","$routeProvider","gravatarServiceProvider","$translateProvider","configLanguages","when","title","templateUrl","controller","otherwise","redirectTo","defaults","reg_langs","useStaticFilesLoader","suffix","registerAvailableLanguageKeys","preferredLanguage","determinePreferredLanguage","fallbackLanguage","useSanitizeValueStrategy","run","$rootScope","$location","toastr","$on","next","current","path","previous","$$route","safeProtocol","promptInput","input","isFunction","$scope","$timeout","storage","splashscreen","progress_percentage","interrupt_next","errors","link","activity","checkProgressState","current_progress","soft","interrupt","calculate","getProgressMessage","$http","Fullscreen","$anchorScroll","$translate","scrollToChatBottom","querySelector","scrollTop","scrollHeight","clearConferenceChat","members","messages","CLEAN_MESSAGE","getResByLayout","layoutsData","confLayoutsData","resIDS","clearMembersResID","preserve","member","resID","reservationID","confResID","findMemberByUUID","uuid","found","translateMember","number","email","addMember","shortPrompt","$watch","activePane","chat_counter","created_at","Date","$apply","chatStatus","resIDs","currentLayout","layoutName","openId","watcher","master","memberIdx","conferenceMemberID","mutedMic","muted","mutedVideo","$applyAsync","closeChat","toggleModMenu","confRole","preventDefault","sendConferenceChat","confKick","confMuteMic","confMuteVideo","confPresenter","setResevartionId","confVideoFloor","confBanner","instant","confCanvasIn","setCanvasIn","confCanvasOut","setCanvasOut","confLayer","setLayer","confResetBanner","confVolumeDown","confVolumeUp","confGainDown","confGainUp","confTransfer","disableOnKeydownDtmf","enableOnKeydownDtmf","confToggleDeaf","origin","pathname","contributors","re","githash","CallHistory","eventQueue","onHold","cur_call","dialpadNumber","called_number","mirrorInput","videoCall","warning","process","search","autocall","call_history","history_control","all_control","has_history","userStatus","calling","clearCallHistory","viewCallsList","calls","call_list","fillDialpadNumber","preview","loading","cancelled","testSpeedJoin","testSpeed","cancel","$modal","buildCanvasesData","canvases","callTemplate","dialpadTemplate","incall","openChat","toggleDialpad","openModal","cbMuteVideo","cbMuteMic","confChangeVideoLayout","videoLayout","$emit","confChangeSpeaker","speakerId","selectedSpeaker","confPopup","href","curCall","webcam","offsetWidth","offsetHeight","y","popup","open","moveTo","screenshare","shareCall","screenshareHangup","pluginUrl","allowHtml","$broadcast","preRoute","skipPreview","$q","$window","ws_modalInstance","backdrop","keyboard","showReconnectModal","autoBand","gapiClientLoaded","gapi","client","plus","people","userId","execute","handleEmailResponse","resp","primaryEmail","emails","displayName","image","sinkIdCallback","deviceName","onKeydownDtmfHistory","caracter","onKeydownDtmfEnabled","dtmfWidget","dtmfHistory","callState","language","use","addClass","dialpad","myVideo","hasClass","redirect","connectCallback","hostname","wsURL","ui_connected","ws_connected","disconnectCallback","reset","auth","signOut","openModalSettings","modalInstance","animation","animationsEnabled","rendered","material","_options","showAbout","showContributors","backspace","toggleCallHistory","removeClass","toggleChat","toggleClass","updateVideoSize","toggleSettings","settingsEl","closeSettings","goFullscreen","fullscreenEnabled","isEnabled","enable","getElementsByTagName","$digest","page_incall","askRecoverCall","events","authResult","load","callActive","call_start","start_time","incomingCall","answerCall","declineCall","selectedVideo","originalPath","unbind","vidQual","bwp","bandDown","bandUp","iconClass","videoQuality","vidRes","$modalInstance","dismiss","ModalWsReconnectController","closeReconnect","instance","$inject","speakerFeature","mydata","copy","unshift","translation","selectedVideoName","changeData","useSTUN","googEchoCancellation","googNoiseSuppression","googHighpassFilter","googAutoGainControl","googAutoGainControl2","changedLanguage","langKey","browserlang","lang","fail_lang","refreshDeviceList","showPreview","speedMsg","isTestingSpeed","resetSettings","factoryReset","checkAutoBand","option","useDedenc","bestres","outgoingBandwidth","incomingBandwidth","checkUseDedRemoteEncoder","checkVideoQuality","resolution","videoResolution","stopMedia","streamObj","mediaStreamSource","createMediaStreamSource","meter","volumes","children","mirrored","selectedAudio","newDevice","device","AudioContext","endPreview","$interval","int_id","stopInterval","resCheckEnded","directive","restrict","$element","focus","scope","attrs","fadeIn","parent","fadeOut","condition","videoElem","newParent","getElementsByClassName","resize","css","appendTo","regex","regex64","test","videoQualitySource","qqvga","qvga","vga","qvga_wide","vga_wide","hd","hhd","framerate","updateReq","ms","new_w","new_h","aspect","videoContainer","round","vertoService","service","$cookieStore","cleanShareCall","that","cleanCall","confLayouts","chattingWith","last_state","updateResolutions","supportedResolutions","audioDevices","shareDevices","textTo","refreshDevicesCallback","speakerDevices","selectedShare","videoFlag","shareFlag","audioFlag","speakerFlag","canVideo","refreshVideoResolution","resolutions","qual","startConference","pvtData","chatID","fromDisplay","canvasInfo","callId","fromJson","stopConference","ourBootstrap","reloaded","loginFailed","videoOnly","from_msg_name","reattached_sessions","mediaPerm","custom","callerid","dedEnc","avatar","stopSharing","StreamTrack","screenfunc","share_call","upBand","ceil","downBand","from_msg_number","configure","httpRequest","floor","httpReturn","googlelogin","googleclientid","autologin","autologin_done","fn","fn_return","emitNextProgress","$localStorage","verto_data","defaultSettings","$default","$reset","factory","history","addCallToHistory","getCallsFromHistory","checkBrowser","checkMediaPerm","refreshMediaDevices","checkConnectionSpeed","provisionConfig","configResponse","configPromise","checkLogin","checkUserStored","progress","progress_message","calculateProgress","_progress","nextProgress"],"mappings":"AAmkUA,QAASA,kBAAiBC,EAAaC,EAAUC,EAAUC,GAC1D,GAAIC,GAAYJ,EAAaK,sBAAsB,IA4BnD,OA3BAD,GAAUE,eAAiBC,mBAC3BH,EAAUI,UAAW,EACrBJ,EAAUK,SAAW,EACrBL,EAAUM,OAAS,EACnBN,EAAUH,UAAYA,GAAa,IACnCG,EAAUF,UAAYA,GAAa,IACnCE,EAAUD,QAAUA,GAAW,IAI/BC,EAAUO,QAAQX,EAAaY,aAE/BR,EAAUS,cACT,WACC,MAAKC,MAAKN,UAELM,KAAKL,SAAWK,KAAKX,QAAWY,OAAOC,YAAYC,QACvDH,KAAKN,UAAW,GACVM,KAAKN,WAHJ,GAMVJ,EAAUc,SACT,WACCJ,KAAKK,aACLL,KAAKR,eAAiB,MAGjBF,EAGR,QAASG,oBAAoBa,GAOzB,IAAK,GAHDC,GAHHC,EAAMF,EAAMG,YAAYC,eAAe,GACpCC,EAAYH,EAAII,OACnBC,EAAM,EAIEC,EAAE,EAAKH,EAAFG,EAAaA,IAC1BP,EAAIC,EAAIM,GACJC,KAAKC,IAAIT,IAAIP,KAAKb,YACrBa,KAAKN,UAAW,EAChBM,KAAKL,SAAWM,OAAOC,YAAYC,OAEpCU,GAAON,EAAIA,CAIZ,IAAIU,GAAOF,KAAKG,KAAKL,EAAMF,EAK3BX,MAAKJ,OAASmB,KAAKI,IAAIF,EAAKjB,KAAKJ,OAAOI,KAAKZ,YAzkUjD,SAAUgC,GAgBNA,EAAEC,cAAgB,SAASC,GACvB,GAAIC,GAAOvB,IACXA,MAAKsB,QAAUF,EAAEI,QACbC,QAAgB,KAChBC,UAAgB,KAChBC,UAAgB,KAChBC,MAAgB,KAChBC,OAAgB,KAChBC,OAAgB,KACvBC,YAAgB,KAChBC,cAAgB,KACTC,UAAgB,SAASC,GAAgB,MAAOX,GAAKY,WAAWD,KACjEZ,GAEHC,EAAKa,OAAS,EAGdpC,KAAKqC,YAAc,SAAS/B,GAASiB,EAAKe,aAAahC,KAI3Dc,EAAEC,cAAckB,UAAUC,WAAa,KAGvCpB,EAAEC,cAAckB,UAAUE,iBAG1BrB,EAAEC,cAAckB,UAAUG,YAAc,EAGxCtB,EAAEC,cAAckB,UAAUI,UAAY,SAAUC,EAAOC,GACnD,GAAIC,GAAS9C,KAAKsB,QAAQW,UAAUjC,KAAKqC,YAChD,IAAe,OAAXS,EAAiB,CACjB9C,KAAK+C,QAAUF,EACf7C,KAAKgD,WAAaJ,EAClBE,EAAOG,KAAK,QAAUL,EAEtB,IAEI9B,GAFAoC,EAAQN,EAAQ,KAChBO,EAAMP,EAAQ,KAEdQ,EAAO,GAAIC,OAAM,MAAMC,KAAK,IAChC,KAAKxC,EAAI,EAAOoC,EAAJpC,EAAWA,IAC1BgC,EAAOG,KAAK,QAAUG,EAGfD,IACPL,EAAOG,KAAK,QAAUG,GAGnBN,EAAOG,KAAK,UAeb7B,EAAEC,cAAckB,UAAUgB,KAAO,SAASC,EAAQC,EAAQC,EAAYC,GAG7DF,IACDA,MAGAzD,KAAKsB,QAAQQ,SACb2B,EAAO3B,OAAS9B,KAAKsB,QAAQQ,OAGjC,IAAI8B,IACAC,QAAU,MACVL,OAAUA,EACVC,OAAUA,EACVK,GAAU9D,KAAK0C,cAGdgB,KACDA,EAAa,SAASK,GAAGC,QAAQC,IAAI,YAAaF,KAGjDJ,IACDA,EAAW,SAASI,GAAGC,QAAQC,IAAI,UAAWF,IAIlD,IAAIjB,GAAS9C,KAAKsB,QAAQW,UAAUjC,KAAKqC,YACzC,IAAe,OAAXS,EAEA,WADA9C,MAAKkE,QAAQpB,EAAQc,EAASF,EAAYC,EAK9C,IAA6B,OAAzB3D,KAAKsB,QAAQG,QACb,KAAM,mEAGVL,GAAE+C,MACEC,KAAW,OACXC,IAAWrE,KAAKsB,QAAQG,QACxB2B,KAAWhC,EAAEkD,OAAOV,GACpBW,SAAW,OACXC,OAAW,EAEXC,QAAW,SAASrB,GACZ,SAAWA,IAAMO,EAASP,EAAKsB,MAAO1E,MAC1C0D,EAAWN,EAAKuB,OAAQ3E,OAI5B0E,MAAW,SAASE,EAAOC,EAAYC,GACnC,IACI,GAAIC,GAAW3D,EAAE4D,UAAUJ,EAAMK,aAE7B,YAAahF,SAAQ+D,QAAQC,IAAIc,GAErCpB,EAASoB,EAASL,MAAO1E,MAC3B,MAAOkF,GAELvB,GAAWe,MAAOE,EAAMK,cAAgBjF,WAkBxDoB,EAAEC,cAAckB,UAAU4C,OAAS,SAAS3B,EAAQC,GAG5CzD,KAAKsB,QAAQQ,SACb2B,EAAO3B,OAAS9B,KAAKsB,QAAQQ,OAGjC,IAAI8B,IACAC,QAAS,MACTL,OAASA,EACTC,OAASA,GAITX,EAAS9C,KAAKsB,QAAQW,UAAUjC,KAAKqC,YACzC,IAAe,OAAXS,EAEA,WADA9C,MAAKkE,QAAQpB,EAAQc,EAKzB,IAA6B,OAAzB5D,KAAKsB,QAAQG,QACb,KAAM,qEAGVL,GAAE+C,MACEC,KAAW,OACXC,IAAWrE,KAAKsB,QAAQG,QACxB2B,KAAWhC,EAAEkD,OAAOV,GACpBW,SAAW,OACXC,OAAW,KAoBnBpD,EAAEC,cAAckB,UAAU6C,MAAQ,SAASC,EAAUC,EAAa3B,GAC9D,GAAIyB,GAAQ,GAAIhE,GAAEC,cAAckE,aAAavF,KAAMsF,EAAa3B,EAChE0B,GAASD,GACTA,EAAMI,YAYVpE,EAAEC,cAAckB,UAAUkD,YAAc,WACpC,MAAwB,QAApBzF,KAAKwC,YAAuBxC,KAAKwC,WAAWkD,WAAa,GAClD,GAGJ,GAGXtE,EAAEC,cAAckB,UAAUoD,YAAc,WAC3C,GAAIpE,GAAOvB,IACAuB,GAAKkE,gBACLlE,EAAKiB,WAAWoD,QAAU,SAAUC,GAAI7B,QAAQC,IAAI,mBACpD1C,EAAKiB,WAAWsD,UAIxB1E,EAAEC,cAAckB,UAAUwD,UAAY,SAAStC,GAClD,GAAIlC,GAAOvB,IACJuB,GAAKD,QAAQM,MAAQ6B,EAAO7B,MAC5BL,EAAKD,QAAQO,OAAS4B,EAAO5B,OACpCN,EAAKD,QAAQS,YAAc0B,EAAO1B,YAClCR,EAAKD,QAAQU,cAAgByB,EAAOzB,eAGjCZ,EAAEC,cAAckB,UAAUyD,cAAgB,SAAS9D,GAC/C,GAAIX,GAAOvB,IAkEX,OAhEIuB,GAAK0E,IACLC,aAAa3E,EAAK0E,IAGjB1E,EAAKkE,gBACNlE,EAAK4E,SAAU,EAEX5E,EAAKiB,kBACEjB,GAAKiB,WAIhBjB,EAAKiB,WAAa,GAAI4D,WAAU7E,EAAKD,QAAQI,WAEzCH,EAAKiB,aAELjB,EAAKiB,WAAWb,UAAYO,EAC5BX,EAAKiB,WAAWoD,QAAU,SAAUC,GAC3BtE,EAAK8E,WACN9E,EAAK8E,SAAW,KAGhB9E,EAAKD,QAAQgF,WACb/E,EAAKD,QAAQgF,UAAU/E,GAGvBA,EAAKa,OAAS,IAAMb,EAAKD,QAAQiF,gBACnChF,EAAKD,QAAQI,UAAYH,EAAKD,QAAQiF,eAGxCvC,QAAQU,MAAM,kBAAoBnD,EAAKa,OAAS,WAAab,EAAK8E,SAAW,QAE7E9E,EAAK0E,GAAKO,WAAW,WACjBxC,QAAQC,IAAI,+BACZ1C,EAAKyE,cAAc9D,IACpBX,EAAK8E,UAER9E,EAAKa,SAEDb,EAAK8E,SAAW,KAAS9E,EAAKa,OAAS,KAAQ,IAC/Cb,EAAK8E,UAAY,MAKzB9E,EAAKiB,WAAWiE,OAAS,WACjBlF,EAAK0E,IACLC,aAAa3E,EAAK0E,IAEtB1E,EAAK8E,SAAW,IAChB9E,EAAKa,OAAS,EACVb,EAAKD,QAAQoF,aACbnF,EAAKD,QAAQoF,YAAYnF,EAK7B,KAFA,GAAIoF,GAEIA,EAAMvF,EAAEC,cAAcuF,EAAEC,OAC5BtF,EAAKiB,WAAWS,KAAK0D,MAM9BpF,EAAKiB,YAAa,GAAO,GAGpCpB,EAAEC,cAAckB,UAAUuE,aAAe,WACnCvF,KAAK0E,IACPC,aAAa3E,KAAK0E,KAGtB7E,EAAEC,cAAckB,UAAUJ,WAAa,SAASD,GAG5C,MAA+B,QAA3BlC,KAAKsB,QAAQI,WAAwB,aAAezB,SAExDD,KAAKgG,cAAc9D,GAEZlC,KAAKwC,YAJ4D,MAU5EpB,EAAEC,cAAcuF,KAQhBxF,EAAEC,cAAckB,UAAU2B,QAAU,SAASpB,EAAQc,EAASF,EAAYC,GACtE,GAAIoD,GAAe3F,EAAEkD,OAAOV,EAExBd,GAAO4C,WAAa,GAEpBnE,KAAOvB,KACPoB,EAAEC,cAAcuF,EAAEI,KAAKD,IAGvBjE,EAAOG,KAAK8D,GAIZ,MAAQnD,IAAiC,mBAAfF,KAC1B1D,KAAKyC,cAAcmB,EAAQE,KAAQF,QAASmD,EAAcE,YAAarD,EAASF,WAAYA,EAAYC,SAAUA,KAW1HvC,EAAEC,cAAckB,UAAUD,aAAe,SAAShC,GAE9C,GAAIyE,EAGX,IAAqB,KAAjBzE,EAAM8C,KAAK,IAA8B,KAAjB9C,EAAM8C,KAAK,IAA8B,KAAjB9C,EAAM8C,KAAK,GAA/D,CAwBO,IAKI,GAJA2B,EAAW3D,EAAE4D,UAAU1E,EAAM8C,MAIL,gBAAb2B,IACP,WAAaA,IACQ,QAArBA,EAASlB,QAAmB,CAK5B,GAAI,UAAYkB,IAAY/E,KAAKyC,cAAcsC,EAASjB,IAAK,CAEzD,GAAIJ,GAAa1D,KAAKyC,cAAcsC,EAASjB,IAAIJ,UAgBjD,cAJO1D,MAAKyC,cAAcsC,EAASjB,QAGnCJ,GAAWqB,EAASJ,OAAQ3E,MAEzB,GAAI,SAAW+E,IAAY/E,KAAKyC,cAAcsC,EAASjB,IAAK,CAI/D,GAAIH,GAAW3D,KAAKyC,cAAcsC,EAASjB,IAAIH,SAC3CuD,EAAWlH,KAAKyC,cAAcsC,EAASjB,IAAIF,OAG/C,QAAKrC,KAAK4E,SAAkC,OAAvBpB,EAASL,MAAMyC,MAAkB5F,KAAKD,QAAQM,OAASL,KAAKD,QAAQO,QACrFN,KAAK4E,SAAU,MAEfnG,MAAKuD,KAAK,SAAW3B,MAAOL,KAAKD,QAAQM,MAAOC,OAAQN,KAAKD,QAAQO,OAAQE,YAAaR,KAAKD,QAAQS,YACrHC,cAAeT,KAAKD,QAAQU,eAC4C,SAAtDhC,KAAKyC,cAAcsC,EAASjB,IAAImD,YAAYzD,OAC5C,SAASO,GACLxC,KAAK4E,SAAU,EACfnC,QAAQC,IAAI,mBACL1C,MAAKkB,cAAcsC,EAASjB,IAE/BvC,KAAKD,QAAQ8F,WACb7F,KAAKD,QAAQ8F,WAAU,EAAM7F,OAMrC,SAASwC,GACLxC,KAAK4E,SAAU,EACfnC,QAAQC,IAAI,oCAAsCc,EAASjB,GAC3D,IAAIhB,GAASvB,KAAKD,QAAQW,UAAUV,KAAKc,YAC1B,QAAXS,GACAA,EAAOG,KAAKiE,GAEZ3F,KAAKD,QAAQ8F,WACb7F,KAAKD,QAAQ8F,WAAU,EAAM7F,OAIrC,SAASwC,GACLC,QAAQC,IAAI,gCAAiCc,EAASjB,UAC/CvC,MAAKkB,cAAcsC,EAASjB,IACnCH,EAASoB,EAASL,MAAO1E,MACrBuB,KAAKD,QAAQ8F,WACjB7F,KAAKD,QAAQ8F,WAAU,EAAO7F,gBAO/BvB,MAAKyC,cAAcsC,EAASjB,QAGnCH,GAASoB,EAASL,MAAO1E,SAInC,MAAOkF,GAIT,WADAlB,SAAQC,IAAI,UAAWiB,GAK3B,GAAsC,kBAA3BlF,MAAKsB,QAAQK,UAA0B,CAC9CrB,EAAM+G,UAAYtC,EACbzE,EAAM+G,YACP/G,EAAM+G,aAGV,IAAIC,GAAQtH,KAAKsB,QAAQK,UAAUrB,EAEnC,IAAIgH,GAA0B,gBAAVA,IAAsBhH,EAAM+G,UAAUvD,GAAI,CAC1D,GAAIyD,IACA1D,QAAS,MACTC,GAAIxD,EAAM+G,UAAUvD,GACpBa,OAAQ2C,GAGRxE,EAASvB,KAAKD,QAAQW,UAAUV,KAAKc,YAC1B,QAAXS,GACAA,EAAOG,KAAK7B,EAAEkD,OAAOiD,UAxIpC,IAAqB,KAAjBjH,EAAM8C,KAAK,GAClBpD,KAAKwH,OAASC,SAASnH,EAAM8C,KAAKsE,UAAU,QAClC,IAAI1H,KAAK+C,SAA4B,KAAjBzC,EAAM8C,KAAK,GAAW,CACpDpD,KAAK2H,SAAWF,SAASnH,EAAM8C,KAAKsE,UAAU,GAE9C,IAAIE,IAA8B,EAAlB5H,KAAKgD,YAAmBhD,KAAKwH,OAAS,KAAS,MAAMK,QAAQ,GACzEC,GAAgC,EAAlB9H,KAAKgD,YAAmBhD,KAAK2H,SAAW,KAAS,MAAME,QAAQ,EAEjF7D,SAAQ+D,KAAK,mBAAqBH,EAAS,UAAYE,EACvD,IAAIjF,GAAK7C,KAAK+C,OACd/C,MAAK+C,QAAU,KACfF,EAAGvC,GACF0H,MAAOhI,KAAKwH,OACZS,QAASjI,KAAK2H,SACdO,MAAON,EACPO,QAASL,MAuIR1G,EAAEC,cAAckE,aAAe,SAAS6C,EAAe9C,EAAa3B,GAGhE3D,KAAKqI,aAELrI,KAAKoI,cAAgBA,EACrBpI,KAAKsF,YAAcA,EACnBtF,KAAK2D,SAAkC,kBAAbA,GAA0BA,EAAW,cAOnEvC,EAAEC,cAAckE,aAAahD,UAAUgB,KAAO,SAASC,EAAQC,EAAQC,EAAYC,GAE1EF,IACDA,MAGAzD,KAAKsB,QAAQQ,SACb2B,EAAO3B,OAAS9B,KAAKsB,QAAQQ,QAG5B4B,IACDA,EAAa,SAASK,GAAGC,QAAQC,IAAI,YAAaF,KAGjDJ,IACLA,EAAW,SAASI,GAAGC,QAAQC,IAAI,UAAWF,KAG9C/D,KAAKqI,UAAUrB,MACXpD,SACAC,QAAU,MACVL,OAAUA,EACVC,OAAUA,EACVK,GAAU9D,KAAKoI,cAAc1F,eAE7BgB,WAAaA,EACbC,SAAaA,KAOrBvC,EAAEC,cAAckE,aAAahD,UAAU4C,OAAS,SAAS3B,EAAQC,GACzDzD,KAAKsB,QAAQQ,SACb2B,EAAO3B,OAAS9B,KAAKsB,QAAQQ,QAGjC9B,KAAKqI,UAAUrB,MACXpD,SACIC,QAAU,MACVL,OAAUA,EACVC,OAAUA,MAQtBrC,EAAEC,cAAckE,aAAahD,UAAUiD,SAAW,WAC9C,GAAIjE,GAAOvB,IAEX,IAA8B,IAA1BA,KAAKqI,UAAUzH,OAAnB,CAGA,GAGI2C,GACAG,EACAC,EALA2E,KACAC,KACAzH,EAAI,EAMJgC,EAASvB,EAAK6G,cAAc9G,QAAQW,UAAUV,EAAK6G,cAAc/F,YACrE,IAAe,OAAXS,EAAiB,CACjB,IAAKhC,EAAI,EAAGA,EAAId,KAAKqI,UAAUzH,OAAQE,IACnCyC,EAAOvD,KAAKqI,UAAUvH,GACtB4C,EAAc,cAAgBH,GAAQA,EAAKG,WAAa8E,OACxD7E,EAAc,YAAgBJ,GAAQA,EAAKI,SAAa6E,OACxDjH,EAAK6G,cAAclE,QAAQpB,EAAQS,EAAKK,QAASF,EAAYC,EAIjE,aAD2B,kBAAhB2B,cAA4BA,YAAYX,SAIvD,IAAK7D,EAAI,EAAGA,EAAId,KAAKqI,UAAUzH,OAAQE,IACnCyC,EAAOvD,KAAKqI,UAAUvH,GACtBwH,EAActB,KAAKzD,EAAKK,SAGpB,MAAQL,GAAKK,UACb2E,EAAShF,EAAKK,QAAQE,KAClBJ,WAAaH,EAAKG,WAClBC,SAAaJ,EAAKI,UAQ9B,IAHAD,EAAa,SAASN,GAAQ7B,EAAKkH,SAASrF,EAAMmF,EAAUhH,EAAK+D,cAGtB,OAAvC/D,EAAK6G,cAAc9G,QAAQG,QAC3B,KAAM,oEAIVL,GAAE+C,MACEE,IAAW9C,EAAK6G,cAAc9G,QAAQG,QACtC2B,KAAWhC,EAAEkD,OAAOgE,GACpB/D,SAAW,OACXC,OAAW,EACXJ,KAAW,OAGXM,MAAW,SAASE,EAAOC,EAAYC,GACnCvD,EAAKoC,SAASiB,EAAOC,EAAYC,IAErCL,QAAWf,MAUnBtC,EAAEC,cAAckE,aAAahD,UAAUkG,SAAW,SAAS9D,EAAQ4D,EAAUjD,GACzE,IAAK,GAAIxE,GAAI,EAAGA,EAAI6D,EAAO/D,OAAQE,IAAK,CACpC,GAAIiE,GAAWJ,EAAO7D,EAGlB,UAAWiE,GACS,OAAhBA,EAASjB,IAAiBiB,EAASjB,KAAMyE,GAIzCA,EAASxD,EAASjB,IAAIH,SAASoB,EAASL,MAAO1E,MAF3C,WAAaC,SAAQ+D,QAAQC,IAAIc,KAMnCA,EAASjB,KAAMyE,KAAa,WAAatI,QAC3C+D,QAAQC,IAAIc,GAEZwD,EAASxD,EAASjB,IAAIJ,WAAWqB,EAASJ,OAAQ3E,MAKnC,kBAAhBsF,IAA4BA,EAAYX,KAGxD+D,QAiCH,SAAUtH,GAIN,QAASuH,GAASC,EAAUC,EAAQC,GAChC,MAAOC,GAAgBH,EAAU,EAAG,GAAIC,EAAQC,GAKpD,QAASC,GAAgBH,EAAUI,EAAWC,EAASJ,EAAQC,GAE3D,IAAK,GADDI,GAA0B,IAAXD,EAAiBA,EAAUL,EAAShI,OAC9CE,EAAIkI,EAAeE,EAAJpI,IAAmBA,EACvC,GAAoC,IAAhC8H,EAAS9H,GAAGqI,QAAQN,MACfC,GAAsE,KAA5DF,EAAS9H,GAAGsI,cAAcD,QAAQL,EAAOM,gBACpD,MAAOtI,EAInB,OAAO,MAIX,QAASuI,GAAoBC,GACzB,GAAIC,GAAU,GAAIC,QAAO,+BACrB7E,EAAS2E,EAAQG,MAAMF,EAC3B,OAAQ5E,IAA2B,GAAjBA,EAAO/D,OAAe+D,EAAO,GAAK,KAsHxD,QAAS+E,MAGT,QAASC,KACL,OAAO,EAGX,QAASC,GAAcrI,EAAMwC,GACzBC,QAAQC,IAAI,kGAAmGF,GAC/G8F,EAAWtI,EAAM,UAAWwC,GAGhC,QAAS+F,GAAgBvI,EAAMwI,GAC3B/F,QAAQC,IAAI,kBACZ4F,EAAWtI,EAAM,WAAYwI,GAGjC,QAASC,GAAsBzI,EAAMwI,GACnC/F,QAAQC,IAAI,yBACZ4F,EAAWtI,EAAM,iBAAkBwI,GAGrC,QAASE,GAAM1I,EAAM2I,GACjB3I,EAAK4I,UAAUD,UAAYA,EAC3B3I,EAAK4I,UAAUC,cAAcpD,KAAKzF,EAAK4I,UAAUD,WAEjDL,EAAWtI,EAAM,SAGrB,QAASsI,GAAWtI,EAAM8I,EAAMC,GACxBD,IAAQ9I,GAAKD,QAAQiJ,WACrBhJ,EAAKD,QAAQiJ,UAAUF,GAAM9I,EAAM+I,GAI3C,QAASE,GAAcjJ,EAAM2I,GACzBlG,QAAQC,IAAI,gBACZ4F,EAAWtI,EAAM,iBAGrB,QAASkJ,GAAelJ,EAAMwC,GAC1BC,QAAQU,MAAM,gBAAiBX,GAC/B8F,EAAWtI,EAAM,UAAWwC,GAGhC,QAAS2G,GAASnJ,EAAMoJ,GACpBpJ,EAAK4I,UAAUS,IAAMrJ,EAAKsJ,WAAWF,EAAIA,KACzC3G,QAAQC,IAAI,WACZ4F,EAAWtI,EAAM,YAsBrB,QAASuJ,GAAevJ,EAAMwI,GAC1B,GAAIxI,EAAKD,QAAQyJ,SAAU,CACvBxJ,EAAKD,QAAQyJ,SAASC,MAAMC,QAAU,OAG7C,IAAIC,IAAO,OAAQ,SAAU,QAAQ/B,QAAQgC,UAAUC,WAAa,CAEhEF,IACP3J,EAAKD,QAAQyJ,SAASM,aAAa,eAAe,GAI5C,GAAIC,GAAU/J,EAAKD,QAAQiK,QAC3BvH,SAAQC,IAAI,gBAAiB8F,EAAQuB,GAE5CE,uBAAuBF,EAASvB,GAKzBxI,EAAKkK,aAAe1B,EACpBC,EAAsBzI,EAAMwI,GAGhC,QAAS2B,GAAWnK,EAAMoJ,GACtBpJ,EAAK4I,UAAUS,IAAMrJ,EAAKsJ,WAAWF,EAAIA,KACzC3G,QAAQC,IAAI,aACZ4F,EAAWtI,EAAM,cAwMrB,QAASoK,GAAeC,GAE3B,GAAIC,EAEAD,GAAItK,QAAQwK,QAAiC,SAAvBF,EAAItK,QAAQwK,QAClC9H,QAAQC,IAAI,uBACZ4H,GAAQ,GACDD,EAAItK,QAAQyK,aAAeH,EAAItK,QAAQ0K,aAC9ChI,QAAQU,MAAM,eAAgBkH,EAAItK,QAAQyK,aAC1CF,GAAQ,IAERA,KAGID,EAAItK,QAAQ2K,cACZJ,EAAQD,EAAItK,QAAQ2K,aAGG,QAAvBL,EAAItK,QAAQwK,SAEnBD,EAAMK,SAAWC,EAA0BP,EAAItK,QAAQwK,UAIjDF,EAAItK,QAAQyJ,UAAYa,EAAItK,QAAQ8K,aAAeR,EAAItK,QAAQ+K,WAC3DC,GACVC,aACkBV,OAAO,EACPW,OAASN,SAAUN,EAAItK,QAAQmL,YAE3CL,WAAYR,EAAItK,QAAQ8K,WACxBM,eAAgBd,EAAItK,QAAQoL,eAC5BC,YAAaf,EAAItK,QAAQqL,YAC/BC,UAAW,SAAS7I,GAAI6H,EAAItK,QAAQuL,iBAAmB9I,EAAGC,QAAQC,IAAI,sBACtE6I,QAAS,SAAS/I,GAAIC,QAAQU,MAAM,qBAAsBX,KAI3D,IAAIyI,MACAO,EAAgBnB,EAAItK,QAAQyK,YAAYiB,mBACxCC,EAAerB,EAAItK,QAAQyK,YAAYkB,cAAgB,EAG3D,UAFOrB,GAAItK,QAAQyK,YAAYiB,mBAE3BpB,EAAItK,QAAQ0K,YACZ,IAAKJ,EAAItK,QAAQmL,WAAetB,UAAU+B,gBAAiB,CAE9D,GAAIC,GAAQlN,OAAOmN,QAAQ,sFAE3BZ,IACIa,OAAQC,IAAK1B,EAAItK,QAAQyK,YAAYwB,SAAUpM,IAAKyK,EAAItK,QAAQyK,YAAYyB,UAC5EC,QAASH,IAAK1B,EAAItK,QAAQyK,YAAY2B,UAAWvM,IAAKyK,EAAItK,QAAQyK,YAAY4B,WAC9EC,YAAaT,EAAQ,SAAW,cAE1B,CACV,GAAIU,KACAjC,GAAItK,QAAQmL,WACZoB,EAAI7G,MAAM8G,SAAUlC,EAAItK,QAAQmL,YAGhCM,IACAc,EAAI7G,MAAMiG,aAAcF,IACxBc,EAAI7G,MAAM+G,aAAchB,KAG5BP,GACIwB,UAAWpC,EAAItK,QAAQyK,YACvBkC,SAAUJ,OAGR,CAEHrB,GAEHa,OAAQC,IAAK1B,EAAItK,QAAQyK,YAAYwB,SAAUpM,IAAKyK,EAAItK,QAAQyK,YAAYyB,UAC5EC,QAASH,IAAK1B,EAAItK,QAAQyK,YAAY2B,UAAWvM,IAAKyK,EAAItK,QAAQyK,YAAY4B,WAK3E,IAAI5C,GAAWa,EAAItK,QAAQyJ,QAEvBA,IAAYa,EAAItK,QAAQmL,WAAuC,SAA1Bb,EAAItK,QAAQmL,WAM1B,QAA1Bb,EAAItK,QAAQmL,YAEVD,EAAQL,EAA0BP,EAAItK,QAAQmL,UAAWD,IAG3DO,IAGAP,EAAM0B,WAAaC,MAAOpB,EAAeO,IAAKL,EAAc9L,IAAK,OAIrE6C,QAAQC,IAAI,mBACZuI,GAAQ,EACRzB,GAAW,GAIZ,OAAQc,MAAOA,EAAOW,MAAOA,EAAOzB,SAAUA,GAwG3C,QAASqD,GAAoB9M,GAyBhC,QAAS+M,KAELC,GAAO,EACPC,EAAY,KAEDjN,EAAQkJ,eACRlJ,EAAQkJ,gBAGQ,SAAhBlJ,EAAQ8C,KACR9C,EAAQoJ,SAAS8D,EAAKC,mBAEjBlO,GAAKe,EAAQoJ,UACdpJ,EAAQoJ,SAAS8D,EAAKC,kBAqElC,QAASC,KACApN,EAAQoK,YAEb8C,EAAKE,YAAY,SAASC,GACtBA,EAAmBhE,IAAMiE,EAAaD,EAAmBhE,KACzD6D,EAAKK,oBAAoBF,GACzBrN,EAAQoK,WAAWiD,IAE/BG,EAAYxN,EAAQiL,aAIhB,QAASwC,KACe,UAAhBzN,EAAQ8C,OAGZoK,EAAKQ,qBAAqB,GAAI/O,QAAOgP,sBAAsB3N,EAAQ4N,UAAWC,EAAcL,GAC5FN,EAAKO,aAAa,SAASJ,GACvBA,EAAmBhE,IAAMiE,EAAaD,EAAmBhE,KACzD6D,EAAKK,oBAAoBF,GACrBrN,EAAQ8N,aACR9N,EAAQ8N,YAAYT,IAG5BG,IA0CJ,QAASF,GAAajE,GAClB,MAAOA,GAMX,QAAS0E,KACA/N,EAAQgO,kBAEbC,IAKJ,QAASA,KACLC,EAAUhB,EAAKiB,kBAAkBnO,EAAQkO,SAAW,kBAChDE,UAAU,IAGdC,IAGJ,QAASA,KACLH,EAAQ7N,UAAY,SAASrB,GACrBgB,EAAQgO,kBAAkBhO,EAAQgO,iBAAiBhP,IAG3DkP,EAAQ/I,OAAS,WACTnF,EAAQsO,iBAAiBtO,EAAQsO,gBAAgBJ,IAEzDA,EAAQ5J,QAAU,SAAStF,GACnBgB,EAAQuO,iBAAiBvO,EAAQuO,gBAAgBvP,GAErD0D,QAAQ8L,KAAK,4BAA6BxP,IAE9CkP,EAAQ1C,QAAU,SAASxM,GACnBgB,EAAQmJ,gBAAgBnJ,EAAQmJ,eAAenK,GAEnD0D,QAAQU,MAAM,2BAA4BpE,IAmBlD,QAAS6O,MAET,QAASL,GAAW/K,GACZzC,EAAQmJ,gBACRnJ,EAAQmJ,eAAe1G,GAE3BC,QAAQU,MAAM,aAAcX,GA5OvC,GAAIwK,IAAY,EAAOD,GAAO,EAC1ByB,KACOC,IAAiBC,MAAO,iCAExB1O,MAAKD,QAAQ4O,YACfF,EAAYhJ,KAAKzF,KAAKD,QAAQ4O,YAG5B5O,EAAQ6O,aAC2B,iBAAxB7O,GAAkB,WACvCyO,EAAOI,WAAaH,EAEpBD,EAAOI,WAAa7O,EAAQ6O,YAI7BJ,EAAOK,aAAe,aACtBL,EAAOM,aAAe,QAEf,IAAI7B,GAAO,GAAIvO,QAAOqQ,kBAAkBP,EAExCV,IACA,IAAI9O,GAAI,CA0DR,IAtCAiO,EAAK+B,eAAiB,SAASjQ,GAE9BgO,IAICC,IACRA,EAAY/H,WAAW6H,EAAa,MAG7B/N,EACHA,EAAM4J,WACN5I,EAAQ2I,MAAM3J,EAAM4J,YAGxBoE,GAAO,EAEHC,IACArI,aAAaqI,GACbA,EAAY,MAGhBF,OAKU/M,EAAQkP,eAIVlP,EAAQkP,aAAaC,iBAAiBC,QAAQ,SAASC,GAASnC,EAAKoC,SAASD,EAAOrP,EAAQkP,gBAC7FlP,EAAQkP,aAAaK,iBAAiBH,QAAQ,SAASC,GAASnC,EAAKoC,SAASD,EAAOrP,EAAQkP,iBAM3FlP,EAAQwP,eAAiBxP,EAAQwP,cAAclQ,OAE/C,IAAK,GADDmQ,GAAUzP,EAAQwP,cACbhQ,EAAI,EAAGA,EAAIiQ,EAAQnQ,OAAQE,IAChC0N,EAAKwC,UAAUD,EAAQjQ,GAK/B0N,GAAKyC,QAAU,SAAS3Q,GACpB0D,QAAQC,IAAI,aAAc3D,EAE1B,IAAI4Q,GAAoB5Q,EAAMyQ,QAAQ,EAEtCG,GAAkBC,WAAa,WACvB7P,EAAQ8P,qBAAqB9P,EAAQ8P,oBAAoBF,IAG7D5P,EAAQwJ,gBAAgBxJ,EAAQwJ,eAAeoG,KAqClD5P,EAAwB,mBAAMA,EAAQgO,oBACvCZ,IACAK,IAyCJ,IAAIS,EA8DJ,QACI6B,aAAc,SAAS1G,EAAK2G,EAAWC,GAEnC/C,EAAKQ,qBAAqB,GAAI/O,QAAOgP,sBAAsBtE,GAAM2G,EAAYA,EAAYnC,EAAcoC,EAAUA,EAAUzC,IAE/H0C,OAAQ,SAAStH,GACbsE,EAAKiD,gBAAgB,GAAIxR,QAAOyR,iBAC5BC,cAAezH,EAAUyH,cACzBzH,UAAWA,EAAUA,cAI7BsE,KAAMA,EACNgB,QAASA,EACToC,SAAU,SAASC,GACXrC,GACAA,EAAQvM,KAAK4O,IAIrBC,KAAM,WACF,GAAIxQ,EAAQkP,uBAAwBuB,aAAa,CAC7C,GAAIC,GAAS1Q,EAAQkP,aAAayB,WAClCD,GAAOtB,QAAQ,SAASC,GAAQA,EAAMmB,SACtCxQ,EAAQkP,aAAe,KAE3BhC,EAAK1I,UAWnB,QAASoM,GAAmBC,EAAIpI,GAC9BoI,EAAGC,UAAYrI,EACfoI,EAAGnH,MAAMC,QAAU,QAGrB,QAASoH,GAAqBF,GAC5BA,EAAGC,UAAY,KACfD,EAAGnH,MAAMC,QAAU,OAGnB,QAASqH,GAAwBC,EAAYC,GACzC,GAAsBhK,SAAlBgK,GAA8ChK,SAAf+J,EAC/B,MAAOE,SAAQC,QAAQH,EAG3B,IAAmC,kBAAzB,oBAEN,MADAvO,SAAQ8L,KAAK,gLACN2C,QAAQC,QAAQH,EAG3B,IAA2B,gBAAjB,KAA8BA,EAAWrG,SAC/C,MAAOuG,SAAQC,QAAQH,EAG3B,IAAIA,EAAWrG,SAAU,CACrB,GAAoC,gBAAzBqG,GAAmB,SAC1B,MAAO,IAAIE,SAAQ,SAASC,GACxBC,mBAAmBH,EAAeD,EAAWrG,UAAU0G,KAAK,SAAS9O,GACjE4O,EAAQG,OAAOC,UAAWP,GAAcrG,SAAUpI,OADtD6O,SAES,WACLD,EAAQH,MAKpB,IAAoC,gBAAzBA,GAAmB,UAAwD,gBAA/BA,GAAWrG,SAAc,MAC5E,MAAO,IAAIuG,SAAQ,SAASC,GACxBC,mBAAmBH,EAAeD,EAAWrG,SAAS6G,OAAOH,KAAK,SAAS9O,GACvE4O,EAAQvG,EAA0BrI,EAAIyO,MAD1CI,SAES,WACLD,EAAQH,OAMxB,MAAOE,SAAQC,QAAQH,GAG3B,QAASS,GAAmB1R,EAASiL,GACjCpB,UAAU8H,aAAa3G,aAAaC,GAAaqG,KAAK,SAAS7I,GACvDzI,EAAQ8K,YACR8F,EAAmB5Q,EAAQ8K,WAAYrC,GAGvCzI,EAAQsL,WACRtL,EAAQsL,UAAU7C,KAN1BoB,SAQS7J,EAAQwL,SAAW,SAAS/I,GACjCC,QAAQU,MAAMX,KAItB,QAASoI,GAA0B+G,EAASC,GACxC,MAAON,QAAOC,UAAWK,OAAcjH,UAAY6G,MAAOG,KAG9D,QAAS5G,GAAahL,GAClB,GAAIiL,GAAcjL,EAAQiL,cACtBV,OAAO,EACPW,MAAO4G,EAGXX,SAAQY,KACJf,EAAwB/F,EAAYV,MAAOvK,EAAQqL,aACnD2F,EAAwB/F,EAAYC,MAAOlL,EAAQoL,kBACpDkG,KAAK,SAASU,GACbN,EAAmB1R,GAAWuK,MAAOyH,EAAW,GAAI9G,MAAO8G,EAAW,OAJ1Eb,SAKS,SAAS/N,GACdV,QAAQU,MAAM,mDAAoDA,EAAO,WAAYpD,KAn8B7FF,EAAEmS,MAAQ,SAASjS,GACftB,KAAKsB,QAAUF,EAAEI,QACbuJ,SAAU,KACVyI,WAAW,EACXC,SAAU,KACjBrH,WAAY,KACZJ,aAAa,EACbS,UAAW,MACJ0D,YAAY,EACZpE,eACAE,eACA1B,WACIC,cAAe,aACfP,MAAO,aACPyB,WAAY,cAEtBW,UAAW,MACN/K,GAEVtB,KAAK0T,cAAe,EACpB1T,KAAK2T,cAAe,EAGb3T,KAAKmK,WACDS,IAAK,KACLgJ,WACAxJ,kBAGXpK,KAAKuM,aACDsH,oBAA+C,SAA1B7T,KAAKsB,QAAQwS,UAAsB,GAAQ,EAChEC,oBAAqB/T,KAAKsB,QAAQyJ,UAAW,GAAO,GAG7CxJ,KAAKD,QAAQyJ,WACbxJ,KAAKD,QAAQyJ,SAASC,MAAMC,QAAU,QAG1CvB,IACAC,KAGJvI,EAAEmS,MAAMS,YAER5S,EAAEmS,MAAMhR,UAAUwI,SAAW,SAASa,EAAKqI,GACvC,GAAI1S,GAAOvB,IAEP4L,IACArK,EAAKD,QAAQyJ,SAAWa,EAC/BrK,EAAKD,QAAQ8K,WAAa6H,EAC1B1S,EAAKgL,YAAYwH,qBAAsB,IAEhCxS,EAAKD,QAAQyJ,SAAW,KAC/BxJ,EAAKD,QAAQ8K,WAAa,KAC1B7K,EAAKgL,YAAYwH,qBAAsB,GAGhCxS,EAAKD,QAAQyJ,WACbxJ,EAAKD,QAAQyJ,SAASC,MAAMC,QAAU,SAI9C7J,EAAEmS,MAAMhR,UAAUiR,UAAY,SAASU,GACnC,GAAI3S,GAAOvB,IACXuB,GAAKD,QAAQkS,UAAYU,GAI7B9S,EAAEmS,MAAMhR,UAAUsI,WAAa,SAASF,GACpC,GAAIpJ,GAAOvB,IAEX,KAAKuB,EAAKD,QAAQkS,UACd,MAAO7I,EAGX,IAG8DwJ,GAH1DvL,EAAW+B,EAAIyJ,MAAM,QAGrBC,EAAY1L,EAASC,EAAU,WAAY,aAE/C,KAAKyL,EACR,MAAO1J,EAEAwJ,GAAc9K,EAAoBT,EAASyL,GAI/C,IAAIC,GAAgB3L,EAASC,EAAU,UAAYuL,EAAYI,WAW/D,OATsB,QAAlBD,EAEP1L,EAASyL,GAAazL,EAASyL,GAAa,cAAgBF,EAAYI,WAAa,4BAG9E3L,EAAS0L,GAAiB1L,EAAS0L,GAAeE,OAAO,8BAG7D7J,EAAM/B,EAAStF,KAAK,SAkExBkI,uBAAyB,SAASF,EAASvB,GACN,mBAAtBuB,GAAQ8G,UACtB9G,EAAQ8G,UAAYrI,EAEpB/F,QAAQU,MAAM,uCAkCftD,EAAEmS,MAAMhR,UAAUkS,OAAS,SAAS9J,EAAK+J,EAAWC,GAChD3U,KAAKwO,KAAK6C,cACNjN,KAAM,SACNuG,IAAKA,GAET+J,EAAWC,IAGfvT,EAAEmS,MAAMhR,UAAUqS,SAAW,WACrBrT,KAAKiN,OACLxK,QAAQC,IAAI,iBACZ1C,KAAKiN,KAAKsD,SAIlB1Q,EAAEmS,MAAMhR,UAAUuP,KAAO,WACrB,GAAIvQ,GAAOvB,IAOX,IALIuB,EAAKD,QAAQyJ,WACbxJ,EAAKD,QAAQyJ,SAASC,MAAMC,QAAU,OACtC1J,EAAKD,QAAQyJ,SAAc,IAAI,IAG/BxJ,EAAKsT,cAAgBtT,EAAKD,QAAQ+K,UAAW,CAC7C,GAAI2F,GAASzQ,EAAKsT,YAAY5C,WAC9BjO,SAAQC,IAAI,+BAAgC+N,GAC5CA,EAAOtB,QAAQ,SAASC,GAAQA,EAAMmB,SACtCvQ,EAAKsT,YAAc,KAOvB,GAJItT,EAAKD,QAAQ8K,YACbiG,EAAqB9Q,EAAKD,QAAQ8K,YAGlC7K,EAAKD,QAAQuL,mBAAqBtL,EAAKD,QAAQ+K,UAAW,CAC1D,GAAI2F,GAASzQ,EAAKD,QAAQuL,iBAAiBoF,WAC3CjO,SAAQC,IAAI,oCAAqC+N,GACjDA,EAAOtB,QAAQ,SAASC,GAAQA,EAAMmB,SAGtCvQ,EAAKiN,OACLxK,QAAQC,IAAI,iBACZ1C,EAAKiN,KAAKsD,SAIlB1Q,EAAEmS,MAAMhR,UAAUuS,QAAU,WAC/B,GAAIvT,GAAOvB,IACX,OAAOuB,GAAKmS,cAGTtS,EAAEmS,MAAMhR,UAAUwS,QAAU,SAASC,GACxC,GAAIzT,GAAOvB,IACR,KAAKuB,EAAKsT,YACN,OAAO,CAId,KAAK,GAFDI,GAAc1T,EAAKsT,YAAYpE,iBAE1B3P,EAAI,EAAGoU,EAAMD,EAAYrU,OAAYsU,EAAJpU,EAASA,IAAM,CACrD,OAAOkU,GACP,IAAK,KACRC,EAAYnU,GAAGqU,SAAU,CACzB,MACG,KAAK,MACRF,EAAYnU,GAAGqU,SAAU,CACzB,MACG,KAAK,SACRF,EAAYnU,GAAGqU,SAAWF,EAAYnU,GAAGqU,QAKtC5T,EAAKmS,aAAeuB,EAAYnU,GAAGqU,QAGvC,OAAQ5T,EAAKmS,cAGVtS,EAAEmS,MAAMhR,UAAU6S,aAAe,WACpC,GAAI7T,GAAOvB,IACX,OAAOuB,GAAKoS,cAGTvS,EAAEmS,MAAMhR,UAAU8S,aAAe,SAASL,GAC7C,GAAIzT,GAAOvB,IACR,KAAKuB,EAAKsT,YACN,OAAO,CAId,KAAK,GAFDS,GAAc/T,EAAKsT,YAAYhE,iBAE1B/P,EAAI,EAAGoU,EAAMI,EAAY1U,OAAYsU,EAAJpU,EAASA,IAAM,CACrD,OAAOkU,GACP,IAAK,KACRM,EAAYxU,GAAGqU,SAAU,CACzB,MACG,KAAK,MACRG,EAAYxU,GAAGqU,SAAU,CACzB,MACG,KAAK,SACRG,EAAYxU,GAAGqU,SAAWG,EAAYxU,GAAGqU,QAKtC5T,EAAKoS,aAAe2B,EAAYxU,GAAGqU,QAGvC,OAAQ5T,EAAKoS,cAGVvS,EAAEmS,MAAMhR,UAAUwM,aAAe,SAAStL,GAMtC,QAASiR,GAAU3K,GACfxI,EAAKsT,YAAc9K,EAEnBxI,EAAKiN,KAAOJ,GACRhK,KAAM7C,EAAK6C,KACXoM,aAAcjP,EAAKsT,YACnB5K,MAAO,SAASC,GACZ,MAAOD,GAAM1I,EAAM2I,IAEvBM,cAAe,WACX,MAAOA,GAAcjJ,IAEzBuJ,eAAgB,SAASf,GACrB,MAAOe,GAAevJ,EAAMwI,IAEhCW,SAAU,SAASC,GACf,MAAOD,GAASnJ,EAAMoJ,IAE1BF,eAAgB,SAAS1G,GACrB,MAAO0G,GAAelJ,EAAMwC,IAEhCwI,YAAahL,EAAKgL,YAClB4D,WAAY5O,EAAKD,QAAQ6O,WACzBjB,UACI9K,KAAM,QACNuG,IAAKpJ,EAAKgU,WAEdrF,WAAY3O,EAAKD,QAAQ4O,aAG7BpG,EAAgBvI,EAAMwI,GAG1B,QAAS4K,GAAQ5Q,GACb6F,EAAcrI,EAAMwC,GAvCxB,GAAIxC,GAAOvB,IACXuB,GAAK6C,KAAO,SACZ7C,EAAKgU,UAAY9R,EAAOkH,IACxB3G,QAAQwR,MAAM,gBAAiB/R,EAAOkH,IAuC7C,IAAI8K,GAAc9J,EAAepK,EAEjCyC,SAAQC,IAAI,oBAAqBwR,EAAY5J,OAC7C7H,QAAQC,IAAI,oBAAqBwR,EAAYjJ,OAEtCjL,EAAKD,QAAQyJ,UAAYxJ,EAAKD,QAAQ8K,aAAe7K,EAAKD,QAAQ+K,WAC9DC,GACVC,aACkBV,OAAO,EACPW,OAASN,SAAUzI,EAAOgJ,YAEtCL,WAAY7K,EAAKD,QAAQ8K,WACzBM,eAAgBnL,EAAKD,QAAQoL,eAC7BC,YAAapL,EAAKD,QAAQqL,YAChCC,UAAW,SAAS7I,GAAIxC,EAAKD,QAAQuL,iBAAmB9I,EAAGC,QAAQC,IAAI,sBACvE6I,QAAS,SAAS/I,GAAIC,QAAQU,MAAM,qBAAsBX,MAIpDxC,EAAKD,QAAQ+K,WACX9K,EAAKD,QAAQyJ,WACfxJ,EAAKD,QAAQuL,iBAAmBtL,EAAKD,QAAQ+K,UACzC9K,EAAKD,QAAQ8K,YACf8F,EAAmB3Q,EAAKD,QAAQ8K,WAAY7K,EAAKD,QAAQ+K,YAG7DqI,EAAUnT,EAAKD,QAAQ+K,YAGvBC,GACEC,aACEV,MAAO4J,EAAY5J,MACnBW,MAAOiJ,EAAYjJ,OAErBA,MAAOiJ,EAAY1K,SACnB2B,eAAgBnL,EAAKD,QAAQoL,eAC7BC,YAAapL,EAAKD,QAAQqL,YAC1BC,UAAW8H,EACX5H,QAAS6H,KAkHbvT,EAAEmS,MAAMhR,UAAUgB,KAAO,SAASqQ,GAY9B,QAASc,GAAU3K,GACtBxI,EAAKsT,YAAc9K,EAEf2L,IACPnU,EAAKgL,YAAYwH,qBAAsB,EACvCxS,EAAKgL,YAAYsH,qBAAsB,EACvCtS,EAAKgL,YAAYoJ,kBAAmB,GAG1BpU,EAAKiN,KAAOJ,GACRhK,KAAM7C,EAAK6C,KACXoM,aAAcjP,EAAKsT,YACnB5K,MAAO,SAASC,GACZ,MAAOD,GAAM1I,EAAM2I,IAEvBM,cAAe,WACX,MAAOA,GAAcjJ,IAEzBuJ,eAAgB4K,EAAS,SAAS3L,KAAa,SAASA,GACpD,MAAOe,GAAevJ,EAAMwI,IAEhC2B,WAAY,SAASf,GACjB,MAAOe,GAAWnK,EAAMoJ,IAE5BD,SAAU,SAASC,GACf,MAAOD,GAASnJ,EAAMoJ,IAE1BF,eAAgB,SAAS1G,GACrB,MAAO0G,GAAelJ,EAAMwC,IAEhCwI,YAAahL,EAAKgL,YAClB4D,WAAY5O,EAAKD,QAAQ6O,WACzBD,WAAY3O,EAAKD,QAAQ4O,aAG7BpG,EAAgBvI,EAAMwI,GAG1B,QAAS4K,GAAQ5Q,GACb6F,EAAcrI,EAAMwC,GAlDxB4F,GAEA,IAAIpI,GAAOvB,KACd0V,GAAS,CAENnU,GAAK6C,KAAO,QAEf7C,EAAKD,QAAQyK,aAAexK,EAAKD,QAAQ0K,cACzC0J,GAAS,EA6Cb,IAAID,GAAc9J,EAAepK,EAEjCyC,SAAQC,IAAI,oBAAqBwR,EAAY5J,OAC7C7H,QAAQC,IAAI,oBAAqBwR,EAAYjJ,OAEtCjL,EAAKD,QAAQ+K,WACX9K,EAAKD,QAAQyJ,WACfxJ,EAAKD,QAAQuL,iBAAmBtL,EAAKD,QAAQ+K,UACzC9K,EAAKD,QAAQ8K,YACf8F,EAAmB3Q,EAAKD,QAAQ8K,WAAY7K,EAAKD,QAAQ+K,YAG7DqI,EAAUnT,EAAKD,QAAQ+K,YAEhBoJ,EAAY5J,OAAS4J,EAAYjJ,MAClCF,GACVC,aACkBV,MAAO4J,EAAY5J,MACnBW,MAAOiJ,EAAYjJ,OAErCA,MAAOiJ,EAAY1K,SACnB6B,UAAW8H,EACL5H,QAAS6H,EACTjI,eAAgBnL,EAAKD,QAAQoL,eAC7BC,YAAapL,EAAKD,QAAQqL,cAI7B+H,EAAU,MAmSX,IAAItB,KAuFJhS,GAAEmS,MAAMqC,aAAe,SAAS/P,EAAGgQ,GACtC,IAAK,GAAI/U,KAAKM,GAAEmS,MAAMS,SAClB,GAAI5S,EAAEmS,MAAMS,SAASlT,GAAG,IAAM+E,GAAKzE,EAAEmS,MAAMS,SAASlT,GAAG,IAAM+U,EAChE,OAAO,CAIR,QAAO,GAGJzU,EAAEmS,MAAMuC,iBAAmB,WAC9B,GAAIjQ,GAAI,EAAGgQ,EAAI,CAEf,KAAK,GAAI/U,KAAKM,GAAEmS,MAAMS,SACd5S,EAAEmS,MAAMS,SAASlT,GAAG,IAAM+E,GAAKzE,EAAEmS,MAAMS,SAASlT,GAAG,IAAM+U,IAChEhQ,EAAIzE,EAAEmS,MAAMS,SAASlT,GAAG,GACxB+U,EAAIzU,EAAEmS,MAAMS,SAASlT,GAAG,GAIzB,QAAQ+E,EAAGgQ,GAGR,IAAIE,KAAY,IAAK,MAAO,IAAK,MAAO,IAAK,MAAO,IAAK,MAAO,IAAK,MAAO,KAAM,MAAO,KAAM,OAC3FC,EAAO,EACPC,EAAM,EAENC,EAAW,SAAUC,EAAK9L,GAEjC,GAAI2L,GAAQD,EAAQnV,OAApB,CACW,GAAIwV,IACDpC,SAAY5S,EAAEmS,MAAMS,SACpB8B,iBAAoB1U,EAAEmS,MAAMuC,mBAKtC,IAFAO,aAAaC,QAAQ,OAASH,EAAK/U,EAAEkD,OAAO8R,IAExC/L,EAAM,MAAOA,GAAK+L,OAR1B,CAYAvQ,EAAIkQ,EAAQC,GAAM,GAClBH,EAAIE,EAAQC,GAAM,GAClBA,GAEA,IAAIxJ,IACAa,OAAQ0F,MAAOlN,GACf4H,QAASsF,MAAO8C,GAGP,SAARM,IACF3J,EAAQL,EAA0BgK,EAAK3J,IAGtCF,GACAC,aAAeV,MAAgB,GAAToK,IAAYzJ,MAAOA,GACzCI,UAAW,SAAS7I,GACbA,EAAEkO,YAAYvB,QAAQ,SAASC,GAASA,EAAMmB,SAC9C9N,QAAQ+D,KAAKlC,EAAI,IAAMgQ,EAAI,eAAgBzU,EAAEmS,MAAMS,SAAShN,MAAMnB,EAAGgQ,IAAKK,EAASC,EAAK9L,IAE/FyC,QAAS,SAAS/I,GAAIC,QAAQ8L,KAAMjK,EAAI,IAAMgQ,EAAI,mBAAoBK,EAASC,EAAK9L,OAKrFjJ,GAAEmS,MAAMgD,YAAc,SAAUJ,EAAK9L,GACxC,GACImM,GAASH,aAAaI,QAAQ,OAASN,EAE3C,IAAIK,EAAQ,CACR,GAAIhS,GAAQpD,EAAE4D,UAAUwR,EAQxB,OANIhS,IACPpD,EAAEmS,MAAMS,SAAWxP,EAAMwP,SACzBhQ,QAAQC,IAAI,sBAAwBkS,EAAK3R,IAEzCR,QAAQU,MAAM,iBAEJ2F,EAAOA,EAAK7F,GAAS,KAIhCpD,EAAEmS,MAAMS,YACRgC,EAAO,EAEPE,EAASC,EAAK9L,IAGXjJ,EAAEmS,MAAMmD,WAAa,SAAUC,EAASC,EAAaC,GACjDvK,GACIC,aAAeV,MAAO+K,EAAapK,MAAOqK,GAC1CjK,UAAW,SAAS7I,GAChBA,EAAEkO,YAAYvB,QAAQ,SAASC,GAASA,EAAMmB,SAC9C9N,QAAQ+D,KAAK,4BACT4O,GACAnQ,WAAWmQ,EAAS,KAAK,IAGjC7J,QAAS,SAAS/I,GACd,MAAI8S,IAAeD,GACf5S,QAAQU,MAAM,2CACPtD,EAAEmS,MAAMmD,WAAWC,EAASC,GAAa,KAEpD5S,QAAQU,MAAM,8BACViS,GACAA,GAAQ,UAMzBjO,QAkCH,SAAUtH,GAyON,QAAS0V,GAASC,EAAOvH,GACrBxL,QAAQU,MAAM,8BAAgC8K,SACvCuH,GAAMC,UAAUxH,GAG3B,QAASyH,GAAWF,EAAOvH,GACvB,IAAK,GAAI0H,KAAKH,GAAMC,UAAUxH,GAC1BuH,EAAMC,UAAUxH,GAAS0H,GAAGC,OAAQ,EACpCnT,QAAQC,IAAI,0BAA4BuL,GACpCuH,EAAMC,UAAUxH,GAAS0H,GAAGE,cAC5BL,EAAMC,UAAUxH,GAAS0H,GAAGE,aAAaL,EAAOvH,GAO5D,QAAS6H,GAAaN,EAAOvH,EAAS8H,EAAaC,GAC/C,GAAI9T,GAAS8T,MAETtD,EAAQxQ,EAAOwQ,MAEfrI,GACA4L,aAAchI,EACdiE,SAAUhQ,EAAOgQ,SACjBgE,QAAShU,EAAOgU,QAChBN,OAAO,EACPC,aAAc3T,EAAO2T,aACrBM,MAAOC,KAGPC,GAAQ,CAsBZ,OApBKb,GAAMC,UAAUxH,KACjBuH,EAAMC,UAAUxH,MAChB8H,EAAYtQ,KAAKwI,GACjBoI,GAAQ,GAGZb,EAAMC,UAAUxH,GAASxI,KAAK4E,GAE1BqI,IACArI,EAAIuL,OAAQ,EACZvL,EAAIqI,OAAQ,IAGX2D,GAASb,EAAMC,UAAUxH,GAAS,GAAG2H,QACtCvL,EAAIuL,OAAQ,EACRvL,EAAIwL,cACJxL,EAAIwL,aAAaL,EAAOvH,KAK5BkI,MAAO9L,EAAI8L,MACXF,aAAchI,GAk+BtB,QAASqI,KACLzW,EAAE2V,MAAMe,KAAKvV,UAAUwV,iBAAmB,WACtC/X,KAAKgY,WAAW,oBAAqB,KAAM,OAG/C5W,EAAE2V,MAAMe,KAAKvV,UAAU0V,KAAO,SAASC,GACnClY,KAAKgY,WAAW,OAAQ,KAAME,IAGlC9W,EAAE2V,MAAMe,KAAKvV,UAAUuP,KAAO,WAC1B9R,KAAKgY,WAAW,OAAQ,KAAM,QAGlC5W,EAAE2V,MAAMe,KAAKvV,UAAU4V,KAAO,SAASC,GACnCpY,KAAKgY,WAAW,OAAQvQ,SAAS2Q,KAGrChX,EAAE2V,MAAMe,KAAKvV,UAAU8V,OAAS,SAASD,GACrCpY,KAAKgY,WAAW,SAAUvQ,SAAS2Q,KAGvChX,EAAE2V,MAAMe,KAAKvV,UAAU+V,OAAS,SAASJ,GACrClY,KAAKgY,WAAW,YAAa,MAAO,QAASE,KAGjD9W,EAAE2V,MAAMe,KAAKvV,UAAUgW,WAAa,WAChCvY,KAAKgY,WAAW,YAAa,MAAO,OAAQ,SAGhD5W,EAAE2V,MAAMe,KAAKvV,UAAUiW,SAAW,SAASN,GACvC,IAAKlY,KAAKyD,OAAOgV,OACb,KAAM,yBAEVzY,MAAKgY,WAAW,gBAAiB,KAAME,IAG3C9W,EAAE2V,MAAMe,KAAKvV,UAAUmW,eAAiB,SAASC,EAAQC,GACrD,IAAK5Y,KAAKyD,OAAOgV,OACb,KAAM,yBAEbG,GACP5Y,KAAKgY,WAAW,aAAc,MAAOW,EAAQC,IAE7C5Y,KAAKgY,WAAW,aAAc,KAAMW,IAI9BvX,EAAE2V,MAAMe,KAAKvV,UAAUsW,KAAO,SAAST,GACnCpY,KAAKgY,WAAW,OAAQvQ,SAAS2Q,KAGrChX,EAAE2V,MAAMe,KAAKvV,UAAUuW,QAAU,SAASV,GACtCpY,KAAKgY,WAAW,QAASvQ,SAAS2Q,KAGtChX,EAAE2V,MAAMe,KAAKvV,UAAUwW,UAAY,SAASX,GACxC,IAAKpY,KAAKyD,OAAOgV,OACb,KAAM,yBAEVzY,MAAKgY,WAAW,SAAUvQ,SAAS2Q,KAGvChX,EAAE2V,MAAMe,KAAKvV,UAAUyW,UAAY,SAASZ,GACxC,IAAKpY,KAAKyD,OAAOgV,OACb,KAAM,yBAEVzY,MAAKgY,WAAW,aAAcvQ,SAAS2Q,GAAW,cAGtDhX,EAAE2V,MAAMe,KAAKvV,UAAU0W,WAAa,SAASb,GACzC,IAAKpY,KAAKyD,OAAOgV,OACb,KAAM,yBAEVzY,MAAKgY,WAAW,YAAavQ,SAAS2Q,GAAW,UAGrDhX,EAAE2V,MAAMe,KAAKvV,UAAU2W,OAAS,SAASd,EAAUe,GAC/C,IAAKnZ,KAAKyD,OAAOgV,OACb,KAAM,yBAEVzY,MAAKgY,WAAW,aAAcvQ,SAAS2Q,GAAWgB,OAAOD,KAG7D/X,EAAE2V,MAAMe,KAAKvV,UAAU8W,WAAa,SAASjB,GACzCpY,KAAKgY,WAAW,aAAcvQ,SAAS2Q,GAAW,SAGtDhX,EAAE2V,MAAMe,KAAKvV,UAAU+W,SAAW,SAASlB,GACvCpY,KAAKgY,WAAW,aAAcvQ,SAAS2Q,GAAW,OAGtDhX,EAAE2V,MAAMe,KAAKvV,UAAUgX,SAAW,SAASnB,GACvCpY,KAAKgY,WAAW,YAAavQ,SAAS2Q,GAAW,SAGrDhX,EAAE2V,MAAMe,KAAKvV,UAAUiX,OAAS,SAASpB,GACrCpY,KAAKgY,WAAW,YAAavQ,SAAS2Q,GAAW,OAGrDhX,EAAE2V,MAAMe,KAAKvV,UAAUkX,SAAW,SAASrB,EAAUsB,GACjD1Z,KAAKgY,WAAW,WAAYvQ,SAAS2Q,GAAWsB,IAGpDtY,EAAE2V,MAAMe,KAAKvV,UAAUoX,SAAW,SAAS9H,EAASzN,GAChD,GAAI0T,GAAO9X,IACX8X,GAAKf,MAAM6C,UAAUrW,KAAK,mBACtBiU,aAAgBM,EAAKrU,OAAOoW,OAAOC,YACnC1W,MACI2W,OAAU,OACVlI,QAAWA,EACXzN,KAAQA,MAiuBxB,QAAS4V,GAAiBC,EAAMC,GAE5B,MAAIA,IAAQ9Y,EAAE2V,MAAF3V,QAAa+Y,MAAMC,OAAShZ,EAAE2V,MAAF3V,QAAaiZ,OAAOJ,EAAKK,MAAMJ,EAAKI,OACjE,GAGJ,EAKX,QAASC,GAAUzW,GACtB,IAAK,GAAIhD,KAAKM,GAAE2V,MAAMyD,gBAAiB,CACnC,GAAIC,GAASrZ,EAAE2V,MAAMyD,gBAAgB1Z,EACrC,IAAI2Z,EAAO3W,KAAOA,EACrB,MAAO2W,GAAY,MAIpB,MAAO3W,GAnmEJ,GAEI4W,GAA0C,mBAAnBza,QAAa,QAA+D,mBAAnCA,QAAO0a,OAAsB,gBACjG,WAGI,GAAIna,GAAM,GAAIoa,aAAY,EAC1B3a,QAAO0a,OAAOE,gBAAgBra,EAC9B,IAAIsa,GAAK,SAASC,GAEd,IADA,GAAIC,GAAMD,EAAIxG,SAAS,IAChByG,EAAIpa,OAAS,GAChBoa,EAAM,IAAMA,CAEhB,OAAOA,GAEX,OAAQF,GAAGta,EAAI,IAAMsa,EAAGta,EAAI,IAAM,IAAMsa,EAAGta,EAAI,IAAM,IAAMsa,EAAGta,EAAI,IAAM,IAAMsa,EAAGta,EAAI,IAAM,IAAMsa,EAAGta,EAAI,IAAMsa,EAAGta,EAAI,IAAMsa,EAAGta,EAAI,KAKtI,WAGI,MAAO,uCAAuCya,QAAQ,QAAS,SAASC,GACpE,GAAIC,GAAoB,GAAhBpa,KAAKqa,SAAgB,EAC7BC,EAAS,KAALH,EAAWC,EAAS,EAAJA,EAAU,CAC9B,OAAOE,GAAE9G,SAAS,MAK1BnT,GAAE2V,MAAQ,SAASzV,EAASiJ,GACxB,GAAIwM,GAAQ/W,IAEZoB,GAAE2V,MAAMuE,MAAMtU,KAAK+P,GAEnBA,EAAMzV,QAAUF,EAAEI,QACdI,MAAO,KACPC,OAAQ,KACRH,UAAW,KACX6Z,IAAK,KACZC,SAAU,KACHzP,eACAE,eACPlK,eACA0Z,cAAeC,WAAY,MAC3B1Z,iBACOmO,YAAY,EACZwL,UAAW,IACjB7Z,OAAQ,KACRuK,UAAW,MACN/K,GAENyV,EAAMzV,QAAQma,aAAahP,WAC3BrL,EAAEmS,MAAMgD,YAAYQ,EAAMzV,QAAQma,aAAahP,UAAWsK,EAAMzV,QAAQma,aAAaC,YAGpF3E,EAAMzV,QAAQma,aAAa3P,SAC5BiL,EAAMzV,QAAQma,aAAa3P,OAAS,OAGnCiL,EAAMzV,QAAQma,aAAa3H,WAC5BiD,EAAMzV,QAAQma,aAAa3H,SAAW,OAGtCiD,EAAMzV,QAAQQ,OACdiV,EAAMjV,OAASiV,EAAMzV,QAAQQ,QAEtBiV,EAAMjV,OAASuU,aAAaI,QAAQ,uBAAyBiE,IACpErE,aAAaC,QAAQ,qBAAsBS,EAAMjV,SAG9CiV,EAAM6E,WACN7E,EAAMxM,UAAYA,MAClBwM,EAAMC,aAEND,EAAM6C,UAAY,GAAIxY,GAAEC,eACpBO,MAAOmV,EAAMzV,QAAQM,MACrBC,OAAQkV,EAAMzV,QAAQO,OACtBH,UAAWqV,EAAMzV,QAAQI,UACzB6E,cAAewQ,EAAMzV,QAAQiF,cAC7B2J,WAAY6G,EAAMzV,QAAQ4O,WACjCnO,YAAagV,EAAMzV,QAAQS,YAC3BC,cAAe+U,EAAMzV,QAAQU,cACtBF,OAAQiV,EAAMjV,OACdH,UAAW,SAASoC,GAChB,MAAOgT,GAAM8E,cAAc9X,EAAEsD,YAEjCX,YAAa,SAASoV,GAClBA,EAAEvY,KAAK,aAEX6D,UAAW,SAAS3C,GACZsS,EAAMxM,UAAUnD,WAChB2P,EAAMxM,UAAUnD,UAAU2P,EAAOtS,IAGzC6B,UAAW,SAAS7B,GACZsS,EAAMxM,UAAUjE,WAChByQ,EAAMxM,UAAUjE,UAAUyQ,EAAOtS,GAErCsS,EAAMqD,UAId,IAAImB,GAAMxE,EAAMzV,QAAQia,GACJ,mBAAV,KACRA,EAAMA,KAGJxE,EAAMzV,QAAQya,UAAYhF,EAAMzV,QAAQia,MACxCxE,EAAMiF,OAAS5a,EAAE,IAAMma,IAG3BxE,EAAM6C,UAAUrW,KAAK,aAKzBnC,EAAE2V,MAAMxU,UAAUkZ,aAAe,SAAS7P,GACtC,GAAImL,GAAQ/W,IAEnB,KAAK,GAAIc,KAAK8K,GACHmL,EAAMzV,QAAQma,aAAa3a,GAAK8K,EAAI9K,EAG3C8K,GAAIa,WACJrL,EAAEmS,MAAMgD,YAAYQ,EAAMzV,QAAQma,aAAahP,UAAWb,EAAMA,EAAI8P,WAAalT,SAIlFpH,EAAE2V,MAAMxU,UAAUwJ,YAAc,SAASH,GACrC,GAAImL,GAAQ/W,IAEnB,KAAK,GAAIc,KAAK8K,GACHmL,EAAMzV,QAAQyK,YAAYjL,GAAK8K,EAAI9K,IAI3CM,EAAE2V,MAAMxU,UAAU4N,WAAa,SAASvE,GACpC,GAAImL,GAAQ/W,IACZ+W,GAAMzV,QAAQ6O,WAAavE,GAG/BxK,EAAE2V,MAAMxU,UAAUwD,UAAY,SAAStC,GAC1C,GAAIsT,GAAQ/W,IACL+W,GAAMzV,QAAQM,MAAQ6B,EAAO7B,MAC7BmV,EAAMzV,QAAQO,OAAS4B,EAAO5B,OAC9BkV,EAAM6C,UAAU7T,UAAUtC,IAG9BrC,EAAE2V,MAAMxU,UAAU0Z,OAAS,SAAS1U,GAChC,GAAIwP,GAAQ/W,IACZ+W,GAAM6C,UAAUjU,cACZoR,EAAMxM,UAAUjE,WAChByQ,EAAMxM,UAAUjE,UAAUyQ,GAAO,GAErCA,EAAMqD,SAGVhZ,EAAE2V,MAAMxU,UAAUX,MAAQ,SAAS2F,GAC/B,GAAIwP,GAAQ/W,IACZ+W,GAAMkF,SACNlF,EAAM6C,UAAUrW,KAAK,aAGzBnC,EAAE2V,MAAMxU,UAAUsP,QAAU,SAAStK,GACjC,GAAIwP,GAAQ/W,KACRkF,EAAM,CAYV,OAVKqC,GAAItB,KACLjC,QAAQU,MAAM,cACdQ,KAGCqC,EAAI2U,OACLlY,QAAQU,MAAM,gBACdQ,KAGAA,GACO,GAGX6R,EAAMoF,WAAW,cACb5U,IAAKA,KAGF,IAGXnG,EAAE2V,MAAMxU,UAAU6Z,aAAe,SAAS5Y,EAAQiB,EAASV,GACvD,GACIjD,GADAiW,EAAQ/W,IAKZ,QAAQwD,GACR,IAAK,kBACD,IAAK1C,IAAKiD,GAAEsY,qBACRvF,EAASC,EAAOhT,EAAEsY,qBAAqBvb,GAE3C,KAAKA,IAAKiD,GAAEuY,mBACRrF,EAAWF,EAAOhT,EAAEuY,mBAAmBxb,GAG3C,MACJ,KAAK,uBAMTM,EAAE2V,MAAMxU,UAAU4Z,WAAa,SAAS3Y,EAAQC,GAC5C,GAAIsT,GAAQ/W,IAEZ+W,GAAM6C,UAAUrW,KAAKC,EAAQC,EAE7B,SAASM,GAELgT,EAAMqF,aAAa5Y,GAAQ,EAAMO,IAGrC,SAASA,GAELgT,EAAMqF,aAAa5Y,GAAQ,EAAOO,KAuB1C,IAAI4T,GAAQ,CA6CZvW,GAAE2V,MAAMxU,UAAUga,UAAY,SAAS/M,EAAS+H,GAC5C,GAAIR,GAAQ/W,KACRmb,KACA7D,KACA7T,EAAS8T,KAEb,IAAwB,gBAAd,GACN4D,EAAEnU,KAAKqQ,EAAaN,EAAOvH,EAAS8H,EAAa7T,QAEjD,KAAK,GAAI3C,KAAK0O,GACV2L,EAAEnU,KAAKqQ,EAAaN,EAAOvH,EAAS8H,EAAa7T,GAWzD,OAPI6T,GAAY1W,QACZmW,EAAMoF,WAAW,mBACb3E,aAAoC,GAAtBF,EAAY1W,OAAc0W,EAAY,GAAKA,EACzDkF,UAAW/Y,EAAO+Y,YAInBrB,GAGX/Z,EAAE2V,MAAMxU,UAAUka,YAAc,SAASC,GACrC,GACI5b,GADAiW,EAAQ/W,IAGZ,IAAK0c,EAME,CACH,GAEIlN,GAFAmN,KACAC,IAGJ,IAAsB,gBAAZ,SACC7F,GAAMC,UAAU0F,GACvBC,EAAcD,SAEd,KAAK5b,IAAK4b,GACN,GAAyB,gBAAdA,GAAO5b,GACd0O,EAAUkN,EAAO5b,SACViW,GAAMC,UAAUxH,GACvBmN,EAAcnN,SACX,CACH,GAAIqN,KACJrN,GAAUkN,EAAO5b,GAAG0W,YAEpB,KAAK,GAAIN,KAAKH,GAAMC,UAAUxH,GACtBuH,EAAMC,UAAUxH,GAAS0H,GAAGQ,OAASgF,EAAO5b,GAAG4W,OAC/CmF,EAAK7V,KAAK+P,EAAMC,UAAUxH,GAAS0H,GAI3CH,GAAMC,UAAUxH,GAAWqN,EAEa,IAApC9F,EAAMC,UAAUxH,GAAS5O,eAClBmW,GAAMC,UAAUxH,GACvBmN,EAAcnN,MAM9B,IAAK,GAAIsN,KAAKH,GACV3Y,QAAQC,IAAI,4BAA6B6Y,GACzCF,EAAa5V,KAAK8V,EAGlBF,GAAahc,QACbmW,EAAMoF,WAAW,qBACb3E,aAAqC,GAAvBoF,EAAahc,OAAcgc,EAAa,GAAKA,QA9CnE,KAAK9b,IAAKiW,GAAMC,UACRD,EAAMC,UAAUlW,IAChBiW,EAAM0F,YAAY1F,EAAMC,UAAUlW,KAkDlDM,EAAE2V,MAAMxU,UAAUwa,UAAY,SAASvN,EAAS/L,GAC5C,GAAIsT,GAAQ/W,KACRuH,GACAiQ,aAAchI,EACdpM,QAEJ,KAAK,GAAItC,KAAK2C,GACV8D,EAAInE,KAAKtC,GAAK2C,EAAO3C,EAEzBiW,GAAMoF,WAAW,kBAAmB5U,IAGxCnG,EAAE2V,MAAMxU,UAAU6X,MAAQ,SAAS4C,GAC/B,GAEIlc,GAFAiW,EAAQ/W,KACRO,EAAI,CAGR,KAAKO,IAAKiW,GAAM6E,QACPrb,GACDyD,QAAQC,IAAI,mBAEhB1D,IACAwW,EAAM6E,QAAQ9a,GAAGmc,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMC,MAGjD,KAAKtZ,IAAKiW,GAAMC,UACRD,EAAMC,UAAUlW,KAChBkD,QAAQC,IAAI,yBAA2BnD,SAChCiW,GAAMC,UAAUlW,KAKnCM,EAAE2V,MAAMxU,UAAU2a,OAAS,SAASF,GAChC,GAAIjG,GAAQ/W,IACZ,IAAIgd,EAAQ,CACR,GAAIG,GAASpG,EAAM6E,QAAQoB,EAEvBG,IACAA,EAAOD,aAGX,KAAK,GAAIpc,KAAKiW,GAAM6E,QAChB7E,EAAM6E,QAAQ9a,GAAGoc,UAK7B9b,EAAE2V,MAAMxU,UAAU6a,QAAU,SAASC,EAAM9S,GACvC,GAAIwM,GAAQ/W,IAEZ,KAAK+W,EAAM6C,UAAUnU,cAEjB,WADAzB,SAAQU,MAAM,mBAId2Y,GAAgB,YAChBtG,EAAMzV,QAAQma,aAAwB,UAAI4B,EAAgB,UAC1DtG,EAAMzV,QAAQma,aAA6B,eAAI4B,EAAqB,eAGxE,IAAIF,GAAS,GAAI/b,GAAE2V,MAAMoG,OAAO/b,EAAE2V,MAAF3V,QAAakc,UAAUC,SAAUvd,KAAMqd,EAQvE,OANI9S,KACA4S,EAAO5S,UAAYA,GAGvB4S,EAAOK,SAEAL,GAGX/b,EAAE2V,MAAMxU,UAAUsZ,cAAgB,SAASzY,GACvC,GAAI2T,GAAQ/W,IAEZ,KAAMoD,IAAQA,EAAKI,OAEf,WADAQ,SAAQU,MAAM,eAAgBtB,EAIlC,IAAIA,EAAKK,OAAOuZ,OAAQ,CACpB,GAAIG,GAASpG,EAAM6E,QAAQxY,EAAKK,OAAOuZ,OAQvC,IANa,iBAAhB5Z,EAAKI,QAA6B2Z,UAClCA,GAAOpG,MAAM6E,QAAQuB,EAAOH,QACnCG,EAAOM,IAAI3L,OACXqL,EAAS,MAGKA,EAEA,OAAQ/Z,EAAKI,QACb,IAAK,YACD2Z,EAAOD,OAAO9Z,EAAKK,OACnB,MACJ,KAAK,eACD0Z,EAAOO,aAAata,EAAKK,OACzB,MACJ,KAAK,cACD0Z,EAAOQ,YAAYva,EAAKK,OACxB,MACJ,KAAK,gBACD0Z,EAAOS,cAAcxa,EAAKK,OAC1B,MACJ,KAAK,aACD0Z,EAAOU,WAAWza,EAAKK,OACvB,MACJ,SACIO,QAAQwR,MAAM,wDAAyD2H,EAAQ/Z,EAAKI,YAKxF,QAAQJ,EAAKI,QACb,IAAK,eACDJ,EAAKK,OAAOqa,QAAS,EAEjB1a,EAAKK,OAAOkH,KAAOvH,EAAKK,OAAOkH,IAAIxB,QAAQ,WAAa,IACxD/F,EAAKK,OAAOsH,UAAW,GAGvB3H,EAAKK,OAAOkH,KAAOvH,EAAKK,OAAOkH,IAAIxB,QAAQ,YAAc,IACzD/F,EAAKK,OAAO+P,WAAY,GAG5B2J,EAAS,GAAI/b,GAAE2V,MAAMoG,OAAO/b,EAAE2V,MAAF3V,QAAakc,UAAUS,QAAShH,EAAO3T,EAAKK,QACxE0Z,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM6D,WAEnC,MACJ,KAAK,eAEG5a,EAAKK,OAAOkH,KAAOvH,EAAKK,OAAOkH,IAAIxB,QAAQ,WAAa,IACxD/F,EAAKK,OAAOwa,WAAY;AAGxB7a,EAAKK,OAAOkH,KAAOvH,EAAKK,OAAOkH,IAAIxB,QAAQ,YAAc,IACzD/F,EAAKK,OAAO+P,WAAY,GAG5B2J,EAAS,GAAI/b,GAAE2V,MAAMoG,OAAO/b,EAAE2V,MAAF3V,QAAakc,UAAUS,QAAShH,EAAO3T,EAAKK,OACxE,MACJ,SACIO,QAAQwR,MAAM,yDAKtB,OACIhS,OAAQJ,EAAKI,QAGjB,OAAQJ,EAAKI,QACb,IAAK,aACDuT,EAAMqD,QACpBrD,EAAMkF,QACN,MACU,KAAK,cACD,GAAIiC,GAAO,KACPC,EAAM,IAcV,IAZI/a,EAAKK,SACL0a,EAAM/a,EAAKK,OAAO+T,cAGlB2G,IACAD,EAAOnH,EAAMC,UAAUmH,GAElBD,IACDA,EAAOnH,EAAMC,UAAUmH,EAAI/J,MAAM,KAAK,OAIzC8J,GAAQC,GAAOA,IAAQpH,EAAMjV,OAC1BiV,EAAMxM,UAAU6T,WAChBrH,EAAMxM,UAAU6T,UAAUrH,EAAO,KAAM3V,EAAE2V,MAAF3V,QAAayQ,QAAQwM,SAAUjb,EAAKK,YAE5E,KAAKya,GAAQC,GAAOpH,EAAM6E,QAAQuC,GACrCpH,EAAM6E,QAAQuC,GAAKG,YAAYld,EAAE2V,MAAF3V,QAAayQ,QAAQwM,SAAUjb,EAAKK,YAChE,IAAKya,EAMR,IAAK,GAAIpd,KAAKod,GAAM,CAChB,GAAIK,GAAML,EAAKpd,EAEVyd,IAAQA,EAAIpH,MAENoH,EAAI9G,QACX8G,EAAI9G,QAAQV,EAAO3T,EAAKK,OAAQ8a,EAAI9K,UAC7BsD,EAAMxM,UAAUiU,QACvBzH,EAAMxM,UAAUiU,QAAQzH,EAAO3T,EAAKK,OAAQ8a,EAAI9K,UAEhDzP,QAAQC,IAAI,SAAUb,EAAKK,QAN3BO,QAAQU,MAAM,qBAAuByZ,EAAM,gBAT9CA,KACDA,EAAM,aAEVna,QAAQU,MAAM,6BAA+ByZ,EAAM,WAiBvD,MAEJ,KAAK,aACGpH,EAAMxM,UAAU6T,WAChBrH,EAAMxM,UAAU6T,UAAUrH,EAAO,KAAM3V,EAAE2V,MAAF3V,QAAayQ,QAAQ9J,KAAM3E,EAAKK,OAAO8D,KAGlFvD,QAAQwR,MAAM,iBAAmBpS,EAAKK,OAAO8D,IAAIkX,KAAMrb,EAAKK,OAAO8D,IAAI2U,KAEvE,MAEJ,KAAK,oBACGnF,EAAMxM,UAAU6T,WAChBrH,EAAMxM,UAAU6T,UAAUrH,EAAO,KAAM3V,EAAE2V,MAAF3V,QAAayQ,QAAQ6M,YAAatb,EAAKK,QAElFO,QAAQwR,MAAM,eAAgBpS,EAAKK,OACnC,MAEJ,SACIO,QAAQU,MAAM,wDAAyDtB,EAAKI,SAMxF,IAAImb,GAAY,SAASC,EAAOtE,GAI5B,IAAK,GAHDa,MACAjG,EAAM0J,EAAMhe,OAEPE,EAAI,EAAOoU,EAAJpU,EAASA,IACjB8d,EAAM9d,IAAMwZ,GACZa,EAAEnU,KAAK4X,EAAM9d,GAIrB,OAAOqa,IAGP0D,EAAY,WACZ,GAAIC,GAAM9e,KAEN+e,KACAH,IAEJE,GAAIE,QAAU,SAASC,GACnBL,EAAQK,CACR,IAAIpJ,GAAIkJ,CACRA,KAIA,KAAK,GAFD7J,GAAM0J,EAAMhe,OAEPE,EAAI,EAAOoU,EAAJpU,EAASA,IAAK,CAC1B,GAAIqd,GAAMS,EAAM9d,EACZ+U,GAAEsI,KACFY,EAAKZ,GAAOtI,EAAEsI,SACPtI,GAAEsI,IAGjBtI,EAAIrN,QAGRsW,EAAII,MAAQ,WACRH,EAAOvW,OACPoW,EAAQpW,OACRuW,KACAH,MAGJE,EAAIK,IAAM,SAAS7E,EAAM8E,EAAKC,GAC1B,GAAIC,IAAS,CAEb,KAAKP,EAAKzE,GACN,GAAiB9R,SAAb6W,GAAqC,EAAXA,GAAgBA,GAAYT,EAAMhe,OAC5Dge,EAAM5X,KAAKsT,OACR,CAKH,IAAK,GAJD/Z,GAAI,EACJgf,KACArK,EAAM0J,EAAMhe,OAEPE,EAAI,EAAOoU,EAAJpU,EAASA,IACjBP,KAAK8e,GACLE,EAAEvY,KAAKsT,GAEXiF,EAAEvY,KAAK4X,EAAM9d,GAGjB8d,GAAQpW,OACRoW,EAAQW,EACRA,EAAI/W,OACJ8W,GAAS,EAMjB,MAFAP,GAAKzE,GAAQ8E,EAENE,GAGXR,EAAIU,IAAM,SAASlF,GACf,GAAIa,IAAI,CAUR,OARI4D,GAAKzE,IACLsE,EAAQD,EAAUC,EAAOtE,SAClByE,GAAKzE,GACZa,GAAI,GAEJnX,QAAQU,MAAM,6BAA+B4V,GAG1Ca,GAGX2D,EAAIW,IAAM,SAASnF,GACf,MAAOyE,GAAKzE,IAGhBwE,EAAIY,MAAQ,WACR,MAAOd,IAGXE,EAAIC,KAAO,WACP,MAAOA,IAGXD,EAAI3V,QAAU,SAASmR,GAGnB,IAAK,GAFDpF,GAAM0J,EAAMhe,OAEPE,EAAI,EAAOoU,EAAJpU,EAASA,IACrB,GAAI8d,EAAM9d,IAAMwZ,EACZ,MAAOxZ,IAKnBge,EAAIa,SAAW,WACX,MAAOf,GAAMhe,QAGjBke,EAAIc,QAAU,WAKV,IAAK,GAJDzE,MAEAjG,EAAM0J,EAAMhe,OAEPE,EAAI,EAAOoU,EAAJpU,EAASA,IAAK,CAC1B,GAAIqd,GAAMS,EAAM9d,EAChBqa,GAAEnU,KAAK+X,EAAKZ,IAGhB,MAAOhD,IAGX2D,EAAIe,KAAO,SAAShd,GAGhB,IAAK,GAFDqS,GAAM0J,EAAMhe,OAEPE,EAAI,EAAOoU,EAAJpU,EAASA,IACrB+B,EAAG+b,EAAM9d,GAAIie,EAAKH,EAAM9d,MAIhCge,EAAIgB,KAAO,SAASC,GAChB,GAAIC,GAAM,EAMV,OAJAlB,GAAIe,KAAK,SAASvF,EAAM8E,GACpBY,GAAO,SAAW1F,EAAO,SAAW2F,KAAKC,UAAUd,IAAQW,EAAO,OAAS,QAGxEC,GAKf5e,GAAE2V,MAAMoJ,UAAY,SAASpJ,EAAOqJ,EAAS9F,EAAMvK,GAC/C,GAAIsQ,GAAKrgB,KACLsgB,EAAY,EACZC,EAAU,KACVC,EAAWzQ,EAAO0Q,OAItB5B,GAAUtb,KAAK8c,GAGfA,EAAGK,KAAOL,EAAGlB,IACbkB,EAAGM,KAAON,EAAGb,IACba,EAAGO,SAAWP,EAAGrB,QACjBqB,EAAGQ,OAASR,EAAGnB,MAEfmB,EAAGD,QAAUA,EACbC,EAAG/F,KAAOA,EACV+F,EAAGG,SAAWA,EAEdH,EAAGtJ,MAAQA,EACXsJ,EAAGtD,UAAY,SAASvN,EAAS5D,GAC7BmL,EAAMgG,UAAUvN,EAAS5D,IAE7ByU,EAAGS,KAAO,EAEVT,EAAGnB,MAAQ,WACPmB,EAAGQ,SACHP,EAAY,EAERD,EAAGU,UACHV,EAAGU,SAASV,GACRtG,OAAQ,WAKpBsG,EAAGW,WAAa,SAAStJ,GACrB,MAAY,GAARA,GACO,EAGP4I,EAAY,GAAK5I,GAAU4I,EAAY,GACnCD,EAAGY,OACHZ,EAAGY,MAAMZ,GACLC,UAAWA,EACX5I,MAAOA,IAGf2I,EAAGS,OACH9c,QAAQwR,MAAM6K,EAAGS,MACbT,EAAGS,KAAO,GACVT,EAAGa,UAAUb,EAAGG,WAEb,IAEPF,EAAY5I,GACL,IAIf2I,EAAGrB,QAAU,SAAStH,EAAOuH,GACrBoB,EAAGW,WAAWtJ,KACd2I,EAAGO,SAAS3B,GACRoB,EAAGU,UACHV,EAAGU,SAASV,GACR3I,MAAOA,EACPqC,OAAQ,cAMxBsG,EAAGc,KAAO,SAASzJ,EAAO0H,EAAKjB,EAAKiD,IACpB,OAARjD,GAAwB3V,SAAR2V,KAChBA,EAAMzG,GAEN2I,EAAGW,WAAWtJ,IACV2I,EAAGU,UACHV,EAAGU,SAASV,GACR3I,MAAOA,EACPqC,OAAQ,OACRqH,MAAOA,EACPjD,IAAKA,EACL/a,KAAMgc,KAMtBiB,EAAGgB,QAAU,SAAS3J,EAAO0H,GACzB,GAAIiB,EAAGW,WAAWtJ,GAAQ,CAGtB,IAAK,GAAI5W,KAAKse,GACViB,EAAGK,KAAKtB,EAAIte,GAAG,GAAIse,EAAIte,GAAG,GAG1Buf,GAAGU,UACHV,EAAGU,SAASV,GACR3I,MAAOA,EACPqC,OAAQ,UACR3W,KAAMgc,EACNE,QAAQ,MAUxBe,EAAGlB,IAAM,SAASzH,EAAO0H,EAAKjB,EAAKiD,GAI/B,IAHY,OAARjD,GAAwB3V,SAAR2V,KAChBA,EAAMzG,GAEN2I,EAAGW,WAAWtJ,GAAQ,CACtB,GAAI4H,GAASe,EAAGK,KAAKvC,EAAKiB,EAAKgC,EAC3Bf,GAAGU,UACHV,EAAGU,SAASV,GACR3I,MAAOA,EACPqC,OAAQ,MACRqH,MAAOA,EACPjD,IAAKA,EACL/a,KAAMgc,EACNE,OAAQA,MAMxBe,EAAGiB,OAAS,SAAS5J,EAAO0H,EAAKjB,EAAKiD,IACtB,OAARjD,GAAwB3V,SAAR2V,KAChBA,EAAMzG,GAEN2I,EAAGW,WAAWtJ,KACd2I,EAAGK,KAAKvC,EAAKiB,EAAKgC,GACdf,EAAGU,UACHV,EAAGU,SAASV,GACR3I,MAAOA,EACPqC,OAAQ,SACRoE,IAAKA,EACL/a,KAAMgc,EACNgC,MAAOA,MAMvBf,EAAGb,IAAM,SAAS9H,EAAOyG,EAAKiD,GAI1B,IAHY,OAARjD,GAAwB3V,SAAR2V,KAChBA,EAAMzG,GAEN2I,EAAGW,WAAWtJ,GAAQ,EACR,OAAV0J,GAA0B,EAARA,GAAuB5Y,SAAV4Y,KAC/BA,EAAQf,EAAGlX,QAAQgV,GAEvB,IAAIoD,GAAKlB,EAAGM,KAAKxC,EAEboD,IAAMlB,EAAGU,UACTV,EAAGU,SAASV,GACR3I,MAAOA,EACPqC,OAAQ,MACRoE,IAAKA,EACLiD,MAAOA,KAMvB,IAAII,GAAe,SAASnG,EAAGtX,EAAGsc,GAC9B,GAAIoB,GAAS1d,EAAEX,IAIf,IAAIqe,EAAOnH,MAAQ+F,EAAG/F,KAItB,OAAQmH,EAAO1H,QAEf,IAAK,OACDsG,EAAGc,KAAKM,EAAOC,UAAWD,EAAOre,KAAMqe,EAAOE,QAASF,EAAOG,SAC9D,MAEJ,KAAK,UACDvB,EAAGgB,QAAQI,EAAOC,UAAWD,EAAOre,KACpC,MACJ,KAAK,MACDid,EAAGlB,IAAIsC,EAAOC,UAAWD,EAAOre,KAAMqe,EAAOE,QAASF,EAAOG,SAC7D,MAEJ,KAAK,SACMH,EAAOG,UAAYH,EAAOE,QAG7BtB,EAAGiB,OAAOG,EAAOC,UAAWD,EAAOre,KAAMqe,EAAOE,QAASF,EAAOG,UAFhE5d,QAAQU,MAAM,iBAAkB+c,EAIpC,MACJ,KAAK,MACMA,EAAOG,UAAYH,EAAOE,QAG7BtB,EAAGb,IAAIiC,EAAOC,UAAWD,EAAOE,QAASF,EAAOG,UAFhD5d,QAAQU,MAAM,iBAAkB+c,EAIpC,MAEJ,KAAK,QACDpB,EAAGnB,OACH,MAEJ,KAAK,UACDmB,EAAGrB,QAAQyC,EAAOC,UAAWD,EAAO/B,MACpC,MAEJ,SACQW,EAAGW,WAAWS,EAAOC,YACjBrB,EAAGU,UACHV,EAAGU,SAASV,GACR3I,MAAO+J,EAAOC,UACd3H,OAAQ0H,EAAO1H,OACf3W,KAAMqe,EAAOre,QAQ7Bid,GAAGD,UACHG,EAAUF,EAAGtJ,MAAMwF,UAAU8D,EAAGD,SAC5B3I,QAAS+J,EACT/N,SAAU4M,EACV7D,UAAWzM,EAAOyM,aAI1B6D,EAAGwB,QAAU,WACTxB,EAAGQ,SACHR,EAAGtJ,MAAM0F,YAAY8D,IAGzBF,EAAGyB,YAAc,SAASC,EAAKnW,GAC3B,GAAIrK,GAAO8e,CACX9e,GAAKwb,UAAUxb,EAAK6e,SAChBD,WACI6B,QAASD,EACT3B,QAAS7e,EAAK6e,QACd9F,KAAM/Y,EAAK+Y,KACX1O,IAAKA,MAKjByU,EAAGa,UAAY,SAAStV,GAEpByU,EAAGyB,YAAY,YAAalW,IAIhCyU,EAAG4B,WAAa,SAASrW,GACrB,GAAIrK,GAAO8e,CACX9e,GAAK2d,QACL3d,EAAKwb,UAAUxb,EAAK6e,SAChBD,WACI6B,QAAS,aACT5B,QAASC,EAAGD,QACZ9F,KAAM+F,EAAG/F,KACT1O,IAAKA,MAKjByU,EAAG6B,UAAY,SAAStW,GACpB,GAAIrK,GAAO8e,EAEPhb,EAAW,WACX9D,EAAK2gB,UAAU3e,KAAKhC,EAAMqK,GAE9BrK,GAAKwb,UAAUxb,EAAK6e,SAChBD,WACI6B,QAAS,YACT5B,QAAS7e,EAAK6e,QACd9F,KAAM/Y,EAAK+Y,KACX1O,IAAKA,KAGbrK,EAAK4gB,OAAS3b,WAAWnB,EAAU,MAGvCgb,EAAGa,UAAUb,EAAGG,WAGpBpf,EAAE2V,MAAMqL,UAAY,SAASrL,EAAOqJ,EAAS9F,EAAM+H,EAAItS,GA4B1D,QAASuS,GAAOlf,GACZ,GAAwB,gBAAbA,GAAK,IAAoBA,EAAK,GAAG+F,QAAQ,KAAO,GAAI,CAClE,GAAIoZ,GAAMnhB,EAAE4D,UAAU5B,EAAK,GAC3BA,GAAK,GAAKmf,EAAIC,UACdpf,EAAK,GAAK,KAEP,MAAOA,GAGX,QAASqf,GAAS7W,GACd,GAAIxI,GAAOwI,EAAIgU,SAER,KAAK,GAAI9e,KAAKsC,GACxBA,EAAKtC,GAAKwhB,EAAOlf,EAAKtC,GAGnB,OAAOsC,GA3CJ,GAAIsf,GACArC,EAAK,GAAIjf,GAAE2V,MAAMoJ,UAAUpJ,EAAOqJ,EAAS9F,GAC3CkC,UAAWzM,EAAOyM,YAElBmG,EAAK3iB,IAET2iB,GAAGxC,UAAYE,EACfsC,EAAGC,UAAYF,EACfC,EAAG5L,MAAQA,EAEX4L,EAAGd,QAAU,WACLa,GACAA,EAAGG,YAEHxC,GACAA,EAAGwB,UAGPa,EAAK,KACLrC,EAAK,MAGTA,EAAGY,MAAQ,SAASrV,EAAKyR,GACrBrZ,QAAQU,MAAM,UAAWkH,EAAKyR,IAwBlCgD,EAAGU,SAAW,SAASnV,EAAKyR,GACxB,GAAI+D,GAAQ,EACR0B,EAAQ,CAEZ,KAAKJ,EAAI,CACL,IAAK3S,EAAOgT,UAAW,CACnB,GAAmB,QAAf1F,EAAKtD,OACL,MAGJhK,GAAOgT,YAEP,KAAK,GAAIjiB,KAAKuc,GAAKja,KACf2M,EAAOgT,UAAU/b,MACbgc,OAAU3F,EAAKja,KAAKtC,KAKhC4hB,EAAKL,EAAGO,UAAU7S,GAGtB,GAAI2S,IAAsB,OAAfrF,EAAKtD,QAAkC,UAAfsD,EAAKtD,UACpCqH,EAAQ/D,EAAK+D,MAEC5Y,SAAV4Y,GAAuB/D,EAAKc,MAC5BiD,EAAQf,EAAGlX,QAAQkU,EAAKc,MAGd3V,SAAV4Y,GAEA,WADApd,SAAQU,MAAM,iCAAkC2Y,EAKpDtN,GAAOgR,UACPhR,EAAOgR,SAASnV,EAAKyR,EAGzB,KACI,OAAQA,EAAKtD,QACb,IAAK,UACD,IAAKsD,EAAKja,KAEN,WADAY,SAAQU,MAAM,eAGlBge,GAAGO,eACHP,EAAGQ,UAAUT,EAAS7W,IACtB8W,EAAGS,sBACH,MACJ,KAAK,MACD,IAAK9F,EAAKja,KAEN,WADAY,SAAQU,MAAM,eAGd2Y,GAAKiC,OAAS,IAEdoD,EAAGO,eACHP,EAAGQ,UAAUT,EAAS7W,KAEtB8W,EAAGQ,UAAUZ,EAAOjF,EAAKja,OAE7Bsf,EAAGS,sBACH,MACJ,KAAK,SACD,IAAK9F,EAAKja,KACN,MAGJsf,GAAGU,SAASd,EAAOjF,EAAKja,MAAOge,GAC/BsB,EAAGS,sBACH,MACJ,KAAK,MACDT,EAAGW,YAAYjC,GACfsB,EAAGS,sBACH,MACJ,KAAK,QACDT,EAAGO,cACH,MACJ,KAAK,UAEDP,EAAGO,eACHP,EAAGQ,UAAUT,EAAS7W,GACtB,MACJ,KAAK,OACDyW,EAAGiB,MACH,MAEJ,KAAK,OACDjB,EAAGkB,QAIT,MAAMre,GACJlB,QAAQU,MAAM,UAAYQ,GAC1B4d,IAGAA,GACAlX,EAAIkV,OACAlV,EAAIkV,KAAO,GACXlV,EAAIsV,UAAUtV,EAAI4U,WAGtB5U,EAAIkV,KAAO,GAKnBT,EAAGU,SAASV,GACRtG,OAAQ,SAKhB,IAAIyJ,GAAgB,CAMpBpiB,GAAE2V,MAAMe,KAAO,SAASf,EAAOtT,GAC3B,GAAIqU,GAAO9X,IAEX8X,GAAKrU,OAASrC,EAAEI,QACZ2b,OAAQ,KACR1E,QAAQ,EACRoB,OAAQ,KACR4J,YAAa,KACbC,WAAY,KACZC,QAAS,MACVlgB,GAEHqU,EAAKf,MAAQA,EACbe,EAAKJ,MAAQ8L,IAEb3L,IAEAd,EAAMwF,UAAUzE,EAAKrU,OAAOoW,OAAO+J,YAC/BnM,QAAS,SAAS4D,EAAGtX,GACb+T,EAAKrU,OAAOggB,aACZ3L,EAAKrU,OAAOggB,YAAY1M,EAAOe,EAAM/T,EAAEX,SAKnD2T,EAAMwF,UAAUzE,EAAKrU,OAAOoW,OAAOgK,aAC/BpM,QAAS,SAAS4D,EAAGtX,GACwB,kBAA9B+T,GAAKrU,OAAmB,cAC/BqU,EAAKrU,OAAOqgB,aAAazI,EAAEtX,MAKvCgT,EAAMwF,UAAUzE,EAAKrU,OAAOoW,OAAOC,aAC/BrC,QAAS,SAAS4D,EAAGtX,GACwB,kBAA9B+T,GAAKrU,OAAmB,cAC/BqU,EAAKrU,OAAOsgB,aAAa1I,EAAEtX,OAM3C3C,EAAE2V,MAAMe,KAAKvV,UAAUyV,WAAa,SAAS+J,EAAKje,EAAIkgB,GAClD,GAAIlM,GAAO9X,IAEX8X,GAAKf,MAAM6C,UAAUrW,KAAK,mBACtBiU,aAAgBM,EAAKrU,OAAOoW,OAAO+J,WACnCxgB,MACI6gB,YAAe,eACfjC,QAAWD,EACXje,GAAMA,EACNkgB,MAASA,MAKrB5iB,EAAE2V,MAAMe,KAAKvV,UAAUsf,QAAU,WAC7B,GAAI/J,GAAO9X,IAEX8X,GAAKoM,WAAY,EACjBpM,EAAKrU,OAAOggB,YAAY3L,EAAKf,MAAOe,EAAM,WAEtCA,EAAKrU,OAAOoW,OAAO+J,YACnB9L,EAAKf,MAAM0F,YAAY3E,EAAKrU,OAAOoW,OAAO+J,YAG1C9L,EAAKrU,OAAOoW,OAAOC,aACnBhC,EAAKf,MAAM0F,YAAY3E,EAAKrU,OAAOoW,OAAOC,aAG1ChC,EAAKrU,OAAOoW,OAAOgK,aACnB/L,EAAKf,MAAM0F,YAAY3E,EAAKrU,OAAOoW,OAAOgK,cAyHlDziB,EAAE2V,MAAMoN,YAER/iB,EAAE2V,MAAMqN,QAAU,SAASrN,EAAOtT,GAmB9B,QAAS4gB,GAAWhC,GAChB,GAAIiC,GAAU,QAAUF,EAAQ1M,MAC5B6M,EAAU,QAAUH,EAAQ1M,MAC5B8M,EAAe,aAAeJ,EAAQ1M,MACtC+M,EAAc,YAAcL,EAAQ1M,MACpCgN,EAAc,iBAAmBN,EAAQ1M,MACzCiN,EAAS,WAAaP,EAAQ1M,MAE9BqI,EAAQ,YAAc4E,EAAS,oCACbL,EAAU,6CACVC,EAAU,6CACVC,EAAe,+CACfE,EAAc,0BAC7CN,EAAQ3gB,OAAOgV,OAAS,8BAAgCgM,EAAc,0BAA4B,IACnG,gBAWG,IATOpC,EAAGtC,KAAKA,GAEf3e,EAAE2V,MAAMoN,SAASS,oBAAsB,SAAS9gB,EAAI+gB,GACvD,GAAIzF,GAAMhe,EAAE,IAAM0C,EAAK,oBAAoBqV,MAC/B,UAARiG,GACcgF,EAAQpM,WAAW,aAAc,MAAOoH,EAAKyF,KAIxDT,EAAQ3gB,OAAOgV,OAAQ,CAC9B,IAAK,GAAIvB,GAAI,EAAGA,EAAIkN,EAAQU,YAAa5N,IAAK,CAC1C,GAAI6N,GAAa,sBAAwB7N,EAAI,IAAMkN,EAAQ1M,MACvDsN,EAAc,qBAAuB9N,EAAI,IAAMkN,EAAQ1M,MAGvDuN,EAAU,YAAcF,EAAa,iCACf7N,EAAE,GAC/B,iEAAmE6N,EAAa,QAAY7N,EAAE,GAAK,YAAc8N,EAAc,4BAE5H3C,GAAG6C,OAAOD,GAGd7jB,EAAE,IAAMqjB,GAAaU,MAAM,WACT,GAAIjN,GAAOkN,OAAO,yBAA0B,GACtDlN,IACPkM,EAAQpM,WAAW,gBAAiB,KAAME,KAKjC9W,EAAE,IAAMkjB,GAASa,MAAM,WACnB,GAAIjN,GAAOkN,OAAO,yBAA0B,GACtDlN,IACckM,EAAQpM,WAAW,OAAQ,KAAME,KAIzC9W,EAAE,IAAMmjB,GAASY,MAAM,WACnBf,EAAQpM,WAAW,OAAQ,KAAM,SAGrC5W,EAAE,IAAMojB,GAAcW,MAAM,WACxB,GAAIjN,GAAOkN,OAAO,yBAA0B,GACtDlN,IACckM,EAAQpM,WAAW,YAAa,MAAO,QAASE,MAIxD9W,EAAE,IAAMsjB,GAAaS,MAAM,WACvBf,EAAQpM,WAAW,YAAa,MAAO,OAAQ,UAKvD,QAASqN,GAAYhD,EAAIiD,GACrB,GAAI/kB,GAAIkH,SAAS6d,GACbC,EAAU,QAAUhlB,EACpBilB,EAAoB,kBAAoBjlB,EACxCklB,EAAoB,kBAAoBllB,EACxCmlB,EAAqB,mBAAqBnlB,EAC1ColB,EAAqB,mBAAqBplB,EAE1CqlB,EAAmB,iBAAmBrlB,EACtCslB,EAAoB,kBAAoBtlB,EAExCulB,EAAe,aAAevlB,EAC9BwlB,EAAgB,cAAgBxlB,EAChCylB,EAAgB,cAAgBzlB,EAEhC0lB,EAAW,SAAW1lB,EACtB2lB,EAAY,UAAY3lB,EACxB4lB,EAAa,WAAa5lB,EAC1B6lB,EAAiB,eAAiB7lB,EAClC8lB,EAAa,WAAa9lB,EAC1B+lB,EAAS,OAAS/lB,EAClBgmB,EAAY,aAAehmB,EAC3BimB,EAAY,aAAejmB,EAC3BkmB,EAAW,YAAclmB,EACzBmmB,EAAW,YAAcnmB,EACzBomB,EAAc,WAAapmB,EAG3Bwf,EAAO,YAAcuG,EAAS,IA2JlC,OAzJPvG,IAAQ,sCAEDA,GAAQ,8BAAgCwF,EAAU,6CACdU,EAAW,6CACXM,EAAY,+CACZC,EAAY,+CACZE,EAAW,8CACXD,EAAW,8CACXE,EAAc,sBAErDvC,EAAQ3gB,OAAOgV,SACtBsH,GAAQ,4CAGMA,GAAQ,8BAAgCmG,EAAY,8CAChBE,EAAiB,kDACjBC,EAAa,kDACbF,EAAa,oBAE3D/B,EAAQU,YAAc,IACR/E,GAAQ,wEACO6F,EAAmB,yDACnBH,EAAoB,0DACpBD,EAAoB,8DAIjBK,EAAoB,4DACvBF,EAAqB,6DACrBD,EAAqB,mCAGtD3F,GAAQ,kCAEsC+F,EAAe,kDACXE,EAAgB,mDAChBD,EAAgB,+BAOxD1D,EAAGtC,KAAKA,GAGHsC,EAAGjf,KAAK,UACThC,EAAE,IAAMklB,GAAQhD,OAGpBjB,EAAGuE,UAAU,SAAS7iB,GAClBse,EAAGjf,MAAMyjB,OAAS,IAClBzlB,EAAE,IAAMklB,GAAQ/C,SAGpBlB,EAAGyE,SAAS,SAAS/iB,GACjBse,EAAGjf,MAAMyjB,OAAS,IAClBzlB,EAAE,IAAMklB,GAAQhD,SAGpBliB,EAAE,IAAMulB,GAAaxB,MAAM,WACvB,GAAI4B,GAAO3B,OAAO,kBAC5B2B,IACc3C,EAAQpM,WAAW,WAAYzX,EAAGwmB,KAI1C3lB,EAAE,IAAMmkB,GAASJ,MAAM,WACnBf,EAAQpM,WAAW,OAAQzX,KAI/Ba,EAAE,IAAM0kB,GAAcX,MAAM,WACxB,GAAI6B,GAAM5B,OAAO,wBAAyB,GACpD4B,IACc5C,EAAQpM,WAAW,YAAazX,EAAGymB,KAI3C5lB,EAAE,IAAM2kB,GAAeZ,MAAM,WACzBf,EAAQpM,WAAW,YAAazX,EAAG,UAEvCa,EAAE,IAAM4kB,GAAeb,MAAM,WACzBf,EAAQpM,WAAW,YAAazX,EAAG,UAGvCa,EAAE,IAAMwkB,GAAkBT,MAAM,WAC5B,GAAI6B,GAAM5B,OAAO,yBAA0B,GACrD4B,IACc5C,EAAQpM,WAAW,aAAczX,EAAGymB,KAI5C5lB,EAAE,IAAMykB,GAAmBV,MAAM,WAC7B,GAAI6B,GAAM5B,OAAO,yBAA0B,GACrD4B,IACc5C,EAAQpM,WAAW,sBAAuBzX,EAAGymB,KAIrD5lB,EAAE,IAAMokB,GAAmBL,MAAM,WAC7Bf,EAAQpM,WAAW,aAAczX,EAAG,UAExCa,EAAE,IAAMqkB,GAAmBN,MAAM,WAC7Bf,EAAQpM,WAAW,aAAczX,EAAG,UAIxCa,EAAE,IAAMskB,GAAoBP,MAAM,WAC9Bf,EAAQpM,WAAW,sBAAuBzX,EAAG,UAEjDa,EAAE,IAAMukB,GAAoBR,MAAM,WAC9Bf,EAAQpM,WAAW,sBAAuBzX,EAAG,UAGjDa,EAAE,IAAM6kB,GAAUd,MAAM,WACpBf,EAAQpM,WAAW,QAASzX,KAGnC6jB,EAAQ3gB,OAAOgV,SACtBrX,EAAE,IAAM8kB,GAAWf,MAAM,WACPf,EAAQpM,WAAW,SAAUzX,KAE/Ca,EAAE,IAAMglB,GAAgBjB,MAAM,WACZf,EAAQpM,WAAW,aAAczX,EAAG,eAEtDa,EAAE,IAAMilB,GAAYlB,MAAM,WACRf,EAAQpM,WAAW,YAAazX,EAAG,WAErDa,EAAE,IAAM+kB,GAAYhB,MAAM,WACR,GAAIhM,GAAOiM,OAAO,oBAAqB,GACjDjM,IACPiL,EAAQpM,WAAW,aAAczX,EAAG6Y,OAAOD,OAKlC/X,EAAE,IAAMmlB,GAAWpB,MAAM,WACrBf,EAAQpM,WAAW,YAAazX,EAAG,QAGvCa,EAAE,IAAMolB,GAAWrB,MAAM,WACrBf,EAAQpM,WAAW,YAAazX,EAAG,UAGvCa,EAAE,IAAMqlB,GAAUtB,MAAM,WACpBf,EAAQpM,WAAW,aAAczX,EAAG,QAGxCa,EAAE,IAAMslB,GAAUvB,MAAM,WACpBf,EAAQpM,WAAW,aAAczX,EAAG,UAGjCwf,EA/QX,GAAIqE,GAAUpkB,IAEdokB,GAAQ3gB,OAASrC,EAAEI,QACfylB,QAAS,KACTC,SAAU,KACVC,UAAW,KACXhK,OAAQ,KACR1E,QAAQ,EACRoB,OAAQ,KACR4J,YAAa,KACbC,WAAY,KACZC,QAAS,MACVlgB,GAEH2gB,EAAQrN,MAAQA,EAChBqN,EAAQ1M,MAAQ8L,IACvBY,EAAQU,YAAcV,EAAQ3gB,OAAOoW,OAAOiL,WAkQrC,IAAIsC,GAAS,GACTC,EAAS,CAIbtQ,GAAMwF,UAAU6H,EAAQ3gB,OAAOoW,OAAOgK,aAClCpM,QAAS,SAAS4D,EAAGtX,GAC2B,kBAAjCqgB,GAAQ3gB,OAAmB,cAClC2gB,EAAQ3gB,OAAOqgB,aAAazI,EAAEtX,MAKjDgT,EAAMwF,UAAU6H,EAAQ3gB,OAAOoW,OAAOC,aAClCrC,QAAS,SAAS4D,EAAGtX,GACoB,kBAAjCqgB,GAAQ3gB,OAAmB,cAClC2gB,EAAQ3gB,OAAOsgB,aAAa1I,EAAEtX,MAKO,cAA/BqgB,EAAQ3gB,OAAOoW,OAAOyN,OACtBF,EAAS,SACTC,EAAS,IAELjD,EAAQ3gB,OAAO0jB,WACf9C,EAAWjjB,EAAEgjB,EAAQ3gB,OAAO0jB,YAC5B/lB,EAAEgjB,EAAQ3gB,OAAO8jB,WAAWxH,KAAK,qCAEjC3e,EAAEgjB,EAAQ3gB,OAAO0jB,WAAWpH,KAAK,IAGrChJ,EAAMwF,UAAU6H,EAAQ3gB,OAAOoW,OAAO+J,YAClCnM,QAAS,SAAS4D,EAAGtX,GAM/B,GAJkBqgB,EAAQ3gB,OAAOggB,aACfW,EAAQ3gB,OAAOggB,YAAY1M,EAAOqN,EAASrgB,EAAEX,MAGhC,sBAA3BW,EAAEX,KAAK,gBACd,IAAK,GAAI8T,GAAI,EAAGA,EAAIkN,EAAQU,YAAa5N,IAAK,CAC1C,GAII5V,GAJA0jB,EAAc,sBAAwB9N,EAAI,IAAMkN,EAAQ1M,MACxDqN,EAAa,uBAAyB7N,EAAI,IAAMkN,EAAQ1M,MAExDnX,EAAI,CASR,IANAa,EAAE4jB,GAAawC,eACfpmB,EAAE4jB,GAAawC,WAAW,UAC1BpmB,EAAE4jB,GAAayC,QAEfrmB,EAAE4jB,GAAaE,OAAO,GAAIwC,QAAO,kBAAmB,SAEhD3jB,EAAEX,KAAKukB,aAAc,CAC5B,GAAIC,KAEJ,KAAK,GAAI9mB,KAAKiD,GAAEX,KAAKukB,aACjBC,EAAM5gB,KAAKjD,EAAEX,KAAKukB,aAAa7mB,GAAGwZ,KAGtChZ,GAAUsmB,EAAMC,KAAK,SAAS5I,EAAG6I,GAC7B,GAAIC,GAA0B,UAArB9I,EAAEvX,UAAU,EAAG,IAAiB,GAAO,EAC5CsgB,EAA0B,UAArBF,EAAEpgB,UAAU,EAAG,IAAiB,GAAO,CAEhD,QAAKqgB,GAAMC,IAAOD,GAAMC,EACpBD,EAAK,GAAK,EAGH9I,GAAK6I,EAAM,EAAQ7I,EAAI6I,EAAM,EAAI,IAGhD,KAAK,GAAIhnB,KAAKQ,GACVF,EAAE4jB,GAAaE,OAAO,GAAIwC,QAAOpmB,EAAQR,GAAIQ,EAAQR,KACrDP,IAIGA,EACPa,EAAE4jB,GAAawC,WAAW,WAAW,GAErCpmB,EAAE2jB,GAAYzB,YAKVc,EAAQF,WAAaE,EAAQ3gB,OAAO8jB,YAChBnmB,EAAEgjB,EAAQ3gB,OAAO8jB,WAAWxH,KAAKhc,EAAEX,KAAK2B,SAAW,YAC/Cqf,EAAQ6D,cACpC/hB,aAAake,EAAQ6D,aACrB7D,EAAQ6D,YAAc,GAEE7D,EAAQ6D,YAAczhB,WAAW,WAAapF,EAAEgjB,EAAQ3gB,OAAO8jB,WAAWxH,KAAKqE,EAAQF,UAAY,GAAK,qCAAuC,SAOlKE,EAAQ3gB,OAAOgV,QACtB2L,EAAQpM,WAAW,oBAAqB,KAAM,MAIxC,IAAIkQ,GAAe,IAEgB,eAA/B9D,EAAQ3gB,OAAOoW,OAAOyN,OACtBY,EAAe,SAASC,EAAMC,EAAOC,EAAeC,GAChD,IAAKF,EAAM,GAAI,CACX,GAAIG,GAAOnnB,EAAE,WAAY+mB,EACzB9C,GAAYkD,EAAMH,GAEdhE,EAAQ3gB,OAAOkgB,SACfS,EAAQ3gB,OAAOkgB,QAAQ5M,EAAOqN,EAASmE,EAAMH,MAM7DhE,EAAQzB,GAAK,GAAIvhB,GAAE2V,MAAMqL,UAAUrL,EAAOqN,EAAQ3gB,OAAOoW,OAAO2O,UAAWpE,EAAQ3gB,OAAOoW,OAAO4O,OAAQrnB,EAAEgjB,EAAQ3gB,OAAOwjB,UACtHzK,WACIQ,OAAQoH,EAAQ3gB,OAAO0Z,OAASiH,EAAQ3gB,OAAO0Z,OAAOH,OAAS,MAGnE+D,SAAY,SAASnV,EAAKyR,GACtBjc,EAAEgjB,EAAQ3gB,OAAOyjB,UAAU/N,KAAK,yBAAgCvN,EAAI+T,WAAa,WAC7EyE,EAAQ3gB,OAAOigB,YACfU,EAAQ3gB,OAAOigB,WAAW3M,EAAOqN,EAAShjB,EAAE2V,MAAF3V,QAAasnB,UAAUC,SAAU/c,EAAKyR,IAIxFuL,UACA7F,YAEQC,OAAU,KACV6F,OAAU,OAGV7F,OAAU,SACxB6F,OAAU,QAGI7F,OAAU,OACxB6F,OAAU,QAGI7F,OAAU,QACV6F,OAAU,QAGV7F,OAAU,SACV6F,OAAUzE,EAAQ3gB,OAAOgV,OAAS,QAAU,UAG5CuK,OAAUoE,EACVyB,OAAUxB,IAGlByB,YAAc,EACdC,UAAY,EACZC,OAAS,EACTC,OAAS,EACTC,SAAW,EACXC,eAAiB,EACjBC,WAAa,EACbC,eAAkB,KAElBC,WACIC,YAAe,gCAGnBC,cAAiBtB,KAKzB9mB,EAAE2V,MAAMqN,QAAQ7hB,UAAUyV,WAAa,SAAS+J,EAAKje,EAAIkgB,GACrD,GAAII,GAAUpkB,IAEdokB,GAAQrN,MAAM6C,UAAUrW,KAAK,mBACzBiU,aAAgB4M,EAAQ3gB,OAAOoW,OAAO+J,WACtCxgB,MACV6gB,YAAe,eACfjC,QAAWD,EACXje,GAAMA,EACNkgB,MAASA,MAKP5iB,EAAE2V,MAAMqN,QAAQ7hB,UAAUoX,SAAW,SAAS9H,EAASzN,GACnD,GAAIggB,GAAUpkB,IACdokB,GAAQrN,MAAM6C,UAAUrW,KAAK,mBACzBiU,aAAgB4M,EAAQ3gB,OAAOoW,OAAOC,YACtC1W,MACV2W,OAAU,OACVlI,QAAWA,EACXzN,KAAQA,MAMNhD,EAAE2V,MAAMqN,QAAQ7hB,UAAUsf,QAAU,WAChC,GAAIuC,GAAUpkB,IAEdokB,GAAQF,WAAY,EAEhBE,EAAQzB,IACRyB,EAAQzB,GAAGd,UAGXuC,EAAQ3gB,OAAOoW,OAAOC,aACtBsK,EAAQrN,MAAM0F,YAAY2H,EAAQ3gB,OAAOoW,OAAOC,aAGhDsK,EAAQ3gB,OAAOoW,OAAO+J,YACtBQ,EAAQrN,MAAM0F,YAAY2H,EAAQ3gB,OAAOoW,OAAO+J,YAGhDQ,EAAQ3gB,OAAO0jB,WACf/lB,EAAEgjB,EAAQ3gB,OAAO0jB,WAAWpH,KAAK,KAIzC3e,EAAE2V,MAAMoG,OAAS,SAASG,EAAWvG,EAAOtT,GACxC,GAAI0Z,GAASnd,IAEbmd,GAAO1Z,OAASrC,EAAEI,QACduJ,SAAUgM,EAAMzV,QAAQyJ,SACxByI,UAAWuD,EAAMzV,QAAQkS,UAChCxH,aAAa,EACbS,WAAW,EACXX,OAAQiL,EAAMzV,QAAQma,aAAa3P,OACnCa,YAAaoK,EAAMzV,QAAQma,aAAa9O,YACxCmH,SAAUiD,EAAMzV,QAAQma,aAAa3H,SAC9ByH,IAAKxE,EAAMzV,QAAQia,IACnBC,SAAUzE,EAAMzV,QAAQka,SACxB5Z,MAAOmV,EAAMzV,QAAQM,MAC3BmK,YAAagL,EAAMzV,QAAQyK,YAC3BM,UAAW0K,EAAMzV,QAAQ+K,WACpB5I,GAGL0Z,EAAO1Z,OAAOuI,cACfmR,EAAO1Z,OAAOgJ,UAAYsK,EAAMzV,QAAQma,aAAahP,UACrD0Q,EAAO1Z,OAAOiJ,eAAiBqK,EAAMzV,QAAQma,aAAa/O,gBAGvDyQ,EAAOpG,MAAQA,EACfoG,EAAOG,UAAYA,EACnBH,EAAOsM,UAAY,KACnBtM,EAAOhD,MAAQgD,EAAOsM,UAAYroB,EAAE2V,MAAF3V,QAAa+Y,MAAb/Y,OAClC+b,EAAO5S,UAAYwM,EAAMxM,UACzB4S,EAAOuM,UAAW,EAClBvM,EAAOW,OAASra,EAAOqa,SAAU,EACxCX,EAAOnR,YAAcvI,EAAOuI,cAAe,EAC3CmR,EAAO1Q,UAAY0Q,EAAO1Z,OAAOgJ,UACjC0Q,EAAOzQ,eAAiByQ,EAAO1Z,OAAOiJ,eACtCyQ,EAAOrR,OAASqR,EAAO1Z,OAAOqI,OAC9BqR,EAAOxQ,YAAcwQ,EAAO1Z,OAAOkJ,YACnCwQ,EAAOrJ,SAAWqJ,EAAO1Z,OAAOqQ,SAErBqJ,EAAO1Z,OAAOuZ,OACdG,EAAOH,OAASG,EAAO1Z,OAAOuZ,OAE9BG,EAAOH,OAASG,EAAO1Z,OAAOuZ,OAAStC,IAGhB,kBAAvByC,GAAO1Z,OAAU,MAC3B0Z,EAAO1Z,OAAO8X,IAAM4B,EAAO1Z,OAAO8X,OAGxB4B,EAAO1Z,OAAO8X,MACd4B,EAAOwM,YAAcC,SAASC,eAAe1M,EAAO1Z,OAAO8X,KAEvD4B,EAAO1Z,OAAOsH,WACdoS,EAAO2M,YAAc3M,EAAOwM,cAIhCxM,EAAO1Z,OAAO+X,WACrB2B,EAAO/Q,WAAawd,SAASC,eAAe1M,EAAO1Z,OAAO+X,WAGvD2B,EAAOpG,MAAM6E,QAAQuB,EAAOH,QAAUG,CAEtC,IAAI4M,KAEA5M,GAAOG,WAAalc,EAAE2V,MAAF3V,QAAakc,UAAUS,SACH,aAApCZ,EAAO1Z,OAAOumB,mBACd7M,EAAO1Z,OAAOwmB,sBAAwB9M,EAAO1Z,OAAOymB,eACpD/M,EAAO1Z,OAAO0mB,wBAA0BhN,EAAO1Z,OAAO2mB,mBAEtDjN,EAAO1Z,OAAOwmB,sBAAwB9M,EAAO1Z,OAAO4mB,eACpDlN,EAAO1Z,OAAO0mB,wBAA0BhN,EAAO1Z,OAAO6mB,kBAGrDnN,EAAO1Z,OAAOwmB,wBACf9M,EAAO1Z,OAAOwmB,sBAAwB,UAGrC9M,EAAO1Z,OAAO0mB,0BACfhN,EAAO1Z,OAAO0mB,wBAA0B,WAG5CJ,EAAa3L,UAAY,SAASX,EAAKlW,GACnCvD,QAAQwR,MAAMjO,IAGlBwiB,EAAa3a,YAAc,SAASqO,EAAK9S,GACrC3G,QAAQU,MAAM,aAAciG,MAGhCwS,EAAO1Z,OAAOwmB,sBAAwB,gBACtC9M,EAAO1Z,OAAO0mB,wBAA0BhN,EAAO1Z,OAAO8mB,oBAG1DR,EAAarf,SAAW,SAAS+S,GAGpC,MAFOzZ,SAAQC,IAAI,QAAUwZ,EAAIrZ,KAAO,OAAQqZ,EAAItT,UAAUS,KAE1DuS,EAAOhD,OAAS/Y,EAAE2V,MAAF3V,QAAa+Y,MAAMqQ,YAAcrN,EAAOhD,OAAS/Y,EAAE2V,MAAF3V,QAAa+Y,MAAMsQ,WAAatN,EAAOhD,OAAS/Y,EAAE2V,MAAF3V,QAAa+Y,MAAMuQ,WAC3IC,UAASC,cAIiB,SAAZnN,EAAIrZ,KACd+Y,EAAOhD,OAAS/Y,EAAE2V,MAAF3V,QAAa+Y,MAAMuQ,QACrBvN,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMqQ,YACjDrN,EAAOhB,WAAW,gBACrBxR,IAAK8S,EAAItT,UAAUS,QAGFuS,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMqQ,YAEnCrN,EAAOhB,WAAW,gBACnCxR,IAAK8S,EAAItT,UAAUS,QAINuS,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMsQ,WAEnCtN,EAAOhB,WAAWgB,EAAOW,OAAS,eAAiB,gBAC/CnT,IAAKwS,EAAOM,IAAItT,UAAUS,SAKtCmf,EAAa9f,MAAQ,SAASwT,GAE1B,MAAgB,SAAZA,EAAIrZ,SACJJ,SAAQC,IAAI,QAASwZ,EAAItT,UAAUD,WADvC,QAMJ6f,EAAac,SAAW,SAASpN,EAAK1T,GAC9BoT,EAAO5S,UAAUugB,oBACwC,kBAAlD3N,GAAO5S,UAAUugB,mBAAmBC,UAC3C5N,EAAO5S,UAAUugB,mBAAmBC,UAAUhhB,GAEzCoT,EAAOpG,MAAMzV,QAAQwpB,oBACmC,kBAAtD3N,GAAOpG,MAAMzV,QAAQwpB,mBAAmBC,WAC/C5N,EAAOpG,MAAMzV,QAAQwpB,mBAAmBC,UAAUhhB,GAEtD/F,QAAQC,IAAI,mBAGhB8lB,EAAajf,eAAiB,SAAS2S,EAAK1T,GACK,kBAApCoT,GAAO5S,UAAUO,gBAC1BqS,EAAO5S,UAAUO,eAAef,EAAQoT,GAE1CnZ,QAAQC,IAAI,0BAGd8lB,EAAapV,QAAU,SAAS5Q,GACxBoZ,EAAO5S,UAAUugB,oBACuC,kBAAjD3N,GAAO5S,UAAUugB,mBAAmBE,SAC3C7N,EAAO5S,UAAUugB,mBAAmBE,WAE/B7N,EAAOpG,MAAMzV,QAAQwpB,oBACkC,kBAArD3N,GAAOpG,MAAMzV,QAAQwpB,mBAAmBE,UAC/C7N,EAAOpG,MAAMzV,QAAQwpB,mBAAmBE,WAE5ChnB,QAAQU,MAAM,SAAUX,GACxBoZ,EAAOD,QAAQ+N,MAAO,gCAG1B9N,EAAOM,IAAM,GAAIrc,GAAEmS,OACfhJ,UAAWwf,EAClB3d,WAAY+Q,EAAOnR,YAAc,KAAOmR,EAAO/Q,WACxCrB,SAAUoS,EAAO1Z,OAAOsH,SAAWoS,EAAO2M,YAAc,KACxDve,SAAU4R,EAAOwM,YACjBnW,UAAW2J,EAAO1Z,OAAO+P,UACzBzH,YAAaoR,EAAO1Z,OAAOsI,YAC3BE,YAAa8K,EAAMzV,QAAQ2K,YAC3BkE,WAAY4G,EAAMzV,QAAQ6O,WAC1BnE,YAAamR,EAAOnR,YACpBS,UAAW0Q,EAAO1Q,UAClBC,eAAgByQ,EAAOzQ,eACvBZ,OAAQqR,EAAOrR,OACfa,YAAawQ,EAAOxQ,YACpBmH,SAAUqJ,EAAOrJ,SACvB5D,WAAY6G,EAAMzV,QAAQ4O,WAC1B7D,UAAW8Q,EAAO1Z,OAAO4I,YAGvB8Q,EAAOM,IAAI1G,MAAQoG,EAAOpG,MAEtBoG,EAAOG,WAAalc,EAAE2V,MAAF3V,QAAakc,UAAUS,UACvCZ,EAAOW,OACPX,EAAO1I,SAEP0I,EAAO+N,SAKnB9pB,EAAE2V,MAAMoG,OAAO5a,UAAUib,OAAS,WAC9B,GAAIL,GAASnd,IACbmd,GAAOM,IAAIla,QAGfnC,EAAE2V,MAAMoG,OAAO5a,UAAU4Z,WAAa,SAAS3Y,EAAQoI,GACnD,GAAIuR,GAASnd,IACb4L,GAAIuf,eAEJ,KAAK,GAAIrqB,KAAKqc,GAAO1Z,QACf,OAAL3C,GAAwB,gBAAV0C,GAAsC,gBAAVA,KAIzCoI,EAAIwf,gBAAuB,UAALtqB,IAI3B8K,EAAIuf,aAAarqB,GAAKqc,EAAO1Z,OAAO3C,WAGjC8K,GAAIwf,eAEJjO,EAAOpG,MAAM6C,UAAUrW,KAAKC,EAAQoI,EAEpC,SAAS7H,GAELoZ,EAAOf,aAAa5Y,GAAQ,EAAMO,IAGtC,SAASA,GAELoZ,EAAOf,aAAa5Y,GAAQ,EAAOO,MA0B3C3C,EAAE2V,MAAMoG,OAAO5a,UAAU8oB,uBAAyB,SAASC,EAAQjmB,EAAUiF,GAChF,GAAI6S,GAASnd,KACTsL,EAAU6R,EAAOwM,WAErB,IAA8B,mBAAnBre,GAAQggB,OAAwB,CACvC,GAAIC,GAAUhR,EAAU+Q,EACxBtnB,SAAQ+D,KAAK,WAAaoV,EAAOH,OAAS,oBAAqB1R,EAASigB,GAExEjgB,EAAQkgB,UAAUF,GACpB1Y,KAAK,WACF5O,QAAQC,IAAI,WAAakZ,EAAOH,OAAS,2CAA6CsO,GAClFjmB,GACPA,GAAS,EAAMkmB,EAASjhB,KAJtBgB,SAOI,SAAS5G,GACZ,GAAI+mB,GAAe/mB,CACA,mBAAfA,EAAM4V,OACbmR,EAAe,WAAatO,EAAOH,OAAS,6DAC3BtY,GAEVW,GACPA,GAAS,EAAO,KAAMiF,GAEnBtG,QAAQU,MAAM+mB,SAGfznB,SAAQ8L,KAAK,WAAaqN,EAAOH,OAAS,sDACtC3X,GACPA,GAAS,EAAO,KAAMiF,IAKpBlJ,EAAE2V,MAAMoG,OAAO5a,UAAU0a,SAAW,SAAS9C,GACzC,GAAIgD,GAASnd,IAMb,IAJImd,EAAOhD,OAAS/Y,EAAE2V,MAAF3V,QAAa+Y,MAAMuR,SACnCvO,EAAOwO,cAGPxO,EAAOhD,OAASA,IAAUH,EAAiBmD,EAAOhD,MAAOA,GAGzD,MAFAnW,SAAQU,MAAM,UAAYyY,EAAOH,OAAS,+BAAiCG,EAAOhD,MAAMG,KAAO,OAASH,EAAMG,MAC9G6C,EAAOD,UACA,CAYX,QATAlZ,QAAQC,IAAI,UAAYkZ,EAAOH,OAAS,uBAAyBG,EAAOhD,MAAMG,KAAO,OAASH,EAAMG,MAEpG6C,EAAOsM,UAAYtM,EAAOhD,MAC1BgD,EAAOhD,MAAQA,EAEXgD,EAAO5S,UAAUqhB,eACjBzO,EAAO5S,UAAUqhB,cAAc5rB,MAG3Bmd,EAAOhD,OAEf,IAAK/Y,GAAE2V,MAAF3V,QAAa+Y,MAAM0R,MACxB,IAAKzqB,GAAE2V,MAAF3V,QAAa+Y,MAAMuQ,OAE3B,GAAIoB,GAAU3O,EAAOrJ,QACrB9P,SAAQ+D,KAAK,kBAAmB+jB,GAE5BA,GAAuB,QAAZA,GAAiC,SAAZA,GACvCtlB,WAAW,WACP2W,EAAOkO,uBAAuBS,IAC/B,IAGA,MAEG,KAAK1qB,GAAE2V,MAAF3V,QAAa+Y,MAAM4R,OACpBvlB,WAAW,WACH2W,EAAOhD,OAAS/Y,EAAE2V,MAAF3V,QAAa+Y,MAAM4R,QACnC5O,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM+C,SAExC,IACH,MACJ,KAAK9b,GAAE2V,MAAF3V,QAAa+Y,MAAMC,MACpB+C,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM0H,QACnC,MACJ,KAAKzgB,GAAE2V,MAAF3V,QAAa+Y,MAAM+C,OAEhBC,EAAOsM,UAAUrK,IAAMhe,EAAE2V,MAAF3V,QAAa+Y,MAAMqQ,WAAWpL,KAAOjC,EAAOsM,UAAUrK,IAAMhe,EAAE2V,MAAF3V,QAAa+Y,MAAM+C,OAAOkC,KAC7GjC,EAAOhB,WAAW,gBAGtBgB,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM0H,QACnC,MACJ,KAAKzgB,GAAE2V,MAAF3V,QAAa+Y,MAAM0H,QAEqB,kBAA9B1E,GAAOpG,MAAMzV,QAAW,KACjCF,EAAE,IAAM+b,EAAO1Z,OAAO8X,KAAKyQ,eAGtB7O,GAAOpG,MAAM6E,QAAQuB,EAAOH,QACtCG,EAAO1Z,OAAOuI,YACrBmR,EAAOM,IAAI7I,WAEXuI,EAAOM,IAAI3L,OAKL,OAAO,GAGX1Q,EAAE2V,MAAMoG,OAAO5a,UAAU6Z,aAAe,SAAS5Y,EAAQiB,EAASV,GAC9D,GAAIoZ,GAASnd,IAIb,QAAQwD,GAER,IAAK,eACL,IAAK,eACGiB,EACA0Y,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMuQ,QAEnCvN,EAAOD,QAEX,MACJ,KAAK,eACGzY,EACA0Y,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM4R,QAEnC5O,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM0H,QAEvC,MAEJ,KAAK,YACD1E,EAAOD,QACP,MAEJ,KAAK,eACGnZ,EAAEkoB,YACiB,QAAfloB,EAAEkoB,UACE9O,EAAOhD,OAAS/Y,EAAE2V,MAAF3V,QAAa+Y,MAAM+R,MACnC/O,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM+R,MAEjB,UAAfnoB,EAAEkoB,WACL9O,EAAOhD,OAAS/Y,EAAE2V,MAAF3V,QAAa+Y,MAAMuQ,QACnCvN,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMuQ,WAevDtpB,EAAE2V,MAAMoG,OAAO5a,UAAU2a,OAAS,SAASzZ,GACvC,GAAI0Z,GAASnd,IAETyD,KACIA,EAAO0oB,YACrBhP,EAAOgP,UAAY1oB,EAAO0oB,WAGZ1oB,EAAOwnB,QACrB9N,EAAO8N,MAAQxnB,EAAOwnB,QAIlB9N,EAAO8N,OAAU9N,EAAOgP,YACzBhP,EAAO8N,MAAQ,mBAGR9N,EAAOhD,MAAMiF,KAAOhe,EAAE2V,MAAF3V,QAAa+Y,MAAb/Y,OAAuBge,KAAOjC,EAAOhD,MAAMiF,IAAMhe,EAAE2V,MAAF3V,QAAa+Y,MAAM+C,OAAOkC,IAC/FjC,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM+C,QAC5BC,EAAOhD,MAAMiF,IAAMhe,EAAE2V,MAAF3V,QAAa+Y,MAAM0H,SAC7C1E,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM0H,UAI3CzgB,EAAE2V,MAAMoG,OAAO5a,UAAUopB,YAAc,WACnC,GAAIxO,GAASnd,IACTmd,GAAOpG,MAAMiF,QACbmB,EAAOpG,MAAMiF,OAAOlK,QAI5B1Q,EAAE2V,MAAMoG,OAAO5a,UAAU6pB,aAAe,WACpC,GAAIjP,GAASnd,IAETmd,GAAOpG,MAAMiF,SACbmB,EAAOpG,MAAMiF,OAAOqQ,KAAK,MAAOlP,EAAOpG,MAAMzV,QAAQya,UAAU,GAAG9D,OAElEzR,WAAW,WACP2W,EAAOwO,cACHxO,EAAOhD,OAAS/Y,EAAE2V,MAAF3V,QAAa+Y,MAAMuR,SACnCvO,EAAOiP,gBAGfjP,EAAOpG,MAAMzV,QAAQqa,aAI7Bva,EAAE2V,MAAMoG,OAAO5a,UAAU2oB,KAAO,WAC5B,GAAI/N,GAASnd,IAEbmd,GAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMuR,SACnCvO,EAAOiP,gBAGXhrB,EAAE2V,MAAMoG,OAAO5a,UAAUwI,SAAW,SAASmJ,GACzC,GAAIiJ,GAASnd,IAEbmd,GAAO1Z,OAAOsH,SAAWmJ,EAErBA,EACAiJ,EAAO2M,YAAc3M,EAAOwM,YAE5BxM,EAAO2M,YAAc,KAGzB3M,EAAOM,IAAI1S,SAASoS,EAAO2M,YAAa3M,EAAO/Q,aAInDhL,EAAE2V,MAAMoG,OAAO5a,UAAUwS,QAAU,SAASC,GAC/C,GAAImI,GAASnd,IACb,OAAOmd,GAAOM,IAAI1I,QAAQC,IAGvB5T,EAAE2V,MAAMoG,OAAO5a,UAAUuS,QAAU,WACtC,GAAIqI,GAASnd,IACb,OAAOmd,GAAOM,IAAI3I,WAGf1T,EAAE2V,MAAMoG,OAAO5a,UAAU8S,aAAe,SAASL,GACpD,GAAImI,GAASnd,IACb,OAAOmd,GAAOM,IAAIpI,aAAaL,IAG5B5T,EAAE2V,MAAMoG,OAAO5a,UAAU6S,aAAe,WAC3C,GAAI+H,GAASnd,IACb,OAAOmd,GAAOM,IAAIrI,gBAGfhU,EAAE2V,MAAMoG,OAAO5a,UAAUiR,UAAY,SAASU,GAC1C,GAAIiJ,GAASnd,IAEbmd,GAAO1Z,OAAO+P,UAAYU,EAC1BiJ,EAAOM,IAAIjK,UAAUU,IAGzB9S,EAAE2V,MAAMoG,OAAO5a,UAAU+pB,KAAO,SAASC,GACrC,GAAIpP,GAASnd,IACTusB,IACApP,EAAOhB,WAAW,cACdmQ,KAAMC,KAKlBnrB,EAAE2V,MAAMoG,OAAO5a,UAAUiqB,IAAM,SAAS5gB,GACpC,GAAIuR,GAASnd,KAChBysB,IAEJ,OAAK7gB,IAIL6gB,EAAKtlB,KAAOyE,EAAIzE,KAChBslB,EAAKC,MAAQ9gB,EAAI8gB,YAGND,EAAKC,OAASD,EAAKtlB,OACnBgW,EAAOhB,WAAW,cACdwQ,IAAK/gB,EACnBwf,gBAAgB,OAVN,GAeRhqB,EAAE2V,MAAMoG,OAAO5a,UAAUkX,SAAW,SAASmT,EAAMnpB,GAC/C,GAAI0Z,GAASnd,IACT4sB,IACAzP,EAAOhB,WAAW,gBACdpC,OAAQ,WACRja,YAAa8sB,EACbnpB,OAAQA,KAKpBrC,EAAE2V,MAAMoG,OAAO5a,UAAU0Y,QAAU,SAAS4R,EAAeppB,GACvD,GAAI0Z,GAASnd,IACT6sB,IACA1P,EAAOhB,WAAW,gBACdpC,OAAQ,UACR8S,cAAeA,EACfppB,OAAQA,KAKpBrC,EAAE2V,MAAMoG,OAAO5a,UAAUuqB,KAAO,SAASrpB,GACrC,GAAI0Z,GAASnd,IAEbmd,GAAOhB,WAAW,gBACdpC,OAAQ,OACRtW,OAAQA,KAIhBrC,EAAE2V,MAAMoG,OAAO5a,UAAUwqB,OAAS,SAAStpB,GACvC,GAAI0Z,GAASnd,IAEbmd,GAAOhB,WAAW,gBACdpC,OAAQ,SACRtW,OAAQA,KAIhBrC,EAAE2V,MAAMoG,OAAO5a,UAAUyqB,WAAa,SAASvpB,GAC3C,GAAI0Z,GAASnd,IAEbmd,GAAOhB,WAAW,gBACdpC,OAAQ,aACRtW,OAAQA,KAIhBrC,EAAE2V,MAAMoG,OAAO5a,UAAUsP,QAAU,SAAStK,GACxC,GAAI4V,GAASnd,KACTkF,EAAM,CAcV,OAZAqC,GAAIkX,KAAOtB,EAAO1Z,OAAO7B,MAEpB2F,EAAItB,KACLjC,QAAQU,MAAM,cACdQ,KAGCqC,EAAI2U,OACLlY,QAAQU,MAAM,gBACdQ,KAGAA,GACO,GAGXiY,EAAOhB,WAAW,cACd5U,IAAKA,KAGF,IAGXnG,EAAE2V,MAAMoG,OAAO5a,UAAUkS,OAAS,SAAShR,GACvC,GAAI0Z,GAASnd,IAERmd,GAAOuM,WACVjmB,IACRA,MAGGA,EAAOkH,IAAMwS,EAAO1Z,OAAOkH,IAEhBlH,IACIA,EAAOsH,UACPoS,EAAOpS,UAAS,GAElCoS,EAAO1Z,OAAO4mB,eAAiB5mB,EAAO4mB,eACtClN,EAAO1Z,OAAO6mB,iBAAmB7mB,EAAO6mB,iBAEpC7mB,EAAOgJ,YACD0Q,EAAO1Q,UAAYhJ,EAAOgJ,UAC1B0Q,EAAOzQ,eAAiBjJ,EAAOiJ,gBAGrCjJ,EAAOqI,SACDqR,EAAOrR,OAASrI,EAAOqI,OACvBqR,EAAOrR,OAASrI,EAAOkJ,aAG7BlJ,EAAOqQ,WACPqJ,EAAOrJ,SAAWrQ,EAAOqQ,WAInBqJ,EAAOM,IAAI1O,aAAatL,GACxB0Z,EAAOuM,UAAW,IAI1BtoB,EAAE2V,MAAMoG,OAAO5a,UAAUmb,aAAe,SAASja,GAC7C,GAAI0Z,GAASnd,IAEbmd,GAAO8P,WAAY,EAEf9P,EAAOhD,MAAMiF,KAAOhe,EAAE2V,MAAF3V,QAAa+Y,MAAMuQ,OAAOtL,MAI9CjC,EAAOhD,MAAMiF,KAAOhe,EAAE2V,MAAF3V,QAAa+Y,MAAM0R,MAAMzM,IAC7CjC,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMuQ,QAE/BvN,EAAO+P,SACPlpB,QAAQC,IAAI,UAAYkZ,EAAOH,OAAS,kEAExChZ,QAAQC,IAAI,UAAYkZ,EAAOH,OAAS,sBACxCG,EAAOM,IAAIhJ,OAAOhR,EAAOkH,IAAK,WAC1BwS,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMuQ,SACpC,SAAS3mB,GACRC,QAAQU,MAAMX,GACdoZ,EAAOD,WAEXlZ,QAAQC,IAAI,UAAYkZ,EAAOH,OAAS,aAAcvZ,EAAOkH,QAOzEvJ,EAAE2V,MAAMoG,OAAO5a,UAAU4qB,UAAY,SAASC,GAC1C,GAAIjQ,GAASnd,KACTqtB,EAAQlQ,EAAO1Z,OAAOwmB,uBAAyBmD,EAAM,QAAU,MAAQjQ,EAAO1Z,OAAO0mB,yBAA2BiD,EAAM,OAAS,IACnI,OAAOC,IAGXjsB,EAAE2V,MAAMoG,OAAO5a,UAAU+b,YAAc,SAAS/W,EAAK9D,GACjD,GAAI0Z,GAASnd,IAETmd,GAAO5S,UAAU6T,WACjBjB,EAAO5S,UAAU6T,UAAUjB,EAAOpG,MAAOoG,EAAQ5V,EAAK9D,IAI9DrC,EAAE2V,MAAMoG,OAAO5a,UAAUsb,WAAa,SAASpa,GAC3C,GAAI0Z,GAASnd,IAEbmd,GAAOmB,YAAYld,EAAE2V,MAAF3V,QAAayQ,QAAQ9J,KAAMtE,IAIlDrC,EAAE2V,MAAMoG,OAAO5a,UAAUqb,cAAgB,SAASna,GAC9C,GAAI0Z,GAASnd,IAETyD,GAAO6pB,eACPnQ,EAAO1Z,OAAOwmB,sBAAwBxmB,EAAO6pB,cAE7C7pB,EAAO8pB,iBACPpQ,EAAO1Z,OAAO0mB,wBAA0B1mB,EAAO8pB,gBAGnDpQ,EAAOmB,YAAYld,EAAE2V,MAAF3V,QAAayQ,QAAQ5G,aAG5C7J,EAAE2V,MAAMoG,OAAO5a,UAAUob,YAAc,SAASla,GAC5C,GAAI0Z,GAASnd,IAETmd,GAAOhD,MAAMiF,KAAOhe,EAAE2V,MAAF3V,QAAa+Y,MAAM0R,MAAMzM,MAIjDjC,EAAO+P,UAAW,EAElB/P,EAAOM,IAAIhJ,OAAOhR,EAAOkH,IAAK,WAC1B3G,QAAQC,IAAI,UAAYkZ,EAAOH,OAAS,4BACxCG,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAM0R,OAE/B1O,EAAO8P,YACPjpB,QAAQC,IAAI,UAAYkZ,EAAOH,OAAS,qBACxCG,EAAOF,SAAS7b,EAAE2V,MAAF3V,QAAa+Y,MAAMuQ,UAExC,SAAS3mB,GACRC,QAAQU,MAAMX,GACdoZ,EAAOD,WAEXlZ,QAAQC,IAAI,UAAYkZ,EAAOH,OAAS,YAAavZ,EAAOkH,OAGhEvJ,EAAE2V,MAAMyW,KAAO,SAASC,GACpB,GAAI3sB,GAAI,EACRgb,IAOA,OANA2R,GAAErZ,MAAM,KAAKsZ,IAAI,SAASntB,GACtBub,EAAEvb,IACE+Z,KAAM/Z,EACN6e,IAAKte,OAGN+R,OAAO8a,OAAO7R,IAGzB1a,EAAE2V,MAAF3V,WAEAA,EAAE2V,MAAF3V,QAAaiZ,OAASxH,OAAO8a,QACzBC,OACIpD,WAAY,EACZxM,WAAY,EACZ0N,QAAS,EACT7J,QAAS,EACT4I,UAAW,EAClBvN,OAAQ,GAELsN,YACIuB,OAAQ,EACR7O,OAAQ,EACfwN,OAAQ,GAEL1M,YACIyM,UAAW,EACXvN,OAAQ,GAEZ6O,QACIrB,OAAQ,EACRmB,MAAO,EACP3O,OAAQ,GAEZwO,SACIjB,UAAW,EACXvN,OAAQ,GAEZuN,WACIC,OAAQ,EACRxN,OAAQ,GAEZwN,QACID,UAAW,EACXD,WAAY,EACZtN,OAAQ,EACRgP,KAAM,GAEVA,MACIhP,OAAQ,EACRwN,OAAQ,GAEZmB,OACI3O,OAAQ,EACRwN,OAAQ,GAEZxN,QACI2E,QAAS,GAEbA,WACAzH,OACIyH,QAAS,KAIjBzgB,EAAE2V,MAAF3V,QAAa+Y,MAAQ/Y,EAAE2V,MAAMyW,KAAK,6FAClCpsB,EAAE2V,MAAF3V,QAAakc,UAAYlc,EAAE2V,MAAMyW,KAAK,oBACtCpsB,EAAE2V,MAAF3V,QAAayQ,QAAUzQ,EAAE2V,MAAMyW,KAAK,qCAEpCpsB,EAAE2V,MAAF3V,QAAeyR,OAAO8a,OAAOvsB,EAAE2V,MAAF3V,SAE7BA,EAAE2V,MAAMuE,SAERla,EAAE2V,MAAM8W,aAER,IAAIC,GAAkB,eAElB5iB,GAAO,OAAQ,SAAU,QAAQ/B,QAAQgC,UAAUC,WAAa,CAChEF,KACF4iB,EAAkB,YAGpB1sB,EAAEnB,QAAQ8tB,KAAKD,EAAiB,WAC5B,IAAK,GAAIE,KAAK5sB,GAAE2V,MAAM8W,WACpBzsB,EAAE2V,MAAM8W,WAAWG,IAGrB,IAAI5sB,EAAE2V,MAAMkX,YACV,MAAO7sB,GAAE2V,MAAMkX,aAEjB,KAAK,GAAIntB,KAAKM,GAAE2V,MAAMuE,MAAO,CACzB,GAAIvE,GAAQ3V,EAAE2V,MAAMuE,MAAMxa,EACtBiW,KACAA,EAAMqD,QACNrD,EAAMkF,UAId,MAAO7a,GAAE2V,MAAMmX,eAGnB9sB,EAAE2V,MAAMoX,gBACR/sB,EAAE2V,MAAMqX,kBACRhtB,EAAE2V,MAAMyD,kBAER,IAAI6T,GAAe,SAAS1X,GAM/B,QAAS2X,GAAWC,GAEhB,IAAK,GAAIztB,GAAI,EAAGA,IAAMytB,EAAY3tB,SAAUE,EAAG,CAClD,GAAI0tB,GAAaD,EAAYztB,GACzBqY,EAAO,EAEXnV,SAAQC,IAAIuqB,GACZxqB,QAAQC,IAAIuqB,EAAWC,KAAO,KAAOD,EAAWE,MAAQ,SAAWF,EAAWtiB,UAEtD,eAApBsiB,EAAWC,MACXtV,EAAOqV,EAAWE,OAAS,eAAiBC,EAAO/tB,OAAS,GAC5D+tB,EAAO3nB,MAAMlD,GAAI0qB,EAAWtiB,SAAUuiB,KAAM,WAAYC,MAAOvV,KACpC,gBAApBqV,EAAWC,MAClBtV,EAAOqV,EAAWE,OAAS,YAAcE,EAAQhuB,OAAS,GAC1DguB,EAAQ5nB,MAAMlD,GAAI0qB,EAAWtiB,SAAUuiB,KAAM,YAAaC,MAAOvV,KACtC,eAApBqV,EAAWC,MAClBtV,EAAOqV,EAAWE,OAAS,WAAaG,EAAIjuB,OAAS,GACrDiuB,EAAI7nB,MAAMlD,GAAI0qB,EAAWtiB,SAAUuiB,KAAM,QAASC,MAAOvV,KAEzDnV,QAAQC,IAAI,qCAAsCuqB,GAKnDptB,EAAE2V,MAAMoX,aAAeU,EACvBztB,EAAE2V,MAAMqX,eAAiBO,EACzBvtB,EAAE2V,MAAMyD,gBAAkBoU,EAE1B5qB,QAAQ+D,KAAK,mBAAoB3G,EAAE2V,MAAMqX,gBACzCpqB,QAAQ+D,KAAK,oBAAqB3G,EAAE2V,MAAMyD,iBAC1CxW,QAAQ+D,KAAK,gBAAiB3G,EAAE2V,MAAMoX,cAElCW,GACPA,EAAQ7c,YAAYvB,QAAQ,SAASC,GAAQA,EAAMmB,SAG5C6E,GACPA,GAAQ,GAOT,QAASoY,GAAYrqB,GACjBV,QAAQC,IAAI,6BAA8BS,GACtCiS,GAASA,GAAQ,GAIzB,QAASqY,GAAWC,GAChB,IAAK,GAAInuB,GAAI,EAAGA,IAAMmuB,EAAKruB,SAAUE,EAEnB,eAAjBmuB,EAAKnuB,GAAG2tB,KACRS,IACwB,eAAjBD,EAAKnuB,GAAG2tB,MACfU,GAGDhkB,WAAU8H,aAAa3G,cAAeT,MAAQqjB,EAAY,GAAI,GAAO,EAAQ1iB,MAAQ2iB,EAAY,GAAI,GAAO,IAChGvc,KAAK,SAAS7I,GACP+kB,EAAU/kB,EACVoB,UAAU8H,aAAamc,mBAAmBxc,KAAK0b,GAA/CnjB,SAAiE4jB,KAHpF5jB,SAKa,SAASjG,GACXlB,QAAQC,IAAI,iCAAmCiB,EAAIoV,QAtElEtW,QAAQ+D,KAAK,sBACb,IAEI+mB,GAFAH,KAAaC,KAAcC,KAC3BM,EAAY,EAAGD,EAAY,CAyE/B/jB,WAAU8H,aAAamc,mBAAmBxc,KAAKoc,GAA/C7jB,SAAiE4jB,GAI9D3tB,GAAE2V,MAAMsY,eAAiB,SAAS1Y,GACrC0X,EAAa1X,IAGVvV,EAAE2V,MAAMoK,KAAO,SAASvV,EAAK+K,GAC3B/K,IACDA,MAGCA,EAAI0jB,eAAkB1jB,EAAI2jB,gBAIpB3jB,EAAI0jB,gBAAkB1jB,EAAI2jB,gBACjClB,EAAa1X,IACL/K,EAAI0jB,eAAiB1jB,EAAI2jB,gBACjCnuB,EAAEmS,MAAMmD,WAAW,SAAS8Y,GAC/B7Y,EAAQ6Y,KACF,GAAM,GAET7Y,EAAQ,MAVRvV,EAAEmS,MAAMmD,WAAW,SAAS8Y,GAC/BnB,EAAa1X,KACP,GAAM,IAaVvV,EAAE2V,MAAM0Y,QAAU,WACrB,MAAO/U,OAILhS,QAEH,SAAUslB,GAAG,GAAoB,gBAAV0B,UAAoC,mBAATC,QAAsBA,OAAOD,QAAQ1B,QAAS,IAAmB,kBAAT4B,SAAqBA,OAAOC,IAAKD,UAAU5B,OAAO,CAAC,GAAI8B,EAAkCA,GAAb,mBAAT7vB,QAAwBA,OAA+B,mBAAT8vB,QAAwBA,OAA6B,mBAAPxuB,MAAsBA,KAAYvB,KAAK8vB,EAAEE,QAAUhC,MAAO,WAAqC,MAAO,YAAY,QAAS7S,GAAEpX,EAAEwb,EAAE0Q,GAAG,QAASnU,GAAEhb,EAAEktB,GAAG,IAAIzO,EAAEze,GAAG,CAAC,IAAIiD,EAAEjD,GAAG,CAAC,GAAIoa,GAAE,kBAAmBgV,UAASA,OAAQ,KAAIlC,GAAG9S,EAAE,MAAOA,GAAEpa,GAAE,EAAI,IAAGgc,EAAE,MAAOA,GAAEhc,GAAE,EAAI,IAAIme,GAAE,GAAIkR,OAAM,uBAAuBrvB,EAAE,IAAK,MAAMme,GAAE9X,KAAK,mBAAmB8X,EAAE,GAAImR,GAAE7Q,EAAEze,IAAI4uB,WAAY3rB,GAAEjD,GAAG,GAAGyC,KAAK6sB,EAAEV,QAAQ,SAASvU,GAAG,GAAIoE,GAAExb,EAAEjD,GAAG,GAAGqa,EAAG,OAAOW,GAAEyD,GAAGpE,IAAIiV,EAAEA,EAAEV,QAAQvU,EAAEpX,EAAEwb,EAAE0Q,GAAG,MAAO1Q,GAAEze,GAAG4uB,QAAQ,IAAI,GAAI5S,GAAE,kBAAmBoT,UAASA,QAAQpvB,EAAE,EAAEA,EAAEmvB,EAAErvB,OAAOE,IAAIgb,EAAEmU,EAAEnvB,GAAI,OAAOgb,GAAE,MAAOX,OAAOkV,GAAG,SAASH,EAAQP,EAAOD,GAUv1B,YAEA,IAAIY,GAAmBJ,EAAQ,wBAE3BF,EAAcM,EAAiBC,gBAAkBtwB,OAAQA,QAC7D0vB,GAAOD,QAAUM,IAEdQ,uBAAuB,IAAIC,GAAG,SAASP,EAAQP,EAAOD,GACzD,YA+BA,SAASgB,GAAwB9kB,GAAO,GAAIA,GAAOA,EAAI+kB,WAAc,MAAO/kB,EAAc,IAAIglB,KAAa,IAAW,MAAPhlB,EAAe,IAAK,GAAIuS,KAAOvS,GAAWiH,OAAOtQ,UAAUsuB,eAAettB,KAAKqI,EAAKuS,KAAMyS,EAAOzS,GAAOvS,EAAIuS,GAAgC,OAAtByS,GAAAA,WAAiBhlB,EAAYglB,EAUlQ,QAASL,KACP,GAAIO,GAAOC,UAAUnwB,OAAS,GAAsB4H,SAAjBuoB,UAAU,GAAmBA,UAAU,MACtE9wB,EAAS6wB,EAAK7wB,OAEdqB,EAAUyvB,UAAUnwB,OAAS,GAAsB4H,SAAjBuoB,UAAU,GAAmBA,UAAU,IAC3EC,YAAY,EACZC,aAAa,EACbC,UAAU,EACVC,YAAY,GAIVC,EAAUC,EAAMptB,IAChBqtB,EAAiBD,EAAME,cAActxB,GAErC+vB;AACFsB,eAAgBA,EAChBE,WAAYA,EACZC,eAAgBJ,EAAMI,eACtBC,WAAYL,EAAMK,WAClBC,gBAAiBN,EAAMM,gBAIzB,QAAQL,EAAeM,SACrB,IAAK,SACH,IAAKC,IAAeA,EAAWC,qBAAuBxwB,EAAQ0vB,WAE5D,MADAI,GAAQ,wDACDpB,CAEToB,GAAQ,+BAERpB,EAAQ+B,YAAcF,EAEtBA,EAAWG,iBAAiB/xB,GAC5B4xB,EAAWI,gBAAgBhyB,GAC3B4xB,EAAWC,mBAAmB7xB,GAC9B4xB,EAAWK,YAAYjyB,GACvB4xB,EAAWM,wBAAwBlyB,GACnC4xB,EAAWO,uBAAuBnyB,GAClC4xB,EAAWQ,2BAA2BpyB,GACtC4xB,EAAWS,qBAAqBryB,GAEhCuxB,EAAWe,oBAAoBtyB,GAC/BuxB,EAAWgB,oBAAoBvyB,GAC/BuxB,EAAWiB,mBAAmBxyB,GAC9BuxB,EAAWkB,uBAAuBzyB,GAClCuxB,EAAWmB,uBAAuB1yB,EAClC,MACF,KAAK,UACH,IAAK2yB,IAAgBA,EAAYd,qBAAuBxwB,EAAQ2vB,YAE9D,MADAG,GAAQ,yDACDpB,CAEToB,GAAQ,gCAERpB,EAAQ+B,YAAca,EAEtBA,EAAYZ,iBAAiB/xB,GAC7B2yB,EAAYd,mBAAmB7xB,GAC/B2yB,EAAYV,YAAYjyB,GACxB2yB,EAAYC,iBAAiB5yB,GAC7B2yB,EAAYE,mBAAmB7yB,GAC/B2yB,EAAYG,qBAAqB9yB,GACjC2yB,EAAYI,mBAAmB/yB,GAE/BuxB,EAAWe,oBAAoBtyB,GAC/BuxB,EAAWgB,oBAAoBvyB,GAC/BuxB,EAAWiB,mBAAmBxyB,GAC9BuxB,EAAWkB,uBAAuBzyB,EAClC,MACF,KAAK,OACH,IAAKgzB,IAAaA,EAASnB,qBAAuBxwB,EAAQ4vB,SAExD,MADAE,GAAQ,yDACDpB,CAEToB,GAAQ,6BAERpB,EAAQ+B,YAAckB,EAEtBA,EAASjB,iBAAiB/xB,GAC1BgzB,EAASC,oBAAoBjzB,GAC7BgzB,EAASnB,mBAAmB7xB,GAC5BgzB,EAASE,iBAAiBlzB,GAI1BuxB,EAAWiB,mBAAmBxyB,GAC9BuxB,EAAWkB,uBAAuBzyB,EAClC,MACF,KAAK,SACH,IAAKmzB,IAAe9xB,EAAQ6vB,WAE1B,MADAC,GAAQ,wDACDpB,CAEToB,GAAQ,+BAERpB,EAAQ+B,YAAcqB,EAEtBA,EAAWC,qBAAqBpzB,GAChCmzB,EAAWE,sBAAsBrzB,GACjCmzB,EAAWG,iBAAiBtzB,GAC5BmzB,EAAWI,oBAAoBvzB,GAC/BmzB,EAAWK,qBAAqBxzB,GAChCmzB,EAAWM,0BAA0BzzB,GACrCmzB,EAAWpB,iBAAiB/xB,GAE5BuxB,EAAWe,oBAAoBtyB,GAC/BuxB,EAAWiB,mBAAmBxyB,GAC9BuxB,EAAWkB,uBAAuBzyB,GAClCuxB,EAAWmB,uBAAuB1yB,EAClC,MACF,SACEmxB,EAAQ,wBAIZ,MAAOpB,GA5JTnd,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,IAET0L,EAAQa,eAAiBA,CAEzB,IAAIqD,GAAS1D,EAAQ,WAEjBmB,EAAQX,EAAwBkD,GAEhCC,EAAe3D,EAAQ,wBAEvB2B,EAAanB,EAAwBmD,GAErCC,EAAa5D,EAAQ,oBAErB+C,EAAWvC,EAAwBoD,GAEnCC,EAAgB7D,EAAQ,0BAExB0C,EAAclC,EAAwBqD,GAEtCC,EAAe9D,EAAQ,wBAEvBkD,EAAa1C,EAAwBsD,GAErCC,EAAe/D,EAAQ,iBAEvBsB,EAAad,EAAwBuD,KAsItCC,uBAAuB,EAAEC,gBAAgB,EAAEC,mBAAmB,EAAEC,yBAAyB,GAAGC,uBAAuB,GAAGC,UAAU,KAAKC,GAAG,SAAStE,EAAQP,EAAOD,GAUnK,YAuCA,SAASgB,GAAwB9kB,GAAO,GAAIA,GAAOA,EAAI+kB,WAAc,MAAO/kB,EAAc,IAAIglB,KAAa,IAAW,MAAPhlB,EAAe,IAAK,GAAIuS,KAAOvS,GAAWiH,OAAOtQ,UAAUsuB,eAAettB,KAAKqI,EAAKuS,KAAMyS,EAAOzS,GAAOvS,EAAIuS,GAAgC,OAAtByS,GAAAA,WAAiBhlB,EAAYglB,EAGlQ,QAAS6D,GAAUC,EAAOC,EAAMC,GACzBD,IAAQC,EAAUC,IAAIF,EAAK7wB,MAGhC8wB,EAAUE,IAAIH,EAAK7wB,GAAI6wB,GACvB9hB,OAAOkiB,KAAKJ,GAAMjkB,QAAQ,SAAU4J,GAC9BA,EAAK0a,SAAS,MAChBP,EAAUC,EAAOA,EAAMjV,IAAIkV,EAAKra,IAAQsa,GAC/Bta,EAAK0a,SAAS,QACvBL,EAAKra,GAAM5J,QAAQ,SAAU5M,GAC3B2wB,EAAUC,EAAOA,EAAMjV,IAAI3b,GAAK8wB,QAOxC,QAASK,GAAYtwB,EAAQgM,EAAO4M,GAClC,GAAI2X,GAAkB3X,EAAW,eAAiB,cAC9C4X,EAAiB,GAAIC,IACzB,IAAc,OAAVzkB,EACF,MAAOwkB,EAET,IAAIE,KAaJ,OAZA1wB,GAAO+L,QAAQ,SAAUsT,GACJ,UAAfA,EAAM5f,MAAoB4f,EAAMsR,kBAAoB3kB,EAAM7M,IAC5DuxB,EAAWruB,KAAKgd,KAGpBqR,EAAW3kB,QAAQ,SAAU6kB,GAC3B5wB,EAAO+L,QAAQ,SAAUgkB,GACnBA,EAAMtwB,OAAS8wB,GAAmBR,EAAMc,UAAYD,EAAUzxB,IAChE2wB,EAAU9vB,EAAQ+vB,EAAOS,OAIxBA,EAGT,QAASlD,GAAgBhyB,GACvBA,EAAO8R,YAAc9R,EAAO8R,aAAe9R,EAAOw1B,kBAGpD,QAASvD,GAAYjyB,GACnB,GAAwE,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,MAAyBA,EAAOqQ,mBAAuB,WAAarQ,GAAOqQ,kBAAkB/N,UAiEtJ8uB,EAAMsE,wBAAwB11B,EAAQ,QAAS,SAAU8D,GAIvD,MAHKA,GAAE6xB,aACL/iB,OAAO8gB,eAAe5vB,EAAG,eAAiBigB,OAAS6R,SAAU9xB,EAAE8xB,YAE1D9xB,QArEyJ,CAClK8O,OAAO8gB,eAAe1zB,EAAOqQ,kBAAkB/N,UAAW,WACxDkd,IAAK,WACH,MAAOzf,MAAK81B,UAEdhB,IAAK,SAAa9G,GACZhuB,KAAK81B,UACP91B,KAAK+1B,oBAAoB,QAAS/1B,KAAK81B,UAEzC91B,KAAKg2B,iBAAiB,QAASh2B,KAAK81B,SAAW9H,IAGjDiI,YAAY,EACZC,cAAc,GAEhB,IAAIC,GAA2Bl2B,EAAOqQ,kBAAkB/N,UAAUyM,oBAClE/O,GAAOqQ,kBAAkB/N,UAAUyM,qBAAuB,WACxD,GAAIonB,GAAQp2B,IA0CZ,OAxCKA,MAAKq2B,eACRr2B,KAAKq2B,aAAe,SAAUtyB,GAG5BA,EAAEgG,OAAOisB,iBAAiB,WAAY,SAAUM,GAC9C,GAAIT,GAAW,MAEbA,GADE51B,EAAOqQ,kBAAkB/N,UAAUg0B,aAC1BH,EAAMG,eAAeC,KAAK,SAAUrb,GAC7C,MAAOA,GAAExK,OAASwK,EAAExK,MAAM7M,KAAOwyB,EAAG3lB,MAAM7M,MAG/B6M,MAAO2lB,EAAG3lB,MAGzB,IAAIrQ,GAAQ,GAAIm2B,OAAM,QACtBn2B,GAAMqQ,MAAQ2lB,EAAG3lB,MACjBrQ,EAAMu1B,SAAWA,EACjBv1B,EAAMs1B,aAAgBC,SAAUA,GAChCv1B,EAAMyQ,SAAWhN,EAAEgG,QACnBqsB,EAAMM,cAAcp2B,KAEtByD,EAAEgG,OAAOkI,YAAYvB,QAAQ,SAAUC,GACrC,GAAIklB,GAAW,MAEbA,GADE51B,EAAOqQ,kBAAkB/N,UAAUg0B,aAC1BH,EAAMG,eAAeC,KAAK,SAAUrb,GAC7C,MAAOA,GAAExK,OAASwK,EAAExK,MAAM7M,KAAO6M,EAAM7M,MAG5B6M,MAAOA,EAEtB,IAAIrQ,GAAQ,GAAIm2B,OAAM,QACtBn2B,GAAMqQ,MAAQA,EACdrQ,EAAMu1B,SAAWA,EACjBv1B,EAAMs1B,aAAgBC,SAAUA,GAChCv1B,EAAMyQ,SAAWhN,EAAEgG,QACnBqsB,EAAMM,cAAcp2B,MAGxBN,KAAKg2B,iBAAiB,YAAah2B,KAAKq2B,eAEnCF,EAAyBQ,MAAM32B,KAAM+wB,aAelD,QAASqB,GAAuBnyB,GAE9B,GAAwE,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,KAAyBA,EAAOqQ,qBAAuB,cAAgBrQ,GAAOqQ,kBAAkB/N,YAAc,oBAAsBtC,GAAOqQ,kBAAkB/N,UAAW,CACjO,GAAIq0B,GAAqB,SAA4BC,EAAIlmB,GACvD,OACEA,MAAOA,EACPmmB,GAAIxK,QAQF,MAPmB9jB,UAAfxI,KAAK+2B,QACY,UAAfpmB,EAAM8d,KACRzuB,KAAK+2B,MAAQF,EAAGG,iBAAiBrmB,GAEjC3Q,KAAK+2B,MAAQ,MAGV/2B,KAAK+2B,OAEdE,IAAKJ,GAKT,KAAK52B,EAAOqQ,kBAAkB/N,UAAU20B,WAAY,CAClDj3B,EAAOqQ,kBAAkB/N,UAAU20B,WAAa,WAE9C,MADAl3B,MAAKm3B,SAAWn3B,KAAKm3B,aACdn3B,KAAKm3B,SAASC,QAEvB,IAAIC,GAAep3B,EAAOqQ,kBAAkB/N,UAAUqO,QACtD3Q,GAAOqQ,kBAAkB/N,UAAUqO,SAAW,SAAUD,EAAO5G,GAC7D,GAAIutB,GAASD,EAAaV,MAAM32B,KAAM+wB,UAKtC,OAJKuG,KACHA,EAASV,EAAmB52B,KAAM2Q,GAClC3Q,KAAKm3B,SAASnwB,KAAKswB,IAEdA,EAGT,IAAIC,GAAkBt3B,EAAOqQ,kBAAkB/N,UAAUi1B,WACzDv3B,GAAOqQ,kBAAkB/N,UAAUi1B,YAAc,SAAUF,GACzDC,EAAgBZ,MAAM32B,KAAM+wB,UAC5B,IAAI0G,GAAMz3B,KAAKm3B,SAAShuB,QAAQmuB,EACpB,MAARG,GACFz3B,KAAKm3B,SAASO,OAAOD,EAAK,IAIhC,GAAIE,GAAgB13B,EAAOqQ,kBAAkB/N,UAAUyO,SACvD/Q,GAAOqQ,kBAAkB/N,UAAUyO,UAAY,SAAUjH,GACvD,GAAI6tB,GAAS53B,IAEbA,MAAKm3B,SAAWn3B,KAAKm3B,aACrBQ,EAAchB,MAAM32B,MAAO+J,IAC3BA,EAAOkI,YAAYvB,QAAQ,SAAUC,GACnCinB,EAAOT,SAASnwB,KAAK4vB,EAAmBgB,EAAQjnB,MAIpD,IAAIknB,GAAmB53B,EAAOqQ,kBAAkB/N,UAAUu1B,YAC1D73B,GAAOqQ,kBAAkB/N,UAAUu1B,aAAe,SAAU/tB,GAC1D,GAAIguB,GAAS/3B,IAEbA,MAAKm3B,SAAWn3B,KAAKm3B,aACrBU,EAAiBlB,MAAM32B,MAAO+J,IAE9BA,EAAOkI,YAAYvB,QAAQ,SAAUC,GACnC,GAAI2mB,GAASS,EAAOZ,SAASX,KAAK,SAAU/I,GAC1C,MAAOA,GAAE9c,QAAUA,GAEjB2mB,IAEFS,EAAOZ,SAASO,OAAOK,EAAOZ,SAAShuB,QAAQmuB,GAAS,UAIzD,IAAwE,YAAjD,mBAAXr3B,GAAyB,YAAcy1B,EAAQz1B,KAAyBA,EAAOqQ,mBAAqB,cAAgBrQ,GAAOqQ,kBAAkB/N,WAAa,oBAAsBtC,GAAOqQ,kBAAkB/N,WAAatC,EAAO+3B,gBAAkB,QAAU/3B,GAAO+3B,aAAaz1B,WAAY,CAC1S,GAAI01B,GAAiBh4B,EAAOqQ,kBAAkB/N,UAAU20B,UACxDj3B,GAAOqQ,kBAAkB/N,UAAU20B,WAAa,WAC9C,GAAIgB,GAASl4B,KAETm4B,EAAUF,EAAetB,MAAM32B,QAInC,OAHAm4B,GAAQznB,QAAQ,SAAU4mB,GACxB,MAAOA,GAAOL,IAAMiB,IAEfC,GAGTtlB,OAAO8gB,eAAe1zB,EAAO+3B,aAAaz1B,UAAW,QACnDkd,IAAK,WAQH,MAPmBjX,UAAfxI,KAAK+2B,QACiB,UAApB/2B,KAAK2Q,MAAM8d,KACbzuB,KAAK+2B,MAAQ/2B,KAAKi3B,IAAID,iBAAiBh3B,KAAK2Q,OAE5C3Q,KAAK+2B,MAAQ,MAGV/2B,KAAK+2B,UAMpB,QAAS1E,GAA2BpyB,GAClC,GAA0E,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,KAAyBA,EAAOqQ,mBAAqBrQ,EAAO+3B,cAAgB/3B,EAAOm4B,eAAhJ,CAKA,KAAM,YAAcn4B,GAAO+3B,aAAaz1B,WAAY,CAClD,GAAI01B,GAAiBh4B,EAAOqQ,kBAAkB/N,UAAU20B,UACpDe,KACFh4B,EAAOqQ,kBAAkB/N,UAAU20B,WAAa,WAC9C,GAAImB,GAASr4B,KAETm4B,EAAUF,EAAetB,MAAM32B,QAInC,OAHAm4B,GAAQznB,QAAQ,SAAU4mB,GACxB,MAAOA,GAAOL,IAAMoB,IAEfF,GAIX,IAAId,GAAep3B,EAAOqQ,kBAAkB/N,UAAUqO,QAClDymB,KACFp3B,EAAOqQ,kBAAkB/N,UAAUqO,SAAW,WAC5C,GAAI0mB,GAASD,EAAaV,MAAM32B,KAAM+wB,UAEtC,OADAuG,GAAOL,IAAMj3B,KACNs3B,IAGXr3B,EAAO+3B,aAAaz1B,UAAU+1B,SAAW,WACvC,GAAIhB,GAASt3B,IACb,OAAOA,MAAKi3B,IAAIqB,WAAW1lB,KAAK,SAAUjO,GACxC,MAKEswB,GAAYtwB,EAAQ2yB,EAAO3mB,OAAO,MAO1C,KAAM,YAAc1Q,GAAOm4B,eAAe71B,WAAY,CACpD,GAAIg2B,GAAmBt4B,EAAOqQ,kBAAkB/N,UAAUg0B,YACtDgC,KACFt4B,EAAOqQ,kBAAkB/N,UAAUg0B,aAAe,WAChD,GAAIiC,GAASx4B,KAETy4B,EAAYF,EAAiB5B,MAAM32B,QAIvC,OAHAy4B,GAAU/nB,QAAQ,SAAUmlB,GAC1B,MAAOA,GAASoB,IAAMuB,IAEjBC,IAGXpH,EAAMsE,wBAAwB11B,EAAQ,QAAS,SAAU8D,GAEvD,MADAA,GAAE8xB,SAASoB,IAAMlzB,EAAE20B,WACZ30B,IAET9D,EAAOm4B,eAAe71B,UAAU+1B,SAAW,WACzC,GAAIzC,GAAW71B,IACf,OAAOA,MAAKi3B,IAAIqB,WAAW1lB,KAAK,SAAUjO,GACxC,MAAOswB,GAAYtwB,EAAQkxB,EAASllB,OAAO,MAKjD,GAAM,YAAc1Q,GAAO+3B,aAAaz1B,WAAa,YAActC,GAAOm4B,eAAe71B,UAAzF,CAKA,GAAIo2B,GAAe14B,EAAOqQ,kBAAkB/N,UAAU+1B,QACtDr4B,GAAOqQ,kBAAkB/N,UAAU+1B,SAAW,WAC5C,GAAIvH,UAAUnwB,OAAS,GAAKmwB,UAAU,YAAc9wB,GAAO24B,iBAAkB,CAC3E,GAAIjoB,GAAQogB,UAAU,GAClBuG,EAAS,OACTzB,EAAW,OACX3wB,EAAM,MAoBV,OAnBAlF,MAAKk3B,aAAaxmB,QAAQ,SAAU+c,GAC9BA,EAAE9c,QAAUA,IACV2mB,EACFpyB,GAAM,EAENoyB,EAAS7J,KAIfztB,KAAKu2B,eAAe7lB,QAAQ,SAAUyK,GAQpC,MAPIA,GAAExK,QAAUA,IACVklB,EACF3wB,GAAM,EAEN2wB,EAAW1a,GAGRA,EAAExK,QAAUA,IAEjBzL,GAAOoyB,GAAUzB,EACZpjB,QAAQomB,OAAO,GAAIC,cAAa,4DAA6D,uBAC3FxB,EACFA,EAAOgB,WACLzC,EACFA,EAASyC,WAEX7lB,QAAQomB,OAAO,GAAIC,cAAa,gDAAiD,uBAE1F,MAAOH,GAAahC,MAAM32B,KAAM+wB,cAIpC,QAASgI,GAAkC94B,GAIzCA,EAAOqQ,kBAAkB/N,UAAUy2B,gBAAkB,WACnD,GAAIC,GAASj5B,IAGb,OADAA,MAAKk5B,qBAAuBl5B,KAAKk5B,yBAC1BrmB,OAAOkiB,KAAK/0B,KAAKk5B,sBAAsBxL,IAAI,SAAUyL,GAC1D,MAAOF,GAAOC,qBAAqBC,GAAU,KAIjD,IAAI9B,GAAep3B,EAAOqQ,kBAAkB/N,UAAUqO,QACtD3Q,GAAOqQ,kBAAkB/N,UAAUqO,SAAW,SAAUD,EAAO5G,GAC7D,IAAKA,EACH,MAAOstB,GAAaV,MAAM32B,KAAM+wB,UAElC/wB,MAAKk5B,qBAAuBl5B,KAAKk5B,wBAEjC,IAAI5B,GAASD,EAAaV,MAAM32B,KAAM+wB,UAMtC,OALK/wB,MAAKk5B,qBAAqBnvB,EAAOjG,IAE8B,KAAzD9D,KAAKk5B,qBAAqBnvB,EAAOjG,IAAIqF,QAAQmuB,IACtDt3B,KAAKk5B,qBAAqBnvB,EAAOjG,IAAIkD,KAAKswB,GAF1Ct3B,KAAKk5B,qBAAqBnvB,EAAOjG,KAAOiG,EAAQutB,GAI3CA,EAGT,IAAIK,GAAgB13B,EAAOqQ,kBAAkB/N,UAAUyO,SACvD/Q,GAAOqQ,kBAAkB/N,UAAUyO,UAAY,SAAUjH,GACvD,GAAIqvB,GAASp5B,IAEbA,MAAKk5B,qBAAuBl5B,KAAKk5B,yBAEjCnvB,EAAOkI,YAAYvB,QAAQ,SAAUC,GACnC,GAAI0oB,GAAgBD,EAAOlC,aAAaV,KAAK,SAAU/I,GACrD,MAAOA,GAAE9c,QAAUA,GAErB,IAAI0oB,EACF,KAAM,IAAIP,cAAa,wBAAyB,uBAGpD,IAAIQ,GAAkBt5B,KAAKk3B,YAC3BS,GAAchB,MAAM32B,KAAM+wB,UAC1B,IAAIwI,GAAav5B,KAAKk3B,aAAasC,OAAO,SAAUC,GAClD,MAA8C,KAAvCH,EAAgBnwB,QAAQswB,IAEjCz5B,MAAKk5B,qBAAqBnvB,EAAOjG,KAAOiG,GAAQyK,OAAO+kB,GAGzD,IAAI1B,GAAmB53B,EAAOqQ,kBAAkB/N,UAAUu1B,YAC1D73B,GAAOqQ,kBAAkB/N,UAAUu1B,aAAe,SAAU/tB,GAG1D,MAFA/J,MAAKk5B,qBAAuBl5B,KAAKk5B,+BAC1Bl5B,MAAKk5B,qBAAqBnvB,EAAOjG,IACjC+zB,EAAiBlB,MAAM32B,KAAM+wB,WAGtC,IAAIwG,GAAkBt3B,EAAOqQ,kBAAkB/N,UAAUi1B,WACzDv3B,GAAOqQ,kBAAkB/N,UAAUi1B,YAAc,SAAUF,GACzD,GAAIoC,GAAS15B,IAcb,OAZAA,MAAKk5B,qBAAuBl5B,KAAKk5B,yBAC7B5B,GACFzkB,OAAOkiB,KAAK/0B,KAAKk5B,sBAAsBxoB,QAAQ,SAAUyoB,GACvD,GAAI1B,GAAMiC,EAAOR,qBAAqBC,GAAUhwB,QAAQmuB,EAC5C,MAARG,GACFiC,EAAOR,qBAAqBC,GAAUzB,OAAOD,EAAK,GAEC,IAAjDiC,EAAOR,qBAAqBC,GAAUv4B,cACjC84B,GAAOR,qBAAqBC,KAIlC5B,EAAgBZ,MAAM32B,KAAM+wB,YAIvC,QAASoB,GAAwBlyB,GA4G/B,QAAS05B,GAAwB9C,EAAI+C,GACnC,GAAIjvB,GAAMivB,EAAYjvB,GAMtB,OALAkI,QAAOkiB,KAAK8B,EAAGgD,qBAAuBnpB,QAAQ,SAAUopB,GACtD,GAAIC,GAAiBlD,EAAGgD,gBAAgBC,GACpCE,EAAiBnD,EAAGoD,SAASF,EAAej2B,GAChD6G,GAAMA,EAAIsQ,QAAQ,GAAIzR,QAAOwwB,EAAel2B,GAAI,KAAMi2B,EAAej2B,MAEhE,GAAImL,wBACT7K,KAAMw1B,EAAYx1B,KAClBuG,IAAKA,IAGT,QAASuvB,GAAwBrD,EAAI+C,GACnC,GAAIjvB,GAAMivB,EAAYjvB,GAMtB,OALAkI,QAAOkiB,KAAK8B,EAAGgD,qBAAuBnpB,QAAQ,SAAUopB,GACtD,GAAIC,GAAiBlD,EAAGgD,gBAAgBC,GACpCE,EAAiBnD,EAAGoD,SAASF,EAAej2B,GAChD6G,GAAMA,EAAIsQ,QAAQ,GAAIzR,QAAOuwB,EAAej2B,GAAI,KAAMk2B,EAAel2B,MAEhE,GAAImL,wBACT7K,KAAMw1B,EAAYx1B,KAClBuG,IAAKA,IAhIT,GAAK1K,EAAOqQ,kBAAZ,CAGA,GAAIghB,GAAiBD,EAAME,cAActxB,EAEzC,IAAIA,EAAOqQ,kBAAkB/N,UAAUqO,UAAY0gB,EAAe6I,SAAW,GAC3E,MAAOpB,GAAkC94B,EAK3C,IAAIm6B,GAAsBn6B,EAAOqQ,kBAAkB/N,UAAUy2B,eAC7D/4B,GAAOqQ,kBAAkB/N,UAAUy2B,gBAAkB,WACnD,GAAIqB,GAAUr6B,KAEVs6B,EAAgBF,EAAoBzD,MAAM32B,KAE9C,OADAA,MAAK65B,gBAAkB75B,KAAK65B,oBACrBS,EAAc5M,IAAI,SAAU3jB,GACjC,MAAOswB,GAAQR,gBAAgB9vB,EAAOjG,MAI1C,IAAI6zB,GAAgB13B,EAAOqQ,kBAAkB/N,UAAUyO,SACvD/Q,GAAOqQ,kBAAkB/N,UAAUyO,UAAY,SAAUjH,GACvD,GAAIwwB,GAAUv6B,IAed,IAbAA,KAAKi6B,SAAWj6B,KAAKi6B,aACrBj6B,KAAK65B,gBAAkB75B,KAAK65B,oBAE5B9vB,EAAOkI,YAAYvB,QAAQ,SAAUC,GACnC,GAAI0oB,GAAgBkB,EAAQrD,aAAaV,KAAK,SAAU/I,GACtD,MAAOA,GAAE9c,QAAUA,GAErB,IAAI0oB,EACF,KAAM,IAAIP,cAAa,wBAAyB,yBAK/C94B,KAAK65B,gBAAgB9vB,EAAOjG,IAAK,CACpC,GAAI02B,GAAY,GAAIv6B,GAAO8R,YAAYhI,EAAOkI,YAC9CjS,MAAKi6B,SAASlwB,EAAOjG,IAAM02B,EAC3Bx6B,KAAK65B,gBAAgBW,EAAU12B,IAAMiG,EACrCA,EAASywB,EAEX7C,EAAchB,MAAM32B,MAAO+J,IAG7B,IAAI8tB,GAAmB53B,EAAOqQ,kBAAkB/N,UAAUu1B,YAC1D73B,GAAOqQ,kBAAkB/N,UAAUu1B,aAAe,SAAU/tB,GAC1D/J,KAAKi6B,SAAWj6B,KAAKi6B,aACrBj6B,KAAK65B,gBAAkB75B,KAAK65B,oBAE5BhC,EAAiBlB,MAAM32B,MAAOA,KAAKi6B,SAASlwB,EAAOjG,KAAOiG,UACnD/J,MAAK65B,gBAAgB75B,KAAKi6B,SAASlwB,EAAOjG,IAAM9D,KAAKi6B,SAASlwB,EAAOjG,IAAIA,GAAKiG,EAAOjG,UACrF9D,MAAKi6B,SAASlwB,EAAOjG,KAG9B7D,EAAOqQ,kBAAkB/N,UAAUqO,SAAW,SAAUD,EAAO5G,GAC7D,GAAI0wB,GAAUz6B,IAEd,IAA4B,WAAxBA,KAAK06B,eACP,KAAM,IAAI5B,cAAa,sDAA0D,oBAEnF,IAAI/nB,MAAaqmB,MAAM7zB,KAAKwtB,UAAW,EACvC,IAAuB,IAAnBhgB,EAAQnQ,SAAiBmQ,EAAQ,GAAGkB,YAAYukB,KAAK,SAAUvG,GACjE,MAAOA,KAAMtf,IAIb,KAAM,IAAImoB,cAAa,gHAAsH,oBAG/I,IAAIO,GAAgBr5B,KAAKk3B,aAAaV,KAAK,SAAU/I,GACnD,MAAOA,GAAE9c,QAAUA,GAErB,IAAI0oB,EACF,KAAM,IAAIP,cAAa,wBAAyB,qBAGlD94B,MAAKi6B,SAAWj6B,KAAKi6B,aACrBj6B,KAAK65B,gBAAkB75B,KAAK65B,mBAC5B,IAAIc,GAAY36B,KAAKi6B,SAASlwB,EAAOjG,GACrC,IAAI62B,EAKFA,EAAU/pB,SAASD,GAGnB8B,QAAQC,UAAUE,KAAK,WACrB6nB,EAAQ/D,cAAc,GAAID,OAAM,4BAE7B,CACL,GAAI+D,GAAY,GAAIv6B,GAAO8R,aAAapB,GACxC3Q,MAAKi6B,SAASlwB,EAAOjG,IAAM02B,EAC3Bx6B,KAAK65B,gBAAgBW,EAAU12B,IAAMiG,EACrC/J,KAAKgR,UAAUwpB,GAEjB,MAAOx6B,MAAKk3B,aAAaV,KAAK,SAAU/I,GACtC,MAAOA,GAAE9c,QAAUA,MA8BtB,cAAe,gBAAgBD,QAAQ,SAAUlN,GAChD,GAAIo3B,GAAe36B,EAAOqQ,kBAAkB/N,UAAUiB,EACtDvD,GAAOqQ,kBAAkB/N,UAAUiB,GAAU,WAC3C,GAAIq3B,GAAU76B,KAEVqd,EAAO0T,UACP+J,EAAe/J,UAAUnwB,QAAkC,kBAAjBmwB,WAAU,EACxD,OAAI+J,GACKF,EAAajE,MAAM32B,MAAO,SAAU45B,GACzC,GAAImB,GAAOpB,EAAwBkB,EAASjB,EAC5Cvc,GAAK,GAAGsZ,MAAM,MAAOoE,KACpB,SAAU71B,GACPmY,EAAK,IACPA,EAAK,GAAGsZ,MAAM,KAAMzxB,IAErB6rB,UAAU,KAER6J,EAAajE,MAAM32B,KAAM+wB,WAAWne,KAAK,SAAUgnB,GACxD,MAAOD,GAAwBkB,EAASjB,OAK9C,IAAIoB,GAA0B/6B,EAAOqQ,kBAAkB/N,UAAUsM,mBACjE5O,GAAOqQ,kBAAkB/N,UAAUsM,oBAAsB,WACvD,MAAKkiB,WAAUnwB,QAAWmwB,UAAU,GAAG3sB,MAGvC2sB,UAAU,GAAKmJ,EAAwBl6B,KAAM+wB,UAAU,IAChDiK,EAAwBrE,MAAM32B,KAAM+wB,YAHlCiK,EAAwBrE,MAAM32B,KAAM+wB,WAQ/C,IAAIkK,GAAuBpoB,OAAOqoB,yBAAyBj7B,EAAOqQ,kBAAkB/N,UAAW,mBAC/FsQ,QAAO8gB,eAAe1zB,EAAOqQ,kBAAkB/N,UAAW,oBACxDkd,IAAK,WACH,GAAIma,GAAcqB,EAAqBxb,IAAIkX,MAAM32B,KACjD,OAAyB,KAArB45B,EAAYx1B,KACPw1B,EAEFD,EAAwB35B,KAAM45B,MAIzC35B,EAAOqQ,kBAAkB/N,UAAUi1B,YAAc,SAAUF,GACzD,GAAI6D,GAAUn7B,IAEd,IAA4B,WAAxBA,KAAK06B,eACP,KAAM,IAAI5B,cAAa,sDAA0D,oBAInF,KAAKxB,EAAOL,IACV,KAAM,IAAI6B,cAAa,yFAA+F,YAExH,IAAIsC,GAAU9D,EAAOL,MAAQj3B,IAC7B,KAAKo7B,EACH,KAAM,IAAItC,cAAa,6CAA8C,qBAIvE94B,MAAKi6B,SAAWj6B,KAAKi6B,YACrB,IAAIlwB,GAAS,MACb8I,QAAOkiB,KAAK/0B,KAAKi6B,UAAUvpB,QAAQ,SAAU2qB,GAC3C,GAAIC,GAAWH,EAAQlB,SAASoB,GAAUppB,YAAYukB,KAAK,SAAU7lB,GACnE,MAAO2mB,GAAO3mB,QAAUA,GAEtB2qB,KACFvxB,EAASoxB,EAAQlB,SAASoB,MAI1BtxB,IACgC,IAA9BA,EAAOkI,YAAYrR,OAGrBZ,KAAK83B,aAAa93B,KAAK65B,gBAAgB9vB,EAAOjG,KAG9CiG,EAAOytB,YAAYF,EAAO3mB,OAE5B3Q,KAAK02B,cAAc,GAAID,OAAM,yBAKnC,QAAS3E,GAAmB7xB,GAK1B,IAJKA,EAAOqQ,mBAAqBrQ,EAAOs7B,0BAEtCt7B,EAAOqQ,kBAAoBrQ,EAAOs7B,yBAE/Bt7B,EAAOqQ,kBAAZ,CAIA,GAAIqoB,GAAe14B,EAAOqQ,kBAAkB/N,UAAU+1B,QACtDr4B,GAAOqQ,kBAAkB/N,UAAU+1B,SAAW,SAAUkD,EAAUC,EAAiBC,GACjF,GAAIC,GAAU37B,KAEVqd,EAAO0T,SAIX,IAAIA,UAAUnwB,OAAS,GAAyB,kBAAb46B,GACjC,MAAO7C,GAAahC,MAAM32B,KAAM+wB,UAKlC,IAA4B,IAAxB4H,EAAa/3B,SAAsC,IAArBmwB,UAAUnwB,QAAwC,kBAAjBmwB,WAAU,IAC3E,MAAO4H,GAAahC,MAAM32B,QAG5B,IAAI47B,GAAkB,SAAyB72B,GAC7C,GAAI82B,MACAC,EAAU/2B,EAASJ,QAgBvB,OAfAm3B,GAAQprB,QAAQ,SAAUqrB,GACxB,GAAIC,IACFl4B,GAAIi4B,EAAOj4B,GACXm4B,UAAWF,EAAOE,UAClB73B,MACE83B,eAAgB,kBAChBC,gBAAiB,oBACjBJ,EAAO33B,OAAS23B,EAAO33B,KAE3B23B,GAAOK,QAAQ1rB,QAAQ,SAAU4J,GAC/B0hB,EAAc1hB,GAAQyhB,EAAOM,KAAK/hB,KAEpCuhB,EAAeG,EAAcl4B,IAAMk4B,IAG9BH,GAILS,EAAe,SAAsB5H,GACvC,MAAO,IAAIU,KAAIviB,OAAOkiB,KAAKL,GAAOhH,IAAI,SAAUvP,GAC9C,OAAQA,EAAKuW,EAAMvW,OAIvB,IAAI4S,UAAUnwB,QAAU,EAAG,CACzB,GAAI27B,GAA0B,SAAiCx3B,GAC7DsY,EAAK,GAAGif,EAAaV,EAAgB72B,KAGvC,OAAO4zB,GAAahC,MAAM32B,MAAOu8B,EAAyBxL,UAAU,KAItE,MAAO,IAAIte,SAAQ,SAAUC,EAASmmB,GACpCF,EAAahC,MAAMgF,GAAU,SAAU52B,GACrC2N,EAAQ4pB,EAAaV,EAAgB72B,MACpC8zB,MACFjmB,KAAK6oB,EAAiBC,KAI1B,sBAAuB,uBAAwB,mBAAmBhrB,QAAQ,SAAUlN,GACnF,GAAIo3B,GAAe36B,EAAOqQ,kBAAkB/N,UAAUiB,EACtDvD,GAAOqQ,kBAAkB/N,UAAUiB,GAAU,WAE3C,MADAutB,WAAU,GAAK,IAAgB,oBAAXvtB,EAA+BvD,EAAOyR,gBAAkBzR,EAAOgP,uBAAuB8hB,UAAU,IAC7G6J,EAAajE,MAAM32B,KAAM+wB,aAKpC,IAAIyL,GAAwBv8B,EAAOqQ,kBAAkB/N,UAAUkP,eAC/DxR,GAAOqQ,kBAAkB/N,UAAUkP,gBAAkB,WACnD,MAAKsf,WAAU,GAMRyL,EAAsB7F,MAAM32B,KAAM+wB,YALnCA,UAAU,IACZA,UAAU,GAAG4F,MAAM,MAEdlkB,QAAQC,aAMrB,QAAS4f,GAAqBryB,GAC5BoxB,EAAMsE,wBAAwB11B,EAAQ,oBAAqB,SAAU8D,GACnE,GAAI8yB,GAAK9yB,EAAE04B,MACX,IAA0B,WAAtB5F,EAAG6D,eAGP,MAAO32B,KA9vBX8O,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,IAET0L,EAAQwD,oBAAsBxD,EAAQsC,iBAAmBxpB,MAEzD,IAAIktB,GAA4B,kBAAXgH,SAAoD,gBAApBA,QAAOC,SAAwB,SAAU/wB,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAX8wB,SAAyB9wB,EAAIgxB,cAAgBF,QAAU9wB,IAAQ8wB,OAAOn6B,UAAY,eAAkBqJ,IAElQixB,EAAgB3M,EAAQ,iBAE5Brd,QAAO8gB,eAAejE,EAAS,oBAC7BuG,YAAY,EACZxW,IAAK,WACH,MAAOod,GAAc7K,mBAIzB,IAAI8K,GAAmB5M,EAAQ,oBAE/Brd,QAAO8gB,eAAejE,EAAS,uBAC7BuG,YAAY,EACZxW,IAAK,WACH,MAAOqd,GAAiB5J,uBAG5BxD,EAAQuC,gBAAkBA,EAC1BvC,EAAQwC,YAAcA,EACtBxC,EAAQ0C,uBAAyBA,EACjC1C,EAAQ2C,2BAA6BA,EACrC3C,EAAQqJ,kCAAoCA,EAC5CrJ,EAAQyC,wBAA0BA,EAClCzC,EAAQoC,mBAAqBA,EAC7BpC,EAAQ4C,qBAAuBA,CAE/B,IAAIsB,GAAS1D,EAAQ,eAEjBmB,EAAQX,EAAwBkD,KA+tBjCmJ,cAAc,GAAGC,oBAAoB,EAAEC,iBAAiB,IAAIC,GAAG,SAAShN,EAAQP,EAAOD,GAS1F,YAMA,SAASwD,GAAoBjzB,EAAQk9B,GACnC,MAAIl9B,GAAOkL,UAAU8H,cAAgB,mBAAqBhT,GAAOkL,UAAU8H,eAGtEhT,EAAOkL,UAAU8H,aAHtB,OAQ2B,kBAAhBkqB,OACTn5B,SAAQU,MAAM,oEAGhBzE,EAAOkL,UAAU8H,aAAamqB,gBAAkB,SAAU7wB,GACxD,MAAO4wB,GAAY5wB,GAAaqG,KAAK,SAAU9E,GAC7C,GAAIuvB,GAAiB9wB,EAAYC,OAASD,EAAYC,MAAMa,MACxDiwB,EAAkB/wB,EAAYC,OAASD,EAAYC,MAAMiB,OACzD8vB,EAAqBhxB,EAAYC,OAASD,EAAYC,MAAM0B,SAchE,OAbA3B,GAAYC,OACVwB,WACEwvB,kBAAmB,UACnBC,oBAAqB3vB,EACrBC,aAAcwvB,GAAsB,IAGpCF,IACF9wB,EAAYC,MAAMwB,UAAUR,SAAW6vB,GAErCC,IACF/wB,EAAYC,MAAMwB,UAAUL,UAAY2vB,GAEnCr9B,EAAOkL,UAAU8H,aAAa3G,aAAaC,OAnCxDsG,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,IAET0L,EAAQwD,oBAAsBA,OAqCxBwK,GAAG,SAASxN,EAAQP,EAAOD,GASjC,YAcA,SAASgB,GAAwB9kB,GAAO,GAAIA,GAAOA,EAAI+kB,WAAc,MAAO/kB,EAAc,IAAIglB,KAAa,IAAW,MAAPhlB,EAAe,IAAK,GAAIuS,KAAOvS,GAAWiH,OAAOtQ,UAAUsuB,eAAettB,KAAKqI,EAAKuS,KAAMyS,EAAOzS,GAAOvS,EAAIuS,GAAgC,OAAtByS,GAAAA,WAAiBhlB,EAAYglB,EAIlQ,QAASoB,GAAiB/xB,GACxB,GAAIkL,GAAYlL,GAAUA,EAAOkL,SAEjC,IAAKA,EAAU8H,aAAf,CAIA,GAAIqe,GAAiBD,EAAME,cAActxB,GAErC09B,EAAuB,SAA8BziB,GACvD,GAA8D,YAA5C,mBAANA,GAAoB,YAAcwa,EAAQxa,KAAoBA,EAAElN,WAAakN,EAAEjN,SACzF,MAAOiN,EAET,IAAI0iB,KA4CJ,OA3CA/qB,QAAOkiB,KAAK7Z,GAAGxK,QAAQ,SAAUyN,GAC/B,GAAY,YAARA,GAA6B,aAARA,GAA8B,gBAARA,EAA/C,CAGA,GAAIhD,GAAwB,WAApBua,EAAQxa,EAAEiD,IAAqBjD,EAAEiD,IAAShQ,MAAO+M,EAAEiD,GAC3C3V,UAAZ2S,EAAEpI,OAA0C,gBAAZoI,GAAEpI,QACpCoI,EAAE7N,IAAM6N,EAAEha,IAAMga,EAAEpI,MAEpB,IAAI8qB,GAAW,SAAkBh1B,EAAQyR,GACvC,MAAIzR,GACKA,EAASyR,EAAKwjB,OAAO,GAAGC,cAAgBzjB,EAAK8c,MAAM,GAE5C,aAAT9c,EAAsB,WAAaA,EAE5C,IAAgB9R,SAAZ2S,EAAEhN,MAAqB,CACzByvB,EAAG3vB,SAAW2vB,EAAG3vB,YACjB,IAAI+vB,KACmB,iBAAZ7iB,GAAEhN,OACX6vB,EAAGH,EAAS,MAAO1f,IAAQhD,EAAEhN,MAC7ByvB,EAAG3vB,SAASjH,KAAKg3B,GACjBA,KACAA,EAAGH,EAAS,MAAO1f,IAAQhD,EAAEhN,MAC7ByvB,EAAG3vB,SAASjH,KAAKg3B,KAEjBA,EAAGH,EAAS,GAAI1f,IAAQhD,EAAEhN,MAC1ByvB,EAAG3vB,SAASjH,KAAKg3B,IAGLx1B,SAAZ2S,EAAEpI,OAA0C,gBAAZoI,GAAEpI,OACpC6qB,EAAG5vB,UAAY4vB,EAAG5vB,cAClB4vB,EAAG5vB,UAAU6vB,EAAS,GAAI1f,IAAQhD,EAAEpI,QAEnC,MAAO,OAAOrC,QAAQ,SAAUutB,GAChBz1B,SAAX2S,EAAE8iB,KACJL,EAAG5vB,UAAY4vB,EAAG5vB,cAClB4vB,EAAG5vB,UAAU6vB,EAASI,EAAK9f,IAAQhD,EAAE8iB,SAKzC/iB,EAAEgjB,WACJN,EAAG3vB,UAAY2vB,EAAG3vB,cAAgBuG,OAAO0G,EAAEgjB,WAEtCN,GAGLO,EAAmB,SAA0B5xB,EAAalC,GAC5D,GAAIinB,EAAe6I,SAAW,GAC5B,MAAO9vB,GAAKkC,EAGd,IADAA,EAAc0T,KAAKme,MAAMne,KAAKC,UAAU3T,IACpCA,GAA8C,WAA/BmpB,EAAQnpB,EAAYV,OAAqB,CAC1D,GAAIwyB,GAAQ,SAAezyB,EAAKqT,EAAG6I,GAC7B7I,IAAKrT,MAASkc,IAAKlc,MACrBA,EAAIkc,GAAKlc,EAAIqT,SACNrT,GAAIqT,IAGf1S,GAAc0T,KAAKme,MAAMne,KAAKC,UAAU3T,IACxC8xB,EAAM9xB,EAAYV,MAAO,kBAAmB,uBAC5CwyB,EAAM9xB,EAAYV,MAAO,mBAAoB,wBAC7CU,EAAYV,MAAQ8xB,EAAqBpxB,EAAYV,OAEvD,GAAIU,GAA8C,WAA/BmpB,EAAQnpB,EAAYC,OAAqB,CAE1D,GAAI8xB,GAAO/xB,EAAYC,MAAM+xB,UAC7BD,GAAOA,IAAyE,YAA/C,mBAATA,GAAuB,YAAc5I,EAAQ4I,IAAsBA,GAASnwB,MAAOmwB,GAC3G,IAAIE,GAA6BlN,EAAe6I,QAAU,EAE1D,IAAImE,IAAwB,SAAfA,EAAKvrB,OAAmC,gBAAfurB,EAAKvrB,OAA0C,SAAfurB,EAAKnwB,OAAmC,gBAAfmwB,EAAKnwB,UAA8BhD,EAAU8H,aAAawrB,0BAA2BtzB,EAAU8H,aAAawrB,0BAA0BF,YAAeC,GAA6B,OACxQjyB,GAAYC,MAAM+xB,UACzB,IAAIG,GAAU,MAMd,IALmB,gBAAfJ,EAAKvrB,OAA0C,gBAAfurB,EAAKnwB,MACvCuwB,GAAW,OAAQ,SACK,SAAfJ,EAAKvrB,OAAmC,SAAfurB,EAAKnwB,SACvCuwB,GAAW,UAETA,EAEF,MAAOvzB,GAAU8H,aAAamc,mBAAmBxc,KAAK,SAAU+rB,GAC9DA,EAAUA,EAAQnF,OAAO,SAAUoF,GACjC,MAAkB,eAAXA,EAAEnQ,MAEX,IAAIoQ,GAAMF,EAAQnI,KAAK,SAAUoI,GAC/B,MAAOF,GAAQI,KAAK,SAAUr1B,GAC5B,MAAOm1B,GAAElQ,MAAMtlB,cAAc21B,SAASt1B,MAW1C,QARKo1B,GAAOF,EAAQ/9B,QAAU89B,EAAQK,SAAS,UAC7CF,EAAMF,EAAQA,EAAQ/9B,OAAS,IAE7Bi+B,IACFtyB,EAAYC,MAAMN,SAAWoyB,EAAKvrB,OAAUA,MAAO8rB,EAAI3yB,WAAeiC,MAAO0wB,EAAI3yB,WAEnFK,EAAYC,MAAQmxB,EAAqBpxB,EAAYC,OACrD4kB,EAAQ,WAAanR,KAAKC,UAAU3T,IAC7BlC,EAAKkC,KAIlBA,EAAYC,MAAQmxB,EAAqBpxB,EAAYC,OAGvD,MADA4kB,GAAQ,WAAanR,KAAKC,UAAU3T,IAC7BlC,EAAKkC,IAGVyyB,EAAa,SAAoBj7B,GACnC,MAAIutB,GAAe6I,SAAW,GACrBp2B,GAGPuW,MACE2kB,sBAAuB,kBACvBC,yBAA0B,kBAC1BC,kBAAmB,kBACnBC,qBAAsB,gBACtBC,4BAA6B,uBAC7BC,gBAAiB,mBACjBC,+BAAgC,kBAChCC,wBAAyB,kBACzBC,gBAAiB,aACjBC,mBAAoB,aACpBC,mBAAoB,cACpB57B,EAAEuW,OAASvW,EAAEuW,KACfzI,QAAS9N,EAAE8N,QACXU,WAAYxO,EAAEwO,YAAcxO,EAAE67B,eAC9BrrB,SAAU,WACR,MAAOvU,MAAKsa,MAAQta,KAAK6R,SAAW,MAAQ7R,KAAK6R,WAKnDguB,EAAgB,SAAuBtzB,EAAamI,EAAWC,GACjEwpB,EAAiB5xB,EAAa,SAAU2O,GACtC/P,EAAU20B,mBAAmB5kB,EAAGxG,EAAW,SAAU3Q,GAC/C4Q,GACFA,EAAQqqB,EAAWj7B,QAK3BoH,GAAUmB,aAAeuzB,EAAc9R,KAAK5iB,EAK5C,IAAI40B,GAAmB50B,EAAU8H,aAAa3G,aAAayhB,KAAK5iB,EAAU8H,aAC1E9H,GAAU8H,aAAa3G,aAAe,SAAU0zB,GAC9C,MAAO7B,GAAiB6B,EAAI,SAAU9kB,GACpC,MAAO6kB,GAAiB7kB,GAAGtI,KAAK,SAAU7I,GACxC,GAAImR,EAAErP,QAAU9B,EAAO0G,iBAAiB7P,QAAUsa,EAAE1O,QAAUzC,EAAO8G,iBAAiBjQ,OAIpF,KAHAmJ,GAAOkI,YAAYvB,QAAQ,SAAUC,GACnCA,EAAMmB,SAEF,GAAIgnB,cAAa,GAAI,gBAE7B,OAAO/uB,IACN,SAAUhG,GACX,MAAO0O,SAAQomB,OAAOmG,EAAWj7B,UA5LzC8O,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,GAGT,IAAI0R,GAA4B,kBAAXgH,SAAoD,gBAApBA,QAAOC,SAAwB,SAAU/wB,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAX8wB,SAAyB9wB,EAAIgxB,cAAgBF,QAAU9wB,IAAQ8wB,OAAOn6B,UAAY,eAAkBqJ,GAEtQ8jB,GAAQsC,iBAAmBA,CAE3B,IAAI4B,GAAS1D,EAAQ,eAEjBmB,EAAQX,EAAwBkD,GAIhCxC,EAAUC,EAAMptB,MAoLjB84B,cAAc,KAAKkD,GAAG,SAAS/P,EAAQP,EAAOD,GASjD,YAsBA,SAASgB,GAAwB9kB,GAAO,GAAIA,GAAOA,EAAI+kB,WAAc,MAAO/kB,EAAc,IAAIglB,KAAa,IAAW,MAAPhlB,EAAe,IAAK,GAAIuS,KAAOvS,GAAWiH,OAAOtQ,UAAUsuB,eAAettB,KAAKqI,EAAKuS,KAAMyS,EAAOzS,GAAOvS,EAAIuS,GAAgC,OAAtByS,GAAAA,WAAiBhlB,EAAYglB,EAElQ,QAASsP,GAAuBt0B,GAAO,MAAOA,IAAOA,EAAI+kB,WAAa/kB,GAAQu0B,UAASv0B,GAEvF,QAAS2mB,GAAoBtyB,GAG3B,GAAKA,EAAOyR,mBAAmBzR,EAAOyR,iBAAmB,cAAgBzR,GAAOyR,gBAAgBnP,WAAhG,CAIA,GAAI69B,GAAwBngC,EAAOyR,eACnCzR,GAAOyR,gBAAkB,SAAU2L,GAOjC,GALoE,YAA/C,mBAATA,GAAuB,YAAcqY,EAAQrY,KAAuBA,EAAKnT,WAA8C,IAAjCmT,EAAKnT,UAAUf,QAAQ,QACvHkU,EAAO4C,KAAKme,MAAMne,KAAKC,UAAU7C,IACjCA,EAAKnT,UAAYmT,EAAKnT,UAAUpB,OAAO,IAGrCuU,EAAKnT,WAAamT,EAAKnT,UAAUtJ,OAAQ,CAE3C,GAAIy/B,GAAkB,GAAID,GAAsB/iB,GAC5CijB,EAAkBC,EAAAA,WAAcC,eAAenjB,EAAKnT,WACpDu2B,EAAqB5tB,OAAOC,OAAOutB,EAAiBC,EAWxD,OARAG,GAAmBn8B,OAAS,WAC1B,OACE4F,UAAWu2B,EAAmBv2B,UAC9Bw2B,OAAQD,EAAmBC,OAC3B/uB,cAAe8uB,EAAmB9uB,cAClCgvB,iBAAkBF,EAAmBE,mBAGlCF,EAET,MAAO,IAAIL,GAAsB/iB,IAEnCpd,EAAOyR,gBAAgBnP,UAAY69B,EAAsB79B,UAIzD8uB,EAAMsE,wBAAwB11B,EAAQ,eAAgB,SAAU8D,GAO9D,MANIA,GAAEmG,WACJ2I,OAAO8gB,eAAe5vB,EAAG,aACvBigB,MAAO,GAAI/jB,GAAOyR,gBAAgB3N,EAAEmG,WACpC02B,SAAU,UAGP78B,KAIX,QAAS0uB,GAAmBxyB,GAC1B,IAAIA,EAAO4gC,kBAAqB5gC,EAAOqQ,kBAAvC,CAGA,GAAIghB,GAAiBD,EAAME,cAActxB,EAEnC,SAAUA,GAAOqQ,kBAAkB/N,WACvCsQ,OAAO8gB,eAAe1zB,EAAOqQ,kBAAkB/N,UAAW,QACxDkd,IAAK,WACH,MAA6B,mBAAfzf,MAAK8gC,MAAwB,KAAO9gC,KAAK8gC,QAK7D,IAAIC,GAAoB,SAA2BnH,GACjD,GAAIoH,GAAWT,EAAAA,WAAcU,cAAcrH,EAAYjvB,IAEvD,OADAq2B,GAASE,QACFF,EAASlC,KAAK,SAAUqC,GAC7B,GAAIC,GAAQb,EAAAA,WAAcc,WAAWF,EACrC,OAAOC,IAAwB,gBAAfA,EAAM3S,MAA6D,KAAnC2S,EAAME,SAASn4B,QAAQ,WAIvEo4B,EAA0B,SAAiC3H,GAE7D,GAAInwB,GAAQmwB,EAAYjvB,IAAIlB,MAAM,kCAClC,IAAc,OAAVA,GAAkBA,EAAM7I,OAAS,EACnC,MAAO,EAET,IAAIu5B,GAAU1yB,SAASgC,EAAM,GAAI,GAEjC,OAAO0wB,KAAYA,EAAU,GAAKA,GAGhCqH,EAA2B,SAAkCC,GAK/D,GAAIC,GAAwB,KAuB5B,OAtB+B,YAA3BpQ,EAAeM,UAKb8P,EAJApQ,EAAe6I,QAAU,GACH,KAApBsH,EAGsB,MAIA,WAEjBnQ,EAAe6I,QAAU,GAKiB,KAA3B7I,EAAe6I,QAAiB,MAAQ,MAGxC,YAGrBuH,GAGLC,EAAoB,SAA2B/H,EAAa6H,GAG9D,GAAIG,GAAiB,KAKU,aAA3BtQ,EAAeM,SAAoD,KAA3BN,EAAe6I,UACzDyH,EAAiB,MAGnB,IAAIn4B,GAAQ82B,EAAAA,WAAcsB,YAAYjI,EAAYjvB,IAAK,sBASvD,OARIlB,GAAM7I,OAAS,EACjBghC,EAAiBn6B,SAASgC,EAAM,GAAGX,OAAO,IAAK,IACX,YAA3BwoB,EAAeM,SAA6C,KAApB6P,IAIjDG,EAAiB,YAEZA,GAGLzL,EAA2Bl2B,EAAOqQ,kBAAkB/N,UAAUyM,oBAClE/O,GAAOqQ,kBAAkB/N,UAAUyM,qBAAuB,WAGxD,GAFAhP,KAAK8gC,MAAQ,KAETC,EAAkBhQ,UAAU,IAAK,CAEnC,GAAI+Q,GAAYP,EAAwBxQ,UAAU,IAG9CgR,EAAaP,EAAyBM,GAGtCE,EAAYL,EAAkB5Q,UAAU,GAAI+Q,GAG5CF,EAAiB,MAEnBA,GADiB,IAAfG,GAAkC,IAAdC,EACLC,OAAOC,kBACA,IAAfH,GAAkC,IAAdC,EACZjhC,KAAKI,IAAI4gC,EAAYC,GAErBjhC,KAAKuM,IAAIy0B,EAAYC,EAKxC,IAAIG,KACJtvB,QAAO8gB,eAAewO,EAAM,kBAC1B1iB,IAAK,WACH,MAAOmiB,MAGX5hC,KAAK8gC,MAAQqB,EAGf,MAAOhM,GAAyBQ,MAAM32B,KAAM+wB,aAIhD,QAAS2B,GAAuBzyB,GAS9B,QAASmiC,GAAWC,EAAIxL,GACtB,GAAIyL,GAAsBD,EAAGp/B,IAC7Bo/B,GAAGp/B,KAAO,WACR,GAAIG,GAAO2tB,UAAU,GACjBnwB,EAASwC,EAAKxC,QAAUwC,EAAKm/B,MAAQn/B,EAAKo/B,UAC9C,IAAsB,SAAlBH,EAAG38B,YAAyBmxB,EAAGsL,MAAQvhC,EAASi2B,EAAGsL,KAAKP,eAC1D,KAAM,IAAIa,WAAU,4CAA8C5L,EAAGsL,KAAKP,eAAiB,UAE7F,OAAOU,GAAoB3L,MAAM0L,EAAItR,YAhBzC,GAAM9wB,EAAOqQ,mBAAqB,qBAAuBrQ,GAAOqQ,kBAAkB/N,UAAlF,CAmBA,GAAImgC,GAAwBziC,EAAOqQ,kBAAkB/N,UAAUkN,iBAC/DxP,GAAOqQ,kBAAkB/N,UAAUkN,kBAAoB,WACrD,GAAIkzB,GAAcD,EAAsB/L,MAAM32B,KAAM+wB,UAEpD,OADAqR,GAAWO,EAAa3iC,MACjB2iC,GAETtR,EAAMsE,wBAAwB11B,EAAQ,cAAe,SAAU8D,GAE7D,MADAq+B,GAAWr+B,EAAEyL,QAASzL,EAAE04B,QACjB14B,KAWX,QAASyuB,GAAoBvyB,GAC3B,GAAKA,EAAOqQ,qBAAqB,mBAAqBrQ,GAAOqQ,kBAAkB/N,WAA/E,CAGA,GAAIqgC,GAAQ3iC,EAAOqQ,kBAAkB/N,SACrCsQ,QAAO8gB,eAAeiP,EAAO,mBAC3BnjB,IAAK,WACH,OACEojB,UAAW,YACXC,SAAU,cACV9iC,KAAK+iC,qBAAuB/iC,KAAK+iC,oBAGrC9M,YAAY,EACZC,cAAc,IAEhBrjB,OAAO8gB,eAAeiP,EAAO,2BAC3BnjB,IAAK,WACH,MAAOzf,MAAKgjC,0BAA4B,MAE1ClO,IAAK,SAAajyB,GACZ7C,KAAKgjC,2BACPhjC,KAAK+1B,oBAAoB,wBAAyB/1B,KAAKgjC,gCAChDhjC,MAAKgjC,0BAEVngC,GACF7C,KAAKg2B,iBAAiB,wBAAyBh2B,KAAKgjC,yBAA2BngC,IAInFozB,YAAY,EACZC,cAAc,KAGf,sBAAuB,wBAAwBxlB,QAAQ,SAAUlN,GAChE,GAAIy/B,GAAaL,EAAMp/B,EACvBo/B,GAAMp/B,GAAU,WAad,MAZKxD,MAAKkjC,6BACRljC,KAAKkjC,2BAA6B,SAAUn/B,GAC1C,GAAI8yB,GAAK9yB,EAAE04B,MACX,IAAI5F,EAAGsM,uBAAyBtM,EAAGuM,gBAAiB,CAClDvM,EAAGsM,qBAAuBtM,EAAGuM,eAC7B,IAAIC,GAAW,GAAI5M,OAAM,wBAAyB1yB,EAClD8yB,GAAGH,cAAc2M,GAEnB,MAAOt/B,IAET/D,KAAKg2B,iBAAiB,2BAA4Bh2B,KAAKkjC,6BAElDD,EAAWtM,MAAM32B,KAAM+wB,eAKpC,QAAS4B,GAAuB1yB,GAE9B,GAAKA,EAAOqQ,kBAAZ,CAGA,GAAIghB,GAAiBD,EAAME,cAActxB,EACzC,MAA+B,WAA3BqxB,EAAeM,SAAwBN,EAAe6I,SAAW,IAArE,CAGA,GAAImJ,GAAYrjC,EAAOqQ,kBAAkB/N,UAAUyM,oBACnD/O,GAAOqQ,kBAAkB/N,UAAUyM,qBAAuB,SAAU+rB,GAMlE,MALIA,IAAQA,EAAKpwB,KAAsD,KAA/CowB,EAAKpwB,IAAIxB,QAAQ,4BACvC4xB,EAAKpwB,IAAMowB,EAAKpwB,IAAIyJ,MAAM,MAAMolB,OAAO,SAAU+J,GAC/C,MAAuB,yBAAhBA,EAAKC,SACXlgC,KAAK,OAEHggC,EAAU3M,MAAM32B,KAAM+wB,cAtTjCle,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,GAGT,IAAI0R,GAA4B,kBAAXgH,SAAoD,gBAApBA,QAAOC,SAAwB,SAAU/wB,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAX8wB,SAAyB9wB,EAAIgxB,cAAgBF,QAAU9wB,IAAQ8wB,OAAOn6B,UAAY,eAAkBqJ,GAEtQ8jB,GAAQ6C,oBAAsBA,EAC9B7C,EAAQ+C,mBAAqBA,EAC7B/C,EAAQgD,uBAAyBA,EACjChD,EAAQ8C,oBAAsBA,EAC9B9C,EAAQiD,uBAAyBA,CAEjC,IAAI8Q,GAAOvT,EAAQ,OAEfqQ,EAAQL,EAAuBuD,GAE/B7P,EAAS1D,EAAQ,WAEjBmB,EAAQX,EAAwBkD,KAwSjCW,UAAU,GAAG5pB,IAAM,KAAK+4B,GAAG,SAASxT,EAAQP,EAAOD,GAStD,YAqCA,SAASwQ,GAAuBt0B,GAAO,MAAOA,IAAOA,EAAI+kB,WAAa/kB,GAAQu0B,UAASv0B,GAEvF,QAAS8kB,GAAwB9kB,GAAO,GAAIA,GAAOA,EAAI+kB,WAAc,MAAO/kB,EAAc,IAAIglB,KAAa,IAAW,MAAPhlB,EAAe,IAAK,GAAIuS,KAAOvS,GAAWiH,OAAOtQ,UAAUsuB,eAAettB,KAAKqI,EAAKuS,KAAMyS,EAAOzS,GAAOvS,EAAIuS,GAAgC,OAAtByS,GAAAA,WAAiBhlB,EAAYglB,EAElQ,QAASkB,GAAmB7xB,GAC1B,GAAIqxB,GAAiBD,EAAME,cAActxB,EAEzC,IAAIA,EAAO0jC,iBACJ1jC,EAAOyR,kBACVzR,EAAOyR,gBAAkB,SAAU2L,GACjC,MAAOA,KAGNpd,EAAOgP,wBACVhP,EAAOgP,sBAAwB,SAAUoO,GACvC,MAAOA,KAMPiU,EAAe6I,QAAU,OAAO,CAClC,GAAIyJ,GAAiB/wB,OAAOqoB,yBAAyBj7B,EAAO24B,iBAAiBr2B,UAAW,UACxFsQ,QAAO8gB,eAAe1zB,EAAO24B,iBAAiBr2B,UAAW,WACvDuyB,IAAK,SAAa9Q,GAChB4f,EAAe9O,IAAIvxB,KAAKvD,KAAMgkB,EAC9B,IAAI6f,GAAK,GAAIpN,OAAM,UACnBoN,GAAG1uB,QAAU6O,EACbhkB,KAAK02B,cAAcmN,OAQvB5jC,EAAO+3B,cAAkB,QAAU/3B,GAAO+3B,aAAaz1B,WACzDsQ,OAAO8gB,eAAe1zB,EAAO+3B,aAAaz1B,UAAW,QACnDkd,IAAK,WAQH,MAPmBjX,UAAfxI,KAAK+2B,QACiB,UAApB/2B,KAAK2Q,MAAM8d,KACbzuB,KAAK+2B,MAAQ,GAAI92B,GAAO6jC,cAAc9jC,MACT,UAApBA,KAAK2Q,MAAM8d,OACpBzuB,KAAK+2B,MAAQ,OAGV/2B,KAAK+2B,SAMd92B,EAAO6jC,gBAAkB7jC,EAAO8jC,gBAClC9jC,EAAO8jC,cAAgB9jC,EAAO6jC,cAGhC,IAAIE,GAA4BC,EAAAA,WAAiChkC,EAAQqxB,EAAe6I,QACxFl6B,GAAOqQ,kBAAoB,SAAUP,GAKnC,MAJIA,IAAUA,EAAOI,aACnBJ,EAAOI,WAAiB+zB,EAAkBC,iBAAkBp0B,EAAOI,WAAYmhB,EAAe6I,SAC9F9I,EAAMptB,IAAI,+BAAgC8L,EAAOI,aAE5C,GAAI6zB,GAAsBj0B,IAEnC9P,EAAOqQ,kBAAkB/N,UAAYyhC,EAAsBzhC,UAG7D,QAAS4wB,GAAiBlzB,IAEpBA,EAAO+3B,cAAkB,gBAAkB/3B,GAAO+3B,aAAaz1B,YACjEtC,EAAO+3B,aAAaz1B,UAAU6hC,aAAenkC,EAAO+3B,aAAaz1B,UAAU8hC,UAzG/ExxB,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,IAET0L,EAAQwD,oBAAsBxD,EAAQsC,iBAAmBxpB,MAEzD,IAAIq0B,GAAgB3M,EAAQ,iBAE5Brd,QAAO8gB,eAAejE,EAAS,oBAC7BuG,YAAY,EACZxW,IAAK,WACH,MAAOod,GAAc7K,mBAIzB,IAAI8K,GAAmB5M,EAAQ,oBAE/Brd,QAAO8gB,eAAejE,EAAS,uBAC7BuG,YAAY,EACZxW,IAAK,WACH,MAAOqd,GAAiB5J,uBAG5BxD,EAAQoC,mBAAqBA,EAC7BpC,EAAQyD,iBAAmBA,CAE3B,IAAIS,GAAS1D,EAAQ,YAEjBmB,EAAQX,EAAwBkD,GAEhCsQ,EAAoBhU,EAAQ,sBAE5BoU,EAAyBpU,EAAQ,0BAEjC+T,EAA0B/D,EAAuBoE,KA4ElDC,WAAW,GAAGC,qBAAqB,EAAExH,oBAAoB,EAAEC,iBAAiB,GAAGwH,yBAAyB,KAAKC,GAAG,SAASxU,EAAQP,EAAOD,GAS3I,YAWA,SAASgB,GAAwB9kB,GAAO,GAAIA,GAAOA,EAAI+kB,WAAc,MAAO/kB,EAAc,IAAIglB,KAAa,IAAW,MAAPhlB,EAAe,IAAK,GAAIuS,KAAOvS,GAAWiH,OAAOtQ,UAAUsuB,eAAettB,KAAKqI,EAAKuS,KAAMyS,EAAOzS,GAAOvS,EAAIuS,GAAgC,OAAtByS,GAAAA,WAAiBhlB,EAAYglB,EAOlQ,QAASuT,GAAiBh0B,EAAYw0B,GACpC,GAAIC,IAAU,CAEd,OADAz0B,GAAa8P,KAAKme,MAAMne,KAAKC,UAAU/P,IAChCA,EAAWqpB,OAAO,SAAUqL,GACjC,GAAIA,IAAWA,EAAO50B,MAAQ40B,EAAOxgC,KAAM,CACzC,GAAI4L,GAAO40B,EAAO50B,MAAQ40B,EAAOxgC,GAC7BwgC,GAAOxgC,MAAQwgC,EAAO50B,MACxBohB,EAAMyT,WAAW,mBAAoB,oBAEvC,IAAIC,GAA2B,gBAAT90B,EAoBtB,OAnBI80B,KACF90B,GAAQA,IAEVA,EAAOA,EAAKupB,OAAO,SAAUn1B,GAE3B,GAA6B,IAAzBA,EAAI8E,QAAQ,SACd,OAAO,CAGT,IAAI67B,GAAY3gC,EAAI4gC,WAAW,UAAY5gC,EAAI4gC,WAAW,WAAa5gC,EAAI06B,SAAS,gBACpF,OAAIiG,KAAcJ,GAChBA,GAAU,GACH,GAEFI,IAAcJ,UAGhBC,GAAOxgC,IACdwgC,EAAO50B,KAAO80B,EAAW90B,EAAK,GAAKA,IAC1BA,EAAKrP,UA7CpBiS,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,IAET0L,EAAQyU,iBAAmBA,CAE3B,IAAIvQ,GAAS1D,EAAQ,YAEjBmB,EAAQX,EAAwBkD,KA2CjC2Q,WAAW,KAAKW,GAAG,SAAShV,EAAQP,EAAOD,GAS9C,YAMA,SAASwD,GAAoBjzB,GACrB,mBAAqBA,GAAOkL,WAG7BlL,EAAOkL,UAAU8H,eAGlBhT,EAAOkL,UAAU8H,cAAgB,mBAAqBhT,GAAOkL,UAAU8H,eAG3EhT,EAAOkL,UAAU8H,aAAamqB,gBAAkBn9B,EAAOkL,UAAUiyB,gBAAgBrP,KAAK9tB,EAAOkL,UAAU8H,gBAdzGJ,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,IAET0L,EAAQwD,oBAAsBA,OAcxBiS,IAAI,SAASjV,EAAQP,EAAOD,GASlC,YAMA,SAASsC,GAAiB/xB,GACxB,GAAIkL,GAAYlL,GAAUA,EAAOkL,UAE7B6zB,EAAa,SAAoBj7B,GACnC,OACEuW,MAAQ2kB,sBAAuB,mBAAoBl7B,EAAEuW,OAASvW,EAAEuW,KAChEzI,QAAS9N,EAAE8N,QACXU,WAAYxO,EAAEwO,WACdgC,SAAU,WACR,MAAOvU,MAAKsa,QAMdylB,EAAmB50B,EAAU8H,aAAa3G,aAAayhB,KAAK5iB,EAAU8H,aAC1E9H,GAAU8H,aAAa3G,aAAe,SAAU4O,GAC9C,MAAO6kB,GAAiB7kB,GAAjB6kB,SAA0B,SAAUh8B,GACzC,MAAO0O,SAAQomB,OAAOmG,EAAWj7B,OAtBvC8O,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,IAET0L,EAAQsC,iBAAmBA,OAwBrBoT,IAAI,SAASlV,EAAQP,EAAOD,GASlC,YAqCA,SAASgB,GAAwB9kB,GAAO,GAAIA,GAAOA,EAAI+kB,WAAc,MAAO/kB,EAAc,IAAIglB,KAAa,IAAW,MAAPhlB,EAAe,IAAK,GAAIuS,KAAOvS,GAAWiH,OAAOtQ,UAAUsuB,eAAettB,KAAKqI,EAAKuS,KAAMyS,EAAOzS,GAAOvS,EAAIuS,GAAgC,OAAtByS,GAAAA,WAAiBhlB,EAAYglB,EAElQ,QAASsB,GAAYjyB,GACqD,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,KAAyBA,EAAOolC,eAAiB,YAAcplC,GAAOolC,cAAc9iC,aAAe,eAAiBtC,GAAOolC,cAAc9iC,YAClMsQ,OAAO8gB,eAAe1zB,EAAOolC,cAAc9iC,UAAW,eACpDkd,IAAK,WACH,OAASoW,SAAU71B,KAAK61B,aAMhC,QAAS/D,GAAmB7xB,GAC1B,GAAIqxB,GAAiBD,EAAME,cAActxB,EAEzC,IAAwE,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,MAA2BA,EAAOqQ,mBAAqBrQ,EAAOqlC,sBAAzH,EAGKrlC,EAAOqQ,mBAAqBrQ,EAAOqlC,uBAEtCrlC,EAAOqQ,kBAAoBrQ,EAAOqlC,uBAInC,sBAAuB,uBAAwB,mBAAmB50B,QAAQ,SAAUlN,GACnF,GAAIo3B,GAAe36B,EAAOqQ,kBAAkB/N,UAAUiB,EACtDvD,GAAOqQ,kBAAkB/N,UAAUiB,GAAU,WAE3C,MADAutB,WAAU,GAAK,IAAgB,oBAAXvtB,EAA+BvD,EAAOyR,gBAAkBzR,EAAOgP,uBAAuB8hB,UAAU,IAC7G6J,EAAajE,MAAM32B,KAAM+wB,aAKpC,IAAIyL,GAAwBv8B,EAAOqQ,kBAAkB/N,UAAUkP,eAC/DxR,GAAOqQ,kBAAkB/N,UAAUkP,gBAAkB,WACnD,MAAKsf,WAAU,GAMRyL,EAAsB7F,MAAM32B,KAAM+wB,YALnCA,UAAU,IACZA,UAAU,GAAG4F,MAAM,MAEdlkB,QAAQC,WAKnB,IAAI6yB,IACFC,WAAY,cACZC,YAAa,eACbC,cAAe,iBACfxJ,eAAgB,kBAChBC,gBAAiB,oBAGfwJ,EAAiB1lC,EAAOqQ,kBAAkB/N,UAAU+1B,QACxDr4B,GAAOqQ,kBAAkB/N,UAAU+1B,SAAW,SAAUkD,EAAUoK,EAAQ3kB,GACxE,MAAO0kB,GAAehP,MAAM32B,MAAOw7B,GAAY,OAAO5oB,KAAK,SAAU8hB,GACnE,GAAIpD,EAAe6I,QAAU,KAAOyL,EAGlC,IACElR,EAAMhkB,QAAQ,SAAU2rB,GACtBA,EAAKj4B,KAAOmhC,EAAiBlJ,EAAKj4B,OAASi4B,EAAKj4B,OAElD,MAAOL,GACP,GAAe,cAAXA,EAAEuW,KACJ,KAAMvW,EAGR2wB,GAAMhkB,QAAQ,SAAU2rB,EAAMv7B,GAC5B4zB,EAAMI,IAAIh0B,EAAG+R,OAAOC,UAAWupB,GAC7Bj4B,KAAMmhC,EAAiBlJ,EAAKj4B,OAASi4B,EAAKj4B,UAKlD,MAAOswB,KACN9hB,KAAKgzB,EAAQ3kB,KAIpB,QAAS6R,GAAmB7yB,GAC1B,GAA0E,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,KAAyBA,EAAOqQ,mBAAqBrQ,EAAO+3B,gBAGrH/3B,EAAO+3B,cAAgB,YAAc/3B,GAAO+3B,aAAaz1B,WAA7D;AAGA,GAAI01B,GAAiBh4B,EAAOqQ,kBAAkB/N,UAAU20B,UACpDe,KACFh4B,EAAOqQ,kBAAkB/N,UAAU20B,WAAa,WAC9C,GAAId,GAAQp2B,KAERm4B,EAAUF,EAAetB,MAAM32B,QAInC,OAHAm4B,GAAQznB,QAAQ,SAAU4mB,GACxB,MAAOA,GAAOL,IAAMb,IAEf+B,GAIX,IAAId,GAAep3B,EAAOqQ,kBAAkB/N,UAAUqO,QAClDymB,KACFp3B,EAAOqQ,kBAAkB/N,UAAUqO,SAAW,WAC5C,GAAI0mB,GAASD,EAAaV,MAAM32B,KAAM+wB,UAEtC,OADAuG,GAAOL,IAAMj3B,KACNs3B,IAGXr3B,EAAO+3B,aAAaz1B,UAAU+1B,SAAW,WACvC,MAAOt4B,MAAK2Q,MAAQ3Q,KAAKi3B,IAAIqB,SAASt4B,KAAK2Q,OAAS8B,QAAQC,QAAQ,GAAI0iB,QAI5E,QAASrC,GAAqB9yB,GAC5B,GAA0E,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,KAAyBA,EAAOqQ,mBAAqBrQ,EAAO+3B,gBAGrH/3B,EAAO+3B,cAAgB,YAAc/3B,GAAOm4B,eAAe71B,WAA/D,CAGA,GAAIg2B,GAAmBt4B,EAAOqQ,kBAAkB/N,UAAUg0B,YACtDgC,KACFt4B,EAAOqQ,kBAAkB/N,UAAUg0B,aAAe,WAChD,GAAIqB,GAAS53B,KAETy4B,EAAYF,EAAiB5B,MAAM32B,QAIvC,OAHAy4B,GAAU/nB,QAAQ,SAAUmlB,GAC1B,MAAOA,GAASoB,IAAMW,IAEjBa,IAGXpH,EAAMsE,wBAAwB11B,EAAQ,QAAS,SAAU8D,GAEvD,MADAA,GAAE8xB,SAASoB,IAAMlzB,EAAE20B,WACZ30B,IAET9D,EAAOm4B,eAAe71B,UAAU+1B,SAAW,WACzC,MAAOt4B,MAAKi3B,IAAIqB,SAASt4B,KAAK2Q,SAIlC,QAASkiB,GAAiB5yB,IACnBA,EAAOqQ,mBAAqB,gBAAkBrQ,GAAOqQ,kBAAkB/N,YAG5EtC,EAAOqQ,kBAAkB/N,UAAUu1B,aAAe,SAAU/tB,GAC1D,GAAIguB,GAAS/3B,IAEbqxB,GAAMyT,WAAW,eAAgB,eACjC9kC,KAAKk3B,aAAaxmB,QAAQ,SAAU4mB,GAC9BA,EAAO3mB,OAAS5G,EAAOkI,YAAY8sB,SAASzH,EAAO3mB,QACrDonB,EAAOP,YAAYF,OAM3B,QAAStE,GAAmB/yB,GAGtBA,EAAO4lC,cAAgB5lC,EAAO6lC,iBAChC7lC,EAAO6lC,eAAiB7lC,EAAO4lC,aAnMnChzB,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,IAET0L,EAAQwD,oBAAsBxD,EAAQsC,iBAAmBxpB,MAEzD,IAAIktB,GAA4B,kBAAXgH,SAAoD,gBAApBA,QAAOC,SAAwB,SAAU/wB,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAX8wB,SAAyB9wB,EAAIgxB,cAAgBF,QAAU9wB,IAAQ8wB,OAAOn6B,UAAY,eAAkBqJ,IAElQixB,EAAgB3M,EAAQ,iBAE5Brd,QAAO8gB,eAAejE,EAAS,oBAC7BuG,YAAY,EACZxW,IAAK,WACH,MAAOod,GAAc7K,mBAIzB,IAAI8K,GAAmB5M,EAAQ,oBAE/Brd,QAAO8gB,eAAejE,EAAS,uBAC7BuG,YAAY,EACZxW,IAAK,WACH,MAAOqd,GAAiB5J,uBAG5BxD,EAAQwC,YAAcA,EACtBxC,EAAQoC,mBAAqBA,EAC7BpC,EAAQoD,mBAAqBA,EAC7BpD,EAAQqD,qBAAuBA,EAC/BrD,EAAQmD,iBAAmBA,EAC3BnD,EAAQsD,mBAAqBA,CAE7B,IAAIY,GAAS1D,EAAQ,YAEjBmB,EAAQX,EAAwBkD,KAsKjC2Q,WAAW,GAAGvH,oBAAoB,GAAGC,iBAAiB,KAAK8I,IAAI,SAAS7V,EAAQP,EAAOD,GAS1F,YAMA,SAASwD,GAAoBjzB,EAAQ+lC,GAC/B/lC,EAAOkL,UAAU8H,cAAgB,mBAAqBhT,GAAOkL,UAAU8H,cAGtEhT,EAAOkL,UAAU8H,eAGtBhT,EAAOkL,UAAU8H,aAAamqB,gBAAkB,SAAU7wB,GACxD,IAAMA,IAAeA,EAAYC,MAAQ,CACvC,GAAItH,GAAM,GAAI4zB,cAAa,yDAI3B,OAHA5zB,GAAIoV,KAAO,gBAEXpV,EAAIiC,KAAO,EACJsL,QAAQomB,OAAO3zB,GAOxB,MALIqH,GAAYC,SAAU,EACxBD,EAAYC,OAAUoB,YAAao4B,GAEnCz5B,EAAYC,MAAMoB,YAAco4B,EAE3B/lC,EAAOkL,UAAU8H,aAAa3G,aAAaC,KAxBtDsG,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,IAET0L,EAAQwD,oBAAsBA,OAyBxB+S,IAAI,SAAS/V,EAAQP,EAAOD,GASlC,YAcA,SAASgB,GAAwB9kB,GAAO,GAAIA,GAAOA,EAAI+kB,WAAc,MAAO/kB,EAAc,IAAIglB,KAAa,IAAW,MAAPhlB,EAAe,IAAK,GAAIuS,KAAOvS,GAAWiH,OAAOtQ,UAAUsuB,eAAettB,KAAKqI,EAAKuS,KAAMyS,EAAOzS,GAAOvS,EAAIuS,GAAgC,OAAtByS,GAAAA,WAAiBhlB,EAAYglB,EAElQ,QAASoB,GAAiB/xB,GACxB,GAAIqxB,GAAiBD,EAAME,cAActxB,GACrCkL,EAAYlL,GAAUA,EAAOkL,UAC7BytB,EAAmB34B,GAAUA,EAAO24B,gBAQxC,IANAztB,EAAUmB,aAAe,SAAUC,EAAamI,EAAWC,GAEzD0c,EAAMyT,WAAW,yBAA0B,uCAC3C35B,EAAU8H,aAAa3G,aAAaC,GAAaqG,KAAK8B,EAAWC,MAG7D2c,EAAe6I,QAAU,IAAM,mBAAqBhvB,GAAU8H,aAAawrB,2BAA4B,CAC3G,GAAIJ,GAAQ,SAAezyB,EAAKqT,EAAG6I,GAC7B7I,IAAKrT,MAASkc,IAAKlc,MACrBA,EAAIkc,GAAKlc,EAAIqT,SACNrT,GAAIqT,KAIXinB,EAAqB/6B,EAAU8H,aAAa3G,aAAayhB,KAAK5iB,EAAU8H,aAU5E,IATA9H,EAAU8H,aAAa3G,aAAe,SAAU4O,GAM9C,MAL8D,YAA5C,mBAANA,GAAoB,YAAcwa,EAAQxa,KAAyC,WAArBwa,EAAQxa,EAAErP,SAClFqP,EAAI+E,KAAKme,MAAMne,KAAKC,UAAUhF,IAC9BmjB,EAAMnjB,EAAErP,MAAO,kBAAmB,sBAClCwyB,EAAMnjB,EAAErP,MAAO,mBAAoB,wBAE9Bq6B,EAAmBhrB,IAGxB0d,GAAoBA,EAAiBr2B,UAAU4jC,YAAa,CAC9D,GAAIC,GAAoBxN,EAAiBr2B,UAAU4jC,WACnDvN,GAAiBr2B,UAAU4jC,YAAc,WACvC,GAAIv6B,GAAMw6B,EAAkBzP,MAAM32B,KAAM+wB,UAGxC,OAFAsN,GAAMzyB,EAAK,qBAAsB,mBACjCyyB,EAAMzyB,EAAK,sBAAuB,oBAC3BA,GAIX,GAAIgtB,GAAoBA,EAAiBr2B,UAAU8jC,iBAAkB,CACnE,GAAIC,GAAyB1N,EAAiBr2B,UAAU8jC,gBACxDzN,GAAiBr2B,UAAU8jC,iBAAmB,SAAUnrB,GAMtD,MALkB,UAAdlb,KAAKyuB,MAA8E,YAA5C,mBAANvT,GAAoB,YAAcwa,EAAQxa,MAC7EA,EAAI+E,KAAKme,MAAMne,KAAKC,UAAUhF,IAC9BmjB,EAAMnjB,EAAG,kBAAmB,sBAC5BmjB,EAAMnjB,EAAG,mBAAoB,wBAExBorB,EAAuB3P,MAAM32B,MAAOkb,OA7DnDrI,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,GAGT,IAAI0R,GAA4B,kBAAXgH,SAAoD,gBAApBA,QAAOC,SAAwB,SAAU/wB,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAX8wB,SAAyB9wB,EAAIgxB,cAAgBF,QAAU9wB,IAAQ8wB,OAAOn6B,UAAY,eAAkBqJ,GAEtQ8jB,GAAQsC,iBAAmBA,CAE3B,IAAI4B,GAAS1D,EAAQ,YAEjBmB,EAAQX,EAAwBkD,KAyDjC2Q,WAAW,KAAKgC,IAAI,SAASrW,EAAQP,EAAOD,GAQ/C,YAqBA,SAASgB,GAAwB9kB,GAAO,GAAIA,GAAOA,EAAI+kB,WAAc,MAAO/kB,EAAc,IAAIglB,KAAa,IAAW,MAAPhlB,EAAe,IAAK,GAAIuS,KAAOvS,GAAWiH,OAAOtQ,UAAUsuB,eAAettB,KAAKqI,EAAKuS,KAAMyS,EAAOzS,GAAOvS,EAAIuS,GAAgC,OAAtByS,GAAAA,WAAiBhlB,EAAYglB,EAElQ,QAAS4C,GAAoBvzB,GAC3B,GAAwE,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,KAA0BA,EAAOqQ,kBAA5F,CAWA,GARM,mBAAqBrQ,GAAOqQ,kBAAkB/N,YAClDtC,EAAOqQ,kBAAkB/N,UAAUy2B,gBAAkB,WAInD,MAHKh5B,MAAKwmC,gBACRxmC,KAAKwmC,kBAEAxmC,KAAKwmC,kBAGV,aAAevmC,GAAOqQ,kBAAkB/N,WAAY,CACxD,GAAIkkC,GAAYxmC,EAAOqQ,kBAAkB/N,UAAUqO,QACnD3Q,GAAOqQ,kBAAkB/N,UAAUyO,UAAY,SAAUjH,GACvD,GAAIqsB,GAAQp2B,IAEPA,MAAKwmC,gBACRxmC,KAAKwmC,kBAEFxmC,KAAKwmC,cAAczH,SAASh1B,IAC/B/J,KAAKwmC,cAAcx/B,KAAK+C,GAE1BA,EAAOkI,YAAYvB,QAAQ,SAAUC,GACnC,MAAO81B,GAAUljC,KAAK6yB,EAAOzlB,EAAO5G,MAIxC9J,EAAOqQ,kBAAkB/N,UAAUqO,SAAW,SAAUD,EAAO5G,GAQ7D,MAPIA,KACG/J,KAAKwmC,cAEExmC,KAAKwmC,cAAczH,SAASh1B,IACtC/J,KAAKwmC,cAAcx/B,KAAK+C,GAFxB/J,KAAKwmC,eAAiBz8B,IAKnB08B,EAAUljC,KAAKvD,KAAM2Q,EAAO5G,IAGjC,gBAAkB9J,GAAOqQ,kBAAkB/N,YAC/CtC,EAAOqQ,kBAAkB/N,UAAUu1B,aAAe,SAAU/tB,GAC1D,GAAI6tB,GAAS53B,IAERA,MAAKwmC,gBACRxmC,KAAKwmC,iBAEP,IAAIplB,GAAQphB,KAAKwmC,cAAcr9B,QAAQY,EACvC,IAAc,KAAVqX,EAAJ,CAGAphB,KAAKwmC,cAAc9O,OAAOtW,EAAO,EACjC,IAAIpP,GAASjI,EAAOkI,WACpBjS,MAAKk3B,aAAaxmB,QAAQ,SAAU4mB,GAC9BtlB,EAAO+sB,SAASzH,EAAO3mB,QACzBinB,EAAOJ,YAAYF,SAO7B,QAAS7D,GAAqBxzB,GAC5B,GAAwE,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,KAA0BA,EAAOqQ,oBAGtF,oBAAsBrQ,GAAOqQ,kBAAkB/N,YACnDtC,EAAOqQ,kBAAkB/N,UAAUmkC,iBAAmB,WACpD,MAAO1mC,MAAK2mC,eAAiB3mC,KAAK2mC,sBAGhC,eAAiB1mC,GAAOqQ,kBAAkB/N,YAAY,CAC1DsQ,OAAO8gB,eAAe1zB,EAAOqQ,kBAAkB/N,UAAW,eACxDkd,IAAK,WACH,MAAOzf,MAAK4mC,cAEd9R,IAAK,SAAa9G,GAChB,GAAI+J,GAAS/3B,IAETA,MAAK4mC,eACP5mC,KAAK+1B,oBAAoB,YAAa/1B,KAAK4mC,cAC3C5mC,KAAK+1B,oBAAoB,QAAS/1B,KAAK6mC,mBAEzC7mC,KAAKg2B,iBAAiB,YAAah2B,KAAK4mC,aAAe5Y,GACvDhuB,KAAKg2B,iBAAiB,QAASh2B,KAAK6mC,iBAAmB,SAAU9iC,GAC/DA,EAAEgN,QAAQL,QAAQ,SAAU3G,GAI1B,GAHKguB,EAAO4O,iBACV5O,EAAO4O,oBAEL5O,EAAO4O,eAAe5H,SAASh1B,GAAnC,CAGAguB,EAAO4O,eAAe3/B,KAAK+C,EAC3B,IAAIzJ,GAAQ,GAAIm2B,OAAM,YACtBn2B,GAAMyJ,OAASA,EACfguB,EAAOrB,cAAcp2B,UAK7B,IAAI61B,GAA2Bl2B,EAAOqQ,kBAAkB/N,UAAUyM,oBAClE/O,GAAOqQ,kBAAkB/N,UAAUyM,qBAAuB,WACxD,GAAI6nB,GAAK72B,IAiBT,OAhBKA,MAAK6mC,kBACR7mC,KAAKg2B,iBAAiB,QAASh2B,KAAK6mC,iBAAmB,SAAU9iC,GAC/DA,EAAEgN,QAAQL,QAAQ,SAAU3G,GAI1B,GAHK8sB,EAAG8P,iBACN9P,EAAG8P,qBAED9P,EAAG8P,eAAex9B,QAAQY,IAAW,GAAzC,CAGA8sB,EAAG8P,eAAe3/B,KAAK+C,EACvB,IAAIzJ,GAAQ,GAAIm2B,OAAM,YACtBn2B,GAAMyJ,OAASA,EACf8sB,EAAGH,cAAcp2B,QAIhB61B,EAAyBQ,MAAME,EAAI9F,aAKhD,QAASwC,GAAiBtzB,GACxB,GAAwE,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,KAA0BA,EAAOqQ,kBAA5F,CAGA,GAAI/N,GAAYtC,EAAOqQ,kBAAkB/N,UACrCmM,EAAcnM,EAAUmM,YACxBK,EAAexM,EAAUwM,aACzBF,EAAsBtM,EAAUsM,oBAChCG,EAAuBzM,EAAUyM,qBACjCyC,EAAkBlP,EAAUkP,eAEhClP,GAAUmM,YAAc,SAAU+sB,EAAiBqL,GACjD,GAAIxlC,GAAUyvB,UAAUnwB,QAAU,EAAImwB,UAAU,GAAKA,UAAU,GAC3DgW,EAAUr4B,EAAYioB,MAAM32B,MAAOsB,GACvC,OAAKwlC,IAGLC,EAAQn0B,KAAK6oB,EAAiBqL,GACvBr0B,QAAQC,WAHNq0B,GAMXxkC,EAAUwM,aAAe,SAAU0sB,EAAiBqL,GAClD,GAAIxlC,GAAUyvB,UAAUnwB,QAAU,EAAImwB,UAAU,GAAKA,UAAU,GAC3DgW,EAAUh4B,EAAa4nB,MAAM32B,MAAOsB,GACxC,OAAKwlC,IAGLC,EAAQn0B,KAAK6oB,EAAiBqL,GACvBr0B,QAAQC,WAHNq0B,EAMX,IAAIC,GAAe,SAAsBpN,EAAa6B,EAAiBqL,GACrE,GAAIC,GAAUl4B,EAAoB8nB,MAAM32B,MAAO45B,GAC/C,OAAKkN,IAGLC,EAAQn0B,KAAK6oB,EAAiBqL,GACvBr0B,QAAQC,WAHNq0B,EAKXxkC,GAAUsM,oBAAsBm4B,EAEhCA,EAAe,SAAsBpN,EAAa6B,EAAiBqL,GACjE,GAAIC,GAAU/3B,EAAqB2nB,MAAM32B,MAAO45B,GAChD,OAAKkN,IAGLC,EAAQn0B,KAAK6oB,EAAiBqL,GACvBr0B,QAAQC,WAHNq0B,GAKXxkC,EAAUyM,qBAAuBg4B,EAEjCA,EAAe,SAAsB98B,EAAWuxB,EAAiBqL,GAC/D,GAAIC,GAAUt1B,EAAgBklB,MAAM32B,MAAOkK,GAC3C,OAAK48B,IAGLC,EAAQn0B,KAAK6oB,EAAiBqL,GACvBr0B,QAAQC,WAHNq0B,GAKXxkC,EAAUkP,gBAAkBu1B,GAG9B,QAAShV,GAAiB/xB,GACxB,GAAIkL,GAAYlL,GAAUA,EAAOkL,SAEjC,IAAIA,EAAU8H,cAAgB9H,EAAU8H,aAAa3G,aAAc,CAEjE,GAAI2G,GAAe9H,EAAU8H,aACzBg0B,EAAgBh0B,EAAa3G,aAAayhB,KAAK9a,EACnD9H,GAAU8H,aAAa3G,aAAe,SAAUC,GAC9C,MAAO06B,GAAcC,EAAgB36B,MAIpCpB,EAAUmB,cAAgBnB,EAAU8H,cAAgB9H,EAAU8H,aAAa3G,eAC9EnB,EAAUmB,aAAe,SAAUC,EAAa1J,EAAIskC,GAClDh8B,EAAU8H,aAAa3G,aAAaC,GAAaqG,KAAK/P,EAAIskC,IAC1DpZ,KAAK5iB,IAIX,QAAS+7B,GAAgB36B,GACvB,MAAIA,IAAqC/D,SAAtB+D,EAAYC,MACtBqG,OAAOC,UAAWvG,GAAeC,MAAO6kB,EAAM+V,cAAc76B,EAAYC,SAG1ED,EAGT,QAAS8mB,GAAqBpzB,GAE5B,GAAIonC,GAAqBpnC,EAAOqQ,iBAChCrQ,GAAOqQ,kBAAoB,SAAUg3B,EAAUC,GAC7C,GAAID,GAAYA,EAASn3B,WAAY,CAEnC,IAAK,GADDq3B,MACK1mC,EAAI,EAAGA,EAAIwmC,EAASn3B,WAAWvP,OAAQE,IAAK,CACnD,GAAI+jC,GAASyC,EAASn3B,WAAWrP,IAC5B+jC,EAAOhU,eAAe,SAAWgU,EAAOhU,eAAe,QAC1DQ,EAAMyT,WAAW,mBAAoB,qBACrCD,EAAS5kB,KAAKme,MAAMne,KAAKC,UAAU2kB,IACnCA,EAAO50B,KAAO40B,EAAOxgC,UACdwgC,GAAOxgC,IACdmjC,EAAcxgC,KAAK69B,IAEnB2C,EAAcxgC,KAAKsgC,EAASn3B,WAAWrP,IAG3CwmC,EAASn3B,WAAaq3B,EAExB,MAAO,IAAIH,GAAmBC,EAAUC,IAE1CtnC,EAAOqQ,kBAAkB/N,UAAY8kC,EAAmB9kC,UAEpD,uBAAyBtC,GAAOqQ,mBAClCuC,OAAO8gB,eAAe1zB,EAAOqQ,kBAAmB,uBAC9CmP,IAAK,WACH,MAAO4nB,GAAmBI,uBAMlC,QAAS/T,GAA0BzzB,GAEuC,YAAjD,mBAAXA,GAAyB,YAAcy1B,EAAQz1B,KAAyBA,EAAOqQ,mBAAqB,YAAcrQ,GAAOolC,cAAc9iC,YAGlJtC,EAAOynC,gBACN70B,OAAO8gB,eAAe1zB,EAAOolC,cAAc9iC,UAAW,eACpDkd,IAAK,WACH,OAASoW,SAAU71B,KAAK61B,aAMhC,QAASvC,GAAsBrzB,GAC7B,GAAI0nC,GAAkB1nC,EAAOqQ,kBAAkB/N,UAAUmM,WACzDzO,GAAOqQ,kBAAkB/N,UAAUmM,YAAc,SAAUk5B,GACzD,GAAIA,EAAc,CACgC,mBAArCA,GAAa/zB,sBAEtB+zB,EAAa/zB,sBAAwB+zB,EAAa/zB,oBAEpD,IAAIg0B,GAAmB7nC,KAAK8nC,kBAAkBtR,KAAK,SAAUZ,GAC3D,MAAOA,GAAY0B,OAAO3mB,OAA2C,UAAlCilB,EAAY0B,OAAO3mB,MAAM8d,MAE1DmZ,GAAa/zB,uBAAwB,GAASg0B,EACb,aAA/BA,EAAiBvqB,UACfuqB,EAAiBE,aACnBF,EAAiBE,aAAa,YAE9BF,EAAiBvqB,UAAY,WAES,aAA/BuqB,EAAiBvqB,YACtBuqB,EAAiBE,aACnBF,EAAiBE,aAAa,YAE9BF,EAAiBvqB,UAAY,YAGxBsqB,EAAa/zB,uBAAwB,GAASg0B,GACvD7nC,KAAKgoC,eAAe,SAG0B,mBAArCJ,GAAa7zB,sBAEtB6zB,EAAa7zB,sBAAwB6zB,EAAa7zB,oBAEpD,IAAIk0B,GAAmBjoC,KAAK8nC,kBAAkBtR,KAAK,SAAUZ,GAC3D,MAAOA,GAAY0B,OAAO3mB,OAA2C,UAAlCilB,EAAY0B,OAAO3mB,MAAM8d,MAE1DmZ,GAAa7zB,uBAAwB,GAASk0B,EACb,aAA/BA,EAAiB3qB,UACf2qB,EAAiBF,aACnBE,EAAiBF,aAAa,YAE9BE,EAAiB3qB,UAAY,WAES,aAA/B2qB,EAAiB3qB,YACtB2qB,EAAiBF,aACnBE,EAAiBF,aAAa,YAE9BE,EAAiB3qB,UAAY,YAGxBsqB,EAAa7zB,uBAAwB,GAASk0B,GACvDjoC,KAAKgoC,eAAe,SAGxB,MAAOL,GAAgBhR,MAAM32B,KAAM+wB,YA9UvCle,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,GAGT,IAAI0R,GAA4B,kBAAXgH,SAAoD,gBAApBA,QAAOC,SAAwB,SAAU/wB,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAX8wB,SAAyB9wB,EAAIgxB,cAAgBF,QAAU9wB,IAAQ8wB,OAAOn6B,UAAY,eAAkBqJ,GAEtQ8jB,GAAQ8D,oBAAsBA,EAC9B9D,EAAQ+D,qBAAuBA,EAC/B/D,EAAQ6D,iBAAmBA,EAC3B7D,EAAQsC,iBAAmBA,EAC3BtC,EAAQwX,gBAAkBA,EAC1BxX,EAAQ2D,qBAAuBA,EAC/B3D,EAAQgE,0BAA4BA,EACpChE,EAAQ4D,sBAAwBA,CAEhC,IAAIM,GAAS1D,EAAQ,YAEjBmB,EAAQX,EAAwBkD,KAiUjC2Q,WAAW,KAAK2D,IAAI,SAAShY,EAAQP,EAAOD,GAS/C,YAiBA,SAASyY,GAAgBv8B,EAAKuS,EAAK6F,GAAiK,MAApJ7F,KAAOvS,GAAOiH,OAAO8gB,eAAe/nB,EAAKuS,GAAO6F,MAAOA,EAAOiS,YAAY,EAAMC,cAAc,EAAM0K,UAAU,IAAkBh1B,EAAIuS,GAAO6F,EAAgBpY,EAa3M,QAAS6lB,GAAe2W,EAAUC,EAAMC,GACtC,GAAI7+B,GAAQ2+B,EAAS3+B,MAAM4+B,EAC3B,OAAO5+B,IAASA,EAAM7I,QAAU0nC,GAAO7gC,SAASgC,EAAM6+B,GAAM,IAM9D,QAAS3S,GAAwB11B,EAAQsoC,EAAiBC,GACxD,GAAKvoC,EAAOqQ,kBAAZ,CAGA,GAAIsyB,GAAQ3iC,EAAOqQ,kBAAkB/N,UACjCkmC,EAAyB7F,EAAM5M,gBACnC4M,GAAM5M,iBAAmB,SAAU0S,EAAiB7lC,GAClD,GAAI6lC,IAAoBH,EACtB,MAAOE,GAAuB9R,MAAM32B,KAAM+wB,UAE5C,IAAI4X,GAAkB,SAAyB5kC,GAC7C,GAAI6kC,GAAgBJ,EAAQzkC,EACxB6kC,IACF/lC,EAAG+lC,GAKP,OAFA5oC,MAAK6oC,UAAY7oC,KAAK6oC,cACtB7oC,KAAK6oC,UAAUhmC,GAAM8lC,EACdF,EAAuB9R,MAAM32B,MAAO0oC,EAAiBC,IAG9D,IAAIG,GAA4BlG,EAAM7M,mBACtC6M,GAAM7M,oBAAsB,SAAU2S,EAAiB7lC,GACrD,GAAI6lC,IAAoBH,IAAoBvoC,KAAK6oC,YAAc7oC,KAAK6oC,UAAUhmC,GAC5E,MAAOimC,GAA0BnS,MAAM32B,KAAM+wB,UAE/C,IAAIgY,GAAc/oC,KAAK6oC,UAAUhmC,EAEjC,cADO7C,MAAK6oC,UAAUhmC,GACfimC,EAA0BnS,MAAM32B,MAAO0oC,EAAiBK,KAGjEl2B,OAAO8gB,eAAeiP,EAAO,KAAO2F,GAClC9oB,IAAK,WACH,MAAOzf,MAAK,MAAQuoC,IAEtBzT,IAAK,SAAajyB,GACZ7C,KAAK,MAAQuoC,KACfvoC,KAAK+1B,oBAAoBwS,EAAiBvoC,KAAK,MAAQuoC,UAChDvoC,MAAK,MAAQuoC,IAElB1lC,GACF7C,KAAKg2B,iBAAiBuS,EAAiBvoC,KAAK,MAAQuoC,GAAmB1lC,IAI3EozB,YAAY,EACZC,cAAc,KAIlB,QAASxE,GAAWsX,GAClB,MAAoB,iBAATA,GACF,GAAI7Y,OAAM,mBAAqC,mBAAT6Y,GAAuB,YAActT,EAAQsT,IAAS,4BAErGC,EAAeD,EACRA,EAAO,8BAAgC,8BAOhD,QAASrX,GAAgBqX,GACvB,MAAoB,iBAATA,GACF,GAAI7Y,OAAM,mBAAqC,mBAAT6Y,GAAuB,YAActT,EAAQsT,IAAS,4BAErGE,GAAwBF,EACjB,oCAAsCA,EAAO,WAAa,YAGnE,QAAS/kC,KACP,GAAwE,YAAjD,mBAAXhE,QAAyB,YAAcy1B,EAAQz1B,SAAuB,CAChF,GAAIgpC,EACF,MAEqB,oBAAZjlC,UAAkD,kBAAhBA,SAAQC,KACnDD,QAAQC,IAAI0yB,MAAM3yB,QAAS+sB,YAQjC,QAAS+T,GAAWqE,EAAWC,GACxBF,GAGLllC,QAAQ8L,KAAKq5B,EAAY,8BAAgCC,EAAY,aASvE,QAAS7X,GAActxB,GACrB,GAAIkL,GAAYlL,EAAOkL,UAInBxG,GAAWitB,QAAS,KAAMuI,QAAS,KAGvC,IAAsB,mBAAXl6B,KAA2BA,EAAOkL,UAE3C,MADAxG,GAAOitB,QAAU,iBACVjtB,CAGT,IAAIwG,EAAU+B,gBAEZvI,EAAOitB,QAAU,UACjBjtB,EAAOw1B,QAAU1I,EAAetmB,EAAUk+B,UAAW,mBAAoB,OACpE,IAAIl+B,EAAU20B,mBAGnBn7B,EAAOitB,QAAU,SACjBjtB,EAAOw1B,QAAU1I,EAAetmB,EAAUk+B,UAAW,wBAAyB,OACzE,IAAIl+B,EAAU8H,cAAgB9H,EAAUk+B,UAAU5/B,MAAM,sBAE7D9E,EAAOitB,QAAU,OACjBjtB,EAAOw1B,QAAU1I,EAAetmB,EAAUk+B,UAAW,qBAAsB,OACtE,CAAA,IAAIppC,EAAOqQ,oBAAqBnF,EAAUk+B,UAAU5/B,MAAM,wBAO/D,MADA9E,GAAOitB,QAAU,2BACVjtB,CALPA,GAAOitB,QAAU,SACjBjtB,EAAOw1B,QAAU1I,EAAetmB,EAAUk+B,UAAW,uBAAwB,GAO/E,MAAO1kC,GAQT,QAASyiC,GAAchkC,GACrB,MAAoE,YAA/C,mBAATA,GAAuB,YAAcsyB,EAAQtyB,IAChDA,EAGFyP,OAAOkiB,KAAK3xB,GAAMkmC,OAAO,SAAUC,EAAaprB,GACrD,GAAIqrB,GAAkC,WAAvB9T,EAAQtyB,EAAK+a,IACxB6F,EAAQwlB,EAAWpC,EAAchkC,EAAK+a,IAAQ/a,EAAK+a,GACnDsrB,EAAgBD,IAAa32B,OAAOkiB,KAAK/Q,GAAOpjB,MACpD,OAAc4H,UAAVwb,GAAuBylB,EAClBF,EAGF12B,OAAOC,OAAOy2B,EAAapB,KAAoBhqB,EAAK6F,SA9L/DnR,OAAO8gB,eAAejE,EAAS,cAC7B1L,OAAO,GAGT,IAAI0R,GAA4B,kBAAXgH,SAAoD,gBAApBA,QAAOC,SAAwB,SAAU/wB,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAX8wB,SAAyB9wB,EAAIgxB,cAAgBF,QAAU9wB,IAAQ8wB,OAAOn6B,UAAY,eAAkBqJ,GAEtQ8jB,GAAQ+B,eAAiBA,EACzB/B,EAAQiG,wBAA0BA,EAClCjG,EAAQgC,WAAaA,EACrBhC,EAAQiC,gBAAkBA,EAC1BjC,EAAQzrB,IAAMA,EACdyrB,EAAQoV,WAAaA,EACrBpV,EAAQ6B,cAAgBA,EACxB7B,EAAQ0X,cAAgBA,CAIxB,IAAI6B,IAAe,EACfC,GAAuB,OAgLrBQ,IAAI,SAASxZ,EAAQP,EAAOD,GASlC,YAIA,SAASia,GAAatN,GACpB,OACEmJ,WAAY,cACZC,YAAa,eACbC,cAAe,iBACfxJ,eAAgB,kBAChBC,gBAAiB,oBACjBE,EAAKj4B,OAASi4B,EAAKj4B,KAGvB,QAASwlC,GAAkBhU,EAAaiU,EAAMzlC,EAAM2F,EAAQ+/B,GAC1D,GAAIn/B,GAAMo/B,EAASC,oBAAoBpU,EAAYnH,KAAMob,EAuBzD,IApBAl/B,GAAOo/B,EAASE,mBACZrU,EAAYsU,YAAYC,sBAG5Bx/B,GAAOo/B,EAASK,oBACZxU,EAAYyU,cAAcF,qBACjB,UAAT/lC,EAAmB,UAAY0lC,GAAY,UAE/Cn/B,GAAO,SAAWirB,EAAY0U,IAAM,OAGlC3/B,GADEirB,EAAY2U,WAAa3U,EAAY4U,YAChC,iBACE5U,EAAY2U,UACd,iBACE3U,EAAY4U,YACd,iBAEA,iBAGL5U,EAAY2U,UAAW,CACzB,GAAI/U,GAAUI,EAAY2U,UAAUE,iBAChC7U,EAAY2U,UAAU55B,MAAM7M,EAChC8xB,GAAY2U,UAAUE,gBAAkBjV,CAExC,IAAIkV,GAAO,SAAW3gC,EAASA,EAAOjG,GAAK,KAAO,IAC9C0xB,EAAU,MACd7qB,IAAO,KAAO+/B,EAEd//B,GAAO,UAAYirB,EAAY+U,uBAAuB,GAAGC,KACrD,IAAMF,EAGN9U,EAAY+U,uBAAuB,GAAGE,MACxClgC,GAAO,UAAYirB,EAAY+U,uBAAuB,GAAGE,IAAID,KACzD,IAAMF,EACV//B,GAAO,oBACHirB,EAAY+U,uBAAuB,GAAGC,KAAO,IAC7ChV,EAAY+U,uBAAuB,GAAGE,IAAID,KAC1C,QAUR,MANAjgC,IAAO,UAAYirB,EAAY+U,uBAAuB,GAAGC,KACrD,UAAYb,EAASe,WAAa,OAClClV,EAAY2U,WAAa3U,EAAY+U,uBAAuB,GAAGE,MACjElgC,GAAO,UAAYirB,EAAY+U,uBAAuB,GAAGE,IAAID,KACzD,UAAYb,EAASe,WAAa,QAEjCngC,EAQT,QAASw5B,GAAiBh0B,EAAYw0B,GACpC,GAAIC,IAAU,CAEd,OADAz0B,GAAa8P,KAAKme,MAAMne,KAAKC,UAAU/P,IAChCA,EAAWqpB,OAAO,SAASqL,GAChC,GAAIA,IAAWA,EAAO50B,MAAQ40B,EAAOxgC,KAAM,CACzC,GAAI4L,GAAO40B,EAAO50B,MAAQ40B,EAAOxgC,GAC7BwgC,GAAOxgC,MAAQwgC,EAAO50B,MACxBjM,QAAQ8L,KAAK,oDAEf,IAAIi1B,GAA2B,gBAAT90B,EAoBtB,OAnBI80B,KACF90B,GAAQA,IAEVA,EAAOA,EAAKupB,OAAO,SAASn1B,GAC1B,GAAI2gC,GAAqC,IAAzB3gC,EAAI8E,QAAQ,UACS,KAAjC9E,EAAI8E,QAAQ,kBACc,KAA1B9E,EAAI8E,QAAQ,YACXy7B,CAEL,OAAII,IACFJ,GAAU,GACH,GAEuB,IAAzBvgC,EAAI8E,QAAQ,UAAkBw7B,GAAe,OACd,KAAlCtgC,EAAI8E,QAAQ,0BAGX07B,GAAOxgC,IACdwgC,EAAO50B,KAAO80B,EAAW90B,EAAK,GAAKA,IAC1BA,EAAKrP,UAMpB,QAASmqC,GAAsBC,EAAmBC,GAChD,GAAIC,IACFC,UACAC,oBACAC,kBAGEC,EAAyB,SAASC,EAAIJ,GACxCI,EAAK9jC,SAAS8jC,EAAI,GAClB,KAAK,GAAIzqC,GAAI,EAAGA,EAAIqqC,EAAOvqC,OAAQE,IACjC,GAAIqqC,EAAOrqC,GAAG0qC,cAAgBD,GAC1BJ,EAAOrqC,GAAG2qC,uBAAyBF,EACrC,MAAOJ,GAAOrqC,IAKhB4qC,EAAuB,SAASC,EAAMC,EAAMC,EAASC,GACvD,GAAIC,GAAST,EAAuBK,EAAKK,WAAWC,IAAKJ,GACrDK,EAASZ,EAAuBM,EAAKI,WAAWC,IAAKH,EACzD,OAAOC,IAAUG,GACbH,EAAOzxB,KAAKlR,gBAAkB8iC,EAAO5xB,KAAKlR,cAqDhD,OAlDA4hC,GAAkBG,OAAOz6B,QAAQ,SAASq7B,GACxC,IAAK,GAAIjrC,GAAI,EAAGA,EAAImqC,EAAmBE,OAAOvqC,OAAQE,IAAK,CACzD,GAAIorC,GAASjB,EAAmBE,OAAOrqC,EACvC,IAAIirC,EAAOzxB,KAAKlR,gBAAkB8iC,EAAO5xB,KAAKlR,eAC1C2iC,EAAOI,YAAcD,EAAOC,UAAW,CACzC,GAAkC,QAA9BJ,EAAOzxB,KAAKlR,eACZ2iC,EAAOC,YAAcE,EAAOF,WAAWC,MAGpCP,EAAqBK,EAAQG,EAC9BlB,EAAkBG,OAAQF,EAAmBE,QAC/C,QAGJe,GAASjsB,KAAKme,MAAMne,KAAKC,UAAUgsB,IAEnCA,EAAOE,YAAcrrC,KAAKuM,IAAIy+B,EAAOK,YACjCF,EAAOE,aAEXlB,EAAmBC,OAAOnkC,KAAKklC,GAG/BA,EAAOG,aAAeH,EAAOG,aAAa7S,OAAO,SAAS8S,GACxD,IAAK,GAAIp1B,GAAI,EAAGA,EAAI60B,EAAOM,aAAazrC,OAAQsW,IAC9C,GAAI60B,EAAOM,aAAan1B,GAAG9S,OAASkoC,EAAGloC,MACnC2nC,EAAOM,aAAan1B,GAAGq1B,YAAcD,EAAGC,UAC1C,OAAO,CAGX,QAAO,GAIT,WAKNvB,EAAkBI,iBAAiB16B,QAAQ,SAAS87B,GAClD,IAAK,GAAI1rC,GAAI,EAAGA,EAAImqC,EAAmBG,iBAAiBxqC,OACnDE,IAAK,CACR,GAAI2rC,GAAmBxB,EAAmBG,iBAAiBtqC,EAC3D,IAAI0rC,EAAiBE,MAAQD,EAAiBC,IAAK,CACjDxB,EAAmBE,iBAAiBpkC,KAAKylC,EACzC,WAMCvB,EAIT,QAASyB,GAAgC5yB,EAAQ3V,EAAMs2B,GACrD,MAS4C,MAR1CkS,OACE/9B,qBAAsB,SAAU,oBAChCG,sBAAuB,SAAU,sBAEnCyF,QACE5F,qBAAsB,oBAAqB,uBAC3CG,sBAAuB,mBAAoB,0BAE7C5K,GAAM2V,GAAQ5Q,QAAQuxB,GAG1B,QAASmS,GAAkBC,EAAc5iC,GAGvC,GAAI6iC,GAAeD,EAAaE,sBAC3BxW,KAAK,SAASyW,GACb,MAAO/iC,GAAUgjC,aAAeD,EAAgBC,YAC5ChjC,EAAUijC,KAAOF,EAAgBE,IACjCjjC,EAAUkjC,OAASH,EAAgBG,MACnCljC,EAAUmjC,WAAaJ,EAAgBI,UACvCnjC,EAAUo3B,WAAa2L,EAAgB3L,UACvCp3B,EAAU9F,OAAS6oC,EAAgB7oC,MAK7C,OAHK2oC,IACHD,EAAaQ,mBAAmBpjC,IAE1B6iC,EAIV,QAASQ,GAAUjzB,EAAMsf,GACvB,GAAI71B,GAAI,GAAIosB,OAAMyJ,EAUlB,OATA71B,GAAEuW,KAAOA,EAETvW,EAAEoD,MACAqmC,kBAAmB,EACnBrO,kBAAmB,GACnBsO,mBAAoB,GACpBhL,UAAWj6B,OACXklC,eAAgBllC,QAChB8R,GACKvW,EArOT,GAAIgmC,GAAW7Z,EAAQ,MAwOvBP,GAAOD,QAAU,SAASzvB,EAAQ0kC,GAIhC,QAASgJ,GAA6Bh9B,EAAO5G,GAC3CA,EAAO6G,SAASD,GAChB5G,EAAO2sB,cAAc,GAAIz2B,GAAO2tC,sBAAsB,YACjDj9B,MAAOA,KAGd,QAASk9B,GAAkCl9B,EAAO5G,GAChDA,EAAOytB,YAAY7mB,GACnB5G,EAAO2sB,cAAc,GAAIz2B,GAAO2tC,sBAAsB,eACjDj9B,MAAOA,KAGd,QAASm9B,GAAajX,EAAIlmB,EAAOklB,EAAU9kB,GACzC,GAAIg9B,GAAa,GAAItX,OAAM,QAC3BsX,GAAWp9B,MAAQA,EACnBo9B,EAAWlY,SAAWA,EACtBkY,EAAWnY,aAAeC,SAAUA,GACpCkY,EAAWh9B,QAAUA,EACrB9Q,EAAOuG,WAAW,WAChBqwB,EAAGmX,eAAe,QAASD,KAI/B,GAAIz9B,GAAoB,SAASP,GAC/B,GAAI8mB,GAAK72B,KAELiuC,EAAerkB,SAASskB,wBAwB5B,KAvBC,mBAAoB,sBAAuB,iBACvCx9B,QAAQ,SAASlN,GAChBqzB,EAAGrzB,GAAUyqC,EAAazqC,GAAQuqB,KAAKkgB,KAG7CjuC,KAAKmuC,wBAA0B,KAE/BnuC,KAAKouC,iBAAkB,EAEvBpuC,KAAKquC,gBACLruC,KAAKsuC,iBAELtuC,KAAKuuC,kBAAoB,KACzBvuC,KAAKwuC,mBAAqB,KAE1BxuC,KAAK06B,eAAiB,SACtB16B,KAAK+iC,mBAAqB,MAC1B/iC,KAAKojC,gBAAkB,MACvBpjC,KAAKyuC,kBAAoB,MAEzB1+B,EAASkQ,KAAKme,MAAMne,KAAKC,UAAUnQ,QAEnC/P,KAAK0uC,YAAsC,eAAxB3+B,EAAOK,aACG,cAAzBL,EAAO4+B,cACT,KAAMpB,GAAU,oBACZ,6CAKN,QAJYx9B,EAAO4+B,gBACjB5+B,EAAO4+B,cAAgB,WAGjB5+B,EAAO6+B,oBACb,IAAK,MACL,IAAK,QACH,KACF,SACE7+B,EAAO6+B,mBAAqB,MAIhC,OAAQ7+B,EAAOK,cACb,IAAK,WACL,IAAK,aACL,IAAK,aACH,KACF,SACEL,EAAOK,aAAe,WAO1B,GAHAL,EAAOI,WAAag0B,EAAiBp0B,EAAOI,eAAkBw0B,GAE9D3kC,KAAK6uC,iBACD9+B,EAAO++B,qBACT,IAAK,GAAIhuC,GAAIiP,EAAO++B,qBAAsBhuC,EAAI,EAAGA,IAC/Cd,KAAK6uC,cAAc7nC,KAAK,GAAI/G,GAAO0jC,gBACjCxzB,WAAYJ,EAAOI,WACnB4+B,aAAch/B,EAAO6+B,0BAIzB7+B,GAAO++B,qBAAuB,CAGhC9uC,MAAKgvC,QAAUj/B,EAIf/P,KAAKivC,gBAELjvC,KAAKkvC,cAAgBnF,EAASoF,oBAC9BnvC,KAAKovC,mBAAqB,EAE1BpvC,KAAKqvC,UAAY7mC,OAEjBxI,KAAKsvC,WAAY,EAGnBz8B,QAAO8gB,eAAerjB,EAAkB/N,UAAW,oBACjD2zB,cAAc,EACdzW,IAAK,WACH,MAAOzf,MAAKuuC,qBAGhB17B,OAAO8gB,eAAerjB,EAAkB/N,UAAW,qBACjD2zB,cAAc,EACdzW,IAAK,WACH,MAAOzf,MAAKwuC,sBAKhBl+B,EAAkB/N,UAAUgO,eAAiB,KAC7CD,EAAkB/N,UAAUgtC,YAAc,KAC1Cj/B,EAAkB/N,UAAU0O,QAAU,KACtCX,EAAkB/N,UAAUitC,eAAiB,KAC7Cl/B,EAAkB/N,UAAUktC,uBAAyB,KACrDn/B,EAAkB/N,UAAUmtC,2BAA6B,KACzDp/B,EAAkB/N,UAAUotC,wBAA0B,KACtDr/B,EAAkB/N,UAAUqtC,0BAA4B,KACxDt/B,EAAkB/N,UAAUstC,oBAAsB,KAClDv/B,EAAkB/N,UAAUutC,cAAgB,KAE5Cx/B,EAAkB/N,UAAUyrC,eAAiB,SAAS1zB,EAAMha,GACtDN,KAAKsvC,YAGTtvC,KAAK02B,cAAcp2B,GACc,kBAAtBN,MAAK,KAAOsa,IACrBta,KAAK,KAAOsa,GAAMha,KAItBgQ,EAAkB/N,UAAUwtC,0BAA4B,WACtD,GAAIzvC,GAAQ,GAAIm2B,OAAM,0BACtBz2B,MAAKguC,eAAe,0BAA2B1tC,IAGjDgQ,EAAkB/N,UAAUytC,iBAAmB,WAC7C,MAAOhwC,MAAKgvC,SAGd1+B,EAAkB/N,UAAUy2B,gBAAkB,WAC5C,MAAOh5B,MAAKquC,cAGd/9B,EAAkB/N,UAAUmkC,iBAAmB,WAC7C,MAAO1mC,MAAKsuC,eAKdh+B,EAAkB/N,UAAU0tC,mBAAqB,SAASxhB,EAAMyhB,GAC9D,GAAIC,GAAqBnwC,KAAKivC,aAAaruC,OAAS,EAChDg1B,GACFjlB,MAAO,KACPu5B,YAAa,KACb4C,aAAc,KACdzC,cAAe,KACfW,kBAAmB,KACnBC,mBAAoB,KACpBV,UAAW,KACXC,YAAa,KACb/b,KAAMA,EACN6b,IAAK,KACLK,uBAAwB,KACxByF,uBAAwB,KACxBrmC,OAAQ,KACRsmC,gCACAC,aAAa,EAEf,IAAItwC,KAAK0uC,aAAeyB,EACtBva,EAAYkX,aAAe9sC,KAAKivC,aAAa,GAAGnC,aAChDlX,EAAYyU,cAAgBrqC,KAAKivC,aAAa,GAAG5E,kBAC5C,CACL,GAAIkG,GAAavwC,KAAKwwC,6BACtB5a,GAAYkX,aAAeyD,EAAWzD,aACtClX,EAAYyU,cAAgBkG,EAAWlG,cAKzC,MAHK6F,IACHlwC,KAAKivC,aAAajoC,KAAK4uB,GAElBA,GAGTtlB,EAAkB/N,UAAUqO,SAAW,SAASD,EAAO5G,GACrD,GAAI/J,KAAKsvC,UACP,KAAM/B,GAAU,oBACZ,yDAGN,IAAIlU,GAAgBr5B,KAAKivC,aAAazY,KAAK,SAAS/I,GAClD,MAAOA,GAAE9c,QAAUA,GAGrB,IAAI0oB,EACF,KAAMkU,GAAU,qBAAsB,wBAIxC,KAAK,GADD3X,GACK90B,EAAI,EAAGA,EAAId,KAAKivC,aAAaruC,OAAQE,IACvCd,KAAKivC,aAAanuC,GAAG6P,OACtB3Q,KAAKivC,aAAanuC,GAAG2tB,OAAS9d,EAAM8d,OACtCmH,EAAc51B,KAAKivC,aAAanuC,GAiBpC,OAdK80B,KACHA,EAAc51B,KAAKiwC,mBAAmBt/B,EAAM8d,OAG9CzuB,KAAKywC,8BAEqC,KAAtCzwC,KAAKquC,aAAallC,QAAQY,IAC5B/J,KAAKquC,aAAarnC,KAAK+C,GAGzB6rB,EAAYjlB,MAAQA,EACpBilB,EAAY7rB,OAASA,EACrB6rB,EAAY2U,UAAY,GAAItqC,GAAO+3B,aAAarnB,EAC5CilB,EAAYyU,eACTzU,EAAY2U,WAGrBj6B,EAAkB/N,UAAUyO,UAAY,SAASjH,GAC/C,GAAI8sB,GAAK72B,IACT,IAAI2kC,GAAe,MACjB56B,EAAOkI,YAAYvB,QAAQ,SAASC,GAClCkmB,EAAGjmB,SAASD,EAAO5G,SAEhB,CAIL,GAAI2mC,GAAe3mC,EAAO4mC,OAC1B5mC,GAAOkI,YAAYvB,QAAQ,SAASC,EAAO8mB,GACzC,GAAImZ,GAAcF,EAAaz+B,YAAYwlB,EAC3C9mB,GAAMqlB,iBAAiB,UAAW,SAAS11B,GACzCswC,EAAYz7B,QAAU7U,EAAM6U,YAGhCu7B,EAAaz+B,YAAYvB,QAAQ,SAASC,GACxCkmB,EAAGjmB,SAASD,EAAO+/B,OAKzBpgC,EAAkB/N,UAAUi1B,YAAc,SAASF,GACjD,GAAIt3B,KAAKsvC,UACP,KAAM/B,GAAU,oBACZ,4DAGN,MAAMjW,YAAkBr3B,GAAO+3B,cAC7B,KAAM,IAAIyK,WAAU,yFAItB,IAAI7M,GAAc51B,KAAKivC,aAAazY,KAAK,SAASvG,GAChD,MAAOA,GAAEsa,YAAcjT,GAGzB,KAAK1B,EACH,KAAM2X,GAAU,qBACZ,6CAEN,IAAIxjC,GAAS6rB,EAAY7rB,MAEzB6rB,GAAY2U,UAAUz4B,OACtB8jB,EAAY2U,UAAY,KACxB3U,EAAYjlB,MAAQ,KACpBilB,EAAY7rB,OAAS,IAGrB,IAAIskC,GAAeruC,KAAKivC,aAAavhB,IAAI,SAASuC,GAChD,MAAOA,GAAElmB,QAE0B,MAAjCskC,EAAallC,QAAQY,IACrB/J,KAAKquC,aAAallC,QAAQY,GAAU,IACtC/J,KAAKquC,aAAa3W,OAAO13B,KAAKquC,aAAallC,QAAQY,GAAS,GAG9D/J,KAAKywC,+BAGPngC,EAAkB/N,UAAUu1B,aAAe,SAAS/tB,GAClD,GAAI8sB,GAAK72B,IACT+J,GAAOkI,YAAYvB,QAAQ,SAASC,GAClC,GAAI2mB,GAAST,EAAGK,aAAaV,KAAK,SAAS/I,GACzC,MAAOA,GAAE9c,QAAUA,GAEjB2mB,IACFT,EAAGW,YAAYF,MAKrBhnB,EAAkB/N,UAAU20B,WAAa,WACvC,MAAOl3B,MAAKivC,aAAazV,OAAO,SAAS5D,GACvC,QAASA,EAAY2U,YAEtB7c,IAAI,SAASkI,GACZ,MAAOA,GAAY2U,aAIvBj6B,EAAkB/N,UAAUg0B,aAAe,WACzC,MAAOv2B,MAAKivC,aAAazV,OAAO,SAAS5D,GACvC,QAASA,EAAY4U,cAEtB9c,IAAI,SAASkI,GACZ,MAAOA,GAAY4U,eAKvBl6B,EAAkB/N,UAAUsuC,mBAAqB,SAASl/B,EACtD+8B,GACF,GAAI7X,GAAK72B,IACT,IAAI0uC,GAAe/8B,EAAgB,EACjC,MAAO3R,MAAKivC,aAAa,GAAG/E,WACvB,IAAIlqC,KAAK6uC,cAAcjuC,OAC5B,MAAOZ,MAAK6uC,cAAc3N,OAE5B,IAAIgJ,GAAc,GAAIjqC,GAAO0jC,gBAC3BxzB,WAAYnQ,KAAKgvC,QAAQ7+B,WACzB4+B,aAAc/uC,KAAKgvC,QAAQJ,oBAkB7B,OAhBA/7B,QAAO8gB,eAAeuW,EAAa,SAC9BlmB,MAAO,MAAO4c,UAAU,IAG7B5gC,KAAKivC,aAAat9B,GAAem/B,2BACjC9wC,KAAKivC,aAAat9B,GAAeo/B,iBAAmB,SAASzwC,GAC3D,GAAI0wC,IAAO1wC,EAAM4J,WAAqD,IAAxC2I,OAAOkiB,KAAKz0B,EAAM4J,WAAWtJ,MAG3DspC,GAAY/vB,MAAQ62B,EAAM,YAAc,YACuB,OAA3Dna,EAAGoY,aAAat9B,GAAem/B,yBACjCja,EAAGoY,aAAat9B,GAAem/B,wBAAwB9pC,KAAK1G,IAGhE4pC,EAAYlU,iBAAiB,iBAC3Bh2B,KAAKivC,aAAat9B,GAAeo/B,kBAC5B7G,GAIT55B,EAAkB/N,UAAU0uC,QAAU,SAAS3G,EAAK34B,GAClD,GAAIklB,GAAK72B,KACLkqC,EAAclqC,KAAKivC,aAAat9B,GAAeu4B,WACnD,KAAIA,EAAYgH,iBAAhB,CAGA,GAAIJ,GACF9wC,KAAKivC,aAAat9B,GAAem/B,uBACnC9wC,MAAKivC,aAAat9B,GAAem/B,wBAA0B,KAC3D5G,EAAYnU,oBAAoB,iBAC9B/1B,KAAKivC,aAAat9B,GAAeo/B,kBACnC7G,EAAYgH,iBAAmB,SAASC,GACtC,KAAIta,EAAG6X,aAAe/8B,EAAgB,GAAtC,CAMA,GAAIrR,GAAQ,GAAIm2B,OAAM,eACtBn2B,GAAM4J,WAAaw2B,OAAQ4J,EAAK34B,cAAeA,EAE/C,IAAIy/B,GAAOD,EAAIjnC,UAEX8mC,GAAOI,GAAqC,IAA7Bv+B,OAAOkiB,KAAKqc,GAAMxwC,MACrC,IAAIowC,GAGwB,QAAtB9G,EAAY/vB,OAAyC,cAAtB+vB,EAAY/vB,SAC7C+vB,EAAY/vB,MAAQ,iBAEjB,CACqB,QAAtB+vB,EAAY/vB,QACd+vB,EAAY/vB,MAAQ,aAGtBi3B,EAAKC,UAAY,EAEjBD,EAAKE,MAAQpH,EAAYC,qBAAqBxJ,gBAE9C,IAAI4Q,GAAsBxH,EAASyH,eAAeJ,EAClD9wC,GAAM4J,UAAY2I,OAAOC,OAAOxS,EAAM4J,UAClC6/B,EAASvJ,eAAe+Q,IAE5BjxC,EAAM4J,UAAUA,UAAYqnC,EAC5BjxC,EAAM4J,UAAU5F,OAAS,WACvB,OACE4F,UAAW5J,EAAM4J,UAAUA,UAC3Bw2B,OAAQpgC,EAAM4J,UAAUw2B,OACxB/uB,cAAerR,EAAM4J,UAAUyH,cAC/BgvB,iBAAkBrgC,EAAM4J,UAAUy2B,mBAMxC,GAAIK,GAAW+I,EAAS0H,iBAAiB5a,EAAG0X,kBAAkB5jC,IACzDqmC,GAIHhQ,EAAS1gC,EAAM4J,UAAUyH,gBACrB,0BAJJqvB,EAAS1gC,EAAM4J,UAAUyH,gBACrB,KAAOrR,EAAM4J,UAAUA,UAAY,OAKzC2sB,EAAG0X,kBAAkB5jC,IACjBo/B,EAAS2H,eAAe7a,EAAG0X,kBAAkB5jC,KAC7Cq2B,EAAS19B,KAAK,GAClB,IAAIquC,GAAW9a,EAAGoY,aAAa2C,MAAM,SAAShc,GAC5C,MAAOA,GAAYsU,aACmB,cAAlCtU,EAAYsU,YAAY/vB,OAGD,eAAzB0c,EAAG4X,oBACL5X,EAAG4X,kBAAoB,YACvB5X,EAAGkZ,6BAKAiB,GACHna,EAAGmX,eAAe,eAAgB1tC,GAEhCqxC,IACF9a,EAAGmX,eAAe,eAAgB,GAAIvX,OAAM,iBAC5CI,EAAG4X,kBAAoB,WACvB5X,EAAGkZ,+BAKP9vC,EAAOuG,WAAW,WAChBsqC,EAAwBpgC,QAAQ,SAAS3M,GACvCmmC,EAAYgH,iBAAiBntC,MAE9B,KAILuM,EAAkB/N,UAAUiuC,4BAA8B,WACxD,GAAI3Z,GAAK72B,KACL8sC,EAAe,GAAI7sC,GAAO4xC,gBAAgB,KAC9C/E,GAAagF,iBAAmB,WAC9Bjb,EAAGkb,4BACHlb,EAAGmb,yBAGL,IAAI3H,GAAgB,GAAIpqC,GAAOgyC,iBAAiBnF,EAWhD,OAVAzC,GAAc6H,kBAAoB,WAChCrb,EAAGmb,0BAEL3H,EAAcv9B,QAAU,WAEtB+F,OAAO8gB,eAAe0W,EAAe,SAChCrmB,MAAO,SAAU4c,UAAU,IAChC/J,EAAGmb,2BAIHlF,aAAcA,EACdzC,cAAeA,IAMnB/5B,EAAkB/N,UAAU4vC,6BAA+B,SACvDxgC,GACF,GAAIu4B,GAAclqC,KAAKivC,aAAat9B,GAAeu4B,WAC/CA,WACKA,GAAYgH,uBACZlxC,MAAKivC,aAAat9B,GAAeu4B,YAE1C,IAAI4C,GAAe9sC,KAAKivC,aAAat9B,GAAem7B,YAChDA,WACKA,GAAagF,uBACb9xC,MAAKivC,aAAat9B,GAAem7B,aAE1C,IAAIzC,GAAgBrqC,KAAKivC,aAAat9B,GAAe04B,aACjDA,WACKA,GAAc6H,wBACd7H,GAAcv9B,cACd9M,MAAKivC,aAAat9B,GAAe04B,gBAK5C/5B,EAAkB/N,UAAU6vC,YAAc,SAASxc,EAC/C3yB,EAAMovC,GACR,GAAI5uC,GAASsnC,EAAsBnV,EAAYoV,kBAC3CpV,EAAYqV,mBACZhoC,IAAQ2yB,EAAY2U,YACtB9mC,EAAO6uC,UAAY1c,EAAY+U,uBAC/BlnC,EAAO8uC,MACLC,MAAOzI,EAASe,WAChB2H,SAAU7c,EAAY8c,eAAeD,UAEnC7c,EAAYwa,uBAAuBxvC,SACrC6C,EAAO8uC,KAAK3H,KAAOhV,EAAYwa,uBAAuB,GAAGxF,MAE3DhV,EAAY2U,UAAUtnC,KAAKQ,IAEzB4uC,GAAQzc,EAAY4U,aAAe/mC,EAAO0nC,OAAOvqC,OAAS,IAEnC,UAArBg1B,EAAYnH,MACTmH,EAAYwa,wBACE,MAAdzL,GACL/O,EAAYwa,uBAAuB1/B,QAAQ,SAAS0f,SAC3CA,GAAEya,MAGTjV,EAAYwa,uBAAuBxvC,OACrC6C,EAAO6uC,UAAY1c,EAAYwa,uBAE/B3sC,EAAO6uC,eAET7uC,EAAO8uC,MACLE,SAAU7c,EAAY8c,eAAeD,UAEnC7c,EAAY8c,eAAeF,QAC7B/uC,EAAO8uC,KAAKC,MAAQ5c,EAAY8c,eAAeF,OAE7C5c,EAAY+U,uBAAuB/pC,SACrC6C,EAAO8uC,KAAK3H,KAAOhV,EAAY+U,uBAAuB,GAAGC,MAE3DhV,EAAY4U,YAAYmI,QAAQlvC,KAIpC6M,EAAkB/N,UAAUsM,oBAAsB,SAAS+qB,GACzD,GAAI/C,GAAK72B,IAGT,IAAsD,MAAjD,QAAS,UAAUmJ,QAAQywB,EAAYx1B,MAC1C,MAAOqO,SAAQomB,OAAO0U,EAAU,YAC5B,qBAAuB3T,EAAYx1B,KAAO,KAGhD,KAAKuoC,EAAgC,sBACjC/S,EAAYx1B,KAAMyyB,EAAG6D,iBAAmB7D,EAAGyY,UAC7C,MAAO78B,SAAQomB,OAAO0U,EAAU,oBAC5B,qBAAuB3T,EAAYx1B,KACnC,aAAeyyB,EAAG6D,gBAGxB,IAAIsG,GACA4R,CACJ,IAAyB,UAArBhZ,EAAYx1B,KAGd48B,EAAW+I,EAAS9I,cAAcrH,EAAYjvB,KAC9CioC,EAAc5R,EAASE,QACvBF,EAAStwB,QAAQ,SAASywB,EAAcxvB,GACtC,GAAIk4B,GAAOE,EAAS8I,mBAAmB1R,EACvCtK,GAAGoY,aAAat9B,GAAeq5B,kBAAoBnB,IAGrDhT,EAAGoY,aAAav+B,QAAQ,SAASklB,EAAajkB,GAC5CklB,EAAGoa,QAAQrb,EAAY0U,IAAK34B,SAEzB,IAAyB,WAArBioB,EAAYx1B,KAAmB,CACxC48B,EAAW+I,EAAS9I,cAAcpK,EAAG2X,mBAAmB7jC,KACxDioC,EAAc5R,EAASE,OACvB,IAAI4R,GAAY/I,EAASlI,YAAY+Q,EACjC,cAAchyC,OAAS,CAC3BogC,GAAStwB,QAAQ,SAASywB,EAAcxvB,GACtC,GAAIikB,GAAciB,EAAGoY,aAAat9B,GAC9Bu4B,EAActU,EAAYsU,YAC1B4C,EAAelX,EAAYkX,aAC3BzC,EAAgBzU,EAAYyU,cAC5BW,EAAoBpV,EAAYoV,kBAChCC,EAAqBrV,EAAYqV,mBAGjC8H,EAAWhJ,EAASiJ,WAAW7R,IACgC,IAA/D4I,EAASlI,YAAYV,EAAc,iBAAiBvgC,MAExD,KAAKmyC,IAAand,EAAYmd,SAAU,CACtC,GAAIE,GAAsBlJ,EAASmJ,iBAC/B/R,EAAcyR,GACdO,EAAuBpJ,EAASqJ,kBAChCjS,EAAcyR,EACdE,KACFK,EAAqB7rB,KAAO,UAGzBuP,EAAG6X,aAAiC,IAAlB/8B,IACrBklB,EAAGoa,QAAQrb,EAAY0U,IAAK34B,GACD,QAAvBm7B,EAAa3yB,OACf2yB,EAAauG,MAAMnJ,EAAa+I,EAC5BH,EAAY,cAAgB,cAEN,QAAxBzI,EAAclwB,OAChBkwB,EAAcgJ,MAAMF,GAKxB,IAAI1vC,GAASsnC,EAAsBC,EAC/BC,EAIJpU,GAAGub,YAAYxc,EACXnyB,EAAO0nC,OAAOvqC,OAAS,GACvB,MAeV,MAVAi2B,GAAG0X,mBACDnqC,KAAMw1B,EAAYx1B,KAClBuG,IAAKivB,EAAYjvB,KAEM,UAArBivB,EAAYx1B,KACdyyB,EAAGyc,sBAAsB,oBAEzBzc,EAAGyc,sBAAsB,UAGpB7gC,QAAQC,WAGjBpC,EAAkB/N,UAAUyM,qBAAuB,SAAS4qB,GAC1D,GAAI/C,GAAK72B,IAGT,IAAsD,MAAjD,QAAS,UAAUmJ,QAAQywB,EAAYx1B,MAC1C,MAAOqO,SAAQomB,OAAO0U,EAAU,YAC5B,qBAAuB3T,EAAYx1B,KAAO,KAGhD,KAAKuoC,EAAgC,uBACjC/S,EAAYx1B,KAAMyyB,EAAG6D,iBAAmB7D,EAAGyY,UAC7C,MAAO78B,SAAQomB,OAAO0U,EAAU,oBAC5B,sBAAwB3T,EAAYx1B,KACpC,aAAeyyB,EAAG6D,gBAGxB,IAAI3pB,KACJ8lB,GAAGyX,cAAc59B,QAAQ,SAAS3G,GAChCgH,EAAQhH,EAAOjG,IAAMiG,GAEvB,IAAIwpC,MACAvS,EAAW+I,EAAS9I,cAAcrH,EAAYjvB,KAC9CioC,EAAc5R,EAASE,QACvB4R,EAAY/I,EAASlI,YAAY+Q,EACjC,cAAchyC,OAAS,EACvB8tC,EAAc3E,EAASlI,YAAY+Q,EACnC,mBAAmBhyC,OAAS,CAChCi2B,GAAG6X,YAAcA,CACjB,IAAI8E,GAAazJ,EAASlI,YAAY+Q,EAClC,kBAAkB,EA4UtB,OA3UIY,GACF3c,EAAGsX,wBAA0BqF,EAAW1qC,OAAO,IAAIsL,MAAM,KACpDjL,QAAQ,YAAc,EAE3B0tB,EAAGsX,yBAA0B,EAG/BnN,EAAStwB,QAAQ,SAASywB,EAAcxvB,GACtC,GAAI8hC,GAAQ1J,EAAS2J,WAAWvS,GAC5B1S,EAAOsb,EAAS4J,QAAQxS,GAExB4R,EAAWhJ,EAASiJ,WAAW7R,IACgC,IAA/D4I,EAASlI,YAAYV,EAAc,iBAAiBvgC,OACpD0gC,EAAWmS,EAAM,GAAG3qC,OAAO,GAAGsL,MAAM,KAAK,GAEzCkJ,EAAYysB,EAAS6J,aAAazS,EAAcyR,GAChDiB,EAAa9J,EAAS+J,UAAU3S,GAEhCmJ,EAAMP,EAASgK,OAAO5S,IAAiB4I,EAASiK,oBAGpD,IAAIjB,GAAsB,gBAATtkB,IAAwC,cAAb6S,GAC3B,kBAAbA,GASF,YANAzK,EAAGoY,aAAat9B,IACd24B,IAAKA,EACL7b,KAAMA,EACN6S,SAAUA,EACVyR,UAAU,KAKTA,GAAYlc,EAAGoY,aAAat9B,IAC7BklB,EAAGoY,aAAat9B,GAAeohC,WAEjClc,EAAGoY,aAAat9B,GAAiBklB,EAAGoZ,mBAAmBxhB,GAAM,GAG/D,IAAImH,GACAsU,EACA4C,EACAzC,EACAG,EACAG,EACAyF,EACApF,EAEAr6B,EAGAsiC,EACAE,EAFAlI,EAAqBlB,EAAS8I,mBAAmB1R,EAGhD4R,KACHE,EAAsBlJ,EAASmJ,iBAAiB/R,EAC5CyR,GACJO,EAAuBpJ,EAASqJ,kBAAkBjS,EAC9CyR,GACJO,EAAqB7rB,KAAO,UAE9B8oB,EACIrG,EAASkK,2BAA2B9S,EAExC,IAAIuR,GAAiB3I,EAASmK,oBAAoB/S,GAE9CgT,EAAapK,EAASlI,YAAYV,EAClC,sBAAuByR,GAAahyC,OAAS,EAC7CwzC,EAAQrK,EAASlI,YAAYV,EAAc,gBAC1CzT,IAAI,SAAS0jB,GACZ,MAAOrH,GAASvJ,eAAe4Q,KAEhC5X,OAAO,SAAS4X,GACf,MAA0B,KAAnBA,EAAKC,WAuBlB,KAnB0B,UAArBzX,EAAYx1B,MAAyC,WAArBw1B,EAAYx1B,QAC5C2uC,GAAYrE,GAAe/8B,EAAgB,GAC5CklB,EAAGoY,aAAat9B,KAClBklB,EAAGsb,6BAA6BxgC,GAChCklB,EAAGoY,aAAat9B,GAAeu4B,YAC3BrT,EAAGoY,aAAa,GAAG/E,YACvBrT,EAAGoY,aAAat9B,GAAem7B,aAC3BjW,EAAGoY,aAAa,GAAGnC,aACvBjW,EAAGoY,aAAat9B,GAAe04B,cAC3BxT,EAAGoY,aAAa,GAAG5E,cACnBxT,EAAGoY,aAAat9B,GAAe44B,WACjC1T,EAAGoY,aAAat9B,GAAe44B,UAAU8J,aACrCxd,EAAGoY,aAAa,GAAG5E,eAErBxT,EAAGoY,aAAat9B,GAAe64B,aACjC3T,EAAGoY,aAAat9B,GAAe64B,YAAY6J,aACvCxd,EAAGoY,aAAa,GAAG5E,gBAGF,UAArBzQ,EAAYx1B,MAAqB2uC,GAmG9B,GAAyB,WAArBnZ,EAAYx1B,OAAsB2uC,EAAU,CACrDnd,EAAciB,EAAGoY,aAAat9B,GAC9Bu4B,EAActU,EAAYsU,YAC1B4C,EAAelX,EAAYkX,aAC3BzC,EAAgBzU,EAAYyU,cAC5BG,EAAc5U,EAAY4U,YAC1BG,EAAyB/U,EAAY+U,uBACrCK,EAAoBpV,EAAYoV,kBAEhCnU,EAAGoY,aAAat9B,GAAey+B,uBAC3BA,EACJvZ,EAAGoY,aAAat9B,GAAes5B,mBAC3BA,EACJpU,EAAGoY,aAAat9B,GAAe+gC,eAAiBA,EAE5C0B,EAAMxzC,QAAiC,QAAvBksC,EAAa3yB,SAC1B24B,IAAaqB,GACZzF,GAAiC,IAAlB/8B,EAGnByiC,EAAM1jC,QAAQ,SAASxG,GACrB2iC,EAAkBjX,EAAYkX,aAAc5iC,KAH9C4iC,EAAawH,oBAAoBF,IAQhC1F,GAAiC,IAAlB/8B,IACS,QAAvBm7B,EAAa3yB,OACf2yB,EAAauG,MAAMnJ,EAAa+I,EAC5B,eAEsB,QAAxB5I,EAAclwB,OAChBkwB,EAAcgJ,MAAMF,GAMxB,IAAIjI,GAAqBH,EACvBnV,EAAYoV,kBACZpV,EAAYqV,oBAEVsJ,EAASrJ,EAAmBC,OAAO3R,OAAO,SAASte,GACrD,MAAgC,QAAzBA,EAAEZ,KAAKlR,gBACbxI,QACE2zC,GAAU3e,EAAY+U,uBAAuB,GAAGE,WAC5CjV,GAAY+U,uBAAuB,GAAGE,IAG/ChU,EAAGub,YAAYxc,EACG,aAAdtY,GAA0C,aAAdA,EACd,aAAdA,GAA0C,aAAdA,IAG5BktB,GACe,aAAdltB,GAA0C,aAAdA,QAiBxBsY,GAAY4U,aAhBnB75B,EAAQ65B,EAAY75B,MAChBkjC,GACG9iC,EAAQ8iC,EAAW9pC,UACtBgH,EAAQ8iC,EAAW9pC,QAAU,GAAI9J,GAAO8R,aAE1C47B,EAA6Bh9B,EAAOI,EAAQ8iC,EAAW9pC,SACvDwpC,EAAavsC,MAAM2J,EAAO65B,EAAaz5B,EAAQ8iC,EAAW9pC,YAErDgH,EAAAA,aACHA,EAAAA,WAAkB,GAAI9Q,GAAO8R,aAE/B47B,EAA6Bh9B,EAAOI,EAAAA,YACpCwiC,EAAavsC,MAAM2J,EAAO65B,EAAaz5B,EAAAA,oBAvKE,CAC7C6kB,EAAciB,EAAGoY,aAAat9B,IAC1BklB,EAAGoZ,mBAAmBxhB,GAC1BmH,EAAY0U,IAAMA,EAEb1U,EAAYsU,cACftU,EAAYsU,YAAcrT,EAAGga,mBAAmBl/B,EAC5C+8B,IAGF0F,EAAMxzC,QAA6C,QAAnCg1B,EAAYkX,aAAa3yB,SACvCg6B,GAAgBzF,GAAiC,IAAlB/8B,EAGjCyiC,EAAM1jC,QAAQ,SAASxG,GACrB2iC,EAAkBjX,EAAYkX,aAAc5iC,KAH9C0rB,EAAYkX,aAAawH,oBAAoBF,IAQjDpJ,EAAoB/qC,EAAOm4B,eAAeoc,gBAAgB/lB,GAIxC,MAAdkW,IACFqG,EAAkBG,OAASH,EAAkBG,OAAO3R,OAChD,SAASib,GACP,MAAsB,QAAfA,EAAMn6B,QAIrBqwB,EAAyB/U,EAAY+U,0BACnCC,KAAgC,MAAzB,EAAIj5B,EAAgB,IAI7B,IAAI+iC,IAAa,CACjB,IAAkB,aAAdp3B,GAA0C,aAAdA,GAK9B,GAJAo3B,GAAc9e,EAAY4U,YAC1BA,EAAc5U,EAAY4U,aACtB,GAAIvqC,GAAOm4B,eAAexC,EAAYyU,cAAe5b,GAErDimB,EAAY,CACd,GAAI3qC,EACJ4G,GAAQ65B,EAAY75B,MAEhBkjC,GAAoC,MAAtBA,EAAW9pC,SAElB8pC,GACJ9iC,EAAQ8iC,EAAW9pC,UACtBgH,EAAQ8iC,EAAW9pC,QAAU,GAAI9J,GAAO8R,YACxCc,OAAO8gB,eAAe5iB,EAAQ8iC,EAAW9pC,QAAS,MAChD0V,IAAK,WACH,MAAOo0B,GAAW9pC,WAIxB8I,OAAO8gB,eAAehjB,EAAO,MAC3B8O,IAAK,WACH,MAAOo0B,GAAWljC,SAGtB5G,EAASgH,EAAQ8iC,EAAW9pC,UAEvBgH,EAAAA,aACHA,EAAAA,WAAkB,GAAI9Q,GAAO8R,aAE/BhI,EAASgH,EAAAA,aAEPhH,IACF4jC,EAA6Bh9B,EAAO5G,GACpC6rB,EAAYya,6BAA6BrpC,KAAK+C,IAEhDwpC,EAAavsC,MAAM2J,EAAO65B,EAAazgC,SAEhC6rB,GAAY4U,aAAe5U,EAAY4U,YAAY75B,QAC5DilB,EAAYya,6BAA6B3/B,QAAQ,SAAS+c,GACxD,GAAIknB,GAAclnB,EAAExb,YAAYukB,KAAK,SAASvG;AAC5C,MAAOA,GAAEnsB,KAAO8xB,EAAY4U,YAAY75B,MAAM7M,IAE5C6wC,IACF9G,EAAkC8G,EAAalnB,KAGnDmI,EAAYya,gCAGdza,GAAYoV,kBAAoBA,EAChCpV,EAAYqV,mBAAqBA,EACjCrV,EAAY4U,YAAcA,EAC1B5U,EAAY8c,eAAiBA,EAC7B9c,EAAY+U,uBAAyBA,EACrC/U,EAAYwa,uBAAyBA,EAIrCvZ,EAAGub,YAAYvb,EAAGoY,aAAat9B,IAC3B,EACA+iC,MA8EalsC,SAAjBquB,EAAGwY,YACLxY,EAAGwY,UAAiC,UAArBzV,EAAYx1B,KAAmB,SAAW,WAG3DyyB,EAAG2X,oBACDpqC,KAAMw1B,EAAYx1B,KAClBuG,IAAKivB,EAAYjvB,KAEM,UAArBivB,EAAYx1B,KACdyyB,EAAGyc,sBAAsB,qBAEzBzc,EAAGyc,sBAAsB,UAE3BzgC,OAAOkiB,KAAKhkB,GAASL,QAAQ,SAASkkC,GACpC,GAAI7qC,GAASgH,EAAQ6jC,EACrB,IAAI7qC,EAAOkI,YAAYrR,OAAQ,CAC7B,GAAyC,KAArCi2B,EAAGyX,cAAcnlC,QAAQY,GAAgB,CAC3C8sB,EAAGyX,cAActnC,KAAK+C,EACtB,IAAIzJ,GAAQ,GAAIm2B,OAAM,YACtBn2B,GAAMyJ,OAASA,EACf9J,EAAOuG,WAAW,WAChBqwB,EAAGmX,eAAe,YAAa1tC,KAInCizC,EAAa7iC,QAAQ,SAASmkC,GAC5B,GAAIlkC,GAAQkkC,EAAK,GACbhf,EAAWgf,EAAK,EAChB9qC,GAAOjG,KAAO+wC,EAAK,GAAG/wC,IAG1BgqC,EAAajX,EAAIlmB,EAAOklB,GAAW9rB,SAIzCwpC,EAAa7iC,QAAQ,SAASmkC,GACxBA,EAAK,IAGT/G,EAAajX,EAAIge,EAAK,GAAIA,EAAK,SAKjC50C,EAAOuG,WAAW,WACVqwB,GAAMA,EAAGoY,cAGfpY,EAAGoY,aAAav+B,QAAQ,SAASklB,GAC3BA,EAAYkX,cACuB,QAAnClX,EAAYkX,aAAa3yB,OACzByb,EAAYkX,aAAaE,sBAAsBpsC,OAAS,IAC1DoD,QAAQ8L,KAAK,sFAEb8lB,EAAYkX,aAAaQ,2BAG5B,KAEI76B,QAAQC,WAGjBpC,EAAkB/N,UAAUuD,MAAQ,WAClC9F,KAAKivC,aAAav+B,QAAQ,SAASklB,GAM7BA,EAAYkX,cACdlX,EAAYkX,aAAah7B,OAEvB8jB,EAAYyU,eACdzU,EAAYyU,cAAcv4B,OAExB8jB,EAAY2U,WACd3U,EAAY2U,UAAUz4B,OAEpB8jB,EAAY4U,aACd5U,EAAY4U,YAAY14B,SAI5B9R,KAAKsvC,WAAY,EACjBtvC,KAAKszC,sBAAsB,WAI7BhjC,EAAkB/N,UAAU+wC,sBAAwB,SAASwB,GAC3D90C,KAAK06B,eAAiBoa,CACtB,IAAIx0C,GAAQ,GAAIm2B,OAAM,uBACtBz2B,MAAKguC,eAAe,uBAAwB1tC,IAI9CgQ,EAAkB/N,UAAUkuC,4BAA8B,WACxD,GAAI5Z,GAAK72B,IACmB,YAAxBA,KAAK06B,gBAA+B16B,KAAKouC,mBAAoB,IAGjEpuC,KAAKouC,iBAAkB,EACvBnuC,EAAOuG,WAAW,WAChB,GAAIqwB,EAAGuX,gBAAiB,CACtBvX,EAAGuX,iBAAkB,CACrB,IAAI9tC,GAAQ,GAAIm2B,OAAM,oBACtBI,GAAGmX,eAAe,oBAAqB1tC,KAExC,KAILgQ,EAAkB/N,UAAUwvC,0BAA4B,WACtD,GAAI+C,GACAz6B,GACFuT,MAAO,EACPmnB,OAAQ,EACRjS,SAAU,EACVkS,UAAW,EACXnS,UAAW,EACXoS,aAAc,EACdC,OAAQ,EAuBV,IArBAl1C,KAAKivC,aAAav+B,QAAQ,SAASklB,GAC7BA,EAAYkX,eAAiBlX,EAAYmd,UAC3C14B,EAAOub,EAAYkX,aAAa3yB,WAIpC26B,EAAW,MACPz6B,EAAO66B,OAAS,EAClBJ,EAAW,SACFz6B,EAAOyoB,SAAW,EAC3BgS,EAAW,WACFz6B,EAAO46B,aAAe,EAC/BH,EAAW,eACFz6B,EAAAA,OAAa,EACtBy6B,EAAW,MACFz6B,EAAO26B,UAAY,EAC5BF,EAAW,YACFz6B,EAAOwoB,UAAY,IAC5BiS,EAAW,aAGTA,IAAa90C,KAAK+iC,mBAAoB,CACxC/iC,KAAK+iC,mBAAqB+R,CAC1B,IAAIx0C,GAAQ,GAAIm2B,OAAM,2BACtBz2B,MAAKguC,eAAe,2BAA4B1tC,KAKpDgQ,EAAkB/N,UAAUyvC,uBAAyB,WACnD,GAAI8C,GACAz6B,GACFuT,MAAO,EACPmnB,OAAQ,EACRI,WAAY,EACZH,UAAW,EACXnS,UAAW,EACXoS,aAAc,EACdC,OAAQ,EAyBV,IAvBAl1C,KAAKivC,aAAav+B,QAAQ,SAASklB,GAC7BA,EAAYkX,cAAgBlX,EAAYyU,gBACvCzU,EAAYmd,WACf14B,EAAOub,EAAYkX,aAAa3yB,SAChCE,EAAOub,EAAYyU,cAAclwB,YAIrCE,EAAO26B,WAAa36B,EAAOwoB,UAE3BiS,EAAW,MACPz6B,EAAO66B,OAAS,EAClBJ,EAAW,SACFz6B,EAAO86B,WAAa,EAC7BL,EAAW,aACFz6B,EAAO46B,aAAe,EAC/BH,EAAW,eACFz6B,EAAAA,OAAa,EACtBy6B,EAAW,MACFz6B,EAAO26B,UAAY,IAC5BF,EAAW,aAGTA,IAAa90C,KAAKojC,gBAAiB,CACrCpjC,KAAKojC,gBAAkB0R,CACvB,IAAIx0C,GAAQ,GAAIm2B,OAAM,wBACtBz2B,MAAKguC,eAAe,wBAAyB1tC,KAIjDgQ,EAAkB/N,UAAUmM,YAAc,WACxC,GAAImoB,GAAK72B,IAET,IAAI62B,EAAGyY,UACL,MAAO78B,SAAQomB,OAAO0U,EAAU,oBAC5B,wCAGN,IAAI6H,GAAiBve,EAAGoY,aAAazV,OAAO,SAASvJ,GACnD,MAAkB,UAAXA,EAAExB,OACR7tB,OACCy0C,EAAiBxe,EAAGoY,aAAazV,OAAO,SAASvJ,GACnD,MAAkB,UAAXA,EAAExB,OACR7tB,OAGCgnC,EAAe7W,UAAU,EAC7B,IAAI6W,EAAc,CAEhB,GAAIA,EAAa55B,WAAa45B,EAAa35B,SACzC,KAAM,IAAIw0B,WACN,uDAEmCj6B,UAArCo/B,EAAa/zB,sBAEbuhC,EADExN,EAAa/zB,uBAAwB,EACtB,EACR+zB,EAAa/zB,uBAAwB,EAC7B,EAEA+zB,EAAa/zB,qBAGOrL,SAArCo/B,EAAa7zB,sBAEbshC,EADEzN,EAAa7zB,uBAAwB,EACtB,EACR6zB,EAAa7zB,uBAAwB,EAC7B,EAEA6zB,EAAa7zB,qBAoBpC,IAfA8iB,EAAGoY,aAAav+B,QAAQ,SAASklB,GACN,UAArBA,EAAYnH,MACd2mB,IACqB,EAAjBA,IACFxf,EAAY0a,aAAc,IAEE,UAArB1a,EAAYnH,OACrB4mB,IACqB,EAAjBA,IACFzf,EAAY0a,aAAc,MAMzB8E,EAAiB,GAAKC,EAAiB,GACxCD,EAAiB,IACnBve,EAAGoZ,mBAAmB,SACtBmF,KAEEC,EAAiB,IACnBxe,EAAGoZ,mBAAmB,SACtBoF,IAIJ,IAAI1qC,GAAMo/B,EAASuL,wBAAwBze,EAAGqY,cAC1CrY,EAAGuY,qBACPvY,GAAGoY,aAAav+B,QAAQ,SAASklB,EAAajkB,GAG5C,GAAIhB,GAAQilB,EAAYjlB,MACpB8d,EAAOmH,EAAYnH,KACnB6b,EAAM1U,EAAY0U,KAAOP,EAASiK,oBACtCpe,GAAY0U,IAAMA,EAEb1U,EAAYsU,cACftU,EAAYsU,YAAcrT,EAAGga,mBAAmBl/B,EAC5CklB,EAAG6X,aAGT,IAAI1D,GAAoB/qC,EAAO+3B,aAAawc,gBAAgB/lB,EAG1C,OAAdkW,IACFqG,EAAkBG,OAASH,EAAkBG,OAAO3R,OAChD,SAASib,GACP,MAAsB,QAAfA,EAAMn6B,QAGrB0wB,EAAkBG,OAAOz6B,QAAQ,SAAS+jC,GAGrB,SAAfA,EAAMn6B,MAC0C9R,SAAhDisC,EAAMzI,WAAW,6BACnByI,EAAMzI,WAAW,2BAA6B,KAK5CpW,EAAYqV,oBACZrV,EAAYqV,mBAAmBE,QACjCvV,EAAYqV,mBAAmBE,OAAOz6B,QAAQ,SAAS6kC,GACjDd,EAAMn6B,KAAKlR,gBAAkBmsC,EAAYj7B,KAAKlR,eAC9CqrC,EAAMtI,YAAcoJ,EAAYpJ,YAClCsI,EAAMhJ,qBAAuB8J,EAAY/J,iBAKjDR,EAAkBI,iBAAiB16B,QAAQ,SAAS8kC,GAClD,GAAIC,GAAmB7f,EAAYqV,oBAC/BrV,EAAYqV,mBAAmBG,oBACnCqK,GAAiB/kC,QAAQ,SAASglC,GAC5BF,EAAO9I,MAAQgJ,EAAQhJ,MACzB8I,EAAO1xC,GAAK4xC,EAAQ5xC,OAM1B,IAAI6mC,GAAyB/U,EAAY+U,0BACvCC,KAAgC,MAAzB,EAAIj5B,EAAgB,IAEzBhB,IAEEg0B,GAAe,OAAkB,UAATlW,IACvBkc,EAAuB,GAAGE,MAC7BF,EAAuB,GAAGE,KACxBD,KAAMD,EAAuB,GAAGC,KAAO,IAKzChV,EAAY0a,cACd1a,EAAY4U,YAAc,GAAIvqC,GAAOm4B,eACjCxC,EAAYyU,cAAe5b,IAGjCmH,EAAYoV,kBAAoBA,EAChCpV,EAAY+U,uBAAyBA,IAIP,eAA5B9T,EAAGmY,QAAQ5+B,eACbzF,GAAO,kBAAoBksB,EAAGoY,aAAavhB,IAAI,SAASuC,GACtD,MAAOA,GAAEqa,MACRhnC,KAAK,KAAO,QAEjBqH,GAAO,4BAEPksB,EAAGoY,aAAav+B,QAAQ,SAASklB,EAAajkB,GAC5ChH,GAAOi/B,EAAkBhU,EAAaA,EAAYoV,kBAC9C,QAASpV,EAAY7rB,OAAQ8sB,EAAGwY,WACpC1kC,GAAO,oBAEHirB,EAAYsU,aAAwC,QAAzBrT,EAAG4X,mBACX,IAAlB98B,GAAwBklB,EAAG6X,cAC9B9Y,EAAYsU,YAAYyL,qBAAqBjlC,QAAQ,SAAS0gC,GAC5DA,EAAKC,UAAY,EACjB1mC,GAAO,KAAOo/B,EAASyH,eAAeJ,GAAQ,SAGV,cAAlCxb,EAAYsU,YAAY/vB,QAC1BxP,GAAO,6BAKb,IAAIowB,GAAO,GAAI96B,GAAOgP,uBACpB7K,KAAM,QACNuG,IAAKA,GAEP,OAAO8H,SAAQC,QAAQqoB,IAGzBzqB,EAAkB/N,UAAUwM,aAAe,WACzC,GAAI8nB,GAAK72B,IAET,IAAI62B,EAAGyY,UACL,MAAO78B,SAAQomB,OAAO0U,EAAU,oBAC5B,yCAGN,IAA4B,sBAAtB1W,EAAG6D,gBACiB,wBAAtB7D,EAAG6D,eACL,MAAOjoB,SAAQomB,OAAO0U,EAAU,oBAC5B,+CAAiD1W,EAAG6D,gBAG1D,IAAI/vB,GAAMo/B,EAASuL,wBAAwBze,EAAGqY,cAC1CrY,EAAGuY,qBACHvY,GAAG6X,cACL/jC,GAAO,kBAAoBksB,EAAGoY,aAAavhB,IAAI,SAASuC,GACtD,MAAOA,GAAEqa,MACRhnC,KAAK,KAAO,QAEjBqH,GAAO,2BAEP,IAAIirC,GAAuB7L,EAAS0H,iBAChC5a,EAAG2X,mBAAmB7jC,KAAK/J,MAC/Bi2B,GAAGoY,aAAav+B,QAAQ,SAASklB,EAAajkB,GAC5C,KAAIA,EAAgB,EAAIikC,GAAxB,CAGA,GAAIhgB,EAAYmd,SAkBd,MAjByB,gBAArBnd,EAAYnH,KAEZ9jB,GAD2B,cAAzBirB,EAAY0L,SACP,qCAEA,mBAAqB1L,EAAY0L,SACpC,0BAEwB,UAArB1L,EAAYnH,KACrB9jB,GAAO,4DAEuB,UAArBirB,EAAYnH,OACrB9jB,GAAO,sEAGTA,GAAO,2CAEQirB,EAAY0U,IAAM,OAKnC,IAAI1U,EAAY7rB,OAAQ,CACtB,GAAI8rC,EACqB,WAArBjgB,EAAYnH,KACdonB,EAAajgB,EAAY7rB,OAAO0G,iBAAiB,GACnB,UAArBmlB,EAAYnH,OACrBonB,EAAajgB,EAAY7rB,OAAO8G,iBAAiB,IAE/CglC,GAEElR,GAAe,OAA8B,UAArB/O,EAAYnH,OACnCmH,EAAY+U,uBAAuB,GAAGE,MACzCjV,EAAY+U,uBAAuB,GAAGE,KACpCD,KAAMhV,EAAY+U,uBAAuB,GAAGC,KAAO,IAO3D,GAAIM,GAAqBH,EACrBnV,EAAYoV,kBACZpV,EAAYqV,oBAEZsJ,EAASrJ,EAAmBC,OAAO3R,OAAO,SAASte,GACrD,MAAgC,QAAzBA,EAAEZ,KAAKlR,gBACbxI,QACE2zC,GAAU3e,EAAY+U,uBAAuB,GAAGE,WAC5CjV,GAAY+U,uBAAuB,GAAGE,IAG/ClgC,GAAOi/B,EAAkBhU,EAAasV,EAClC,SAAUtV,EAAY7rB,OAAQ8sB,EAAGwY,WACjCzZ,EAAY8c,gBACZ9c,EAAY8c,eAAeoD,cAC7BnrC,GAAO,sBAIX,IAAIowB,GAAO,GAAI96B,GAAOgP,uBACpB7K,KAAM,SACNuG,IAAKA,GAEP,OAAO8H,SAAQC,QAAQqoB,IAGzBzqB,EAAkB/N,UAAUkP,gBAAkB,SAASvH,GACrD,GACI82B,GADAnK,EAAK72B,IAET,OAAIkK,IAA2C1B,SAA5B0B,EAAUyH,gBACzBzH,EAAUw2B,OACLjuB,QAAQomB,OAAO,GAAI4J,WAAU,qCAI/B,GAAIhwB,SAAQ,SAASC,EAASmmB,GACnC,IAAKhC,EAAG2X,mBACN,MAAO3V,GAAO0U,EAAU,oBACpB,0DACC,IAAKrjC,GAAqC,KAAxBA,EAAUA,UAe5B,CACL,GAAIyH,GAAgBzH,EAAUyH,aAC9B,IAAIzH,EAAUw2B,OACZ,IAAK,GAAI5/B,GAAI,EAAGA,EAAI+1B,EAAGoY,aAAaruC,OAAQE,IAC1C,GAAI+1B,EAAGoY,aAAanuC,GAAGwpC,MAAQpgC,EAAUw2B,OAAQ,CAC/C/uB,EAAgB7Q,CAChB,OAIN,GAAI80B,GAAciB,EAAGoY,aAAat9B,EAClC,KAAIikB,EAqCF,MAAOiD,GAAO0U,EAAU,iBACpB,6BArCJ,IAAI3X,EAAYmd,SACd,MAAOrgC,IAET,IAAI0+B,GAAOv+B,OAAOkiB,KAAK7qB,EAAUA,WAAWtJ,OAAS,EACjDmpC,EAASvJ,eAAet2B,EAAUA,aAEtC,IAAsB,QAAlBknC,EAAK9P,WAAqC,IAAd8P,EAAKhE,MAA4B,IAAdgE,EAAKhE,MACtD,MAAO16B,IAGT,IAAI0+B,EAAKC,WAAgC,IAAnBD,EAAKC,UACzB,MAAO3+B,IAIT,KAAsB,IAAlBf,GAAwBA,EAAgB,GACxCikB,EAAYkX,eAAiBjW,EAAGoY,aAAa,GAAGnC,gBAC7CD,EAAkBjX,EAAYkX,aAAcsE,GAC/C,MAAOvY,GAAO0U,EAAU,iBACpB,6BAKR,IAAIwI,GAAkB7rC,EAAUA,UAAUs5B,MACJ,KAAlCuS,EAAgB5sC,QAAQ,QAC1B4sC,EAAkBA,EAAgBjtC,OAAO,IAE3Ck4B,EAAW+I,EAAS0H,iBAAiB5a,EAAG2X,mBAAmB7jC,KAC3Dq2B,EAASrvB,IAAkB,MACtBy/B,EAAKhtC,KAAO2xC,EAAkB,qBAC7B,OACNlf,EAAG2X,mBAAmB7jC,IAClBo/B,EAAS2H,eAAe7a,EAAG2X,mBAAmB7jC,KAC9Cq2B,EAAS19B,KAAK,QA5DpB,KAAK,GAAI4T,GAAI,EAAGA,EAAI2f,EAAGoY,aAAaruC,SAC9Bi2B,EAAGoY,aAAa/3B,GAAG67B,WAGvBlc,EAAGoY,aAAa/3B,GAAG41B,aAAaQ,uBAChCtM,EAAW+I,EAAS0H,iBAAiB5a,EAAG2X,mBAAmB7jC,KAC3Dq2B,EAAS9pB,IAAM,0BACf2f,EAAG2X,mBAAmB7jC,IAClBo/B,EAAS2H,eAAe7a,EAAG2X,mBAAmB7jC,KAC9Cq2B,EAAS19B,KAAK,KACduzB,EAAG6X,cAVmCx3B,KAkE9CxE,OAIJpC,EAAkB/N,UAAU+1B,SAAW,SAASkD,GAC9C,GAAIA,GAAYA,YAAoBv7B,GAAO24B,iBAAkB,CAC3D,GAAIod,GAAmB,IAUvB,IATAh2C,KAAKivC,aAAav+B,QAAQ,SAASklB,GAC7BA,EAAY2U,WACZ3U,EAAY2U,UAAU55B,QAAU6qB,EAClCwa,EAAmBpgB,EAAY2U,UACtB3U,EAAY4U,aACnB5U,EAAY4U,YAAY75B,QAAU6qB,IACpCwa,EAAmBpgB,EAAY4U,gBAG9BwL,EACH,KAAMzI,GAAU,qBAAsB,oBAExC,OAAOyI,GAAiB1d,WAG1B,GAAI2d,KASJ,OARAj2C,MAAKivC,aAAav+B,QAAQ,SAASklB,IAChC,YAAa,cAAe,cAAe,eACxC,iBAAiBllB,QAAQ,SAASlN,GAC5BoyB,EAAYpyB,IACdyyC,EAASjvC,KAAK4uB,EAAYpyB,GAAQ80B,gBAIrC7lB,QAAQY,IAAI4iC,GAAUrjC,KAAK,SAASsjC,GACzC,GAAIC,GAAU,GAAI/gB,IAMlB,OALA8gB,GAASxlC,QAAQ,SAASgkB,GACxBA,EAAMhkB,QAAQ,SAAS2rB,GACrB8Z,EAAQrhB,IAAIuH,EAAKv4B,GAAIu4B,OAGlB8Z,IAKX,IAAIC,IAAe,eAAgB,iBAAkB,iBACnD,kBAAmB,mBACrBA,GAAY1lC,QAAQ,SAAS2lC,GAC3B,GAAIzqC,GAAM3L,EAAOo2C,EACjB,IAAIzqC,GAAOA,EAAIrJ,WAAaqJ,EAAIrJ,UAAU+1B,SAAU,CAClD,GAAIge,GAAiB1qC,EAAIrJ,UAAU+1B,QACnC1sB,GAAIrJ,UAAU+1B,SAAW,WACvB,MAAOge,GAAe3f,MAAM32B,MAC3B4S,KAAK,SAAS2jC,GACb,GAAIC,GAAW,GAAIphB,IAKnB,OAJAviB,QAAOkiB,KAAKwhB,GAAa7lC,QAAQ,SAAS5M,GACxCyyC,EAAYzyC,GAAIM,KAAOulC,EAAa4M,EAAYzyC,IAChD0yC,EAAS1hB,IAAIhxB,EAAIyyC,EAAYzyC,MAExB0yC,OAOf,IAAIC,IAAW,cAAe,eA8D9B,OA7DAA,GAAQ/lC,QAAQ,SAASlN,GACvB,GAAIo3B,GAAetqB,EAAkB/N,UAAUiB,EAC/C8M,GAAkB/N,UAAUiB,GAAU,WACpC,GAAI6Z,GAAO0T,SACX,OAAuB,kBAAZ1T,GAAK,IACO,kBAAZA,GAAK,GACPud,EAAajE,MAAM32B,MAAO+wB,UAAU,KAC1Cne,KAAK,SAASgnB,GACU,kBAAZvc,GAAK,IACdA,EAAK,GAAGsZ,MAAM,MAAOiD,KAEtB,SAASl1B,GACa,kBAAZ2Y,GAAK,IACdA,EAAK,GAAGsZ,MAAM,MAAOjyB,MAIpBk2B,EAAajE,MAAM32B,KAAM+wB,cAIpC0lB,GAAW,sBAAuB,uBAAwB,mBAC1DA,EAAQ/lC,QAAQ,SAASlN,GACvB,GAAIo3B,GAAetqB,EAAkB/N,UAAUiB,EAC/C8M,GAAkB/N,UAAUiB,GAAU,WACpC,GAAI6Z,GAAO0T,SACX,OAAuB,kBAAZ1T,GAAK,IACO,kBAAZA,GAAK,GACPud,EAAajE,MAAM32B,KAAM+wB,WAC/Bne,KAAK,WACmB,kBAAZyK,GAAK,IACdA,EAAK,GAAGsZ,MAAM,OAEf,SAASjyB,GACa,kBAAZ2Y,GAAK,IACdA,EAAK,GAAGsZ,MAAM,MAAOjyB,MAIpBk2B,EAAajE,MAAM32B,KAAM+wB,eAMnC,YAAYrgB,QAAQ,SAASlN,GAC5B,GAAIo3B,GAAetqB,EAAkB/N,UAAUiB,EAC/C8M,GAAkB/N,UAAUiB,GAAU,WACpC,GAAI6Z,GAAO0T,SACX,OAAuB,kBAAZ1T,GAAK,GACPud,EAAajE,MAAM32B,KAAM+wB,WAC/Bne,KAAK,WACmB,kBAAZyK,GAAK,IACdA,EAAK,GAAGsZ,MAAM,QAIbiE,EAAajE,MAAM32B,KAAM+wB,cAI7BzgB,KAGN3F,IAAM,KAAK+rC,IAAI,SAASxmB,EAAQP,EAAOD,GAE1C,YAGA,IAAIqa,KAIJA,GAASiK,mBAAqB,WAC5B,MAAOjzC,MAAKqa,SAAS7G,SAAS,IAAIzL,OAAO,EAAG,KAI9CihC,EAASe,WAAaf,EAASiK,qBAG/BjK,EAAS2J,WAAa,SAASiD,GAC7B,MAAOA,GAAKnT,OAAOpvB,MAAM,MAAMsZ,IAAI,SAAS6V,GAC1C,MAAOA,GAAKC,UAIhBuG,EAAS9I,cAAgB,SAAS0V,GAChC,GAAIC,GAAQD,EAAKviC,MAAM,OACvB,OAAOwiC,GAAMlpB,IAAI,SAASmpB,EAAMz1B,GAC9B,OAAQA,EAAQ,EAAI,KAAOy1B,EAAOA,GAAMrT,OAAS,UAKrDuG,EAAS2H,eAAiB,SAASiF,GACjC,GAAI3V,GAAW+I,EAAS9I,cAAc0V,EACtC,OAAO3V,IAAYA,EAAS,IAI9B+I,EAAS0H,iBAAmB,SAASkF,GACnC,GAAI3V,GAAW+I,EAAS9I,cAAc0V,EAEtC,OADA3V,GAASE,QACFF,GAIT+I,EAASlI,YAAc,SAAS8U,EAAM9tC,GACpC,MAAOkhC,GAAS2J,WAAWiD,GAAMnd,OAAO,SAAS+J,GAC/C,MAAgC,KAAzBA,EAAKp6B,QAAQN,MAOxBkhC,EAASvJ,eAAiB,SAAS+C,GACjC,GAAIqT,EAGFA,GADmC,IAAjCrT,EAAKp6B,QAAQ,gBACPo6B,EAAK77B,UAAU,IAAI0M,MAAM,KAEzBmvB,EAAK77B,UAAU,IAAI0M,MAAM,IAenC,KAAK,GAZDlK,IACFgjC,WAAY0J,EAAM,GAClBvF,UAAW5pC,SAASmvC,EAAM,GAAI,IAC9BtV,SAAUsV,EAAM,GAAGxtC,cACnBikC,SAAU5lC,SAASmvC,EAAM,GAAI,IAC7BzJ,GAAIyJ,EAAM,GACVE,QAASF,EAAM,GACfxJ,KAAM3lC,SAASmvC,EAAM,GAAI,IAEzBxyC,KAAMwyC,EAAM,IAGL91C,EAAI,EAAGA,EAAI81C,EAAMh2C,OAAQE,GAAK,EACrC,OAAQ81C,EAAM91C,IACZ,IAAK,QACHoJ,EAAU6sC,eAAiBH,EAAM91C,EAAI,EACrC,MACF,KAAK,QACHoJ,EAAU8sC,YAAcvvC,SAASmvC,EAAM91C,EAAI,GAAI,GAC/C,MACF,KAAK,UACHoJ,EAAU+sC,QAAUL,EAAM91C,EAAI,EAC9B,MACF,KAAK,QACHoJ,EAAUonC,MAAQsF,EAAM91C,EAAI,GAC5BoJ,EAAUy2B,iBAAmBiW,EAAM91C,EAAI,EACvC,MACF,SACEoJ,EAAU0sC,EAAM91C,IAAM81C,EAAM91C,EAAI,GAItC,MAAOoJ,IAIT6/B,EAASyH,eAAiB,SAAStnC,GACjC,GAAIS,KACJA,GAAI3D,KAAKkD,EAAUgjC,YACnBviC,EAAI3D,KAAKkD,EAAUmnC,WACnB1mC,EAAI3D,KAAKkD,EAAUo3B,SAASvD,eAC5BpzB,EAAI3D,KAAKkD,EAAUmjC,UACnB1iC,EAAI3D,KAAKkD,EAAU4sC,SAAW5sC,EAAUijC,IACxCxiC,EAAI3D,KAAKkD,EAAUkjC,KAEnB,IAAIhpC,GAAO8F,EAAU9F,IAkBrB,OAjBAuG,GAAI3D,KAAK,OACT2D,EAAI3D,KAAK5C,GACI,SAATA,GAAmB8F,EAAU6sC,gBAC7B7sC,EAAU8sC,cACZrsC,EAAI3D,KAAK,SACT2D,EAAI3D,KAAKkD,EAAU6sC,gBACnBpsC,EAAI3D,KAAK,SACT2D,EAAI3D,KAAKkD,EAAU8sC,cAEjB9sC,EAAU+sC,SAAgD,QAArC/sC,EAAUo3B,SAASl4B,gBAC1CuB,EAAI3D,KAAK,WACT2D,EAAI3D,KAAKkD,EAAU+sC,WAEjB/sC,EAAUy2B,kBAAoBz2B,EAAUonC,SAC1C3mC,EAAI3D,KAAK,SACT2D,EAAI3D,KAAKkD,EAAUy2B,kBAAoBz2B,EAAUonC,QAE5C,aAAe3mC,EAAIrH,KAAK,MAKjCymC,EAASmN,gBAAkB,SAAS3T,GAClC,MAAOA,GAAKz6B,OAAO,IAAIsL,MAAM,MAK/B21B,EAASoN,YAAc,SAAS5T,GAC9B,GAAIqT,GAAQrT,EAAKz6B,OAAO,GAAGsL,MAAM,KAC7BgjC,GACF5L,YAAa/jC,SAASmvC,EAAM1V,QAAS,IAUvC,OAPA0V,GAAQA,EAAM,GAAGxiC,MAAM,KAEvBgjC,EAAO98B,KAAOs8B,EAAM,GACpBQ,EAAOjL,UAAY1kC,SAASmvC,EAAM,GAAI,IACtCQ,EAAOC,SAA4B,IAAjBT,EAAMh2C,OAAe6G,SAASmvC,EAAM,GAAI,IAAM,EAEhEQ,EAAOhL,YAAcgL,EAAOC,SACrBD,GAKTrN,EAASuN,YAAc,SAAS7C,GAC9B,GAAIlJ,GAAKkJ,EAAMjJ,WACoBhjC,UAA/BisC,EAAMhJ,uBACRF,EAAKkJ,EAAMhJ,qBAEb,IAAI4L,GAAW5C,EAAM4C,UAAY5C,EAAMrI,aAAe,CACtD,OAAO,YAAcb,EAAK,IAAMkJ,EAAMn6B,KAAO,IAAMm6B,EAAMtI,WACvC,IAAbkL,EAAiB,IAAMA,EAAW,IAAM,QAM/CtN,EAASwN,YAAc,SAAShU,GAC9B,GAAIqT,GAAQrT,EAAKz6B,OAAO,GAAGsL,MAAM,IACjC,QACEtQ,GAAI2D,SAASmvC,EAAM,GAAI,IACvBt5B,UAAWs5B,EAAM,GAAGztC,QAAQ,KAAO,EAAIytC,EAAM,GAAGxiC,MAAM,KAAK,GAAK,WAChEs4B,IAAKkK,EAAM,KAMf7M,EAASyN,YAAc,SAASC,GAC9B,MAAO,aAAeA,EAAgB3zC,IAAM2zC,EAAgBC,cACvDD,EAAgBn6B,WAA2C,aAA9Bm6B,EAAgBn6B,UACxC,IAAMm6B,EAAgBn6B,UACtB,IACN,IAAMm6B,EAAgB/K,IAAM,QAMlC3C,EAAS4N,UAAY,SAASpU,GAI5B,IAAK,GAFDqU,GADAR,KAEAR,EAAQrT,EAAKz6B,OAAOy6B,EAAKp6B,QAAQ,KAAO,GAAGiL,MAAM,KAC5C8C,EAAI,EAAGA,EAAI0/B,EAAMh2C,OAAQsW,IAChC0gC,EAAKhB,EAAM1/B,GAAGssB,OAAOpvB,MAAM,KAC3BgjC,EAAOQ,EAAG,GAAGpU,QAAUoU,EAAG,EAE5B,OAAOR,IAITrN,EAAS8N,UAAY,SAASpD,GAC5B,GAAIlR,GAAO,GACPgI,EAAKkJ,EAAMjJ,WAIf,IAHmChjC,SAA/BisC,EAAMhJ,uBACRF,EAAKkJ,EAAMhJ,sBAETgJ,EAAMzI,YAAcn5B,OAAOkiB,KAAK0f,EAAMzI,YAAYprC,OAAQ,CAC5D,GAAI6C,KACJoP,QAAOkiB,KAAK0f,EAAMzI,YAAYt7B,QAAQ,SAASonC,GACzCrD,EAAMzI,WAAW8L,GACnBr0C,EAAOuD,KAAK8wC,EAAQ,IAAMrD,EAAMzI,WAAW8L,IAE3Cr0C,EAAOuD,KAAK8wC,KAGhBvU,GAAQ,UAAYgI,EAAK,IAAM9nC,EAAOH,KAAK,KAAO,OAEpD,MAAOigC,IAKTwG,EAASgO,YAAc,SAASxU,GAC9B,GAAIqT,GAAQrT,EAAKz6B,OAAOy6B,EAAKp6B,QAAQ,KAAO,GAAGiL,MAAM,IACrD,QACEhQ,KAAMwyC,EAAM1V,QACZqL,UAAWqK,EAAMtzC,KAAK,OAI1BymC,EAASiO,YAAc,SAASvD,GAC9B,GAAIhB,GAAQ,GACRlI,EAAKkJ,EAAMjJ,WAYf,OAXmChjC,UAA/BisC,EAAMhJ,uBACRF,EAAKkJ,EAAMhJ,sBAETgJ,EAAMpI,cAAgBoI,EAAMpI,aAAazrC,QAE3C6zC,EAAMpI,aAAa37B,QAAQ,SAAS47B,GAClCmH,GAAS,aAAelI,EAAK,IAAMe,EAAGloC,MACrCkoC,EAAGC,WAAaD,EAAGC,UAAU3rC,OAAS,IAAM0rC,EAAGC,UAAY,IACxD,SAGDkH,GAKT1J,EAASkO,eAAiB,SAAS1U,GACjC,GAAI2U,GAAK3U,EAAKp6B,QAAQ,KAClBytC,GACFhM,KAAMnjC,SAAS87B,EAAKz6B,OAAO,EAAGovC,EAAK,GAAI,KAErCC,EAAQ5U,EAAKp6B,QAAQ,IAAK+uC,EAO9B,OANIC,GAAQ,IACVvB,EAAMwB,UAAY7U,EAAKz6B,OAAOovC,EAAK,EAAGC,EAAQD,EAAK,GACnDtB,EAAM5yB,MAAQuf,EAAKz6B,OAAOqvC,EAAQ,IAElCvB,EAAMwB,UAAY7U,EAAKz6B,OAAOovC,EAAK,GAE9BtB,GAGT7M,EAASsO,eAAiB,SAAS9U,GACjC,GAAIqT,GAAQrT,EAAKz6B,OAAO,IAAIsL,MAAM,IAClC,QACEkkC,UAAW1B,EAAM1V,QACjBqX,MAAO3B,EAAMlpB,IAAI,SAASkd,GACxB,MAAOnjC,UAASmjC,EAAM,QAO5Bb,EAASgK,OAAS,SAAS5S,GACzB,GAAImJ,GAAMP,EAASlI,YAAYV,EAAc,UAAU,EACvD,OAAImJ,GACKA,EAAIxhC,OAAO,GADpB,QAKFihC,EAASyO,iBAAmB,SAASjV,GACnC,GAAIqT,GAAQrT,EAAKz6B,OAAO,IAAIsL,MAAM,IAClC,QACEqkC,UAAW7B,EAAM,GAAGxtC,cACpB4a,MAAO4yB,EAAM,KAOjB7M,EAASqJ,kBAAoB,SAASjS,EAAcyR,GAClD,GAAIa,GAAQ1J,EAASlI,YAAYV,EAAeyR,EAC5C,iBAGJ,QACEtrB,KAAM,OACNoxB,aAAcjF,EAAM/lB,IAAIqc,EAASyO,oBAKrCzO,EAASK,oBAAsB,SAAS3mC,EAAQk1C,GAC9C,GAAIhuC,GAAM,WAAaguC,EAAY,MAInC,OAHAl1C,GAAOi1C,aAAahoC,QAAQ,SAASkoC,GACnCjuC,GAAO,iBAAmBiuC,EAAGH,UAAY,IAAMG,EAAG50B,MAAQ,SAErDrZ,GAKTo/B,EAASmJ,iBAAmB,SAAS/R,EAAcyR,GACjD,GAAIa,GAAQ1J,EAAS2J,WAAWvS,EAEhCsS,GAAQA,EAAMj/B,OAAOu1B,EAAS2J,WAAWd,GACzC,IAAIiG,IACFlY,iBAAkB8S,EAAMja,OAAO,SAAS+J,GACtC,MAAwC,KAAjCA,EAAKp6B,QAAQ,kBACnB,GAAGL,OAAO,IACbgwC,SAAUrF,EAAMja,OAAO,SAAS+J,GAC9B,MAAsC,KAA/BA,EAAKp6B,QAAQ,gBACnB,GAAGL,OAAO,IAEf,OAAO+vC,IAIT9O,EAASE,mBAAqB,SAASxmC,GACrC,MAAO,eAAiBA,EAAOk9B,iBAAmB,iBAC/Bl9B,EAAOq1C,SAAW,QAIvC/O,EAAS8I,mBAAqB,SAAS1R,GASrC,IAAK,GARDvH,IACFuR,UACAC,oBACAC,iBACAkH,SAEEkB,EAAQ1J,EAAS2J,WAAWvS,GAC5B4X,EAAQtF,EAAM,GAAGr/B,MAAM,KAClBtT,EAAI,EAAGA,EAAIi4C,EAAMn4C,OAAQE,IAAK,CACrC,GAAIyqC,GAAKwN,EAAMj4C,GACXk4C,EAAajP,EAASlI,YACtBV,EAAc,YAAcoK,EAAK,KAAK,EAC1C,IAAIyN,EAAY,CACd,GAAIvE,GAAQ1K,EAASoN,YAAY6B,GAC7BC,EAAQlP,EAASlI,YACjBV,EAAc,UAAYoK,EAAK,IAQnC,QANAkJ,EAAMzI,WAAaiN,EAAMr4C,OAASmpC,EAAS4N,UAAUsB,EAAM,OAC3DxE,EAAMpI,aAAetC,EAASlI,YAC1BV,EAAc,aAAeoK,EAAK,KACnC7d,IAAIqc,EAASgO,aAChBne,EAAYuR,OAAOnkC,KAAKytC,GAEhBA,EAAMn6B,KAAKyjB,eACjB,IAAK,MACL,IAAK,SACHnE,EAAYyR,cAAcrkC,KAAKytC,EAAMn6B,KAAKyjB,iBAWlD,MAJAgM,GAASlI,YAAYV,EAAc,aAAazwB,QAAQ,SAAS6yB,GAC/D3J,EAAYwR,iBAAiBpkC,KAAK+iC,EAASwN,YAAYhU,MAGlD3J,GAKTmQ,EAASC,oBAAsB,SAASvb,EAAMob,GAC5C,GAAIl/B,GAAM,EAGVA,IAAO,KAAO8jB,EAAO,IACrB9jB,GAAOk/B,EAAKsB,OAAOvqC,OAAS,EAAI,IAAM,IACtC+J,GAAO,sBACPA,GAAOk/B,EAAKsB,OAAOzd,IAAI,SAAS+mB,GAC9B,MAAmCjsC,UAA/BisC,EAAMhJ,qBACDgJ,EAAMhJ,qBAERgJ,EAAMjJ,cACZloC,KAAK,KAAO,OAEfqH,GAAO,uBACPA,GAAO,8BAGPk/B,EAAKsB,OAAOz6B,QAAQ,SAAS+jC,GAC3B9pC,GAAOo/B,EAASuN,YAAY7C,GAC5B9pC,GAAOo/B,EAAS8N,UAAUpD,GAC1B9pC,GAAOo/B,EAASiO,YAAYvD,IAE9B,IAAIyE,GAAW,CAiBf,OAhBArP,GAAKsB,OAAOz6B,QAAQ,SAAS+jC,GACvBA,EAAMyE,SAAWA,IACnBA,EAAWzE,EAAMyE,YAGjBA,EAAW,IACbvuC,GAAO,cAAgBuuC,EAAW,QAEpCvuC,GAAO,iBAEHk/B,EAAKuB,kBACPvB,EAAKuB,iBAAiB16B,QAAQ,SAASyoC,GACrCxuC,GAAOo/B,EAASyN,YAAY2B,KAIzBxuC,GAKTo/B,EAASkK,2BAA6B,SAAS9S,GAC7C,GAcIiY,GAdAC,KACAzf,EAAcmQ,EAAS8I,mBAAmB1R,GAC1CmY,EAAsD,KAA7C1f,EAAYyR,cAAcliC,QAAQ,OAC3CowC,EAA4D,KAAhD3f,EAAYyR,cAAcliC,QAAQ,UAG9CovC,EAAQxO,EAASlI,YAAYV,EAAc,WAC9CzT,IAAI,SAAS6V,GACZ,MAAOwG,GAASkO,eAAe1U,KAEhC/J,OAAO,SAASod,GACf,MAA2B,UAApBA,EAAMwB,YAEXoB,EAAcjB,EAAM33C,OAAS,GAAK23C,EAAM,GAAG3N,KAG3C6O,EAAQ1P,EAASlI,YAAYV,EAAc,oBAC9CzT,IAAI,SAAS6V,GACZ,GAAIqT,GAAQrT,EAAKz6B,OAAO,IAAIsL,MAAM,IAClC,OAAOwiC,GAAMlpB,IAAI,SAASmpB,GACxB,MAAOpvC,UAASovC,EAAM,OAGtB4C,GAAM74C,OAAS,GAAK64C,EAAM,GAAG74C,OAAS,GAAK64C,EAAM,GAAG,KAAOD,IAC7DJ,EAAgBK,EAAM,GAAG,IAG3B7f,EAAYuR,OAAOz6B,QAAQ,SAAS+jC,GAClC,GAAiC,QAA7BA,EAAMn6B,KAAKyjB,eAA2B0W,EAAMzI,WAAWC,IAAK,CAC9D,GAAIyN,IACF9O,KAAM4O,EACNG,iBAAkBlyC,SAASgtC,EAAMzI,WAAWC,IAAK,IAE/CuN,IAAeJ,IACjBM,EAAS7O,KAAOD,KAAMwO,IAExBC,EAAmBryC,KAAK0yC,GACpBJ,IACFI,EAAWz5B,KAAKme,MAAMne,KAAKC,UAAUw5B,IACrCA,EAASE,KACPhP,KAAM4O,EACNK,UAAWN,EAAY,aAAe,OAExCF,EAAmBryC,KAAK0yC,OAII,IAA9BL,EAAmBz4C,QAAgB44C,GACrCH,EAAmBryC,MACjB4jC,KAAM4O,GAKV,IAAIM,GAAY/P,EAASlI,YAAYV,EAAc,KAenD,OAdI2Y,GAAUl5C,SAEVk5C,EADsC,IAApCA,EAAU,GAAG3wC,QAAQ,WACX1B,SAASqyC,EAAU,GAAGhxC,OAAO,GAAI,IACF,IAAlCgxC,EAAU,GAAG3wC,QAAQ,SAEqB,IAAvC1B,SAASqyC,EAAU,GAAGhxC,OAAO,GAAI,IAAa,IACpD,KAEMN,OAEd6wC,EAAmB3oC,QAAQ,SAASjN,GAClCA,EAAOs2C,WAAaD,KAGjBT,GAITtP,EAASmK,oBAAsB,SAAS/S,GACtC,GAAIuR,MAIAsH,EAAajQ,EAASlI,YAAYV,EAAc,WAC/CzT,IAAI,SAAS6V,GACZ,MAAOwG,GAASkO,eAAe1U,KAEhC/J,OAAO,SAAS5tB,GACf,MAAyB,UAAlBA,EAAIwsC,YACV,EACH4B,KACFtH,EAAeF,MAAQwH,EAAWh2B,MAClC0uB,EAAe9H,KAAOoP,EAAWpP,KAKnC,IAAIqP,GAAQlQ,EAASlI,YAAYV,EAAc,eAC/CuR,GAAeoD,YAAcmE,EAAMr5C,OAAS,EAC5C8xC,EAAeD,SAA4B,IAAjBwH,EAAMr5C,MAIhC,IAAIs5C,GAAMnQ,EAASlI,YAAYV,EAAc,aAG7C,OAFAuR,GAAewH,IAAMA,EAAIt5C,OAAS,EAE3B8xC,GAKT3I,EAAS+J,UAAY,SAAS3S,GAC5B,GAAIyV,GACAuD,EAAOpQ,EAASlI,YAAYV,EAAc,UAC9C,IAAoB,IAAhBgZ,EAAKv5C,OAEP,MADAg2C,GAAQuD,EAAK,GAAGrxC,OAAO,GAAGsL,MAAM,MACxBrK,OAAQ6sC,EAAM,GAAIjmC,MAAOimC,EAAM,GAEzC,IAAIwD,GAAQrQ,EAASlI,YAAYV,EAAc,WAC9CzT,IAAI,SAAS6V,GACZ,MAAOwG,GAASkO,eAAe1U,KAEhC/J,OAAO,SAAS6gB,GACf,MAA+B,SAAxBA,EAAUjC,WAEnB,OAAIgC,GAAMx5C,OAAS,GACjBg2C,EAAQwD,EAAM,GAAGp2B,MAAM5P,MAAM,MACrBrK,OAAQ6sC,EAAM,GAAIjmC,MAAOimC,EAAM,KAFzC,QAUF7M,EAASoF,kBAAoB,WAC3B,MAAOpuC,MAAKqa,SAAS7G,WAAWzL,OAAO,EAAG,KAQ5CihC,EAASuL,wBAA0B,SAASgF,EAAQC,EAASC,GAC3D,GAAIC,GACAtgB,EAAsB3xB,SAAZ+xC,EAAwBA,EAAU,CAE9CE,GADEH,EACUA,EAEAvQ,EAASoF,mBAEvB,IAAIuL,GAAOF,GAAY,mBAEvB,OAAO,YACIE,EAAO,IAAMD,EAAY,IAAMtgB,EACpC,yCAKR4P,EAASH,kBAAoB,SAAShU,EAAaiU,EAAMzlC,EAAM2F,GAC7D,GAAIY,GAAMo/B,EAASC,oBAAoBpU,EAAYnH,KAAMob,EAyBzD,IAtBAl/B,GAAOo/B,EAASE,mBACZrU,EAAYsU,YAAYC,sBAG5Bx/B,GAAOo/B,EAASK,oBACZxU,EAAYyU,cAAcF,qBACjB,UAAT/lC,EAAmB,UAAY,UAEnCuG,GAAO,SAAWirB,EAAY0U,IAAM,OAGlC3/B,GADEirB,EAAYtY,UACP,KAAOsY,EAAYtY,UAAY,OAC7BsY,EAAY2U,WAAa3U,EAAY4U,YACvC,iBACE5U,EAAY2U,UACd,iBACE3U,EAAY4U,YACd,iBAEA,iBAGL5U,EAAY2U,UAAW,CAEzB,GAAIG,GAAO,QAAU3gC,EAAOjG,GAAK,IAC7B8xB,EAAY2U,UAAU55B,MAAM7M,GAAK,MACrC6G,IAAO,KAAO+/B,EAGd//B,GAAO,UAAYirB,EAAY+U,uBAAuB,GAAGC,KACrD,IAAMF,EACN9U,EAAY+U,uBAAuB,GAAGE,MACxClgC,GAAO,UAAYirB,EAAY+U,uBAAuB,GAAGE,IAAID,KACzD,IAAMF,EACV//B,GAAO,oBACHirB,EAAY+U,uBAAuB,GAAGC,KAAO,IAC7ChV,EAAY+U,uBAAuB,GAAGE,IAAID,KAC1C,QAUR,MANAjgC,IAAO,UAAYirB,EAAY+U,uBAAuB,GAAGC,KACrD,UAAYb,EAASe,WAAa,OAClClV,EAAY2U,WAAa3U,EAAY+U,uBAAuB,GAAGE,MACjElgC,GAAO,UAAYirB,EAAY+U,uBAAuB,GAAGE,IAAID,KACzD,UAAYb,EAASe,WAAa,QAEjCngC,GAITo/B,EAAS6J,aAAe,SAASzS,EAAcyR,GAG7C,IAAK,GADDa,GAAQ1J,EAAS2J,WAAWvS,GACvBrgC,EAAI,EAAGA,EAAI2yC,EAAM7yC,OAAQE,IAChC,OAAQ2yC,EAAM3yC,IACZ,IAAK,aACL,IAAK,aACL,IAAK,aACL,IAAK,aACH,MAAO2yC,GAAM3yC,GAAGgI,OAAO,GAK7B,MAAI8pC,GACK7I,EAAS6J,aAAahB,GAExB,YAGT7I,EAAS4J,QAAU,SAASxS,GAC1B,GAAIsS,GAAQ1J,EAAS2J,WAAWvS,GAC5B4X,EAAQtF,EAAM,GAAGr/B,MAAM,IAC3B,OAAO2kC,GAAM,GAAGjwC,OAAO,IAGzBihC,EAASiJ,WAAa,SAAS7R,GAC7B,MAAyC,MAAlCA,EAAa/sB,MAAM,IAAK,GAAG,IAGpC21B,EAAS1I,WAAa,SAASF,GAC7B,GAAIsS,GAAQ1J,EAAS2J,WAAWvS,GAC5ByV,EAAQnD,EAAM,GAAG3qC,OAAO,GAAGsL,MAAM,IACrC,QACEqa,KAAMmoB,EAAM,GACZxJ,KAAM3lC,SAASmvC,EAAM,GAAI,IACzBtV,SAAUsV,EAAM,GAChB+D,IAAK/D,EAAMxf,MAAM,GAAG9zB,KAAK,OAI7BymC,EAAS6Q,WAAa,SAASzZ,GAC7B,GAAIoC,GAAOwG,EAASlI,YAAYV,EAAc,MAAM,GAChDyV,EAAQrT,EAAKz6B,OAAO,GAAGsL,MAAM,IACjC,QACEymC,SAAUjE,EAAM,GAChB6D,UAAW7D,EAAM,GACjBkE,eAAgBrzC,SAASmvC,EAAM,GAAI,IACnCmE,QAASnE,EAAM,GACfoE,YAAapE,EAAM,GACnBE,QAASF,EAAM,KAKnB7M,EAASkR,WAAa,SAAStE,GAC7B,GAAoB,gBAATA,IAAqC,IAAhBA,EAAK/1C,OACnC,OAAO,CAGT,KAAK,GADD6yC,GAAQ1J,EAAS2J,WAAWiD,GACvB71C,EAAI,EAAGA,EAAI2yC,EAAM7yC,OAAQE,IAChC,GAAI2yC,EAAM3yC,GAAGF,OAAS,GAA4B,MAAvB6yC,EAAM3yC,GAAGg9B,OAAO,GACzC,OAAO,CAIX,QAAO,GAIa,gBAAXnO,KACTA,EAAOD,QAAUqa,aAGR,IAAI,KA0Bf,WAqCI,QAASmR,GAAqBx2C,EAAOoJ,GACjC,GAAIqtC,IACAtvC,OAAO,EACPW,OACIwB,WACIwvB,kBAAmB94B,EAAQ,SAAW,UACtC8I,SAAUvN,OAAOyV,OAAOrI,MAAQ,KAAOpN,OAAOyV,OAAOrI,MAAQ,KAC7DM,UAAW1N,OAAOyV,OAAOjI,OAAS,KAAOxN,OAAOyV,OAAOjI,OAAS,MAEpEQ,aAQR,OAJIH,KACAqtC,EAAmB3uC,MAAMwB,UAAUyvB,oBAAsB3vB,GAGtDqtC,EAGX,QAASC,KACL,MAAKC,GAKAA,EAAOC,aAKZD,GAAOE,cAAcH,aACjBI,iBAAiB,GAClB,SANCh1C,YAAW40C,EAAa,SALxBK,GAAWL,GAcnB,QAASK,GAAWC,GAChB,MAAIL,OACAK,MAIJL,EAASzxB,SAAS+xB,cAAc,UAChCN,EAAOO,OAAS,WACZP,EAAOC,UAAW,EAElBI,KAEJL,EAAOQ,IAAM,iDACbR,EAAOrwC,MAAMC,QAAU,YACtB2e,SAAS1N,MAAQ0N,SAASkyB,iBAAiBC,YAAYV,IAtF5Dp7C,OAAO+7C,YAAc,SAAS32C,GAkB1B,QAAS42C,GAAiB37C,GACjBA,EAAM8C,OAEP9C,EAAM8C,KAAKq6B,sBAC4B,0BAAnCn9B,EAAM8C,KAAKq6B,oBACXp4B,EAAS,qBACNA,EAAS,KAAM/E,EAAM8C,KAAKq6B,oBAAqByd,EAAqB,KAAM56C,EAAM8C,KAAKq6B,uBAG5Fn9B,EAAM8C,KAAK84C,uBACX72C,EAAS/E,EAAM8C,KAAK84C,sBAAuB,KAAMhB,EAAqB56C,EAAM8C,KAAK84C,wBAIrFj8C,OAAO81B,oBAAoB,UAAWkmB,IA5B1C,MAAM9wC,WAAU+B,oBACZ7H,GAAS,KAAM,WACXmH,OACI2vC,eAAgB,SAChBvuC,YAAa,aAMzBwtC,QAEAn7C,QAAO+1B,iBAAiB,UAAWimB,IAyEvC,IAAIZ,EAGJp7C,QAAOi7C,qBAAuB,SAAS71C,GACnCo2C,EAAW,WACPO,YAAY,SAASt3C,EAAOoJ,EAAUqtC,GAClC91C,EAASX,EAAOy2C,EAAmB3uC,eAMnD,WAyCI,QAAS0uC,GAAqBx2C,EAAOoJ,GACjC,GAAIqtC,IACAtvC,OAAO,EACPW,OACIwB,WACIwvB,kBAAmB94B,EAAQ,SAAW,UACtC8I,SAAUvN,OAAOyV,OAAOrI,MAAQ,KAAOpN,OAAOyV,OAAOrI,MAAQ,KAC7DM,UAAW1N,OAAOyV,OAAOjI,OAAS,KAAOxN,OAAOyV,OAAOjI,OAAS,MAEpEQ,aAQR,OAJIH,KACAqtC,EAAmB3uC,MAAMwB,UAAUyvB,oBAAsB3vB,GAGtDqtC,EAGX,QAASC,KACL,MAAKC,GAKAA,EAAOC,aAKZD,GAAOE,cAAcH,aACjBI,iBAAiB,GAClB,SANCh1C,YAAW40C,EAAa,SALxBK,GAAWL,GAcnB,QAASK,GAAWC,GAChB,MAAIL,OACAK,MAIJL,EAASzxB,SAAS+xB,cAAc,UAChCN,EAAOO,OAAS,WACZP,EAAOC,UAAW,EAElBI,KAEJL,EAAOQ,IAAM,iDACbR,EAAOrwC,MAAMC,QAAU,YACtB2e,SAAS1N,MAAQ0N,SAASkyB,iBAAiBC,YAAYV,IA1F5D,GAAwD,KAArDzxB,SAASwyB,OAAOjzC,QAAQ,yBAA3B,CAIAlJ,OAAO+7C,YAAc,SAAS32C,GAkB1B,QAAS42C,GAAiB37C,GACjBA,EAAM8C,OAEP9C,EAAM8C,KAAKq6B,sBAC4B,0BAAnCn9B,EAAM8C,KAAKq6B,oBACXp4B,EAAS,qBACNA,EAAS,KAAM/E,EAAM8C,KAAKq6B,oBAAqByd,EAAqB,KAAM56C,EAAM8C,KAAKq6B,uBAG5Fn9B,EAAM8C,KAAK84C,uBACX72C,EAAS/E,EAAM8C,KAAK84C,sBAAuB,KAAMhB,EAAqB56C,EAAM8C,KAAK84C,wBAIrFj8C,OAAO81B,oBAAoB,UAAWkmB,IA5B1C,MAAM9wC,WAAU+B,oBACZ7H,GAAS,KAAM,WACXmH,OACI2vC,eAAgB,SAChBvuC,YAAa,aAMzBwtC,QAEAn7C,QAAO+1B,iBAAiB,UAAWimB,IAyEvC,IAAIZ,EAGJp7C,QAAOi7C,qBAAuB,SAAS71C,GACnCo2C,EAAW,WACPO,YAAY,SAASt3C,EAAOoJ,EAAUqtC,GAClC91C,EAASX,EAAOy2C,EAAmB3uC,iBAwBlD,SAASyS,GAAG,YAAa,SAAS6I,GAAE7I,EAAE6I,GAAG,GAAI5M,IAAG,MAAM+D,IAAI,MAAM6I,GAAG8W,GAAG3f,GAAG,KAAK6I,GAAG,KAAK5M,GAAG,GAAI,OAAO0jB,IAAG,GAAG,MAAM1jB,EAAE,QAASA,GAAE+D,EAAE6I,GAAG,MAAO7I,IAAG6I,EAAE7I,IAAI,GAAG6I,EAAE,QAAS8W,GAAE3f,EAAE2f,EAAE76B,EAAEiqB,EAAE8B,EAAEja,GAAG,MAAOiS,GAAE5M,EAAE4M,EAAEA,EAAE8W,EAAE3f,GAAG6I,EAAEkG,EAAEnY,IAAIia,GAAG/rB,GAAG,QAASA,GAAEkb,EAAE6I,EAAE5M,EAAEnX,EAAEiqB,EAAE8B,EAAEja,GAAG,MAAO+oB,GAAE9W,EAAE5M,GAAG4M,EAAE/jB,EAAEkb,EAAE6I,EAAEkG,EAAE8B,EAAEja,GAAG,QAASmY,GAAE/O,EAAE6I,EAAE5M,EAAEnX,EAAEiqB,EAAE8B,EAAEja,GAAG,MAAO+oB,GAAE9W,EAAE/jB,EAAEmX,GAAGnX,EAAEkb,EAAE6I,EAAEkG,EAAE8B,EAAEja,GAAG,QAASia,GAAE7Q,EAAE6I,EAAE5M,EAAEnX,EAAEiqB,EAAE8B,EAAEja,GAAG,MAAO+oB,GAAE9W,EAAE5M,EAAEnX,EAAEkb,EAAE6I,EAAEkG,EAAE8B,EAAEja,GAAG,QAASA,GAAEoJ,EAAE6I,EAAE5M,EAAEnX,EAAEiqB,EAAE8B,EAAEja,GAAG,MAAO+oB,GAAE1jB,GAAG4M,GAAG/jB,GAAGkb,EAAE6I,EAAEkG,EAAE8B,EAAEja,GAAG,QAAS/U,GAAEme,EAAE/D,GAAG+D,EAAE/D,GAAG,IAAI,KAAKA,EAAE,GAAG+D,GAAG/D,EAAE,KAAK,GAAG,GAAG,IAAIA,CAAE,IAAI0jB,GAAE99B,EAAEoW,EAAEmlC,EAAEC,EAAEC,EAAE,WAAWh9B,EAAE,WAAWzD,EAAE,YAAYsU,EAAE,SAAU,KAAIwO,EAAE,EAAEA,EAAE3f,EAAEre,OAAOg+B,GAAG,GAAG99B,EAAEy7C,EAAErlC,EAAEqI,EAAE88B,EAAEvgC,EAAEwgC,EAAElsB,EAAEmsB,EAAEx4C,EAAEw4C,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,GAAG,EAAE,YAAYxO,EAAErsB,EAAEqsB,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,GAAG,GAAG,YAAY9iB,EAAE/X,EAAE+X,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,GAAG,GAAG,WAAWrf,EAAExb,EAAEwb,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,GAAG,GAAG,aAAa2d,EAAEx4C,EAAEw4C,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,YAAYxO,EAAErsB,EAAEqsB,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,GAAG,GAAG,YAAY9iB,EAAE/X,EAAE+X,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,GAAG,GAAG,aAAarf,EAAExb,EAAEwb,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,GAAG,GAAG,WAAW2d,EAAEx4C,EAAEw4C,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,YAAYxO,EAAErsB,EAAEqsB,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,GAAG,GAAG,aAAa9iB,EAAE/X,EAAE+X,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,IAAI,GAAG,QAAQrf,EAAExb,EAAEwb,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,IAAI,GAAG,aAAa2d,EAAEx4C,EAAEw4C,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,IAAI,EAAE,YAAYxO,EAAErsB,EAAEqsB,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,IAAI,GAAG,WAAW9iB,EAAE/X,EAAE+X,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,IAAI,GAAG,aAAarf,EAAExb,EAAEwb,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,IAAI,GAAG,YAAY2d,EAAEvuB,EAAEuuB,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,YAAYxO,EAAEpC,EAAEoC,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,GAAG,EAAE,aAAa9iB,EAAEkS,EAAElS,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,IAAI,GAAG,WAAWrf,EAAEyO,EAAEzO,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,GAAG,GAAG,YAAY2d,EAAEvuB,EAAEuuB,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,YAAYxO,EAAEpC,EAAEoC,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,IAAI,EAAE,UAAU9iB,EAAEkS,EAAElS,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,IAAI,GAAG,YAAYrf,EAAEyO,EAAEzO,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,GAAG,GAAG,YAAY2d,EAAEvuB,EAAEuuB,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,WAAWxO,EAAEpC,EAAEoC,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,IAAI,EAAE,aAAa9iB,EAAEkS,EAAElS,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,GAAG,GAAG,YAAYrf,EAAEyO,EAAEzO,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,GAAG,GAAG,YAAY2d,EAAEvuB,EAAEuuB,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,IAAI,EAAE,aAAaxO,EAAEpC,EAAEoC,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,GAAG,EAAE,WAAW9iB,EAAEkS,EAAElS,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,GAAG,GAAG,YAAYrf,EAAEyO,EAAEzO,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,IAAI,GAAG,aAAa2d,EAAEzsB,EAAEysB,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,SAASxO,EAAEN,EAAEM,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,GAAG,GAAG,aAAa9iB,EAAEgU,EAAEhU,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,IAAI,GAAG,YAAYrf,EAAEuQ,EAAEvQ,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,IAAI,GAAG,WAAW2d,EAAEzsB,EAAEysB,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,aAAaxO,EAAEN,EAAEM,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,GAAG,GAAG,YAAY9iB,EAAEgU,EAAEhU,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,GAAG,GAAG,YAAYrf,EAAEuQ,EAAEvQ,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,IAAI,GAAG,aAAa2d,EAAEzsB,EAAEysB,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,IAAI,EAAE,WAAWxO,EAAEN,EAAEM,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,GAAG,GAAG,YAAY9iB,EAAEgU,EAAEhU,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,GAAG,GAAG,YAAYrf,EAAEuQ,EAAEvQ,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,GAAG,GAAG,UAAU2d,EAAEzsB,EAAEysB,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,YAAYxO,EAAEN,EAAEM,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,IAAI,GAAG,YAAY9iB,EAAEgU,EAAEhU,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,IAAI,GAAG,WAAWrf,EAAEuQ,EAAEvQ,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,GAAG,GAAG,YAAY2d,EAAE1mC,EAAE0mC,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,GAAG,EAAE,YAAYxO,EAAEva,EAAEua,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,GAAG,GAAG,YAAY9iB,EAAEjG,EAAEiG,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,IAAI,GAAG,aAAarf,EAAE1J,EAAE0J,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,GAAG,GAAG,WAAW2d,EAAE1mC,EAAE0mC,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,IAAI,EAAE,YAAYxO,EAAEva,EAAEua,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,GAAG,GAAG,aAAa9iB,EAAEjG,EAAEiG,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,IAAI,GAAG,UAAUrf,EAAE1J,EAAE0J,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,GAAG,GAAG,aAAa2d,EAAE1mC,EAAE0mC,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,YAAYxO,EAAEva,EAAEua,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,IAAI,GAAG,WAAW9iB,EAAEjG,EAAEiG,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,GAAG,GAAG,aAAarf,EAAE1J,EAAE0J,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,IAAI,GAAG,YAAY2d,EAAE1mC,EAAE0mC,EAAEh9B,EAAEzD,EAAEsU,EAAEnR,EAAE2f,EAAE,GAAG,EAAE,YAAYxO,EAAEva,EAAEua,EAAEmsB,EAAEh9B,EAAEzD,EAAEmD,EAAE2f,EAAE,IAAI,GAAG,aAAa9iB,EAAEjG,EAAEiG,EAAEsU,EAAEmsB,EAAEh9B,EAAEN,EAAE2f,EAAE,GAAG,GAAG,WAAWrf,EAAE1J,EAAE0J,EAAEzD,EAAEsU,EAAEmsB,EAAEt9B,EAAE2f,EAAE,GAAG,GAAG,YAAY2d,EAAEz0B,EAAEy0B,EAAEz7C,GAAGye,EAAEuI,EAAEvI,EAAErI,GAAG4E,EAAEgM,EAAEhM,EAAEugC,GAAGjsB,EAAEtI,EAAEsI,EAAEksB,EAAG,QAAOC,EAAEh9B,EAAEzD,EAAEsU,GAAG,QAASlZ,GAAE+H,GAAG,GAAI6I,GAAE5M,EAAE,EAAG,KAAI4M,EAAE,EAAEA,EAAE,GAAG7I,EAAEre,OAAOknB,GAAG,EAAE5M,GAAGshC,OAAOC,aAAax9B,EAAE6I,GAAG,KAAKA,EAAE,GAAG,IAAK,OAAO5M,GAAE,QAASmhC,GAAEp9B,GAAG,GAAI6I,GAAE5M,IAAK,KAAIA,GAAG+D,EAAEre,QAAQ,GAAG,GAAG,OAAOknB,EAAE,EAAEA,EAAE5M,EAAEta,OAAOknB,GAAG,EAAE5M,EAAE4M,GAAG,CAAE,KAAIA,EAAE,EAAEA,EAAE,EAAE7I,EAAEre,OAAOknB,GAAG,EAAE5M,EAAE4M,GAAG,KAAK,IAAI7I,EAAEy9B,WAAW50B,EAAE,KAAKA,EAAE,EAAG,OAAO5M,GAAE,QAASohC,GAAEr9B,GAAG,MAAO/H,GAAEpW,EAAEu7C,EAAEp9B,GAAG,EAAEA,EAAEre,SAAS,QAAS27C,GAAEt9B,EAAE6I,GAAG,GAAI5M,GAAE0jB,EAAE76B,EAAEs4C,EAAEp9B,GAAG+O,KAAK8B,IAAK,KAAI9B,EAAE,IAAI8B,EAAE,IAAI,OAAO/rB,EAAEnD,OAAO,KAAKmD,EAAEjD,EAAEiD,EAAE,EAAEkb,EAAEre,SAASsa,EAAE,EAAE,GAAGA,EAAEA,GAAG,EAAE8S,EAAE9S,GAAG,UAAUnX,EAAEmX,GAAG4U,EAAE5U,GAAG,WAAWnX,EAAEmX,EAAG,OAAO0jB,GAAE99B,EAAEktB,EAAExZ,OAAO6nC,EAAEv0B,IAAI,IAAI,EAAEA,EAAElnB,QAAQsW,EAAEpW,EAAEgvB,EAAEtb,OAAOoqB,GAAG,MAAM,QAASrf,GAAEN,GAAG,GAAI6I,GAAE5M,EAAE0jB,EAAE,mBAAmB76B,EAAE,EAAG,KAAImX,EAAE,EAAEA,EAAE+D,EAAEre,OAAOsa,GAAG,EAAE4M,EAAE7I,EAAEy9B,WAAWxhC,GAAGnX,GAAG66B,EAAEd,OAAOhW,IAAI,EAAE,IAAI8W,EAAEd,OAAO,GAAGhW,EAAG,OAAO/jB,GAAE,QAAS+X,GAAEmD,GAAG,MAAO09B,UAASC,mBAAmB39B,IAAI,QAASmR,GAAEnR,GAAG,MAAOq9B,GAAExgC,EAAEmD,IAAI,QAASrY,GAAEqY,GAAG,MAAOM,GAAE6Q,EAAEnR,IAAI,QAAS9D,GAAE8D,EAAE6I,GAAG,MAAOy0B,GAAEzgC,EAAEmD,GAAGnD,EAAEgM,IAAI,QAAS2F,GAAExO,EAAE6I,GAAG,MAAOvI,GAAEpE,EAAE8D,EAAE6I,IAAI,QAASmI,GAAEhR,EAAE6I,EAAE5M,GAAG,MAAO4M,GAAE5M,EAAEC,EAAE2M,EAAE7I,GAAGwO,EAAE3F,EAAE7I,GAAG/D,EAAEkV,EAAEnR,GAAGrY,EAAEqY,GAAG,kBAAmB2Q,SAAQA,OAAOC,IAAID,OAAO,WAAW,MAAOK,KAAIhR,EAAE49B,IAAI5sB,GAAGjwB,MAkG7rH,WACE,YAEA,IAAI88C,GAAWC,QAAQptB,OAAO,YAC5B,QACA,UACA,mBACA,kBACA,eACA,YACA,YACA,aACA,SACA,YACA,WACA,iBACA,cACA,eACA,qBACA,yBACA,yBAGFmtB,GAASE,SAAS,mBAChBC,YACMn5C,GAAI,KAAMwW,KAAM,YAChBxW,GAAI,KAAMwW,KAAM,aAChBxW,GAAI,KAAMwW,KAAM,aAChBxW,GAAI,KAAMwW,KAAM,YAChBxW,GAAI,KAAMwW,KAAM,cAChBxW,GAAI,KAAMwW,KAAM,WAChBxW,GAAI,KAAMwW,KAAM,OAChBxW,GAAI,KAAMwW,KAAM,YAChBxW,GAAI,KAAMwW,KAAM,YAChBxW,GAAI,KAAMwW,KAAM,UAChBxW,GAAI,KAAMwW,KAAM,YAChBxW,GAAI,KAAMwW,KAAM,cAGtB4iC,UACIC,GAAM,KACNC,MAAS,KACTC,MAAS,KACTC,GAAM,KACNC,MAAS,KACTC,GAAM,KACNC,MAAS,KACTC,MAAS,KACTnS,GAAM,KACNoS,MAAS,KACTC,MAAS,KACTC,GAAM,KACNC,MAAS,KACTC,GAAM,KACNC,MAAS,KACTC,GAAM,KACNC,MAAS,KACTC,GAAM,KACNC,MAAS,KACTC,GAAM,KACNC,MAAS,KACTC,MAAS,KACTC,GAAM,KACNC,MAAS,KACT36C,GAAM,KACN46C,MAAS,KACTC,GAAM,KACNC,MAAS,KACTC,MAAS,KACTC,MAAS,QAIfhC,EAAS/sC,QAAQ,iBAAkB,0BAA2B,qBAAsB,kBAClF,SAASgvC,EAAgBC,EAAyBC,EAAoBC,GACpEH,EACAI,KAAK,KACHC,MAAO,UACPC,YAAa,8BACbC,WAAY,2BAEdH,KAAK,UACHC,MAAO,QACPC,YAAa,sBACbC,WAAY,oBAEdH,KAAK,YACHC,MAAO,UACPC,YAAa,wBACbC,WAAY,sBAEdH,KAAK,WACDC,MAAO,YACPC,YAAa,uBACbC,WAAY,qBAEhBH,KAAK,YACHC,MAAO,6BACPC,YAAa,wBACbC,WAAY,sBAEdH,KAAK,YACHC,MAAO,gBACPC,YAAa,wBACbC,WAAY,sBAEdH,KAAK,oBACHC,MAAO,GACPC,YAAa,gCACbC,WAAY,6BAEdC,WACEC,WAAY,MAGdR,EAAwBS,UACtBtf,UAAS,KAGX,IAAIuf,KACJ3C,SAAQrsC,QAAQwuC,EAAgBjC,UAAW,SAASj5B,EAAO7F,GACzDuhC,EAAU14C,KAAKgd,EAAMlgB,MAGvBm7C,EACCU,sBACC92C,OAAQ,kBACR+2C,OAAQ,UAETC,8BAA8BH,EAAWR,EAAgBhC,UACzD4C,kBAAkB,MAClBC,6BACAC,iBAAiB,MACjBC,yBAAyB,SAI9BnD,EAASoD,KAAK,aAAc,YAAa,SAAU,SAAU,QAC3D,SAASC,EAAYC,EAAWC,EAAQj7B,EAAQrO,GAE9CopC,EAAWG,IAAK,oBAAqB,SAAShgD,EAAOigD,EAAMC,GACpDzpC,EAAM3T,KAAK4xC,WACY,wBAArBuL,EAAKlB,aAGRe,EAAUK,KAAK,OAKrBN,EAAWG,IAAI,sBAAuB,SAAShgD,EAAOkgD,EAASE,GAC7DP,EAAWf,MAAQoB,EAAQG,QAAQvB,QAGrCe,EAAWS,cAAe,EAEM,UAA5B3gD,OAAO0qB,SAAS2W,WAClB6e,EAAWS,cAAe,GAI5BT,EAAWU,YAAc,SAASzB,EAAOvtC,EAAS6c,EAAOrpB,GAC7C+f,GACRg6B,MAAOA,EACPvtC,QAASA,EACTivC,OAAO,EACPpyB,MAAOA,IACN9b,KAAK,SAASoI,GACX+hC,QAAQgE,WAAW17C,IACrBA,EAAS2V,IAEV,qBAWX,WACE,YAEuB+hC,SAAQptB,OAAO,oBACpC,eACA,eACA,iBACA,mBAKJ,WACE,YAEAotB,SACCptB,OAAO,oBACP2vB,WAAW,0BAA2B,SAAU,aAAc,YAAa,WAAY,UAAW,eAAgB,SAAU,QAC3H,SAAS0B,EAAQb,EAAYC,EAAWa,EAAUC,EAASC,EAAc/7B,EAAQrO,GAC/E/S,QAAQwR,MAAM,qCAEdwrC,EAAOI,oBAAsBD,EAAaC,oBAC1CJ,EAAOnvC,QAAU,GACjBmvC,EAAOK,gBAAiB,EACxBL,EAAOM,SAEP,IAAI9B,GAAa,SAAS+B,EAAMC,GAC3BA,GACc,mBAAZA,IACDD,EAAOC,GAIXpB,EAAUK,KAAKc,IAGbE,EAAqB,SAASC,EAAkBlyB,EAAQuX,EAASya,EAAUG,EAAMC,EAAW/vC,GAI9F,GAHAmvC,EAAOI,oBAAsBD,EAAaU,UAAUH,GACpDV,EAAOnvC,QAAUA,EAEd+vC,GAAuB,SAAVpyB,EAAmB,CAEjC,GADAwxB,EAAOM,OAAOt6C,KAAK6K,IACf8vC,EAEF,WADAnC,GAAW,GAAIgC,EAGf3vC,IAAoB,cAGlBzE,QAAQyE,KACVmvC,EAAOK,gBAAiB,GAI5B,MAAGL,GAAOK,eAAV,QAIAL,EAAOnvC,QAAUsvC,EAAaW,mBAAmBJ,EAAiB,IAE3D,GAGTvB,GAAWG,IAAI,gBAAiB,SAASzc,EAAI6d,EAAkBlyB,EAAQuX,EAASya,EAAUG,EAAMC,EAAW/vC,GACzGovC,EAAS,WACP,MAAGla,OACDA,GAAQn0B,KAAK,SAAS7N,GACpB8M,EAAU9M,EAAkB,QAC5ByqB,EAASzqB,EAAiB,OACvB08C,EAAmBC,EAAkBlyB,EAAQuX,EAASya,EAAUG,EAAMC,EAAW/vC,IAClFsvC,EAAaZ,cAOfkB,EAAmBC,EAAkBlyB,EAAQuX,EAASya,EAAUG,EAAMC,EAAW/vC,IAIrFsvC,EAAaZ,SACZ,OAGLJ,EAAWG,IAAI,oBAAqB,SAASzc,EAAI6d,GAC/CV,EAAOnvC,QAAU,WACdkF,EAAM3T,KAAK4xC,UAKVoL,EAAUK,KAAK,aAGjBjB,EAAW,UACXY,EAAUK,KAAK,aAInBU,EAAaZ,aAMnB,WACE,YAEAxD,SACGptB,OAAO,oBACP2vB,WAAW,4BAA6B,SAAU,QACjD,YAAa,QAAS,UAAW,aACjC,SAAS0B,EAAQe,EAAO3B,EAAWrpC,EAAOmqC,EAASc,GACjDh+C,QAAQwR,MAAM,6CAOtB,WACE,YAEAunC,SACCptB,OAAO,oBACP2vB,WAAW,kBAAmB,SAAU,aAAc,QACrD,YAAa,gBAAiB,WAAY,QAAS,SAAU,aAC7D,SAAS0B,EAAQb,EAAY4B,EAAO3B,EAAW6B,EAAehB,EAC5DlqC,EAAOqO,EAAQ88B,GAGf,QAASC,KAEP,GAAIv2C,GAAMge,SAASw4B,cAAc,iBACjCx2C,GAAIy2C,UAAYz2C,EAAI02C,aAQtB,QAASC,KACPvB,EAAOwB,WACPxB,EAAOyB,YACPzB,EAAOnvC,QAAU6wC,EA8CnB,QAASC,GAAehqC,GAEtB,IAAK,GADDiqC,GAAc7rC,EAAM3T,KAAKy/C,gBACpB/hD,EAAI,EAAGA,EAAI8hD,EAAYhiD,OAAQE,IACtC,GAAI8hD,EAAY9hD,GAAGwZ,OAAS3B,EAC1B,MAAOiqC,GAAY9hD,GAAGgiD,OAM5B,QAASC,GAAkBC,GACzBhC,EAAOwB,QAAQ9xC,QAAQ,SAASuyC,GAC9B,GAAIC,GAAQD,EAAOzzB,OAAOhjB,MAAM22C,aAChCn/C,SAAQwR,MAAM,mBAAqB0tC,GAC/BA,GAASF,GAAwC,KAA5BA,EAAS75C,QAAQ+5C,IACtCA,IACFl/C,QAAQwR,MAAM,mBAAqB0tC,EAAQ,WAAaD,EAAOn/C,GAAK,KACpEk9C,EAAOoC,UAAUH,EAAOn/C,GAAIo/C,MAKlC,QAASG,GAAiBC,GACxB,GAAIC,IAAQ,CACZ,KAAK,GAAI9rB,KAAOupB,GAAOwB,QAAS,CAC9B,GAAIS,GAASjC,EAAOwB,QAAQ/qB,EAC5B,IAAIwrB,EAAOK,MAAQA,EAAM,CACvBC,GAAQ,CACR,QAGJ,MAAIA,GACK9rB,EAEA,GAIX,QAAS+rB,GAAgBP,GACvB,OACEK,KAAQL,EAAO,GACfn/C,GAAMm/C,EAAO,GAAG,GAChBQ,OAAUR,EAAO,GAAG,GACpB3oC,KAAQ2oC,EAAO,GAAG,GAClBxO,MAASwO,EAAO,GAAG,GACnBzzB,OAAUvP,KAAKme,MAAM6kB,EAAO,GAAG,IAC/BS,MAAST,EAAO,GAAG,GAAGS,OAI1B,QAASC,GAAUV,GACjBjC,EAAOwB,QAAQx7C,KAAKw8C,EAAgBP,IAqOtC,QAASW,GAAYzqC,EAAMtW,GACzBuiB,GACEg6B,MAAOjmC,EACP2nC,OAAO,EACPpyB,MAAO,GACP1K,MAAO,KACNpR,KAAK,SAASwM,GACXA,GAAOvc,GACTA,EAAGuc,KA9VTpb,QAAQwR,MAAM,4BAWd,IAAIktC,GAAgB,EAOpBH,KAEAvB,EAAO6C,OAAO,aAAc,WACD,QAArB7C,EAAO8C,aACT3D,EAAW4D,aAAe,GAE5B5D,EAAW2D,WAAa9C,EAAO8C,aAGjC3D,EAAWG,IAAI,kBAAmB,SAAShgD,EAAO8C;AAChDA,EAAK4gD,WAAa,GAAIC,MACtBjgD,QAAQC,IAAI,kBAAmBb,GAC/B49C,EAAOkD,OAAO,WACZlD,EAAOyB,SAASz7C,KAAK5D,GACjBA,EAAKqb,MAAQ1H,EAAM3T,KAAKkX,MACtB0mC,EAAOmD,YAAmC,QAArBnD,EAAO8C,cAC9B3D,EAAW4D,aAEf9C,EAAS,WACPkB,KACC,SAIPhC,EAAWG,IAAI,kBAAmB,SAAShgD,EAAO8C,GAChD69C,EAAS,WACPD,EAAOlpC,KAAOf,EAAM3T,KAAK0U,KAAKrU,OAAOoW,WAIzCsmC,EAAWG,IAAI,qBAAsB,SAAShgD,EAAOqY,GACnDqoC,EAAOoD,OAASzB,EAAehqC,GAK/BoqC,EAAkB/B,EAAOoD,UAG3BjE,EAAWG,IAAI,wBAAyB,SAAShgD,EAAO8C,GACtD49C,EAAOqD,cAAgBjhD,EAAK,GAAGkhD,WAC/BtD,EAAOoD,OAASzB,EAAe3B,EAAOqD,iBAyDxClE,EAAWG,IAAI,aAAc,WAC3BU,EAAOuD,OAAS,OAGlBpE,EAAWG,IAAI,eAAgB,SAAShgD,EAAOkiD,GAC7CxB,EAAOkD,OAAO,WACZ3B,GACA,KAAK,GAAI9qB,KAAO+qB,GAAS,CACvB,GAAIS,GAAST,EAAQ/qB,EACrBksB,GAAUV,QAKhB9C,EAAWG,IAAI,cAAe,SAAShgD,EAAO2iD,GAC5CjC,EAAOkD,OAAO,WACZP,EAAUV,OAId9C,EAAWG,IAAI,cAAe,SAAShgD,EAAOgjD,GACxCnD,EAAWqE,SAAWrE,EAAWsE,SAAWnB,IAC9CvsC,EAAMmG,SACNjd,OAAO6F,SAGTk7C,EAAOkD,OAAO,WACZ,GAAIQ,GAAYrB,EAAiBC,EAChB,KAAboB,GAEF1D,EAAOwB,QAAQ9qB,OAAOgtB,EAAW,OAKvCvE,EAAWG,IAAI,iBAAkB,SAAShgD,EAAO2iD,GAC/CA,EAASO,EAAgBP,EACzB,IAAIyB,GAAYrB,EAAiBJ,EAAOK,KACxB,GAAZoB,EACF1gD,QAAQC,IAAI,+BAAkCg/C,EAAOK,MAErDtC,EAAOkD,OAAO,WAIRz8C,SAASw7C,EAAOn/C,KAAO2D,SAASsP,EAAM3T,KAAKuhD,sBAC7C5tC,EAAM3T,KAAKwhD,SAAW3B,EAAOzzB,OAAO3jB,MAAMg5C,MAC1C9tC,EAAM3T,KAAK0hD,WAAa7B,EAAOzzB,OAAOhjB,MAAMq4C,MACrD9tC,EAAM3T,KAAKG,KAAKwR,QAAQkuC,EAAOzzB,OAAO3jB,MAAMg5C,MAAQ,MAAQ,MAC5D9tC,EAAM3T,KAAKG,KAAK8R,aAAa4tC,EAAOzzB,OAAOhjB,MAAMq4C,MAAQ,MAAQ,OAE1D9H,QAAQv7C,OAAOw/C,EAAOwB,QAAQkC,GAAYzB,OAKhD9C,EAAWG,IAAI,gBAAiB,SAAShgD,GACvC0gD,EAAO+D,YAAY,WACjBxC,IACAvB,EAAOgE,gBAQXhE,EAAOiE,cAAgB,SAAS7jC,GACH,aAAvBrK,EAAM3T,KAAK8hD,WACflE,EAAOuD,OAASvD,EAAOuD,QAAUnjC,EAAQ,KAAOA,IAGlD4/B,EAAO/9C,KAAO,SAAS3C,GAIjBA,GAAuB,WAAdA,EAAM8D,MACjB9D,EAAM6kD,iBAERpuC,EAAMquC,mBAAmBpE,EAAOnvC,SAChCmvC,EAAOnvC,QAAU6wC,GAInB1B,EAAOqE,SAAW,SAASjtC,GACzBpU,QAAQC,IAAI,mBACZ8S,EAAM3T,KAAK0U,KAAKe,KAAKT,IAGvB4oC,EAAOsE,YAAc,SAASltC,GACF,aAAvBrB,EAAM3T,KAAK8hD,WACZlhD,QAAQC,IAAI,sBACZ8S,EAAM3T,KAAK0U,KAAKgB,QAAQV,KAI5B4oC,EAAOuE,cAAgB,SAASntC,GACJ,aAAvBrB,EAAM3T,KAAK8hD,WACZlhD,QAAQC,IAAI,wBACZ8S,EAAM3T,KAAK0U,KAAKiB,UAAUX,KAI9B4oC,EAAOwE,cAAgB,SAASptC,GAC9BpU,QAAQC,IAAI,wBACZ8S,EAAM3T,KAAK0U,KAAKkB,UAAUZ,IAG5B4oC,EAAOoC,UAAY,SAAShrC,EAAU8qC,GACpCl/C,QAAQC,IAAI,MAAOmU,EAAU,KAAM8qC,GACnCnsC,EAAM0uC,iBAAiBrtC,EAAU8qC,IAGnClC,EAAO0E,eAAiB,SAASttC,GAC/BpU,QAAQC,IAAI,yBACZ8S,EAAM3T,KAAK0U,KAAKmB,WAAWb,IAG7B4oC,EAAO2E,WAAa,SAASvtC,GAC3BpU,QAAQC,IAAI,qBAEZmhB,GACEg6B,MAAO8C,EAAW0D,QAAQ,uBAC1B9E,OAAO,EACPpyB,MAAO,GACP1K,MAAO,KACNpR,KAAK,SAASuG,GACXA,GACFpC,EAAM3T,KAAK0U,KAAKoB,OAAOd,EAAUe,MAKvC6nC,EAAO6E,aAAe,SAASztC,EAAUQ,GACvC,MAAIA,OACF7B,GAAM+uC,YAAY1tC,EAAUQ,OAI9BgrC,GAAY1B,EAAW0D,QAAQ,0BAA2B,SAAShtC,GACjE5U,QAAQC,IAAImU,EAAUQ,GACtB7B,EAAM+uC,YAAY1tC,EAAUQ,MAKhCooC,EAAO+E,cAAgB,SAAS3tC,EAAUQ,GACxC,MAAIA,OACF7B,GAAMivC,aAAa5tC,EAAUQ,OAI/BgrC,GAAY1B,EAAW0D,QAAQ,0BAA2B,SAAShtC,GACjE7B,EAAMivC,aAAa5tC,EAAUQ,MAIjCooC,EAAOiF,UAAY,SAAS7tC,EAAUQ,GACpC,MAAIA,OACF7B,GAAMmvC,SAAS9tC,EAAUQ,OAI3BgrC,GAAY1B,EAAW0D,QAAQ,sBAAuB,SAAShtC,GAC7D7B,EAAMmvC,SAAS9tC,EAAUQ,MAI7BooC,EAAOmF,gBAAkB,SAAS/tC,GAChCpU,QAAQC,IAAI,yBACZ,IAAIkV,GAAO,OACXpC,GAAM3T,KAAK0U,KAAKoB,OAAOd,EAAUe,IAGnC6nC,EAAOoF,eAAiB,SAAShuC,GAC/BpU,QAAQC,IAAI,yBACZ8S,EAAM3T,KAAK0U,KAAKuB,WAAWjB,IAG7B4oC,EAAOqF,aAAe,SAASjuC,GAC7BpU,QAAQC,IAAI,uBACZ8S,EAAM3T,KAAK0U,KAAKwB,SAASlB,IAG3B4oC,EAAOsF,aAAe,SAASluC,GAC7BpU,QAAQC,IAAI,uBACZ8S,EAAM3T,KAAK0U,KAAKyB,SAASnB,IAG3B4oC,EAAOuF,WAAa,SAASnuC,GAC3BpU,QAAQC,IAAI,qBACZ8S,EAAM3T,KAAK0U,KAAK0B,OAAOpB,IAGzB4oC,EAAOwF,aAAe,SAASpuC,GAC7BpU,QAAQC,IAAI,uBACZk8C,EAAWsG,uBACXrhC,GACEg6B,MAAO8C,EAAW0D,QAAQ,kBAC1B/zC,QAASqwC,EAAW0D,QAAQ,oBAC5B9E,OAAO,EACPpyB,MAAOwzB,EAAW0D,QAAQ,kBAC1B5hC,MAAO,KACNpR,KAAK,SAAS8G,GACfymC,EAAWuG,sBACPhtC,GACF3C,EAAM3T,KAAK0U,KAAK2B,SAASrB,EAAUsB,KATvC0L,SAWS,WACP+6B,EAAWuG,yBAKf1F,EAAO2F,eAAiB,SAAS1D,GACL,aAAvBlsC,EAAM3T,KAAK8hD,WACZlhD,QAAQC,IAAI,yBAERg/C,EAAOzzB,OAAO3jB,MAAMsM,KACtBpB,EAAM3T,KAAK0U,KAAKO,OAAO4qC,EAAOn/C,IAE9BiT,EAAM3T,KAAK0U,KAAKK,KAAK8qC,EAAOn/C,YAsBxC,WACE,YAEAi5C,SACGptB,OAAO,oBACP2vB,WAAW,0BAA2B,SAAU,QAC/C,SACA,SAAS0B,EAAQe,EAAO1B,GACtB,GAAIh8C,GAAMpE,OAAO0qB,SAASi8B,OAAS3mD,OAAO0qB,SAASk8B,QACnD9E,GAAMtiC,IAAIpb,EAAM,oBACbI,QAAQ,SAASrB,GAEhB,GAAI0jD,KAEJ/J,SAAQrsC,QAAQtN,EAAM,SAAS4gB,EAAO7F,GACpC,GAAI4oC,GAAK,cACLzsC,EAAO0J,EAAM/I,QAAQ8rC,EAAI,MACzBrD,EAAQ1/B,EAAM/I,QAAQ8rC,EAAI,KAE9B/mD,MAAKgH,MACHsT,KAAQA,EACRopC,MAASA,KAEVoD,GAEH9F,EAAO8F,aAAeA,IAEvBpiD,MAAM,WACL27C,EAAO37C,MAAM,mCAMzB,WACE,YAEAq4C,SACGptB,OAAO,oBACP2vB,WAAW,mBAAoB,SAAU,QACxC,SACA,SAAS0B,EAAQe,EAAO1B,GACzB,GAAI2G,GAAU,YACPhG,GAAOgG,QAAUA,QAe7B,WACE,YAEAjK,SACGptB,OAAO,oBACP2vB,WAAW,qBAAsB,aAAc,SAC9C,QAAS,YAAa,SAAU,QAAS,UAAW,cAAe,aAAc,WACjF,SAASa,EAAYa,EAAQe,EAAO3B,EAAWC,EAAQtpC,EAAOmqC,EAAS+F,EAAaC,EAAYjG,GAiE9F,QAAS19C,GAAK41C,GAIZ,MAHA+H,GAAQ99C,KAAK+jD,QAAS,EACtBjG,EAAQ99C,KAAKgkD,SAAW,EACxBjH,EAAWkH,cAAgBlO,GACtBgH,EAAWkH,eAAiBnG,EAAQ99C,KAAKkkD,eAC5CnH,EAAWkH,cAAgBnG,EAAQ99C,KAAKkkD,eACjC,GACGnH,EAAWkH,eAAkBnG,EAAQ99C,KAAKkkD,cAKlDvwC,EAAM3T,KAAKG,MACbS,QAAQwR,MAAM,mCACP,GAG4B,IAAjC2jC,EAAUhwC,QAAQ,aACpBg3C,EAAWqE,SAAU,EACrBztC,EAAMxT,KAAK48C,EAAWkH,cAAe,MAEjC56C,UAAW,OACXX,OAAQ,OACRgI,SAAU,OACVoW,eAAgB,KAChBloB,iBACAooB,iBAAkB,KAClBm9B,aAAa,QAGjBnH,GAAUK,KAAK,aAIjBS,EAAQ99C,KAAK0hD,YAAa,EAC1B5D,EAAQ99C,KAAKwhD,UAAW,EAExB1D,EAAQ99C,KAAKokD,WAAY,EACzBzwC,EAAMxT,KAAK48C,EAAWkH,eAEtBnG,EAAQ99C,KAAKkkD,cAAgBnH,EAAWkH,cACxCJ,EAAY9nC,IAAIghC,EAAWkH,cAAe,gBAC1CjH,GAAUK,KAAK,aAlCbJ,EAAOoH,QAAQ,gCACR,GAzEXzjD,QAAQwR,MAAM,gCAEd0xC,EAAWQ,UAEPtH,EAAUuH,SAASC,WACnBzH,EAAWkH,cAAgBjH,EAAUuH,SAASC,eACvCxH,GAAUuH,SAASC,SAC1BrkD,EAAK48C,EAAWkH,eACblH,EAAWqE,WAKlBxD,EAAO6G,aAAeZ,EAAY5zC,MAClC2tC,EAAO8G,gBAAkBb,EAAYc,cACrC/G,EAAOgH,YAAcn1C,OAAOkiB,KAAKisB,EAAO6G,cAAcjnD,OACtDsgD,EAAQ99C,KAAKokD,WAAY,EACzBtG,EAAQ99C,KAAK6kD,WAAa,aAC1B/G,EAAQ99C,KAAK8kD,SAAU,EAEvBlH,EAAOmH,iBAAmB,WAKxB,MAJAlB,GAAY/nC,QACZ8hC,EAAO6G,aAAeZ,EAAY5zC,MAClC2tC,EAAO8G,gBAAkBb,EAAYc,cACrC/G,EAAOgH,YAAcn1C,OAAOkiB,KAAKisB,EAAO6G,cAAcjnD,OAC/CogD,EAAO8G,iBAGhB9G,EAAOoH,cAAgB,SAASC,GAC9B,MAAOrH,GAAOsH,UAAYD,GAUxB,YAActxC,GAAM3T,OACtB+8C,EAAWkH,cAAgBtwC,EAAM3T,KAAKwkD,eACtC7wC,GAAM3T,KAAKwkD,SACXrkD,EAAK48C,EAAWkH,gBAOlBrG,EAAOuH,kBAAoB,SAAS9E,GAClCtD,EAAWkH,cAAgB5D,GAG7BzC,EAAOwH,QAAU,WACfpI,EAAUK,KAAK,aAGjBN,EAAW1mC,SAAW,WACpB,MAAK0mC,GAAWkH,kBAGhBtwC,GAAM3T,KAAKG,KAAKkW,SAAS0mC,EAAWkH,gBAF3B,GAqDXrG,EAAOyH,SAAU,EACjBzH,EAAO0H,WAAY,EACnBvI,EAAW58C,KAAO,SAAS41C,GACzB,MAAK+H,GAAQ99C,KAAKulD,eAAkBxI,EAAWkH,eAG/CrG,EAAOyH,SAAU,MAEjB1xC,GAAM6xC,UAAU,WACd,MAAI5H,GAAO0H,WACT1H,EAAO0H,WAAY,OACnB1H,EAAOyH,SAAU,QAGjBllD,GAAK41C,MAVA51C,EAAK41C,IAehBgH,EAAW0I,OAAS,WAClB7H,EAAO0H,WAAY,UAO7B,WACE,YAEA3L,SACGptB,OAAO,oBACP2vB,WAAW,oBAAqB,aAAc,SAC7C,QAAS,YAAa,SAAU,WAAY,SAAU,QAAS,UAAW,SAAU,aAAc,aAClG,SAASa,EAAYa,EAAQe,EAAO3B,EAAW0I,EAAQ7H,EAAUZ,EAC/DtpC,EAAOmqC,EAAS97B,EAAQ48B,EAAYE,GA8GpC,QAAS6G,KACP/H,EAAOlpC,KAAOf,EAAM3T,KAAK0U,KAAKrU,OAAOoW,OACrCmnC,EAAOgI,WAAcllD,GAAI,EAAGwW,KAAM,gBAClC,KAAK,GAAIxZ,GAAI,EAAGA,EAAIkgD,EAAOlpC,KAAKgN,YAAahkB,IAC3CkgD,EAAOgI,SAAShiD,MAAOlD,GAAIhD,EAAE,EAAGwZ,KAAM,WAAaxZ,EAAE,KAhHzDkD,QAAQwR,MAAM,+BACdwrC,EAAOroC,OAAS,KAChBwnC,EAAWkH,cAAgB,GAC3BrG,EAAOiI,aAAe,2BACtBjI,EAAOkI,gBAAkB,GACzBlI,EAAOmI,QAAS,EAEZjI,EAAQ99C,KAAKokD,YACfxG,EAAOiI,aAAe,4BAGxB9I,EAAWG,IAAI,kBAAmB,SAAShgD,EAAO8C,GAChD69C,EAAS,WACJD,EAAOmD,YACRnD,EAAOoI,WAETL,QAIJ5I,EAAWG,IAAI,aAAc,SAAShgD,EAAO8C,GAC3C69C,EAAS,WACPD,EAAOiI,aAAe,+BAO1BjI,EAAOqI,cAAgB,WACrBrI,EAAOsI,UAAU,+BACf,2BAcJtI,EAAOwG,UAAY,WACjBpiC,GACEg6B,MAAO8C,EAAW0D,QAAQ,sBAC1B/zC,QAASqwC,EAAW0D,QAAQ,0BAC3BhzC,KAAK,WACNsuC,EAAQ99C,KAAKokD,WAAY,EACzBxG,EAAOiI,aAAe,8BAI1BjI,EAAOuI,YAAc,SAASjpD,EAAO8C,GACnC89C,EAAQ99C,KAAK0hD,YAAc5D,EAAQ99C,KAAK0hD,YAG1C9D,EAAOwI,UAAY,SAASlpD,EAAO8C,GACjC89C,EAAQ99C,KAAKwhD,UAAY1D,EAAQ99C,KAAKwhD,UAGxC5D,EAAOyI,sBAAwB,SAAS9wC,EAAQC,GAC9C7B,EAAM3T,KAAK0U,KAAKY,eAAeC,EAAQC,GACvCooC,EAAO0I,YAAc/wC,EACrBwnC,EAAWwJ,MAAM,qBAAsBhxC,IAGzCqoC,EAAO4I,kBAAoB,SAASC,GAClC3I,EAAQ99C,KAAK0mD,gBAAkBD,EAC/B1J,EAAWwJ,MAAM,iBAAkBE,IAGrC7I,EAAO+I,UAAY,SAASllC,GAC1B,GACI4I,IADQ7D,SAASC,eAAe,UAC5B5pB,OAAO0qB,SAASq/B,MACpBC,EAAUlzC,EAAM3T,KAAKG,KAAKyZ,OAC1Bm8B,EAAYpiC,EAAM3T,KAAKG,KAAKE,OAAO0mB,wBACnC9c,EAAQ68C,OAAOC,YACf18C,EAASy8C,OAAOE,aAAe,IAC/B7pD,GAAKmV,OAAOrI,MAAQA,GAAO,EAC3Bg9C,GAAK30C,OAAOjI,OAASA,GAAQ,CAEjCggB,GAAIA,EAAExS,QAAQ,OAAQ,IACtBwS,GAAK,2BAA6Bw8B,EAAU,2BAA6B9Q,EAAW,cAAgBt0B,EAEpG7gB,QAAQC,IAAI,yBAA2BwpB,EACvC,IAAI68B,GAAQrqD,OAAOsqD,KAAK98B,EAAG,iBAAmB5I,EAAW,sDAAwDxX,EAAQ,WAAaI,EAAQ,IAAalN,EAAI,QAAU8pD,EACzKC,GAAME,OAAOjqD,EAAG8pD,IAGlBrJ,EAAOyJ,YAAc,WACnB,MAAG1zC,GAAM3T,KAAKsnD,WACZ3zC,EAAM4zC,qBACC,QAEL5zC,EAAM3T,KAAK0U,MACb9T,QAAQC,IAAI,iCAAkC8S,EAAM3T,KAAK0U,MAGzDf,EAAM0zC,YAAY1zC,EAAM3T,KAAK0U,KAAKrU,OAAOoW,OAAO4O,SAGhD1R,EAAM0zC,YAAYvJ,EAAQ99C,KAAKkkD,iBAYnCtG,EAAOloC,QAAU/B,EAAM+B,QACvBkoC,EAAOjoC,UAAYhC,EAAMgC,UAEzBonC,EAAWG,IAAI,6BAA8B,SAAShgD,EAAOoE,GAC3D,GAAIkmD,GAAY,6FAChB,QAAOlmD,GACL,IAAK,oBACH27C,EAAOt4C,KAAK,uDAAwD,QAAU,MAChF,KAAK,gBACHs4C,EAAOoH,QAAQ,mDAAoDmD,EAAW,wDAAyD,WAAaC,WAAW,GAAS,MAC1K,KAAK,qBACHxK,EAAOt4C,KAAK,wDAAyD,YAM3Ek5C,EAAS,WACPj9C,QAAQC,IAAI,+BACZ+8C,EAAO8J,WAAW,gBACjB,WAMX,WACE,YAEA/N,SACGptB,OAAO,oBACP2vB,WAAW,mBAAoB,SAAU,QAAS,YAAa,QAC9D,SAAS0B,EAAQe,EAAO3B,EAAWrpC,GACjC,GAAIg0C,GAAW,WACVh0C,EAAM3T,KAAK4xC,WACZoL,EAAUK,KAAK,YAGnBsK,IAEA,IAAIzwC,GAAO8lC,EAAUuH,SAASrtC,KAC1BopC,EAAQtD,EAAUuH,SAASjE,MAC3BsH,EAAc5K,EAAUuH,SAASqD,WAErC,OAAI1wC,IAAQopC,GACV3sC,EAAM3T,KAAKkX,KAAOA,EAClBvD,EAAM3T,KAAKsgD,MAAQA,MACnB1C,GAAOp/C,OAAM,EAAMopD,KAIrBj0C,EAAM3T,KAAKkX,KAAO0mC,EAAOE,QAAQ99C,KAAKkX,KACtCvD,EAAM3T,KAAKsgD,MAAQ1C,EAAOE,QAAQ99C,KAAKsgD,UAEvC1/C,SAAQwR,MAAM,qCAOtB,WACE,YAEAunC,SACGptB,OAAO,oBACP2vB,WAAW,kBACT,SAAU,aAAc,YAAa,SAAU,WAAY,KAAM,QAAS,UAAW,cAAe,SAAU,aAAc,SAAU,aAAc,aAAc,UAAW,SAAS0B,EAAQb,EAAYC,EAAW0I,EAAQ7H,EAAUgK,EAAIl0C,EAAOmqC,EAAS+F,EAAa5G,EAAQ2B,EAAY58B,EAAQ8hC,EAAYhF,EAAYgJ,GAmN7T,QAAS5kD,GAAUu9B,EAAIzgC,GACrB,IAAG+8C,EAAWgL,iBAAd,CAGA,GAAI7pD,IACF8pD,SAAU,SACVC,UAAU,EAENrK,GAAOsK,qBACTnL,EAAWgL,iBAAmBnK,EAAOsI,UAAU,6BAA8B,6BAA8BhoD,KAIjH,QAAS8F,GAAUy8B,EAAIzgC,GAClB89C,EAAQ99C,KAAKmoD,UACdx0C,EAAM6xC,YAEJzI,EAAWgL,mBAIfhL,EAAWgL,iBAAiBrlD,QAC5Bq6C,EAAWgL,iBAAmB,MAkJhC,QAASK,KACdC,KAAKC,OAAOC,KAAKC,OAAOnsC,KAAKosC,OAAQ,OAAOC,QAAQC,GAG/C,QAASA,GAAoBC,GAElC,IAAK,GADMC,GACFnrD,EAAE,EAAGA,EAAIkrD,EAAKE,OAAOtrD,OAAQE,IACR,YAAxBkrD,EAAKE,OAAOprD,GAAGsD,OAAoB6nD,EAAeD,EAAKE,OAAOprD,GAAGkjB,MAEvEhgB,SAAQwR,MAAM,kBAAoBy2C,GAClCjoD,QAAQwR,MAAM,iBAAmBw2C,EAAKG,aACtCnoD,QAAQwR,MAAM,aAAew2C,EAAKI,MAAM/nD,KACxCL,QAAQwR,MAAMw2C,GACdhoD,QAAQwR,MAAMuB,EAAM3T,MACpB2T,EAAM3T,KAAKsgD,MAAQuI,EACnBl1C,EAAM3T,KAAKkX,KAAO0xC,EAAKG,YACvBjL,EAAQ99C,KAAKkX,KAAOvD,EAAM3T,KAAKkX,KAC/B4mC,EAAQ99C,KAAKsgD,MAAQ3sC,EAAM3T,KAAKsgD,MAEhC1C,EAAOp/C,QAkKF,QAASyqD,GAAe5nD,EAAS6nD,GAC3B7nD,EACF47C,EAAOt4C,KAAK,wCAA0CukD,EAAa,OAAQ,WAAazB,WAAW,IAEnGxK,EAAO37C,MAAM,oDAAsD,SA4BvE,QAAS6nD,GAAqBjsD,GAC5B,GAAIksD,GAAWlsD,EAAM6d,GACjBgiC,GAAWsM,sBAAwBD,EAAS/iD,MAAM,4BACpD02C,EAAWuM,WAAWF,GACtBxL,EAAO+D,eAjkBX,GAjBA/gD,QAAQwR,MAAM,6BACd2qC,EAAWwM,aAAgB3oC,MAAO,IAClCm8B,EAAWsM,sBAAuB,EAElCrrD,EAAE2V,MAAMkX,YAAc,WACpB,MAA4B,UAAxBlX,EAAM3T,KAAKwpD,WACN,EADT,QAKE1L,EAAQ99C,KAAKypD,UAAsC,YAA1B3L,EAAQ99C,KAAKypD,SACxC3K,EAAW4K,IAAI5L,EAAQ99C,KAAKypD,UAE5B3L,EAAQ99C,KAAKypD,SAAW,UAG1B1M,EAAWsE,OAASrE,EAAUuH,SAASlD,OACJ,SAA/BrE,EAAUuH,SAASnD,QAAoB,CACzCrE,EAAWqE,SAAU,EACrBzH,QAAQzxC,QAAQse,SAAS1N,MAAM6wC,SAAS,UACxC,IAAIC,GACA7T,EAAY6T,EAAU5M,EAAUuH,SAASxO,UACzCvgC,EAAWwnC,EAAUuH,SAAS9iC,SAE9BmoC,KACEp0C,IACFo0C,GAAW,WAAap0C,GAE1BunC,EAAWhH,UAAYA,EACvBgH,EAAWvnC,SAAWA,EACtBwnC,EAAUuH,SAASC,SAAWoF,GAIlC,GAAIC,GAAUrjC,SAASC,eAAe,SACtCm3B,GAAOjqC,MAAQA,EACfiqC,EAAOE,QAAUA,EACjBF,EAAO6G,aAAe9K,QAAQzxC,QAAQ,iBAAiB4hD,SAAS,UAChE/M,EAAWgE,WAAapH,QAAQzxC,QAAQ,YAAY4hD,SAAS,WAC7DlM,EAAOsK,oBAAqB,EAI5BnL,EAAW4D,aAAe,EAC1B5D,EAAW2D,WAAa,UAKxB3D,EAAWkH,cAAgB,GAGtBtwC,EAAM3T,KAAK4xC,YACdhxC,QAAQwR,MAAM,kEACd4qC,EAAUK,KAAK,MAGjBN,EAAWG,IAAI,sBAAuB,SAASzc,GAC7Cmd,EAAOp/C,OAAM,KAGfu+C,EAAWG,IAAI,iBAAkB,SAAShgD,EAAOupD,GAC3C9yC,EAAM3T,KAAKG,MACbwT,EAAM3T,KAAKG,KAAK8nB,uBAAuBw+B,EAAWwC,KAQtDlM,EAAWv+C,MAAQ,SAASurD,EAAUnC,GACrBxiD,QAAZ2kD,IACDA,GAAW,GAGK3kD,QAAfwiD,IACDA,GAAc,EAGhB,IAAIoC,GAAkB,SAAS/xC,EAAG25B,GAChCgM,EAAOkD,OAAO,WACdntC,EAAM3T,KAAK+xC,YAAa,EACpBH,IACFkM,EAAQ99C,KAAKiqD,SAAWt2C,EAAM3T,KAAKiqD,SACnCnM,EAAQ99C,KAAKkqD,MAAQv2C,EAAM3T,KAAKkqD,MAChCpM,EAAQ99C,KAAKmqD,aAAex2C,EAAM3T,KAAK4xC,UACvCkM,EAAQ99C,KAAKoqD,aAAez2C,EAAM3T,KAAK4xC,UACvCkM,EAAQ99C,KAAKkX,KAAOvD,EAAM3T,KAAKkX,KAC/B4mC,EAAQ99C,KAAKsgD,MAAQ3sC,EAAM3T,KAAKsgD,MAChCxC,EAAQ99C,KAAKxB,MAAQmV,EAAM3T,KAAKxB,MAChCs/C,EAAQ99C,KAAK01C,SAAW/hC,EAAM3T,KAAK01C,SAC/BoI,EAAQ99C,KAAKmoD,UACfx0C,EAAM6xC,YAGJuE,GAAYjM,EAAQ99C,KAAKolD,UAAYwC,EACvC5K,EAAUK,KAAK,YACN0M,GACT/M,EAAUK,KAAK,eAMrB1pC,GAAM3T,KAAK+xC,YAAa,EACxBp+B,EAAMlX,QAAQutD,IAOhBjN,EAAWlkC,OAAS,WAClB,GAAI5b,GAAa,WACf,GAAIotD,GAAqB,SAASpyC,EAAG25B,GACnChxC,QAAQwR,MAAM,8BACd0rC,EAAQwM,QACG,mBAATjC,QACVznD,QAAQwR,MAAMi2C,MACdA,KAAKkC,KAAKC,WAEFxN,EAAUK,KAAK,UAGb1pC,GAAM3T,KAAKG,MACbwT,EAAMmG,SAGR8jC,EAAOgE,YACPhE,EAAOsK,oBAAqB,EAC5Bv0C,EAAM1W,WAAWotD,GAEjB12C,EAAMmG,SAGJnG,GAAM3T,KAAKG,KACb6hB,GACEg6B,MAAO8C,EAAW0D,QAAQ,qBAC1B/zC,QAASqwC,EAAW0D,QAAQ,gCAC3BhzC,KAAK,WACNvS,MAGFA,KAQJ2gD,EAAO6M,kBAAoB,WACzB,GAAIC,GAAgBhF,EAAOyB,MACzBwD,UAAW/M,EAAOgN,kBAClB3O,YAAa,+BACbC,WAAY,2BAGdwO,GAAcnpD,OAAOiO,KACnB,SAASjO,GACPX,QAAQC,IAAIU,IAEd,WACEX,QAAQ+D,KAAK,uBAAyB,GAAIk8C,SAI9C6J,EAAcG,SAASr7C,KACrB,WACElK,OAAOwlD,SAAS/sC,UAKtBg/B,EAAWmJ,UAAY,SAASjK,EAAaC,EAAY6O,GACvD,GAAI7sD,IACFysD,UAAW/M,EAAOgN,kBAClB3O,YAAaA,EACbC,WAAYA,EAGdvC,SAAQv7C,OAAOF,EAAS6sD,EAExB,IAAIL,GAAgBhF,EAAOyB,KAAKjpD,EAiBhC,OAfAwsD,GAAcnpD,OAAOiO,KACnB,SAASjO,GACPX,QAAQC,IAAIU,IAEd,WACEX,QAAQ+D,KAAK,uBAAyB,GAAIk8C,SAI9C6J,EAAcG,SAASr7C,KACrB,WACElK,OAAOwlD,SAAS/sC,SAIb2sC,GAGT3N,EAAWG,IAAI,WAAYh6C,GAC3B65C,EAAWG,IAAI,WAAYl5C,GAE3B+4C,EAAWgL,iBA2BXnK,EAAOoN,UAAY,WACjBpN,EAAOsI,UAAU,sBAAuB,oBAG1CtI,EAAOqN,iBAAmB,WACxBrN,EAAOsI,UAAU,6BAA8B,2BAQjDnJ,EAAW7zB,KAAO,SAASm3B,GACzBz/C,QAAQC,IAAI,OAAQw/C,GACpBtD,EAAWkH,cAAgBlH,EAAWkH,cAAgB5D,EAClD1sC,EAAM3T,KAAKG,MACbwT,EAAMuV,KAAKm3B,IAOftD,EAAWmO,UAAY,WACrB,GAAI7K,GAAStD,EAAWkH,cACpBnyC,EAAMuuC,EAAO7iD,MACjBu/C,GAAWkH,cAAgB5D,EAAO/7C,UAAU,EAAGwN,EAAM,IAIvD8rC,EAAOuN,kBAAoB,WACpBvN,EAAO6G,cAIV9K,QAAQzxC,QAAQ,iBAAiBkjD,YAAY,UAC7CzR,QAAQzxC,QAAQ,yBAAyBkjD,YAAY,YAJrDzR,QAAQzxC,QAAQ,iBAAiByhD,SAAS,UAC1ChQ,QAAQzxC,QAAQ,yBAAyByhD,SAAS,WAKpD/L,EAAO6G,aAAe9K,QAAQzxC,QAAQ,iBAAiB4hD,SAAS,WAGlElM,EAAOyN,WAAa,WACdtO,EAAWgE,YAAwC,SAA1BhE,EAAW2D,aACtC3D,EAAW4D,aAAe,GAE5BhH,QAAQzxC,QAAQ,YAAYojD,YAAY,WACxCvO,EAAWgE,WAAapH,QAAQzxC,QAAQ,YAAY4hD,SAAS,WAC7DyB,mBAGFxO,EAAWiJ,SAAW,WACpBjJ,EAAWgE,YAAa,EACxBpH,QAAQzxC,QAAQ,YAAYkjD,YAAY,YAG1CxN,EAAOgE,UAAY,WACjB7E,EAAWgE,YAAa,EACxBpH,QAAQzxC,QAAQ,YAAYyhD,SAAS,YAGvC/L,EAAO4N,eAAiB,WACtB,GAAIC,GAAa9R,QAAQzxC,QAAQse,SAASw4B,cAAc,aACxDyM,GAAWH,YAAY,WACvBvO,EAAWwJ,MAAM,kBAAmBkF,EAAW3B,SAAS,aAG1DlM,EAAO8N,cAAgB,WACrB,GAAID,GAAa9R,QAAQzxC,QAAQse,SAASw4B,cAAc,aACpDyM,GAAW3B,SAAS,aACtB2B,EAAWL,YAAY,WACvBrO,EAAWwJ,MAAM,kBAAmBkF,EAAW3B,SAAS,cAI5DlM,EAAO+N,aAAe,WACY,cAA5B7N,EAAQ99C,KAAK6kD,aAGjB9H,EAAW6O,mBAAqBhN,EAAWiN,YACvCjN,EAAWiN,YACbjN,EAAW6G,SAEX7G,EAAWkN,OAAOtlC,SAASulC,qBAAqB,QAAQ,MAI5DhP,EAAWG,IAAI,aAAc,SAAShgD,GACpC4gD,EAAQ99C,KAAKokD,WAAY,IAG3BrH,EAAWG,IAAI,cAAe,SAAShgD,EAAO8C,GACxC4+C,EAAWiN,aACbjN,EAAW6G,SAGR1I,EAAWgE,aACdpH,QAAQzxC,QAAQ,YAAYojD,YAAY,WACxCvO,EAAWgE,WAAapH,QAAQzxC,QAAQ,YAAY4hD,SAAS,YAG/D/M,EAAWkH,cAAgB,GAC3BrjD,QAAQwR,MAAM,gCACd4qC,EAAUK,KAAK,WAEf,KACEN,EAAWiP,UACX,MAAOrrD,GACPC,QAAQC,IAAI,iBAIhBk8C,EAAWG,IAAI,cAAe,SAAShgD,EAAO8C,GAC5C,GAAIisD,GAAc,WAChB,MAAOpE,GAAG,SAASv4C,EAASmmB,GACtBqoB,EAAQ99C,KAAKksD,eACflqC,GACEg6B,MAAO8C,EAAW0D,QAAQ,qBAC1B/zC,QAASqwC,EAAW0D,QAAQ,8BAC3BhzC,KAAK,WACN5O,QAAQC,IAAI,2BACZm8C,EAAUK,KAAK,YACd,WACDS,EAAQ99C,KAAK6kD,WAAa,aAC1BlxC,EAAMmG,YAGRlZ,QAAQC,IAAI,2BACZm8C,EAAUK,KAAK,YAEjB/tC,MAGJw0C,GAAWqI,OAAOvoD,KAAKqoD,KAGzBrO,EAAOV,IAAI,mCAAoC,SAAUhgD,EAAMkvD,GAE7DxrD,QAAQC,IAAI,yBACnBD,QAAQC,IAAIurD,GACZ/D,KAAKC,OAAO+D,KAAK,OAAQ,KAAMjE,KAyB1BxK,EAAOV,IAAI,mCAAoC,SAAUhgD,EAAMkvD,GAE7DxrD,QAAQC,IAAI,2BAGdk8C,EAAWuP,WAAa,SAAStsD,EAAMK,GACrCsT,EAAM3T,KAAKwhD,SAAW1D,EAAQ99C,KAAKwhD,SACnC7tC,EAAM3T,KAAK0hD,WAAa5D,EAAQ99C,KAAK0hD,WAEhC5D,EAAQ99C,KAAKgkD,WAChBlG,EAAQ99C,KAAKusD,WAAa,GAAI1L,OAEhC/C,EAAQ99C,KAAK6kD,WAAa,WAC1B,IAAI0H,GAAa,GAAI1L,MAAK/C,EAAQ99C,KAAKusD,WACvCxP,GAAWyP,WAAaD,EAExB1O,EAAS,WACPD,EAAO8J,WAAW,iBAEpBmC,EAAQh1C,OACRipC,EAAQ99C,KAAK8kD,SAAU,EAEvBhH,EAAQ99C,KAAKgkD,SAAW,EAExBhH,EAAUK,KAAK,WAEZh9C,EAAOsH,UACRo1C,EAAWwJ,MAAM,aAAc,UAInCxJ,EAAWG,IAAI,cAAe,SAAShgD,EAAO8C,EAAMK,GAClD08C,EAAWuP,WAAWtsD,EAAMK,KAG9B08C,EAAWG,IAAI,eAAgB,SAAShgD,EAAO8C,GAC7C89C,EAAQ99C,KAAK8kD,SAAU,IAGzB/H,EAAWG,IAAI,gBAAiB,SAAShgD,EAAO8C,GAC9CY,QAAQC,IAAI,uBAAyBb,GAErC89C,EAAQ99C,KAAKgkD,SAAW,EACxBpG,EAAO6O,cAAe,EACtB3O,EAAQ99C,KAAKokD,WAAY,EACzBtG,EAAQ99C,KAAK0hD,YAAa,EAC1B5D,EAAQ99C,KAAKwhD,UAAW,EAExBx/B,GACEg6B,MAAO8C,EAAW0D,QAAQ,uBAC1B/zC,QAASqwC,EAAW0D,QAAQ,yBAA2BxiD,IACtDwP,KAAK,WACN,GAAI+8C,GAAa,GAAI1L,MAAK/C,EAAQ99C,KAAKusD,WACvCxP,GAAWyP,WAAaD,EACxB3rD,QAAQC,IAAIk8C,EAAWyP,YAEvB5O,EAAO8O,aACP5O,EAAQ99C,KAAKkkD,cAAgBlkD,EAC7B6jD,EAAY9nC,IAAI/b,EAAM,WAAW,GACjCg9C,EAAUK,KAAK,YACd,WACDO,EAAO+O,cACP9I,EAAY9nC,IAAI/b,EAAM,WAAW,OAIrC49C,EAAOl0B,KAAO,WACZo0B,EAAQ99C,KAAK+jD,QAAUjG,EAAQ99C,KAAK+jD,OACpCpwC,EAAM3T,KAAKG,KAAKypB,cAMlBg0B,EAAO9jC,OAAS,WACd,MAAKnG,GAAM3T,KAAKG,KAMZ48C,EAAWqE,YACbvkD,QAAO6F,SAaLiR,EAAM3T,KAAKsnD,WACb3zC,EAAM4zC,oBAGR5zC,EAAMmG,SAENijC,EAAWwJ,MAAM,kBACjBvJ,GAAUK,KAAK,cA1BbJ,EAAOoH,QAAQvF,EAAW0D,QAAQ,+BAClCxF,GAAUK,KAAK,cA4BnBO,EAAO8O,WAAa,WAClB5O,EAAQ99C,KAAK+jD,QAAS,EAEtBpwC,EAAM3T,KAAKG,KAAKkR,QACdjB,UAAW0tC,EAAQ99C,KAAKoQ,UACxB/G,UAAWy0C,EAAQ99C,KAAK4sD,cACxBjlD,SAAUm2C,EAAQ99C,KAAK2H,SACvBe,OAAQo1C,EAAQ99C,KAAK0I,OACrBue,eAAgBtT,EAAM3T,KAAKkX,KAC3BgQ,iBAAkBvT,EAAM3T,KAAKxB,QAI/Bw+C,EAAUK,KAAK,YAGjBO,EAAO+O,YAAc,WACnB/O,EAAO9jC,SACP8jC,EAAO6O,cAAe,GAGxB7O,EAAO/oC,KAAO,WACD+oC,EAAOH,YAAYqB,EAAW0D,QAAQ,0BAA2B,GAAI,OAC9E,SAAS1tC,GACPnB,EAAM3T,KAAK0U,KAAKG,KAAKC,GACrBlU,QAAQC,IAAI,cAAeiU,MAKjC8oC,EAAOlvC,KAAO,WACZiF,EAAM3T,KAAK0U,KAAKhG,QAGlBkvC,EAAO1oC,OAAS,WACH0oC,EAAOH,YAAYqB,EAAW0D,QAAQ,0BAA2B,GAAI,OAC9E,SAAS1tC,GACPnB,EAAM3T,KAAK0U,KAAKQ,OAAOJ,GACvBlU,QAAQC,IAAI,mBAAoBiU,MAItC8oC,EAAOzoC,WAAa,WAClBxB,EAAM3T,KAAK0U,KAAKS,cAGlByoC,EAAOxoC,SAAW,WACLwoC,EAAOH,YAAYqB,EAAW0D,QAAQ,0BAA2B,GAAI,OAC9E,SAAS1tC,GACPnB,EAAM3T,KAAK0U,KAAKU,SAASN,GACzBlU,QAAQC,IAAI,kBAAmBiU,MAYrCioC,EAAWuM,WAAa,SAASjJ,GAC/BtD,EAAWwM,YAAY3oC,MAAQm8B,EAAWwM,YAAY3oC,MAAQy/B,EAC1D1sC,EAAM3T,KAAKG,MACbwT,EAAMuV,KAAKm3B,IAIftD,EAAWsG,qBAAuB,WAChCtG,EAAWsM,sBAAuB,GAGpCtM,EAAWuG,oBAAsB,WAC/BvG,EAAWsM,sBAAuB,GAGpCtM,EAAWG,IAAI,oBAAqB,SAAShgD,EAAOigD,EAAMC,GACtB,YAA9BD,EAAKI,QAAQsP,cACf9P,EAAWwM,YAAY3oC,MAAQ,GAC/B+4B,QAAQzxC,QAAQ4/C,GAASn9B,KAAK,UAAWw+B,IAEzCxP,QAAQzxC,QAAQ4/C,GAASgF,OAAO,UAAW3D,WAiBrD,WACE,YAEAxP,SACGptB,OAAO,oBACV2vB,WAAW,kBAAmB,SAAU,QAAS,YAChD,QAAS,UAAW,aACpB,SAAS0B,EAAQe,EAAO3B,EAAWrpC,EAAOmqC,EAASf,GACjDn8C,QAAQwR,MAAM,6BACbwrC,EAAOE,QAAUA,EAEjBf,EAAWG,IAAI,YAAa,SAASv8C,EAAGX,GACtC,GAAI+sD,GAAUjP,EAAQ99C,KAAK+sD,QAC9BC,EAAM,CAEHpP,GAAOqP,SAAWjtD,EAAK+E,QACvB64C,EAAOsP,OAASltD,EAAK8E,MAEjB9E,EAAK+E,QAAU,KACjBioD,IAGEhtD,EAAK8E,MAAQ,KACdkoD,IAGHpP,EAAOuP,UAAY,qCAET,EAANH,EACDpP,EAAOuP,UAAY,sCACL,EAANH,IACRpP,EAAOuP,UAAY,oCAGtBx5C,EAAMy5C,aAAa9/C,QAAQ,SAASme,GAC9BA,EAAI/qB,IAAMqsD,IACZnP,EAAOyP,OAAS5hC,EAAIH,SAIxBsyB,EAAOkD,iBAOf,WACE,YAEAnH,SACGptB,OAAO,oBACP2vB,WAAW,0BAA2B,SACrC,iBACA,SAAS0B,EAAQ0P,GAEf1P,EAAOz/B,GAAK,WACVmvC,EAAe5qD,MAAM,QAGvBk7C,EAAO6H,OAAS,WACd6H,EAAeC,QAAQ,iBAMjC,WACE,YAQE,SAASC,GAA2BzQ,EAAYa,EAAQE,EAASnqC,GAK/D,QAAS85C,KACH1Q,EAAWgL,kBAAoBp0C,EAAM3T,KAAK0tD,WAC5C/5C,EAAM3T,KAAK0tD,SAASl3C,UAAU9S,eAC9Bq5C,EAAWgL,iBAAiBrlD,cACrBiR,GAAM3T,KAAK0tD,UARtB9sD,QAAQwR,MAAM,wCAEdwrC,EAAO6P,eAAiBA,EAT5B9T,QACGptB,OAAO,oBACP2vB,WAAW,6BAA8BsR,GAE1CA,EAA2BG,SAAW,aAAc,SAAU,UAAW,YAmB7E,WACE,YAEAhU,SACGptB,OAAO,oBACP2vB,WAAW,mCAAoC,SAC9C,QAAS,YAAa,iBAAkB,QAAS,UACjD,SAAS0B,EAAQe,EAAO3B,EAAWsQ,EAAgB35C,EAAOmqC,GACxDl9C,QAAQwR,MAAM,8CAEdwrC,EAAOjqC,MAAQA,EACfiqC,EAAOE,QAAUA,EAEjBF,EAAOz/B,GAAK,WACVmvC,EAAe5qD,MAAM,QAGvBk7C,EAAO6H,OAAS,WACd6H,EAAeC,QAAQ,WAGzB55C,EAAM3T,KAAKkX,KAAO4mC,EAAQ99C,KAAKkX,KAC/BvD,EAAM3T,KAAKsgD,MAAQxC,EAAQ99C,KAAKsgD,YAOxC,WACE,YAEA3G,SACGptB,OAAO,oBACP2vB,WAAW,sBAAuB,SAAU,QAC3C,YAAa,aAAc,UAAW,QAAS,aAAc,SAAU,kBACvE,SAAS0B,EAAQe,EAAO3B,EAAWD,EAAYe,EAASnqC,EAAOmrC,EAAY7B,EAAQnB,GACjFl7C,QAAQwR,MAAM,sCAEdpU,EAAE8sD,SAAS/sC,OAEX6/B,EAAOgQ,eAAqE,mBAA7CpnC,UAASC,eAAe,UAAUyB,OACjE01B,EAAOE,QAAUA,EACjBF,EAAOjqC,MAAQA,EACfiqC,EAAOiQ,OAASlU,QAAQmU,KAAKhQ,EAAQ99C,MACrC49C,EAAO/D,UAAYiC,EAAgBjC,UACnC+D,EAAO/D,UAAUkU,SAASrtD,GAAI,UAAWwW,KAAO4nC,EAAW0D,QAAQ,sBACnE5E,EAAOiQ,OAAOpE,SAAW3L,EAAQ99C,KAAKypD,UAAY,UAElD1M,EAAWG,IAAI,0BAA2B,WACxC4B,EAAW,oBAAoBtvC,KAAK,SAAUw+C,GAC9CpQ,EAAO/D,UAAU,GAAG3iC,KAAO82C,MAI7BjR,EAAWG,IAAI,kBAAmB,SAASv8C,EAAGyrB,GACxCA,EACFwxB,EAAOiQ,OAASlU,QAAQmU,KAAKhQ,EAAQ99C,MAErC49C,EAAOz/B,OAIXy/B,EAAOz/B,GAAK,WACVvd,QAAQC,IAAI,qBAAsB+8C,EAAOiQ,OAAOjB,cAAehP,EAAOjqC,MAAM3T,KAAK+qB,cAEjF4uB,QAAQrsC,QAAQqG,EAAM3T,KAAK+qB,aAAc,SAAS3hB,GAChDxI,QAAQC,IAAI,kBAAmBuI,GAC3BA,EAAM1I,IAAMk9C,EAAOiQ,OAAOjB,gBAC5BhP,EAAOiQ,OAAOI,kBAAoB7kD,EAAMkiB,MACxC1qB,QAAQC,IAAI,gCAAiCuI,EAAMkiB,UAGnDsyB,EAAOiQ,OAAOnH,iBAAmB5I,EAAQ99C,KAAK0mD,iBAChD3J,EAAWwJ,MAAM,iBAAkB3I,EAAOiQ,OAAOnH,iBAEnD5I,EAAQoQ,WAAWtQ,EAAOiQ,QAC1Bl6C,EAAM3T,KAAK0tD,SAAS3gD,WAAW+wC,EAAQ99C,KAAKmuD,SAExCrQ,EAAQ99C,KAAKmoD,UACfvK,EAAO4H,WAGT,IAAI38C,IACFulD,qBAA4DhpD,SAAtC04C,EAAQ99C,KAAKouD,sBAAqC,EAAOtQ,EAAQ99C,KAAKouD,qBAC5FC,qBAA4DjpD,SAAtC04C,EAAQ99C,KAAKquD,sBAAqC,EAAOvQ,EAAQ99C,KAAKquD,qBAC5FC,mBAAwDlpD,SAApC04C,EAAQ99C,KAAKsuD,oBAAmC,EAAOxQ,EAAQ99C,KAAKsuD,mBACxFC,oBAA0DnpD,SAArC04C,EAAQ99C,KAAKuuD,qBAAoC,EAAOzQ,EAAQ99C,KAAKuuD,oBAC1FC,qBAA2DppD,SAArC04C,EAAQ99C,KAAKuuD,qBAAoC,EAAOzQ,EAAQ99C,KAAKuuD,oBAE7F56C,GAAM3T,KAAK0tD,SAASxvD,QAAQ2K,YAAcA,GAI5C+0C,EAAO6Q,gBAAkB,SAASC,GAChC,GAAgB,YAAZA,EAAsB,CACzB5Q,EAAQ99C,KAAKypD,SAAW,SACvB,IAAIkF,GAAc7P,EAAWpC,mBAC7BoC,GAAW4K,IAAIiF,GAAan/C,KAC1B,SAASo/C,KAAU,SAASC,GAC1B/P,EAAW4K,IAAI,YAGnB5K,GAAW4K,IAAIgF,GACf5Q,EAAQ99C,KAAKypD,SAAWiF,GAI5B9Q,EAAOkR,kBAAoB,WACzB,MAAOn7C,GAAMsY,kBAGf2xB,EAAOmR,YAAc,WACnB,GAAItD,GAAa9R,QAAQzxC,QAAQse,SAASw4B,cAAc,aAExD,OADAyM,GAAWH,YAAY,WAClB33C,EAAM3T,KAAKG,SAKd88C,GAAOoH,QAAQvF,EAAW0D,QAAQ,iCAJlCxF,GAAUK,KAAK,aAQnBO,EAAO4H,UAAY,WAIjB,QAAS/lD,GAAGO,GACV49C,EAAOiQ,OAAOd,QAAUjP,EAAQ99C,KAAK+sD,QACrCnP,EAAOoR,SAAW,OAAShvD,EAAK8E,MAAQ,UAAY9E,EAAK+E,QACzD64C,EAAOqR,gBAAiB,EACxBrR,EAAOkD,SANT,MADAlD,GAAOqR,gBAAiB,EACjBt7C,EAAM6xC,UAAU/lD,IAUzBm+C,EAAOsR,cAAgB,WACxBllD,QAAQ,6BACH8zC,EAAQqR,eACRvR,EAAO/kC,SACdhc,OAAO0qB,SAASC,WAIbo2B,EAAOwR,cAAgB,SAASC,GAC9BzR,EAAOiQ,OAAOyB,WAAY,CAC1B,IAAIC,GAAUnC,aAAaA,aAAa5vD,OAAO,EAC/CogD,GAAOiQ,OAAOd,QAAUwC,EAAQ7uD,GAChCo9C,EAAQ99C,KAAK+sD,QAAUwC,EAAQ7uD,GAC/BiT,EAAM3T,KAAK0tD,SAAS/kD,aAClBwB,SAAUolD,EAAQtlD,MAClBK,UAAWilD,EAAQllD,OACnBD,SAAUmlD,EAAQtlD,MAClBM,UAAWglD,EAAQllD,OACnBR,aAAc,GACdD,mBAAoBk0C,EAAQ99C,KAAK2J,gBAEnCm0C,EAAQ99C,KAAK+sD,QAAUwC,EAAQ7uD,GAC1B2uD,EAMHzR,EAAOiQ,OAAOtI,eAAgB,GAL9B3H,EAAOiQ,OAAO2B,kBAAoB,UAClC5R,EAAOiQ,OAAO4B,kBAAoB,UAClC7R,EAAOiQ,OAAOtI,eAAgB,IAOlC3H,EAAO8R,yBAA2B,SAASL,GACO,KAA3C,IAAK,UAAW,QAAQtpD,QAAQspD,GACnCzR,EAAOiQ,OAAOyB,WAAY,EAE1B1R,EAAOiQ,OAAOyB,WAAY,GAI9B1R,EAAO+R,kBAAoB,SAASC,GAClC,GAAIntD,GAAIotD,gBAAgBD,GAAmB,MACvCn9C,EAAIo9C,gBAAgBD,GAAoB,MAC5C9R,GAAQ99C,KAAK+sD,QAAU6C,EACvBj8C,EAAM3T,KAAK0tD,SAAS/kD,aAClBwB,SAAU1H,EACV6H,UAAWmI,EACXrI,SAAU3H,EACV8H,UAAWkI,EACX5I,aAAc,GACdD,mBAAoBk0C,EAAQ99C,KAAK2J,uBAU7C,WACE,YAEAgwC,SACGptB,OAAO,oBACP2vB,WAAW,qBAAsB,aAAc,SAC9C,QAAS,YAAa,SAAU,WAAY,SAAU,QAAS,UAAW,SAAU,aAAc,aAClG,SAASa,EAAYa,EAAQe,EAAO3B,EAAW0I,EAAQ7H,EAAUZ,EAC/DtpC,EAAOmqC,EAAS97B,EAAQ48B,EAAYE,GA4CpC,QAASgR,GAAUnpD,GACjB,GAAqB,kBAAVA,GACTA,EAAO+H,WAEP,IAAI/H,EAAO2gB,OAAQ,CACjB,GAAI1Y,GAASjI,EAAOkI,WACpBD,GAAOtB,QAAQ,SAASC,EAAOyQ,GAC7BzQ,EAAMmB,UAKd,QAAS6L,GAAY5T,GACfopD,GACFD,EAAUC,GAGZA,EAAYppD,EACZyB,uBAAuBY,EAAYrC,GAC/B7K,IACFk0D,EAAoBl0D,EAAam0D,wBAAwBtpD,GACzDupD,EAAQr0D,iBAAiBC,GACzBk0D,EAAkBvzD,QAAQyzD,IAhE9BtS,EAAOE,QAAUA,EACjBl9C,QAAQwR,MAAM,+BACd,IAAIpJ,GAAawd,SAASC,eAAe,gBACrC0pC,EAAU3pC,SAASw4B,cAAc,sBACjCmR,KACFA,EAAUA,EAAQC,UAGpBxS,EAAO50C,WAAa,WAClB,GAAIG,IACFknD,UAAU,EACV5nD,OACEoC,WAAaH,SAAUozC,EAAQ99C,KAAKswD,kBAIpCC,EAAY58C,EAAM3T,KAAK+qB,aAAaqI,KAAK,SAASo9B,GACpD,MAAOA,GAAO9vD,IAAMo9C,EAAQ99C,KAAK4sD,eAGnC9O,GAAQ99C,KAAK4sD,cAAgB2D,EAAU7vD,GACvCo9C,EAAQ99C,KAAKiuD,kBAAoBsC,EAAUjlC,MAEtB,SAAjBilC,EAAU7vD,KACZyI,EAAYC,OACVyB,WAAaH,SAAU6lD,EAAU7vD,OAIrCqH,UAAUmB,aAAaC,EAAaoR,EAAa,SAASzY,EAAK9B,MAIjE,IAAIlE,GAAe,IACS,oBAAjB20D,gBACT30D,EAAe,GAAI20D,cAGrB,IAAIT,GAAoB,KACpBE,EAAQ,KACRH,IA6CJnS,GAAOkR,kBAAoB,WAC1B,MAAOn7C,GAAMsY,kBAGd2xB,EAAOwG,UAAY,WACjBpiC,GACEg6B,MAAO8C,EAAW0D,QAAQ,sBAC1B/zC,QAASqwC,EAAW0D,QAAQ,0BAC3BhzC,KAAK,WACNsuC,EAAQ99C,KAAKokD,WAAY,EACzBxG,EAAOiI,aAAe,8BAI1BjI,EAAOuI,YAAc,SAASjpD,EAAO8C,GACnC89C,EAAQ99C,KAAK0hD,YAAc5D,EAAQ99C,KAAK0hD,YAG1C9D,EAAOwI,UAAY,SAASlpD,EAAO8C,GACjC89C,EAAQ99C,KAAKwhD,UAAY1D,EAAQ99C,KAAKwhD,UAGxC5D,EAAOyI,sBAAwB,SAAS9wC,GACtC5B,EAAM3T,KAAK0U,KAAKY,eAAeC,IAGjCqoC,EAAO8S,WAAa,WAClB1nD,EAAWyvC,IAAM,KACb38C,IACFo0D,EAAMlzD,WACNkzD,EAAM9zD,eAAiB,MAEzB0zD,EAAUC,GACV/S,EAAUK,KAAK,YACfS,EAAQ99C,KAAKolD,SAAU,GAGzBxH,EAAO50C,mBAKf,WACI,YAEA2wC,SACKptB,OAAO,oBACP2vB,WAAW,qBAAsB,aAAc,SAAU,YAAa,YAAa,QAChF,SAASa,EAAYa,EAAQZ,EAAW2T,EAAWh9C,GAC/C/S,QAAQC,IAAI,qBACZ,IAAI+vD,EAEJhT,GAAOiT,aAAe,WAClBF,EAAUlL,OAAOmL,IAGrBA,EAASD,EAAU,WACbh9C,EAAM3T,KAAK8wD,gBACblT,EAAOiT,eACP7T,EAAUK,KAAK,cAEhB,WAMnB,WACE,YACsB1D,SAAQptB,OAAO,yBAOvC,WACE,YAEAotB,SACCptB,OAAO,mBACPwkC,UAAU,aAAc,WACvB,SAAUlT,GACR,OACEmT,SAAU,IACV7S,KAAM,SAAUP,EAAQqT,GACtBpT,EAAS,WACPoT,EAAS,GAAGC,kBAOxB,WACE,YAEAvX,SACCptB,OAAO,mBACPwkC,UAAU,gBACV,aAAc,SAASnS,GACtB,GAAIT,GAAO,SAASgT,EAAOjpD,EAASkpD,GAClC,GAAI1zD,GAAI,IACR4H,QAAO,iBAAiB+rD,OAAO,QAC/B/rD,OAAO,wBAAwB+rD,OAAO,QACtCnpD,EAAQopD,SAAS3mC,KAAK,YAAa,WAC7Bi0B,EAAWiN,cACb/oD,aAAapF,GACb4H,OAAO,iBAAiB+rD,OAAO,QAC/B/rD,OAAO,wBAAwB+rD,OAAO,KACtC3zD,EAAI0F,WAAW,WACTw7C,EAAWiN,cACbvmD,OAAO,iBAAiBisD,QAAQ,QAChCjsD,OAAO,wBAAwBisD,QAAQ,OAExC,QAGPrpD,EAAQopD,SAAS3mC,KAAK,aAAc,WAClCrlB,OAAO,iBAAiB+rD,SACxB/rD,OAAO,wBAAwB+rD,WAKnC,QACElT,KAAMA,SAKZ,WACE,YAEAxE,SACCptB,OAAO,mBAAmBwkC,UAAU,aACrC,WACE,GAAI5S,GAAO,SAASgT,EAAOjpD,EAASkpD,GAClCD,EAAM1Q,OAAO,YAAa,SAAS+Q,GACjCtpD,EAAQkjD,YAAY,aACpBljD,EAAQkjD,YAAY,gBACpBljD,EAAQkjD,YAAY,cAEpBljD,EAAQyhD,SAAS6H,KAKrB,QACEL,OACEK,UAAa,KAEfrT,KAAMA,QAcZ,WACE,YAEAxE,SACCptB,OAAO,mBACPwkC,UAAU,WACX,WAEE,QAAS5S,GAAKgT,EAAOjpD,EAASkpD,GAE5BxwD,QAAQC,IAAI,+BACZ,IAAI4wD,GAAYnsD,OAAO,WAEnBosD,EAAYlrC,SAASmrC,uBAAuB,oBACrDD,GAAU,GAAG/Y,YAAYnyB,SAASC,eAAe,WAEjDzoB,EAAE,WAAW4zD,OAAO,WAChBrG,oBAGJvtD,EAAEnB,QAAQ+0D,OAAO,WACbrG,oBAGJA,kBAEAkG,EAAUrG,YAAY,QACtBqG,EAAUI,IAAI,UAAW,SAEpBV,EAAM7E,WAAW,IAAK3kD,UAAU,IAEhCO,EAAQ4I,GAAG,WAAY,WAErBlQ,QAAQC,IAAI,kCACZ4wD,EAAU9H,SAAS,QAAQmI,SAASxsD,OAAO,SAC3CtH,EAAEnB,QAAQiwD,OAAO,YAIrB,OACE3O,KAAMA,QAMZ,WACE,YACmBxE,SAAQptB,OAAO,sBAGpC,WACE,YAEAotB,SACCptB,OAAO,gBACP6J,OAAO,YAAa,WACnB,GAAI27B,GAAQ,gFACRC,EAAU,iGAEd,OAAO,UAAUj8C,EAAM9L,EAAOkS,GAC5B,GAAIze,GAAI,CACRuM,GAAQA,GAAS,IACd+nD,EAAQC,KAAKl8C,KACdA,EAAOA,EAAK8B,QAAQm6C,EAAS,6DAA8D/nD,EAAO,0CAGpG,GACE8L,GAAOA,EAAK8B,QAAQk6C,EAAO,+CAAgD9nD,EAAO,4BAC1EkS,GAAMA,GAAKze,IAAMye,IAAO41C,EAAME,KAAKl8C,GAE7C,OAAOA,SAOb,WACE,YACmB4jC,SAAQptB,OAAO,qBAMpC,IAAI6gC,iBACA8E,qBACFxxD,GAAI,QACJ4qB,MAAO,gBACPrhB,MAAO,IACPI,OAAQ,MAER3J,GAAI,OACJ4qB,MAAO,eACPrhB,MAAO,IACPI,OAAQ,MAER3J,GAAI,MACJ4qB,MAAO,cACPrhB,MAAO,IACPI,OAAQ,MAER3J,GAAI,YACJ4qB,MAAO,oBACPrhB,MAAO,IACPI,OAAQ,MAER3J,GAAI,WACJ4qB,MAAO,mBACPrhB,MAAO,IACPI,OAAQ,MAER3J,GAAI,KACJ4qB,MAAO,cACPrhB,MAAO,KACPI,OAAQ,MAER3J,GAAI,MACJ4qB,MAAO,gBACPrhB,MAAO,KACPI,OAAQ,OAGNwlD,iBACFsC,OACEloD,MAAO,IACPI,OAAQ,KAEV+nD,MACEnoD,MAAO,IACPI,OAAQ,KAEVgoD,KACEpoD,MAAO,IACPI,OAAQ,KAEVioD,WACEroD,MAAO,IACPI,OAAQ,KAEVkoD,UACEtoD,MAAO,IACPI,OAAQ,KAEVmoD,IACEvoD,MAAO,KACPI,OAAQ,KAEVooD,KACExoD,MAAO,KACPI,OAAQ,OAIRqsC,YACFh2C,GAAI,MACJ4qB,MAAO,UAEP5qB,GAAI,MACJ4qB,MAAO,UAEP5qB,GAAI,OACJ4qB,MAAO,QAEP5qB,GAAI,OACJ4qB,MAAO,UAEP5qB,GAAI,OACJ4qB,MAAO,QAEP5qB,GAAI,OACJ4qB,MAAO,QAEP5qB,GAAI,OACJ4qB,MAAO,QAEP5qB,GAAI,OACJ4qB,MAAO,QAEP5qB,GAAI,IACJ4qB,MAAO,aAEP5qB,GAAI,UACJ4qB,MAAO,mBAGLonC,YACFhyD,GAAI,KACJ4qB,MAAO,WAEP5qB,GAAI,KACJ4qB,MAAO,WAEP5qB,GAAI,KACJ4qB,MAAO,WAGLqnC,UAEApH,gBAAkB,SAASqH,GACtBA,IAAIA,EAAK,KAEd9vD,aAAa6vD,WACbA,UAAYvvD,WAAW,WACnB,GAAIquD,GAAYnsD,OAAO,UACvBmsD,GAAUxnD,MAAM,IAChBwnD,EAAUpnD,OAAO,GAEjB,IAEIwoD,GAAOC,EAFPrwD,EAAIgvD,EAAUxnD,QACdwI,EAAIg/C,EAAUpnD,SAEd0oD,EAAStwD,EAAIgQ,EACbugD,EAAiB1tD,OAAO,oBACxB7C,GAAIgQ,GACJogD,EAAQG,EAAe/oD,QACvB6oD,EAAQn1D,KAAKs1D,MAAMD,EAAe/oD,QAAU8oD,KAE5CD,EAAQE,EAAe3oD,SACvBwoD,EAAQl1D,KAAKs1D,MAAMD,EAAe3oD,SAAW0oD,IAEjDtB,EAAUxnD,MAAM4oD,GAChBpB,EAAUpnD,OAAOyoD,GACjBlyD,QAAQC,IAAI,yBAA2BgyD,EAAQ,IAAMC,IACtDF,IAGHM,aAAevZ,QAAQptB,OAAO,gBAAiB,aAEnD2mC,cAAaC,QAAQ,SAAU,aAAc,eAAgB,YAAa,UACxE,SAASpW,EAAYqW,EAAcpW,EAAWc,GAmC5C,QAASuV,GAAeC,GACtBtzD,EAAKsnD,UAAY,KACjBtnD,EAAKwpD,UAAY,SACjB8J,EAAKrnC,iBAGP,QAASsnC,KACPvzD,EAAKG,KAAO,KACZH,EAAKwpD,UAAY,KACjBxpD,EAAK0U,KAAO,KACZ1U,EAAKwzD,eACLxzD,EAAK8hD,SAAW,KAChB9hD,EAAKyzD,aAAe,KAEpB1W,EAAWwJ,MAAM,cAAe,UAOlC,QAAS+F,GAAWoH,EAAYrzD,GAC9B08C,EAAWwJ,MAAM,cAAemN,EAAYrzD,GAG9C,QAASykD,KACP/H,EAAWwJ,MAAM,eAAgB,WAGnC,QAASkG,GAAapM,GACpBtD,EAAWwJ,MAAM,gBAAiBlG,GAGpC,QAASsT,GAAkBC,GA0BzB,MAzBAhzD,SAAQwR,MAAM,0DAIdxR,QAAQwR,MAAM,cAAgB8/C,mBAAmB10D,QACjDoD,QAAQwR,MAAMwhD,GAEdja,QAAQrsC,QAAQ4kD,mBAAoB,SAAStC,EAAYlvD,GACvDi5C,QAAQrsC,QAAQsmD,EAAsB,SAAS5gD,GAC7C,GAAI/I,GAAQ+I,EAAI,GACZ3I,EAAS2I,EAAI,EAEd48C,GAAW3lD,OAASA,GAAS2lD,EAAWvlD,QAAUA,GACnD+iD,aAAaxpD,KAAKgsD,OAMxBhvD,QAAQwR,MAAM,gBAAkBg7C,aAAa5vD,QAC7CwC,EAAKotD,aAAeA,aACpBxsD,QAAQwR,MAAMg7C,cACdptD,EAAK+sD,QAAWK,aAAa5vD,OAAS,EAAK4vD,aAAaA,aAAa5vD,OAAS,GAAGkD,GAAK,KACtFE,QAAQwR,MAAMpS,EAAK+sD,SAEZK,aA7FT,GAAIptD,IAEF0tD,SAAU,KACV9b,WAAW,EAGXzxC,KAAM,KACNmnD,UAAW,KACXkC,UAAW,KACX90C,KAAM,KACN8+C,eACA1R,SAAU,KACV2R,aAAc,KACd12C,UAAW,KAGXgO,gBACA8oC,gBACAC,gBACA1G,gBACArX,UAAWqd,EAAa/2C,IAAI,kBAC5BnF,KAAMk8C,EAAa/2C,IAAI,mBACvBikC,MAAO8S,EAAa/2C,IAAI,oBACxBuH,IAAKwvC,EAAa/2C,IAAI,kBACtB03C,OAAQX,EAAa/2C,IAAI,sBAAwB,OACjD7d,MAAO40D,EAAa/2C,IAAI,qBAAuB,OAC/Cq5B,SAAU0d,EAAa/2C,IAAI,sBAAwB,OACnD4tC,SAAUptD,OAAO0qB,SAAS0iC,SAC1BC,MAAQ,SAAWrtD,OAAO0qB,SAAS0iC,SAAW,QAC9C9mD,cAAe,KACf2J,WAAY,KACZgkD,eAAe,GAiEbtH,GACF9zC,SAAS,EACTC,WAAW,EAGb,QACE3V,KAAMA,EACNwpD,UAAWA,EAGX4D,aAAcA,aACdyC,gBAAiBA,gBACjBnZ,UAAWA,UACXgc,UAAWA,UAEXsB,uBAAyB,SAAgC/xD,GACvDjC,EAAK+qB,eACHrqB,GAAI,OACJ4qB,MAAO,cAETtrB,EAAK8zD,eACHpzD,GAAI,SACJ4qB,MAAO,WAETtrB,EAAK6zD,eACHnzD,GAAI,MACJ4qB,MAAO,uBAGZ5qB,GAAI,OACJ4qB,MAAO,kBAEJtrB,EAAKi0D,iBACRvzD,GAAI,MACJ4qB,MAAO,oBAGAwyB,EAAQ99C,KAAKk0D,gBACfpW,EAAQ99C,KAAKk0D,cAAgBl0D,EAAK8zD,aAAa,GAAO,GAGxD,KAAK,GAAIp2D,KAAK4H,QAAOqO,MAAMoX,aAAc,CACvC,GAAIylC,GAASlrD,OAAOqO,MAAMoX,aAAartB,EAClC8yD,GAAOllC,MAMVtrB,EAAK+qB,aAAannB,MAChBlD,GAAI8vD,EAAO9vD,GACX4qB,MAAOklC,EAAOllC,OAASklC,EAAO9vD,KAPhCV,EAAK+qB,aAAannB,MAChBlD,GAAI,UAAYhD,EAChB4tB,MAAO,UAAY5tB,IAUd,GAALA,GAAWogD,EAAQ99C,KAAK4sD,gBAC1B9O,EAAQ99C,KAAK4sD,cAAgB4D,EAAO9vD,IAGjC8vD,EAAOllC,MAQZtrB,EAAK8zD,aAAalwD,MAChBlD,GAAI8vD,EAAO9vD,GACX4qB,MAAOklC,EAAOllC,OAASklC,EAAO9vD,KAT9BV,EAAK8zD,aAAalwD,MAChBlD,GAAI,gBAAkBhD,EACtB4tB,MAAO,gBAAkB5tB;GAW/B,IAAK,GAAIA,KAAK4H,QAAOqO,MAAMqX,eAAgB,CACzC,GAAIwlC,GAASlrD,OAAOqO,MAAMqX,eAAettB,EAEhC,IAALA,GAAWogD,EAAQ99C,KAAKswD,gBAC1BxS,EAAQ99C,KAAKswD,cAAgBE,EAAO9vD,IAGjC8vD,EAAOllC,MAOZtrB,EAAK6zD,aAAajwD,MAChBlD,GAAI8vD,EAAO9vD,GACX4qB,MAAOklC,EAAOllC,OAASklC,EAAO9vD,KAR9BV,EAAK6zD,aAAajwD,MAChBlD,GAAI,cAAgBhD,EACpB4tB,MAAO,cAAgB5tB,IAU7B,IAAK,GAAIA,KAAK4H,QAAOqO,MAAMyD,gBAAiB,CAC1C,GAAIo5C,GAASlrD,OAAOqO,MAAMyD,gBAAgB1Z,EAEjC,IAALA,GAAWogD,EAAQ99C,KAAK0mD,kBAC1B5I,EAAQ99C,KAAK0mD,gBAAkB8J,EAAO9vD,IAGnC8vD,EAAOllC,MAOZtrB,EAAKi0D,eAAerwD,MAClBlD,GAAI8vD,EAAO9vD,GACX4qB,MAAOklC,EAAOllC,OAASklC,EAAO9vD,KAR9BV,EAAKi0D,eAAerwD,MAClBlD,GAAI,WAAahD,EACjB4tB,MAAO,WAAa5tB,IAS1BkD,QAAQwR,MAAM,yDAGd,IAAI+hD,GAAYn0D,EAAK+qB,aAAa2Q,KAAK,SAAS80B,GAE9C,MADA5vD,SAAQC,IAAI,qBAAsB2vD,GAC9BA,EAAOllC,OAASwyB,EAAQ99C,KAAKiuD,mBAC/BrtD,QAAQC,IAAI,oCAAqC2vD,EAAOllC,OACxDwyB,EAAQ99C,KAAK4sD,cAAgB4D,EAAO9vD,IAC7B,GAEF8vD,EAAO9vD,IAAMo9C,EAAQ99C,KAAK4sD,eAAgD,SAA/B9O,EAAQ99C,KAAK4sD,gBAG7DwH,EAAYp0D,EAAK8zD,aAAap4B,KAAK,SAAS80B,GAC9C,MAAOA,GAAO9vD,IAAMo9C,EAAQ99C,KAAKk0D,gBAG/BG,EAAYr0D,EAAK6zD,aAAan4B,KAAK,SAAS80B,GAC9C,MAAOA,GAAO9vD,IAAMo9C,EAAQ99C,KAAKswD,gBAG/BgE,EAAct0D,EAAKi0D,eAAev4B,KAAK,SAAS80B,GAClD,MAAOA,GAAO9vD,IAAMo9C,EAAQ99C,KAAK0mD,iBAGnC9lD,SAAQC,IAAI,kBAAmBi9C,EAAQ99C,KAAK4sD,eAC5ChsD,QAAQC,IAAI,eAAgBszD,GAEvBA,IAAWrW,EAAQ99C,KAAK4sD,cAAgB5sD,EAAK+qB,aAAa/qB,EAAK+qB,aAAavtB,OAAS,GAAGkD,IACxF0zD,IAAWtW,EAAQ99C,KAAKk0D,cAAgBl0D,EAAK8zD,aAAa,GAAGpzD,IAC7D2zD,IAAWvW,EAAQ99C,KAAKswD,cAAgBtwD,EAAK6zD,aAAa,GAAGnzD,KAC7D4zD,GAAet0D,EAAKi0D,eAAez2D,OAAS,IAAGsgD,EAAQ99C,KAAK0mD,gBAAkB1mD,EAAKi0D,eAAe,GAAGvzD,IAGzE,IAA7BV,EAAK+qB,aAAavtB,QACpBoD,QAAQC,IAAI,+BACZb,EAAKu0D,UAAW,EAChBv0D,EAAK+qB,aAAannB,MAChBlD,GAAI,OACJ4qB,MAAO,eAGTtrB,EAAKu0D,UAAW,EAGf5a,QAAQgE,WAAW17C,IACpBA,KAIJgqB,eAAgB,SAAShqB,GACvBrB,QAAQwR,MAAM,sCACXnQ,EACDqD,OAAOqO,MAAMsY,eAAehqB,GAE5BqD,OAAOqO,MAAMsY,eAAervB,KAAKo3D,yBAOrCQ,uBAAwB,SAASC,GAG/B,GAFA7zD,QAAQwR,MAAM,4CAEVpS,EAAK0tD,SAAU,CACjB,GAAIjrD,GAAIgyD,EAA8B,iBAAE,GACpChiD,EAAIgiD,EAA8B,iBAAE,EAE9B,QAANhiD,IACFhQ,EAAI,KACJgQ,EAAI,KAGNkhD,EAAkBc,EAAsB,WAEnC3W,EAAQ99C,KAAKmoD,UAAYrK,EAAQ99C,KAAK+sD,UACzCtqD,EAAIotD,gBAAgB/R,EAAQ99C,KAAK+sD,SAAS9iD,MAC1CwI,EAAIo9C,gBAAgB/R,EAAQ99C,KAAK+sD,SAAS1iD,QAE5CrK,EAAK0tD,SAAS/kD,aACZwB,SAAU1H,EACV6H,UAAWmI,EACXrI,SAAU3H,EACV8H,UAAWkI,EACX5I,aAAc,GACdD,mBAAoBk0C,EAAQ99C,KAAK2J,gBAEnCyjD,aAAa9/C,QAAQ,SAASonD,GACxBjyD,IAAMiyD,EAAKzqD,OAASwI,IAAMiiD,EAAKrqD,SAC7ByzC,EAAQ99C,KAAK+sD,UAAY2H,EAAKh0D,IAA+B0E,SAAzB04C,EAAQ99C,KAAK+sD,WACnDjP,EAAQ99C,KAAK+sD,QAAU2H,EAAKh0D,MAKlCV,EAAK8wD,eAAgB,MAGrBlwD,SAAQwR,MAAM,mCAUlB3V,QAAS,SAASwF,GAIhB,QAAS0yD,GAAgB18C,EAAG8B,EAAQ66C,GAClC7X,EAAWwJ,MAAM,aAAc,SAC/BxJ,EAAWwJ,MAAM,kBAAmB,cACpCvmD,EAAKyzD,aAAemB,EAAQC,OAC5B70D,EAAK8hD,SAAW8S,EAAQ1wC,KACxBlkB,EAAKuhD,mBAAqBqT,EAAQrT,kBAClC,IAAI7sC,GAAO,GAAI1W,GAAE2V,MAAMe,KAAKuD,GAC1B8B,OAAQA,EACR1E,OAAQyoC,EAAQ99C,KAAK2H,SACrB8O,OAAQm+C,EACRj0C,aAAc,SAAS1I,EAAGtX,GACxB,GAAI0a,GAAO1a,EAAEX,KAAK80D,aAAen0D,EAAEX,KAAKqb,MAAQ,UAC5C5M,EAAU9N,EAAEX,KAAKyO,SAAW,EAChCsuC,GAAWwJ,MAAM,mBACflrC,KAAMA,EACNvC,KAAMrK,KAGV4R,YAAa,SAASpI,EAAGvD,EAAMjG,GAE7B,GADA7N,QAAQC,IAAI,wBAAyB8sB,WACf,YAAlBlf,EAAQkI,OAEV,GAA+B,qBAA3BlI,EAAQ,gBAAwC,CAClD,GAAI+V,KAEJ,KAAK,GAAI9mB,KAAK+Q,GAAQ8V,aACpBC,EAAM5gB,KAAK6K,EAAQ8V,aAAa7mB,GAAGwZ,KAGrC,IAAIhZ,GAAUsmB,EAAMC,KAAK,SAAS5I,EAAG6I,GACnC,GAAIC,GAA0B,UAArB9I,EAAEvX,UAAU,EAAG,IAAiB,GAAO,EAC5CsgB,EAA0B,UAArBF,EAAEpgB,UAAU,EAAG,IAAiB,GAAO,CAEhD,QAAKqgB,GAAMC,IAAOD,GAAMC,EACfD,EAAK,GAAK,EAGR9I,GAAK6I,EAAM,EAAQ7I,EAAI6I,EAAM,EAAI,IAE9C1kB,GAAKy/C,gBAAkBhxC,EAAQ8V,aAC/BvkB,EAAKwzD,YAAct1D,MACiB,cAA3BuQ,EAAQ,iBACjBzO,EAAK+0D,WAAatmD,EAAQ8V,aAC1Bw4B,EAAWwJ,MAAM,wBAAyB93C,EAAQ8V,eAElDw4B,EAAWwJ,MAAM,uBAAwB93C,KAM5B,cAAjBzO,EAAK8hD,WACPlhD,QAAQC,IAAI,gCACZ6T,EAAKC,mBACLD,EAAKE,WAAW,eAGlB5U,EAAK0U,KAAOA,EAEZ1U,EAAK+c,UAAY,GAAI/e,GAAE2V,MAAMoJ,UAC3B/c,EAAK0tD,SAAUkH,EAAQxvC,UACvBwvC,EAAQvvC,QACNjM,WACEQ,OAAQG,EAASA,EAAOH,OAAS,QAIvC5Z,EAAK+c,UAAUc,MAAQ,SAASrV,EAAKyR,GACnCrZ,QAAQC,IAAI,kBAAmB2H,EAAKyR,IAGtCja,EAAK+c,UAAUY,SAAW,SAASnV,EAAKyR,GAEtC,OAAQA,EAAKtD,QACX,IAAK,UACHomC,EAAWwJ,MAAM,eAAgBtsC,EAAKja,MACtCia,EAAKja,KAAKsN,QAAQ,SAASuyC,GACzB,GAAImV,GAASnV,EAAO,GAChBzzB,EAASutB,QAAQsb,SAASpV,EAAO,GAAG,GACpCmV,KAAWh1D,EAAKG,KAAKyZ,QACvBmjC,EAAW+D,OAAO,WAChB9gD,EAAKwhD,SAAWp1B,EAAO3jB,MAAMg5C,MAC7BzhD,EAAK0hD,WAAat1B,EAAOhjB,MAAMq4C,SAIrC,MACF,KAAK,MACH,GAAI5B,IAAU5lC,EAAKc,IAAKd,EAAKja,KAC7B+8C,GAAWwJ,MAAM,cAAe1G,EAChC,MACF,KAAK,MACH,GAAIK,GAAOjmC,EAAKc,GAChBgiC,GAAWwJ,MAAM,cAAerG,EAChC,MACF,KAAK,QACHnD,EAAWwJ,MAAM,gBACjB,MACF,KAAK,SACH,GAAI1G,IAAU5lC,EAAKc,IAAKd,EAAKja,KAC7B+8C,GAAWwJ,MAAM,iBAAkB1G,EACnC,MACF,SACEj/C,QAAQC,IAAI,iBAAkBoZ,EAAKtD,UAK3C,QAASu+C,KACPt0D,QAAQC,IAAI,oBACRb,EAAK+c,WACP/c,EAAK+c,UAAU0B,UACf7d,QAAQC,IAAI,uBACZk8C,EAAWwJ,MAAM,iBACjBvmD,EAAK+c,UAAY,MAEjBnc,QAAQC,IAAI,iCAGVb,EAAK0U,OACP1U,EAAK0U,KAAK+J,UACVze,EAAK0U,KAAO,MAgIhB,QAASygD,KACP,GAAIz2D,GAASs+C,EAAUuH,SAAS7lD,MAOhC,OANe,WAAXA,IACFA,EAASV,EAAE2V,MAAM0Y,UACjB2wB,EAAUuH,SAAS7lD,OAASA,GAI1BsB,EAAK0tD,WAAa1tD,EAAK0tD,SAASl3C,UAAUnU,eAC5CrC,EAAK0tD,SAASl3C,UAAU9S,eACxB1D,EAAK0tD,SAAS70C,aACd7Y,GAAK0tD,SAASlvD,UAGhBwB,EAAK0tD,SAAW,GAAIpoD,QAAOqO,OACzBnV,MAAOwB,EAAKxB,MAAQ,IAAMwB,EAAKiqD,SAC/BxrD,OAAQuB,EAAK01C,SACbp3C,UAAW0B,EAAKkqD,MAChB/mD,cAAenD,EAAKmD,cACpB2J,WAAY9M,EAAK8M,WACjBqL,IAAK,SACLQ,SAAU,wBACV9P,aACIulD,qBAA4DhpD,SAAtC04C,EAAQ99C,KAAKouD,sBAAqC,EAAOtQ,EAAQ99C,KAAKouD,qBAC5FC,qBAA4DjpD,SAAtC04C,EAAQ99C,KAAKquD,sBAAqC,EAAOvQ,EAAQ99C,KAAKquD,qBAC5FC,mBAAwDlpD,SAApC04C,EAAQ99C,KAAKsuD,oBAAmC,EAAOxQ,EAAQ99C,KAAKsuD,mBACxFC,oBAA0DnpD,SAArC04C,EAAQ99C,KAAKuuD,qBAAoC,EAAOzQ,EAAQ99C,KAAKuuD,oBAC1FC,qBAA2DppD,SAArC04C,EAAQ99C,KAAKuuD,qBAAoC,EAAOzQ,EAAQ99C,KAAKuuD,qBAE/F7vD,OAAQA,EACRqO,WAAY+wC,EAAQ99C,KAAKmuD,SACxBhnD,GAKHmsD,EAAK8B,UAAW,EAChB9vD,OAAOqO,MAAM8W,WAAW7mB,KAAK,WAC3B0vD,EAAK8B,UAAW,QAGlBp1D,GAAK0tD,SAASr1C,cACZhP,UAAWy0C,EAAQ99C,KAAK4sD,cACxBl8C,SAAUotC,EAAQ99C,KAAK0mD,gBACvBh+C,OAAQo1C,EAAQ99C,KAAKswD,cACrBh4C,WAAYg7C,EAAKkB,0BAzSrB5zD,QAAQwR,MAAM,kCACd,IAAIkhD,GAAO12D,KA+HPuK,GACFnD,UAAW,SAASiU,EAAG5W,GACrBrB,EAAK4xC,UAAYvwC,EACjB07C,EAAWsY,aAAeh0D,EAC1B07C,EAAWwJ,MAAM,WAAYllD,GAC7BT,QAAQwR,MAAM,6BAA8B/Q,GAExCs4C,QAAQgE,WAAW17C,IACrBA,EAASgW,EAAG5W,IAIhB2Z,UAAW,SAAS/C,EAAG8B,EAAQ5V,EAAK9D,GAGlC,OAFAO,QAAQwR,MAAM,aAAc6F,EAAG8B,EAAQ5V,EAAK9D,GAEpC8D,GACN,IAAKnG,GAAE2V,MAAF3V,QAAayQ,QAAQwM,SACxB,GAAI5a,EAAOu0D,QACT,OAAQv0D,EAAOu0D,QAAQj+C,QACrB,IAAK,4BACZtW,EAAOu0D,QAAQhsD,aAAgBvI,EAAOu0D,QAAQU,YACtD10D,QAAQC,IAAI,6BACZq0D,IACAP,EAAgB18C,EAAG8B,EAAQ1Z,EAAOu0D,SAClCrJ,kBAEiB,MACF,KAAK,4BACZlrD,EAAOu0D,QAAQhsD,aAAgBvI,EAAOu0D,QAAQU,YACtD10D,QAAQC,IAAI,6BACZq0D,KAKW,KAKF,KAAKl3D,GAAE2V,MAAF3V,QAAayQ,QAAQ9J,KACxB,GAAImU,GAAOzY,EAAOyY,KACduC,EAAOhb,EAAOk1D,eAAiBl1D,EAAOgb,IAC1C,KAAKvC,EAEH,WADAlY,SAAQC,IAAI,2BAA4BR,EAG1C08C,GAAWwJ,MAAM,mBACflrC,KAAMA,EACNvC,KAAMA,GAER,MACF,KAAK9a,GAAE2V,MAAF3V,QAAayQ,QAAQ5G,QACpBk1C,EAAW+D,OAAO,aAClB,MACN,KAAK9iD,GAAE2V,MAAF3V,QAAayQ,QAAQ6M,YACpByhC,EAAWwJ,MAAM,eACfiP,oBAAqBn1D,EAAOm1D,qBAE9B,MACN,SACE50D,QAAQ8L,KAAK,iCAAkCvI,EAAK4V,EAAQ1Z,KAKlEmoB,cAAe,SAASgT,GAOtB,OANKx7B,EAAKG,OACRH,EAAKG,KAAOq7B,GAId56B,QAAQwR,MAAM,iBAAkBopB,GACxBA,EAAEzkB,MAAMG,MACd,IAAK,UACHu1C,EAAajxB,EAAEn7B,OAAO2mB,iBACtB,MACF,KAAK,SACHpmB,QAAQwR,MAAM,WAAYopB,EAAEzR,aAC5B/pB,EAAKwpD,UAAY,QACjB,MACF,KAAK,QACH5oD,QAAQwR,MAAM,cAAeopB,EAAEzR,aAC/B/pB,EAAKwpD,UAAY,SACjB1E,GACA,MACF,KAAK,SACHlkD,QAAQwR,MAAM,cAAeopB,EAAEzR,aAC/B/pB,EAAKwpD,UAAY,SACjB8C,EAAW9wB,EAAEnV,UAAUnP,KAAMskB,EAAEn7B,QAC7CkrD,iBACc,MACF,KAAK,SACH3qD,QAAQwR,MAAM,0BAA4BopB,EAAE3T,OAC5C7nB,EAAKwpD,UAAY,QACjB,MACF,KAAK,UACH5oD,QAAQwR,MAAM,eAAiBopB,EAAE3T,OAC7B2T,EAAEn7B,OAAOuI,YACXyqD,EAAeC,IAEf4B,IACK5B,EAAK8B,UACR7B,IAGJ,MACF,SACE3yD,QAAQ8L,KAAK,+BAAgC8uB,KAKnDt4B,UAAW,SAAS+U,EAAG5W,GACrBT,QAAQwR,MAAM,aAAc/Q,GAC5B07C,EAAWwJ,MAAM,WAAYllD,IAG/B+Z,QAAS,SAASnD,EAAGtX,GACnBC,QAAQwR,MAAM,WAAYzR,KAI1B2yD,EAAO12D,IAiDPoD,GAAKy1D,UACPN,IAEAn3D,EAAEmS,MAAMmD,WAAW6hD,GAAc,GAAM,IAI3CM,UAAW,SAASxzD,GAClBjE,EAAEmS,MAAMmD,WAAWrR,GAAU,GAAM,IAQrCzD,MAAO,SAASyD,GACdjC,EAAK0tD,SAAS/qD,WACZnE,MAAOwB,EAAKxB,MAAQ,IAAMwB,EAAKiqD,SAC/BxrD,OAAQuB,EAAK01C,WAEf11C,EAAK0tD,SAASlvD,QAEVm7C,QAAQgE,WAAW17C,IACrBA,EAASjC,EAAK0tD,UAAU,IAU5BzwD,WAAY,SAASgF,GACnBrB,QAAQwR,MAAM,sCAEdpS,EAAK0tD,SAAS70C,SACd7Y,EAAK4xC,WAAY,EAEjBhxC,QAAQwR,MAAM,mCAEVunC,QAAQgE,WAAW17C,IACrBA,EAASjC,EAAK0tD,SAAU1tD,EAAK4xC,YASjCzxC,KAAM,SAASzD,EAAauF,EAAUyzD,GACpC90D,QAAQwR,MAAM,kCAAoC1V,EAAc,IAEhE,IAAIyD,GAAOH,EAAK0tD,SAAS1zC,QAAQ2/B,QAAQv7C,QACvC+oB,mBAAoBzqB,EACpBoqB,eAAgB9mB,EAAKkX,KACrB8P,iBAAkBhnB,EAAK21D,SAAW31D,EAAK21D,SAAW31D,EAAKsgD,MACvDkP,kBAAmB1R,EAAQ99C,KAAKwvD,kBAChCC,kBAAmB3R,EAAQ99C,KAAKyvD,kBAChC9nD,SAAUm2C,EAAQ99C,KAAK2H,SACvByI,UAAW0tC,EAAQ99C,KAAKoQ,UACxB/G,UAAWy0C,EAAQ99C,KAAK4sD,cACxBl8C,SAAUotC,EAAQ99C,KAAK0mD,gBACvBh+C,OAAQo1C,EAAQ99C,KAAKswD,cACrBsF,OAAQ9X,EAAQ99C,KAAKsvD,UACrBnL,YAAarG,EAAQ99C,KAAKmkD,YAC1BvlD,eACE0hD,MAAQxC,EAAQ99C,KAAKsgD,MACrBuV,OAAQ,8BAAgCpc,IAAIqE,EAAQ99C,KAAKsgD,OAAS,eAEnEoV,GAEH11D,GAAKG,KAAOA,EAEZH,EAAKwhD,UAAW,EAChBxhD,EAAK0hD,YAAa,EAEd/H,QAAQgE,WAAW17C,IACrBA,EAASjC,EAAK0tD,SAAUvtD,IAI5BknD,YAAa,SAAS3qD,EAAauF,GAG/B,GAAIqxD,GAAO12D,IAElB,IAAmC,WAA/BkhD,EAAQ99C,KAAKk0D,cAA4B,CAElCtzD,QAAQC,IAAI,4BAA8Bi9C,EAAQ99C,KAAKk0D,cAE9D,IAAI/zD,GAAOH,EAAK0tD,SAAS1zC,SAC5BmN,mBAAoBzqB,EAAc,UAClCoqB,eAAgB9mB,EAAKkX,KAAO,YAC5B8P,iBAAkBhnB,EAAKxB,MAAQ,YAC/BgxD,kBAAmB1R,EAAQ99C,KAAKwvD,kBAChCC,kBAAmB3R,EAAQ99C,KAAKyvD,kBAChCpmD,UAAWy0C,EAAQ99C,KAAKk0D,cACxBvsD,UAAU,EACViB,aAAa,EACbgtD,OAAQ9X,EAAQ99C,KAAKsvD,UACrBnL,YAAarG,EAAQ99C,KAAKmkD,YAC1BvlD,eACI0hD,MAAQxC,EAAQ99C,KAAKsgD,MACrBuV,OAAQ,8BAAgCpc,IAAIqE,EAAQ99C,KAAKsgD,OAAS,eA+BnE,OA1BOngD,GAAKka,IAAInc,QAAQiJ,UAAUsgB,SAAW,SAASpN,EAAK1T,GAS9D,QAASmvD,KACFxC,EAAKtzD,KAAKsnD,YAChBgM,EAAK/L,oBACL3mD,QAAQC,IAAI,sBAXb,GAAG8F,EAAQ,CACP,GAAIovD,GAAcpvD,EAAO8G,iBAAiB,EAC1CsoD,GAAYnjC,iBAAiB,QAASkjC,GAI1Cl1D,QAAQC,IAAI,wBAUFb,EAAKsnD,UAAYnnD,EAEjBS,QAAQC,IAAI,YAAab,GAEzBA,EAAKwhD,UAAW,EAChBxhD,EAAK0hD,YAAa,MAElB4R,GAAKrnC,iBAMXrrB,QAAQC,IAAI,4BAA8Bi9C,EAAQ99C,KAAKk0D,cAEvD,IAAI8B,GAAa,SAAS10D,EAAOoJ,EAAUqtC,GAEzC,GAAGz2C,EAED,WADAy7C,GAAWwJ,MAAM,6BAA8BjlD,EAIjD,IAAI20D,GAAaj2D,EAAK0tD,SAAS1zC,SAC7BmN,mBAAoBzqB,EAAc,UAClCoqB,eAAgB9mB,EAAKkX,KAAO,YAC5B8P,iBAAkBhnB,EAAKxB,MAAQ,YAC/BgxD,kBAAmB1R,EAAQ99C,KAAKwvD,kBAChCC,kBAAmB3R,EAAQ99C,KAAKyvD,kBAChC9mD,YAAaovC,EAAqBA,EAAmB3uC,MAAMwB,aAC3DjD,UAAU,EACViB,aAAa,EACbgtD,OAAQ9X,EAAQ99C,KAAKsvD,UACrBnL,YAAarG,EAAQ99C,KAAKmkD,YAC1BvlD,eACE0hD,MAAQxC,EAAQ99C,KAAKsgD,MACrBuV,OAAQ,8BAAgCpc,IAAIqE,EAAQ99C,KAAKsgD,OAAS,eAKtE2V,GAAW57C,IAAInc,QAAQiJ,UAAUsgB,SAAW,SAASpN,EAAK1T,GASxD,QAASmvD,KACJxC,EAAKtzD,KAAKsnD,YACXgM,EAAK/L,oBACL3mD,QAAQC,IAAI,sBAXhB,GAAG8F,EAAQ,CACT,GAAIovD,GAAcpvD,EAAO8G,iBAAiB,EAC1CsoD,GAAYnjC,iBAAiB,QAASkjC,GAIxCl1D,QAAQC,IAAI,wBAUdb,EAAKsnD,UAAY2O,EAEjBr1D,QAAQC,IAAI,YAAab,GAEzBA,EAAKwhD,UAAW,EAChBxhD,EAAK0hD,YAAa,EAGnB35C,WAAU+B,gBACZksD,IAEOpd,YAAYod,IAKpBzO,kBAAmB,WACjB,MAAKvnD,GAAKsnD,WAKV1mD,QAAQC,IAAI,gBAAiBb,EAAKsnD,WAClCtnD,EAAKsnD,UAAUxtC,aAEflZ,SAAQwR,MAAM,gCAPZxR,QAAQwR,MAAM,gCACP,IAeX0H,OAAQ,SAAS7X,GAGf,MAFArB,SAAQwR,MAAM,0CAETpS,EAAKG,MAKVH,EAAKG,KAAK2Z,SAEN9Z,EAAK0U,OACP1U,EAAK0U,KAAK+J,UACVze,EAAK0U,KAAO,MAGd9T,QAAQwR,MAAM,6BAEVunC,QAAQgE,WAAW17C,IACrBA,EAASjC,EAAK0tD,UAAU,MAdxB9sD,QAAQwR,MAAM,gCACP,IAuBX8W,KAAM,SAASm3B,EAAQp+C,GAGrB,MAFArB,SAAQwR,MAAM,4BAA8BiuC,EAAS,MAEhDrgD,EAAKG,MAKVH,EAAKG,KAAK+oB,KAAKm3B,EAAOlvC,YACtBvQ,QAAQwR,MAAM,wCAEVunC,QAAQgE,WAAW17C,IACrBA,EAASjC,EAAK0tD,UAAU,MARxB9sD,QAAQwR,MAAM,mCACP,IAgBXozC,UAAW,SAAS/lD,GAElBO,EAAK0tD,SAASl3C,UAAUjX,UAAU,OAAY,SAASoB,EAAGX,GACxD,GAAIk2D,GAASv4D,KAAKw4D,KAAkB,IAAbn2D,EAAK8E,OACxBsxD,EAAWz4D,KAAKw4D,KAAoB,IAAfn2D,EAAK+E,QAG1B+4C,GAAQ99C,KAAKmoD,WACfrK,EAAQ99C,KAAKyvD,kBAAoB2G,EACjCtY,EAAQ99C,KAAKwvD,kBAAoB0G,EACjCpY,EAAQ99C,KAAKsvD,WAAY,EACzBxR,EAAQ99C,KAAK+sD,QAAU,KAEV,IAATmJ,EACFpY,EAAQ99C,KAAK+sD,QAAU,QAEP,IAATmJ,EACPpY,EAAQ99C,KAAK+sD,QAAU,OAEP,KAATmJ,IACPpY,EAAQ99C,KAAK+sD,QAAU,QAIxBttD,GACDA,EAAGO,GAGL+8C,EAAWwJ,MAAM,YAAavmD,MAQlC0V,QAAS,SAASzT,GAGhB,MAFArB,SAAQwR,MAAM,gDAETpS,EAAKG,MAKVH,EAAKG,KAAK+oB,KAAK,KACflpB,EAAKwhD,UAAYxhD,EAAKwhD,SACtB5gD,QAAQwR,MAAM,wCAEVunC,QAAQgE,WAAW17C,IACrBA,EAASjC,EAAK0tD,UAAU,MATxB9sD,QAAQwR,MAAM,8BACP,IAiBXuD,UAAW,SAAS1T,GAGlB,MAFArB,SAAQwR,MAAM,kDAETpS,EAAKG,MAKVH,EAAKG,KAAK+oB,KAAK,MACflpB,EAAK0hD,YAAc1hD,EAAK0hD,WACxB9gD,QAAQwR,MAAM,0CAEVunC,QAAQgE,WAAW17C,IACrBA,EAASjC,EAAK0tD,UAAU,MATxB9sD,QAAQwR,MAAM,8BACP,IAcX4vC,mBAAoB,SAASvzC,GAC3BzO,EAAK0U,KAAK6B,SAAS9H,EAAS,YAE9Bi0C,YAAa,SAAS1tC,EAAUQ,GAC9BxV,EAAK0U,KAAKE,WAAW,aAAcI,EAAUQ,IAE/CotC,aAAc,SAAS5tC,EAAUQ,GAC/BxV,EAAK0U,KAAKE,WAAW,sBAAuBI,EAAUQ,IAExDstC,SAAU,SAAS9tC,EAAUQ,GAC3BxV,EAAK0U,KAAKE,WAAW,YAAaI,EAAUQ,IAK9C6sC,iBAAkB,SAASrtC,EAAU8qC,GACnC9/C,EAAK0U,KAAKE,WAAW,aAAcI,EAAU8qC,IAM/C5kC,YAAa,SAASpC,EAAM7W,GAC1BjC,EAAKG,KAAKsO,SACR5L,GAAI7C,EAAKyzD,aACT36C,KAAMA,EACNy8C,cAAev1D,EAAKkX,KACpBm/C,gBAAiBr2D,EAAK4jB,MAGpB+1B,QAAQgE,WAAW17C,IACrBA,EAASjC,EAAK0tD,UAAU,OASlC,IAAIwF,cAAevZ,QAAQptB,OAAO,eAElC2mC,cAAaC,QAAQ,UAAW,aAAc,QAAS,YAAa,UAAW,QAC7E,SAASpW,EAAY4B,EAAO3B,EAAWc,EAASnqC,GAC9C,GAAI2iD,GAAY,WAIXxY,EAAQ99C,KAAKkX,OACdvD,EAAM3T,KAAKkX,KAAO4mC,EAAQ99C,KAAKkX,MAE9B4mC,EAAQ99C,KAAKsgD,QACd3sC,EAAM3T,KAAKsgD,MAAQxC,EAAQ99C,KAAKsgD,OAE/BxC,EAAQ99C,KAAKxB,QACdmV,EAAM3T,KAAKxB,MAAQs/C,EAAQ99C,KAAKxB,OAE/Bs/C,EAAQ99C,KAAK01C,WACd/hC,EAAM3T,KAAK01C,SAAWoI,EAAQ99C,KAAK01C,SAOrC,IAAIz0C,GAAMpE,OAAO0qB,SAASi8B,OAAS3mD,OAAO0qB,SAASk8B,SAC/C8S,EAAc5X,EAAMtiC,IAAIpb,EAAM,2BAA6BtD,KAAK64D,MAAqB,IAAd74D,KAAKqa,SAAkB,IAE9Fy+C,EAAaF,EAAY/mD,KAAK,SAAS7N,GACzC,GAAI3B,GAAO2B,EAAS3B,KAGhBkX,EAAOvD,EAAM3T,KAAKkX,KAClBopC,EAAQ3sC,EAAM3T,KAAKsgD,KAyCvB,OAvCA1/C,SAAQwR,MAAM,gBAAkBpS,EAAK02D,aACjC12D,EAAK02D,cACP/iD,EAAM3T,KAAK02D,YAAc12D,EAAK02D,YAC9B/iD,EAAM3T,KAAK22D,eAAiB32D,EAAK22D,gBAG/B32D,EAAKmD,gBACPwQ,EAAM3T,KAAKmD,cAAgBnD,EAAKmD,eAG9BnD,EAAK8M,aACP6G,EAAM3T,KAAK8M,WAAa9M,EAAK8M,YAG/B6sC,QAAQv7C,OAAOuV,EAAM3T,KAAMA,GAMf,IAARkX,GAA2B,IAAblX,EAAKkX,OACrBvD,EAAM3T,KAAKkX,KAAOA,GAEP,IAATopC,GAA6B,IAAdtgD,EAAKsgD,QACtB3sC,EAAM3T,KAAKsgD,MAAQA,GAEG,IAApB3sC,EAAM3T,KAAKxB,OAAsC,IAAvBmV,EAAM3T,KAAK01C,UAAwC,IAAtBoI,EAAQ99C,KAAKxB,OAAwC,IAAzBs/C,EAAQ99C,KAAK01C,WAClG/hC,EAAM3T,KAAKxB,MAAQs/C,EAAQ99C,KAAKxB,MAChCmV,EAAM3T,KAAK01C,SAAWoI,EAAQ99C,KAAK01C,UAGT,QAAxB/hC,EAAM3T,KAAK42D,WAAwBjjD,EAAM3T,KAAK62D,iBAChDj2D,QAAQwR,MAAM,8BACduB,EAAM3T,KAAK62D,gBAAiB,GAG3BljD,EAAM3T,KAAK42D,WAAa9Y,EAAQ99C,KAAKkX,KAAK1Z,QAAUsgD,EAAQ99C,KAAKsgD,MAAM9iD,QAAUsgD,EAAQ99C,KAAKxB,MAAMhB,QAAUsgD,EAAQ99C,KAAK01C,SAASl4C,QACrIu/C,EAAWwJ,MAAM,sBAAuBvmD,GAEnC2B,GACN,SAASA,GAEV,MADAo7C,GAAWwJ,MAAM,oBAAqB5kD,GAC/BA,GAGT,OAAO80D,GAGT,QACEH,UAAaA,MAMjB3c,QACGptB,OAAO,gBACP4mC,QAAQ,cAAe,aAAc,KAAM,UAAW,QACrD,SAASpW,EAAY8K,EAAI/J,EAASnqC,GAEhC,GAAIw4C,MAEAhP,EAAO,WACT,GAAI2Z,GAAIC,CAIR,IAFAD,EAAK3K,EAAOruB,QAEF14B,QAAN0xD,EAEF,WADA/Z,GAAWwJ,MAAM,sBAGnBwQ,GAAYD,GAEZ,IAAIE,GAAmB,WACrBja,EAAWwJ,MAAM,mBAGnBwQ,GAAUvnD,KACR,WACEwnD,KAEF,WACEA,OAKF1S,EAAU,WACZvH,EAAWG,IAAI,kBAAmB,SAAUzc,GAC1C0c,MAGFA,IAGF,QACEA,KAAQA,EACRmH,QAAWA,EACX6H,OAAUA,MAMpB,WACE,YACmBxS,SAAQptB,OAAO,kBAAmB,iBAKrDotB,QACCptB,OAAO,kBACP4mC,QAAQ,WAAY,aAAc,gBACnC,SAASpW,EAAYka,GA4CnB,QAAS/I,GAAWgJ,GAClB5xD,OAAOlH,QAAO,EAAM4B,EAAMk3D,GA5C5B,GAAIl3D,GAAOi3D,EACdE,GACEhN,cAAc,EACPC,cAAc,EACdpG,SAAU,EACVE,cAAe,GACfv8C,UAAU,EACV88C,gBACAC,mBACA6H,YAAY,EACZr1C,KAAM,GACNopC,MAAO,GACP9hD,MAAO,GACPk3C,SAAU,GACVmP,WAAY,eACZnD,YAAY,EACZF,UAAU,EACV4D,SAAS,EACTwH,cAAe,KACfqB,kBAAmB,KACnBqC,cAAe,KACf4D,cAAe,KACfxN,gBAAiB,KACjBt2C,WAAW,EACX+9C,SAAS,EACTmB,WAAW,EACXnL,aAAa,EACbqL,kBAAmB,UACnBC,kBAAmB,UACnB1C,QAAS3nD,OACT8mD,gBAAgB,EAChBmC,sBAAsB,EACtBC,oBAAoB,EACpBF,sBAAsB,EACtBG,qBAAqB,EACrBpG,UAAU,EACV5C,eAAe,EACf57C,cAAe,KACf8/C,SAAUrkD,OAShB,OANApF,GAAKo3D,SAASD,IAOZn3D,KAAMA,EACNkuD,WAAYA,EACZ5D,MAAO,WACLtqD,EAAKmqD,cAAe,EACpBnqD,EAAKoqD,cAAe,EACpBpqD,EAAKgkD,SAAW,EAChBhkD,EAAK6kD,WAAa,gBAEpBsK,aAAc,WACZl8C,aAAa6I,QAEb9b,EAAKq3D,OAAOF,QAQlBxd,QACCptB,OAAO,kBACP+qC,QAAQ,eAAgB,UAAW,SAASxZ,GAE3C,GAAIyZ,GAAUzZ,EAAQ99C,KAAKykD,aACvBC,EAAkB5G,EAAQ99C,KAAK0kD,gBAE/B8S,EAAmB,SAASnX,EAAQnmC,EAAWkS,GAC3BhnB,QAAnBmyD,EAAQlX,KACTkX,EAAQlX,OAGVkX,EAAQlX,GAAQ0N,SACd1N,OAAUA,EACVnmC,UAAaA,EACbkS,OAAUA,EACVmgC,WAAc1L,QAGhB,IAAI7iC,GAAQ0mC,EAAgB3+C,QAAQs6C,EACpCz/C,SAAQC,IAAImd,GACTA,EAAQ,IACT0mC,EAAgBpwB,OAAOtW,EAAO,GAGhC0mC,EAAgBqJ,QAAQ1N,IAItBoX,EAAsB,SAASpX,GACjC,MAAOkX,GAAQlX,GAGjB,QACEpwC,IAAK,WACH,MAAOsnD,IAET5S,YAAa,WACX,MAAOD,IAETroC,IAAK,SAASgkC,GACZ,MAAOoX,GAAoBpX,IAE7BtkC,IAAK,SAASskC,EAAQnmC,EAAWkS,GAC/B,MAAOorC,GAAiBnX,EAAQnmC,EAAWkS,IAE7CtQ,MAAO,WAKL,MAJAgiC,GAAQ99C,KAAKykD,gBACb3G,EAAQ99C,KAAK0kD,mBACb6S,EAAUzZ,EAAQ99C,KAAKykD,aACvBC,EAAkB5G,EAAQ99C,KAAK0kD,qBAQrC/K,QACGptB,OAAO,kBACP4mC,QAAQ,gBAAiB,aAAc,KAAM,UAAW,SAAU,QAAS,aAC1E,SAASpW,EAAY8K,EAAI/J,EAASnxC,EAAQgH,EAAOmrC,GAE/C,GAAI4Y,GAAe,WACjB,MAAO7P,GAAG,SAASv4C,EAASmmB,GAC1B,GAAI2oB,GAAW,kBACX78C,GACF68C,SAAYA,EACZG,MAAQ,EACRnyB,OAAU,UACV3d,QAAWqwC,EAAW0D,QAAQ,yBAE3Bz6C,WAAU8H,aAAa3G,eAC1B3H,EAAe,OAAI,QACnBA,EAAgB,QAAIu9C,EAAW0D,QAAQ,0BACvC/sB,EAAOl0B,IAGT+N,EAAQ/N,MAKRo2D,EAAiB,WACnB,MAAO9P,GAAG,SAASv4C,EAASmmB,GAC1B,GAAI2oB,GAAW,aACX78C,GACF68C,SAAYA,EACZG,MAAQ,EACRnyB,OAAU,UACV3d,QAAWqwC,EAAW0D,QAAQ,0BAGhC7uC,GAAM8hD,UAAU,SAASrpC,GACnBA,IACF7qB,EAAe,OAAI,QACnBA,EAAgB,QAAIu9C,EAAW0D,QAAQ,0BACvC7uC,EAAM3T,KAAKy1D,WAAY,EACvBhgC,EAAOl0B,IAEToS,EAAM3T,KAAKy1D,WAAY,EACvBnmD,EAAQ/N,QAKVq2D,EAAsB,WACxB,MAAO/P,GAAG,SAASv4C,EAASmmB,GAC1B,GAAI2oB,GAAW,kBACX78C,GACF6qB,OAAU,UACVmyB,MAAQ,EACRH,SAAYA,EACZ3vC,QAAWqwC,EAAW0D,QAAQ,yBAGhC7uC,GAAMsY,eAAe,SAASG,GAC5BzY,EAAMqgD,uBAAuB,WAC3B1kD,EAAQ/N,UAOZs2D,EAAuB,WACzB,MAAOhQ,GAAG,SAASv4C,EAASmmB,GAe1B,QAASh2B,GAAGO,GACVsP,EAAQ/N,GAfV,GAAI68C,GAAW,yBACX78C,GACF6qB,OAAU,UACVmyB,MAAQ,EACRH,SAAYA,EACZ3vC,QAAWqwC,EAAW0D,QAAQ,0BAG5B1E,GAAQ99C,KAAKmoD,UAAYx0C,EAAM3T,KAAK0tD,SACtC/5C,EAAM6xC,UAAU/lD,GAEhB6P,EAAQ/N,MASVu2D,EAAkB,WACpB,MAAOjQ,GAAG,SAASv4C,EAASmmB,GAC1B,GAAI2oB,GAAW,mBACX78C,GACF6qB,OAAU,UACVmyB,MAAQ,EACRH,SAAYA,EACZ3vC,QAAWqwC,EAAW0D,QAAQ,4BAG5BuV,EAAiBprD,EAAO2pD,YAExB0B,EAAgBD,EAAevoD,KACjC,SAAS7N,GAKP,MAAGA,GAASyqB,QAAU,KAAOzqB,EAASyqB,QAAU,IACvC7qB,GAEPA,EAAe,OAAI,QACnBA,EAAgB,QAAIu9C,EAAW0D,QAAQ,2BAChCjhD,IAIXA,GAAgB,QAAIy2D,EAEpB1oD,EAAQ/N,MAIV02D,EAAa,WACf,MAAOpQ,GAAG,SAASv4C,EAASmmB,GAC1B,GAAI2oB,GAAW,cACX78C,GACF6qB,OAAU,UACVmyB,MAAQ,EACRH,SAAYA,EACZ3vC,QAAWqwC,EAAW0D,QAAQ,eAGhC,IAAG7uC,EAAM3T,KAAK+xC,YAAcp+B,EAAM3T,KAAK4xC,UAErC,WADAtiC,GAAQ/N,EAIV,IAAI22D,GAAkB,WAKhBpa,EAAQ99C,KAAKmqD,cAAgBrM,EAAQ99C,KAAKoqD,eAAiBz2C,EAAM3T,KAAK+xC,aACxEp+B,EAAM3T,KAAKiqD,SAAWnM,EAAQ99C,KAAKiqD,UAAYt2C,EAAM3T,KAAKiqD,SAC1Dt2C,EAAM3T,KAAKkqD,MAAQpM,EAAQ99C,KAAKkqD,OAASv2C,EAAM3T,KAAKkqD,MACpDv2C,EAAM3T,KAAKkX,KAAO4mC,EAAQ99C,KAAKkX,KAC/BvD,EAAM3T,KAAKsgD,MAAQxC,EAAQ99C,KAAKsgD,MAChC3sC,EAAM3T,KAAKxB,MAAQs/C,EAAQ99C,KAAKxB,MAChCmV,EAAM3T,KAAK01C,SAAWoI,EAAQ99C,KAAK01C,SAEnC/hC,EAAM3T,KAAK+xC,YAAa,EACxBp+B,EAAMlX,QAAQ,SAASwb,EAAG25B,GACxBj+B,EAAM3T,KAAK+xC,YAAa,EACxBziC,EAAQ/N,MAKXu8C,GAAQ99C,KAAKmqD,cAAgBrM,EAAQ99C,KAAKoqD,aAC3C8N,IAEA5oD,EAAQ/N,MAKV42D,GACFT,EACAC,EACAC,EACAE,EACAG,EACAJ,GAGEO,GACFtZ,EAAW0D,QAAQ,yBACnB1D,EAAW0D,QAAQ,0BACnB1D,EAAW0D,QAAQ,yBACnB1D,EAAW0D,QAAQ,2BACnB1D,EAAW0D,QAAQ,eACnB1D,EAAW0D,QAAQ,2BAGjB9D,EAAqB,SAASJ,GAChC,MAAyCl5C,SAAtCgzD,EAAiB9Z,GACX8Z,EAAiB9Z,GAEjBQ,EAAW0D,QAAQ,gBAI1BlE,EAAmB,GACnBN,EAAsB,EAEtBqa,EAAoB,SAASr6C,GAC/B,GAAIs6C,EAIJ,OAFAA,GAAYt6C,EAAQ,EACpBggC,EAAuBsa,EAAYH,EAAS36D,OAAU,KAIpD+6D,EAAe,WACjB,GAAIzB,GAAIC,EAAW3qC,EAAQoyB,EAAWJ,EAAUG,EAAM9vC,EAASk1B,CAI/D,IAHA6a,GAAY,EACZF,IAEGA,GAAoB6Z,EAAS36D,OAE9B,WADAu/C,GAAWwJ,MAAM,oBAAqBjI,EAIxCwY,GAAKqB,EAAS7Z,GACdyY,EAAYD,GAEZ,IAAIE,GAAmB,SAASD,GACH3xD,QAAxB2xD,EAAmB,UACpBpzB,EAAUozB,EAAmB,SAG/B3qC,EAAS2qC,EAAkB,OAC3BxY,EAAOwY,EAAgB,KACvB3Y,EAAW2Y,EAAoB,SAC/BtoD,EAAUsoD,EAAmB,QAEhB,WAAV3qC,IACDoyB,GAAY,GAGdzB,EAAWwJ,MAAM,gBAAiBjI,EAAkBlyB,EAAQuX,EAASya,EAAUG,EAAMC,EAAW/vC,GAIlGsoD,GAAUvnD,KACR,SAASunD,GACPC,EAAiBD,IAEnB,SAASA,GACPC,EAAiBD,KAMvB,QACE5Z,KAAQob,EACR7Z,mBAAsBA,EACtBV,oBAAuBA,EACvBS,UAAa4Z","sourcesContent":["/*\n * Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\n * Copyright (C) 2005-2014, Anthony Minessale II <anthm@freeswitch.org>\n *\n * Version: MPL 1.1\n *\n * The contents of this file are subject to the Mozilla Public License Version\n * 1.1 (the \"License\"); you may not use this file except in compliance with\n * the License. You may obtain a copy of the License at\n * http://www.mozilla.org/MPL/\n *\n * Software distributed under the License is distributed on an \"AS IS\" basis,\n * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n * for the specific language governing rights and limitations under the\n * License.\n *\n * The Original Code is jquery.jsonrpclient.js modified for Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\n *\n * The Initial Developer of the Original Code is\n * Textalk AB http://textalk.se/\n * Portions created by the Initial Developer are Copyright (C)\n * the Initial Developer. All Rights Reserved.\n *\n * Contributor(s):\n *\n * Anthony Minessale II <anthm@freeswitch.org>\n *\n * jquery.jsonrpclient.js - JSON RPC client code\n *\n */\n/**\n * This plugin requires jquery.json.js to be available, or at least the methods $.toJSON and\n * $.parseJSON.\n *\n * The plan is to make use of websockets if they are available, but work just as well with only\n * http if not.\n *\n * Usage example:\n *\n *   var foo = new $.JsonRpcClient({ ajaxUrl: '/backend/jsonrpc' });\n *   foo.call(\n *     'bar', [ 'A parameter', 'B parameter' ],\n *     function(result) { alert('Foo bar answered: ' + result.my_answer); },\n *     function(error)  { console.log('There was an error', error); }\n *   );\n *\n * More examples are available in README.md\n */\n(function($) {\n  /**\n   * @fn new\n   * @memberof $.JsonRpcClient\n   *\n   * @param options An object stating the backends:\n   *                ajaxUrl    A url (relative or absolute) to a http(s) backend.\n   *                socketUrl  A url (relative of absolute) to a ws(s) backend.\n   *                onmessage  A socket message handler for other messages (non-responses).\n   *                getSocket  A function returning a WebSocket or null.\n   *                           It must take an onmessage_cb and bind it to the onmessage event\n   *                           (or chain it before/after some other onmessage handler).\n   *                           Or, it could return null if no socket is available.\n   *                           The returned instance must have readyState <= 1, and if less than 1,\n   *                           react to onopen binding.\n   */\n    $.JsonRpcClient = function(options) {\n        var self = this;\n        this.options = $.extend({\n            ajaxUrl       : null,\n            socketUrl     : null, ///< The ws-url for default getSocket.\n            onmessage     : null, ///< Other onmessage-handler.\n            login         : null, /// auth login\n            passwd        : null, /// auth passwd\n            sessid        : null,\n\t    loginParams   : null,\n\t    userVariables : null,\n            getSocket     : function(onmessage_cb) { return self._getSocket(onmessage_cb); }\n        }, options);\n\n        self.ws_cnt = 0;\n\n        // Declare an instance version of the onmessage callback to wrap 'this'.\n        this.wsOnMessage = function(event) { self._wsOnMessage(event); };\n    };\n\n    /// Holding the WebSocket on default getsocket.\n    $.JsonRpcClient.prototype._ws_socket = null;\n\n    /// Object <id>: { success_cb: cb, error_cb: cb }\n    $.JsonRpcClient.prototype._ws_callbacks = {};\n\n    /// The next JSON-RPC request id.\n    $.JsonRpcClient.prototype._current_id = 1;\n\n\n    $.JsonRpcClient.prototype.speedTest = function (bytes, cb) {\n        var socket = this.options.getSocket(this.wsOnMessage);\n\tif (socket !== null) {\n\t    this.speedCB = cb;\n\t    this.speedBytes = bytes;\n\t    socket.send(\"#SPU \" + bytes);\n\n\t    var loops = bytes / 1024;\n\t    var rem = bytes % 1024;\n\t    var i;\n\t    var data = new Array(1024).join(\".\");\n\t    for (i = 0; i < loops; i++) {\n\t\tsocket.send(\"#SPB \" + data);\n\t    }\n\t    \n\t    if (rem) {\n\t\tsocket.send(\"#SPB \" + data);\n\t    }\n\n\t    socket.send(\"#SPE\");\n\t}\n    };\n\n\n\n    /**\n     * @fn call\n     * @memberof $.JsonRpcClient\n     *\n     * @param method     The method to run on JSON-RPC server.\n     * @param params     The params; an array or object.\n     * @param success_cb A callback for successful request.\n     * @param error_cb   A callback for error.\n     */\n    $.JsonRpcClient.prototype.call = function(method, params, success_cb, error_cb) {\n    // Construct the JSON-RPC 2.0 request.\n\n        if (!params) {\n            params = {};\n        }\n\n        if (this.options.sessid) {\n            params.sessid = this.options.sessid;\n        }\n\n        var request = {\n            jsonrpc : '2.0',\n            method  : method,\n            params  : params,\n            id      : this._current_id++  // Increase the id counter to match request/response\n        };\n\n        if (!success_cb) {\n            success_cb = function(e){console.log(\"Success: \", e);};\n        }\n\n        if (!error_cb) {\n            error_cb = function(e){console.log(\"Error: \", e);};\n        }\n\n        // Try making a WebSocket call.\n        var socket = this.options.getSocket(this.wsOnMessage);\n        if (socket !== null) {\n            this._wsCall(socket, request, success_cb, error_cb);\n            return;\n        }\n\n        // No WebSocket, and no HTTP backend?  This won't work.\n        if (this.options.ajaxUrl === null) {\n            throw \"$.JsonRpcClient.call used with no websocket and no http endpoint.\";\n        }\n\n        $.ajax({\n            type     : 'POST',\n            url      : this.options.ajaxUrl,\n            data     : $.toJSON(request),\n            dataType : 'json',\n            cache    : false,\n\n            success  : function(data) {\n                if ('error' in data) error_cb(data.error, this);\n                success_cb(data.result, this);\n            },\n\n            // JSON-RPC Server could return non-200 on error\n            error    : function(jqXHR, textStatus, errorThrown) {\n                try {\n                    var response = $.parseJSON(jqXHR.responseText);\n\n                    if ('console' in window) console.log(response);\n\n                    error_cb(response.error, this);\n                } catch (err) {\n                    // Perhaps the responseText wasn't really a jsonrpc-error.\n                    error_cb({ error: jqXHR.responseText }, this);\n                }\n            }\n        });\n    };\n\n    /**\n     * Notify sends a command to the server that won't need a response.  In http, there is probably\n     * an empty response - that will be dropped, but in ws there should be no response at all.\n     *\n     * This is very similar to call, but has no id and no handling of callbacks.\n     *\n     * @fn notify\n     * @memberof $.JsonRpcClient\n     *\n     * @param method     The method to run on JSON-RPC server.\n     * @param params     The params; an array or object.\n     */\n    $.JsonRpcClient.prototype.notify = function(method, params) {\n        // Construct the JSON-RPC 2.0 request.\n\n        if (this.options.sessid) {\n            params.sessid = this.options.sessid;\n        }\n\n        var request = {\n            jsonrpc: '2.0',\n            method:  method,\n            params:  params\n        };\n\n        // Try making a WebSocket call.\n        var socket = this.options.getSocket(this.wsOnMessage);\n        if (socket !== null) {\n            this._wsCall(socket, request);\n            return;\n        }\n\n        // No WebSocket, and no HTTP backend?  This won't work.\n        if (this.options.ajaxUrl === null) {\n            throw \"$.JsonRpcClient.notify used with no websocket and no http endpoint.\";\n        }\n\n        $.ajax({\n            type     : 'POST',\n            url      : this.options.ajaxUrl,\n            data     : $.toJSON(request),\n            dataType : 'json',\n            cache    : false\n        });\n    };\n\n    /**\n     * Make a batch-call by using a callback.\n     *\n     * The callback will get an object \"batch\" as only argument.  On batch, you can call the methods\n     * \"call\" and \"notify\" just as if it was a normal $.JsonRpcClient object, and all calls will be\n     * sent as a batch call then the callback is done.\n     *\n     * @fn batch\n     * @memberof $.JsonRpcClient\n     *\n     * @param callback    The main function which will get a batch handler to run call and notify on.\n     * @param all_done_cb A callback function to call after all results have been handled.\n     * @param error_cb    A callback function to call if there is an error from the server.\n     *                    Note, that batch calls should always get an overall success, and the\n     *                    only error\n     */\n    $.JsonRpcClient.prototype.batch = function(callback, all_done_cb, error_cb) {\n        var batch = new $.JsonRpcClient._batchObject(this, all_done_cb, error_cb);\n        callback(batch);\n        batch._execute();\n    };\n\n    /**\n     * The default getSocket handler.\n     *\n     * @param onmessage_cb The callback to be bound to onmessage events on the socket.\n     *\n     * @fn _getSocket\n     * @memberof $.JsonRpcClient\n     */\n\n    $.JsonRpcClient.prototype.socketReady = function() {\n        if (this._ws_socket === null || this._ws_socket.readyState > 1) {\n            return false;\n        }\n\n        return true;\n    };\n\n    $.JsonRpcClient.prototype.closeSocket = function() {\n\tvar self = this;\n        if (self.socketReady()) {\n            self._ws_socket.onclose = function (w) {console.log(\"Closing Socket\");};\n            self._ws_socket.close();\n        }\n    };\n\n    $.JsonRpcClient.prototype.loginData = function(params) {\n\tvar self = this;\n        self.options.login = params.login;\n        self.options.passwd = params.passwd;\n\tself.options.loginParams = params.loginParams;\n\tself.options.userVariables = params.userVariables;\n    };\n\n    $.JsonRpcClient.prototype.connectSocket = function(onmessage_cb) {\n        var self = this;\n\n        if (self.to) {\n            clearTimeout(self.to);\n        }\n\n        if (!self.socketReady()) {\n            self.authing = false;\n\n            if (self._ws_socket) {\n                delete self._ws_socket;\n            }\n\n            // No socket, or dying socket, let's get a new one.\n            self._ws_socket = new WebSocket(self.options.socketUrl);\n\n            if (self._ws_socket) {\n                // Set up onmessage handler.\n                self._ws_socket.onmessage = onmessage_cb;\n                self._ws_socket.onclose = function (w) {\n                    if (!self.ws_sleep) {\n                        self.ws_sleep = 1000;\n                    }\n\n                    if (self.options.onWSClose) {\n                        self.options.onWSClose(self);\n                    }\n\n                    if (self.ws_cnt > 10 && self.options.wsFallbackURL) {\n                      self.options.socketUrl = self.options.wsFallbackURL;\n                    }\n\n                    console.error(\"Websocket Lost \" + self.ws_cnt + \" sleep: \" + self.ws_sleep + \"msec\");\n\n                    self.to = setTimeout(function() {\n                        console.log(\"Attempting Reconnection....\");\n                        self.connectSocket(onmessage_cb);\n                    }, self.ws_sleep);\n\n                    self.ws_cnt++;\n\n                    if (self.ws_sleep < 3000 && (self.ws_cnt % 10) === 0) {\n                        self.ws_sleep += 1000;\n                    }\n                };\n\n                // Set up sending of message for when the socket is open.\n                self._ws_socket.onopen = function() {\n                    if (self.to) {\n                        clearTimeout(self.to);\n                    }\n                    self.ws_sleep = 1000;\n                    self.ws_cnt = 0;\n                    if (self.options.onWSConnect) {\n                        self.options.onWSConnect(self);\n                    }\n\n                    var req;\n                    // Send the requests.\n                    while ((req = $.JsonRpcClient.q.pop())) {\n                        self._ws_socket.send(req);\n                    }\n                };\n            }\n        }\n\n        return self._ws_socket ? true : false;\n    };\n\n    $.JsonRpcClient.prototype.stopRetrying = function() {\n      if (self.to)\n        clearTimeout(self.to);\n    }\n\n    $.JsonRpcClient.prototype._getSocket = function(onmessage_cb) {\n        // If there is no ws url set, we don't have a socket.\n        // Likewise, if there is no window.WebSocket.\n        if (this.options.socketUrl === null || !(\"WebSocket\" in window)) return null;\n\n        this.connectSocket(onmessage_cb);\n\n        return this._ws_socket;\n    };\n\n    /**\n     * Queue to save messages delivered when websocket is not ready\n     */\n    $.JsonRpcClient.q = [];\n\n    /**\n     * Internal handler to dispatch a JRON-RPC request through a websocket.\n     *\n     * @fn _wsCall\n     * @memberof $.JsonRpcClient\n     */\n    $.JsonRpcClient.prototype._wsCall = function(socket, request, success_cb, error_cb) {\n        var request_json = $.toJSON(request);\n\n        if (socket.readyState < 1) {\n            // The websocket is not open yet; we have to set sending of the message in onopen.\n            self = this; // In closure below, this is set to the WebSocket.  Use self instead.\n            $.JsonRpcClient.q.push(request_json);\n        } else {\n            // We have a socket and it should be ready to send on.\n            socket.send(request_json);\n        }\n\n        // Setup callbacks.  If there is an id, this is a call and not a notify.\n        if ('id' in request && typeof success_cb !== 'undefined') {\n            this._ws_callbacks[request.id] = { request: request_json, request_obj: request, success_cb: success_cb, error_cb: error_cb };\n        }\n    };\n\n    /**\n     * Internal handler for the websocket messages.  It determines if the message is a JSON-RPC\n     * response, and if so, tries to couple it with a given callback.  Otherwise, it falls back to\n     * given external onmessage-handler, if any.\n     *\n     * @param event The websocket onmessage-event.\n     */\n    $.JsonRpcClient.prototype._wsOnMessage = function(event) {\n        // Check if this could be a JSON RPC message.\n        var response;\n\n\t// Special sub proto\n\tif (event.data[0] == \"#\" && event.data[1] == \"S\" && event.data[2] == \"P\") {\n\t    if (event.data[3] == \"U\") {\n\t\tthis.up_dur = parseInt(event.data.substring(4));\n\t    } else if (this.speedCB && event.data[3] == \"D\") {\n\t\tthis.down_dur = parseInt(event.data.substring(4));\n\n\t\tvar up_kps = (((this.speedBytes * 8) / (this.up_dur / 1000)) / 1024).toFixed(0);\n\t\tvar down_kps = (((this.speedBytes * 8) / (this.down_dur / 1000)) / 1024).toFixed(0);\n\t\t\n\t\tconsole.info(\"Speed Test: Up: \" + up_kps + \" Down: \" + down_kps);\n\t\tvar cb = this.speedCB;\n\t\tthis.speedCB = null;\n\t\tcb(event, {\n\t\t\tupDur: this.up_dur,\n\t\t\tdownDur: this.down_dur,\n\t\t\tupKPS: up_kps,\n\t\t\tdownKPS: down_kps\n\t\t});\n\t    }\n\t    \n\t    return;\n\t}\n\n\n        try {\n            response = $.parseJSON(event.data);\n\n            /// @todo Make using the jsonrcp 2.0 check optional, to use this on JSON-RPC 1 backends.\n\n            if (typeof response === 'object' &&\n                'jsonrpc' in response &&\n                response.jsonrpc === '2.0') {\n\n                /// @todo Handle bad response (without id).\n\n                // If this is an object with result, it is a response.\n                if ('result' in response && this._ws_callbacks[response.id]) {\n                    // Get the success callback.\n                    var success_cb = this._ws_callbacks[response.id].success_cb;\n\n    /*\n                    // set the sessid if present\n                    if ('sessid' in response.result && !this.options.sessid || (this.options.sessid != response.result.sessid)) {\n                        this.options.sessid = response.result.sessid;\n                        if (this.options.sessid) {\n                            console.log(\"setting session UUID to: \" + this.options.sessid);\n                        }\n                    }\n    */\n                    // Delete the callback from the storage.\n                    delete this._ws_callbacks[response.id];\n\n                    // Run callback with result as parameter.\n                    success_cb(response.result, this);\n                    return;\n                } else if ('error' in response && this._ws_callbacks[response.id]) {\n                // If this is an object with error, it is an error response.\n\n                // Get the error callback.\n                    var error_cb = this._ws_callbacks[response.id].error_cb;\n                    var orig_req = this._ws_callbacks[response.id].request;\n\n                    // if this is an auth request, send the credentials and resend the failed request\n                    if (!self.authing && response.error.code == -32000 && self.options.login && self.options.passwd) {\n                        self.authing = true;\n\n                        this.call(\"login\", { login: self.options.login, passwd: self.options.passwd, loginParams: self.options.loginParams,\n\t\t\t\t\t     userVariables: self.options.userVariables},\n                            this._ws_callbacks[response.id].request_obj.method == \"login\" ?\n                            function(e) {\n                                self.authing = false;\n                                console.log(\"logged in\");\n                                delete self._ws_callbacks[response.id];\n\n                                if (self.options.onWSLogin) {\n                                    self.options.onWSLogin(true, self);\n                                }\n                            }\n\n                            :\n\n                            function(e) {\n                                self.authing = false;\n                                console.log(\"logged in, resending request id: \" + response.id);\n                                var socket = self.options.getSocket(self.wsOnMessage);\n                                if (socket !== null) {\n                                    socket.send(orig_req);\n                                }\n                                if (self.options.onWSLogin) {\n                                    self.options.onWSLogin(true, self);\n                                }\n                            },\n\n                            function(e) {\n                                console.log(\"error logging in, request id:\", response.id);\n                                delete self._ws_callbacks[response.id];\n                                error_cb(response.error, this);\n                                if (self.options.onWSLogin) {\n                                self.options.onWSLogin(false, self);\n                                }\n                            });\n                            return;\n                        }\n\n                        // Delete the callback from the storage.\n                        delete this._ws_callbacks[response.id];\n\n                        // Run callback with the error object as parameter.\n                        error_cb(response.error, this);\n                        return;\n                    }\n                }\n            } catch (err) {\n            // Probably an error while parsing a non json-string as json.  All real JSON-RPC cases are\n            // handled above, and the fallback method is called below.\n            console.log(\"ERROR: \"+ err);\n            return;\n        }\n\n        // This is not a JSON-RPC response.  Call the fallback message handler, if given.\n        if (typeof this.options.onmessage === 'function') {\n            event.eventData = response;\n            if (!event.eventData) {\n                event.eventData = {};\n            }\n\n            var reply = this.options.onmessage(event);\n\n            if (reply && typeof reply === \"object\" && event.eventData.id) {\n                var msg = {\n                    jsonrpc: \"2.0\",\n                    id: event.eventData.id,\n                    result: reply\n                };\n\n                var socket = self.options.getSocket(self.wsOnMessage);\n                if (socket !== null) {\n                    socket.send($.toJSON(msg));\n                }\n            }\n        }\n    };\n\n\n    /************************************************************************************************\n     * Batch object with methods\n     ************************************************************************************************/\n\n    /**\n     * Handling object for batch calls.\n     */\n    $.JsonRpcClient._batchObject = function(jsonrpcclient, all_done_cb, error_cb) {\n        // Array of objects to hold the call and notify requests.  Each objects will have the request\n        // object, and unless it is a notify, success_cb and error_cb.\n        this._requests   = [];\n\n        this.jsonrpcclient = jsonrpcclient;\n        this.all_done_cb = all_done_cb;\n        this.error_cb    = typeof error_cb === 'function' ? error_cb : function() {};\n\n    };\n\n    /**\n     * @sa $.JsonRpcClient.prototype.call\n     */\n    $.JsonRpcClient._batchObject.prototype.call = function(method, params, success_cb, error_cb) {\n\n        if (!params) {\n            params = {};\n        }\n\n        if (this.options.sessid) {\n            params.sessid = this.options.sessid;\n        }\n\n        if (!success_cb) {\n            success_cb = function(e){console.log(\"Success: \", e);};\n        }\n\n        if (!error_cb) {\n        error_cb = function(e){console.log(\"Error: \", e);};\n        }\n\n        this._requests.push({\n            request    : {\n            jsonrpc : '2.0',\n            method  : method,\n            params  : params,\n            id      : this.jsonrpcclient._current_id++  // Use the client's id series.\n        },\n            success_cb : success_cb,\n            error_cb   : error_cb\n        });\n    };\n\n    /**\n     * @sa $.JsonRpcClient.prototype.notify\n     */\n    $.JsonRpcClient._batchObject.prototype.notify = function(method, params) {\n        if (this.options.sessid) {\n            params.sessid = this.options.sessid;\n        }\n\n        this._requests.push({\n            request    : {\n                jsonrpc : '2.0',\n                method  : method,\n                params  : params\n            }\n        });\n    };\n\n    /**\n     * Executes the batched up calls.\n     */\n    $.JsonRpcClient._batchObject.prototype._execute = function() {\n        var self = this;\n\n        if (this._requests.length === 0) return; // All done :P\n\n        // Collect all request data and sort handlers by request id.\n        var batch_request = [];\n        var handlers = {};\n        var i = 0;\n        var call;\n        var success_cb;\n        var error_cb;\n\n        // If we have a WebSocket, just send the requests individually like normal calls.\n        var socket = self.jsonrpcclient.options.getSocket(self.jsonrpcclient.wsOnMessage);\n        if (socket !== null) {\n            for (i = 0; i < this._requests.length; i++) {\n                call = this._requests[i];\n                success_cb = ('success_cb' in call) ? call.success_cb : undefined;\n                error_cb   = ('error_cb'   in call) ? call.error_cb   : undefined;\n                self.jsonrpcclient._wsCall(socket, call.request, success_cb, error_cb);\n            }\n\n            if (typeof all_done_cb === 'function') all_done_cb(result);\n            return;\n        }\n\n        for (i = 0; i < this._requests.length; i++) {\n            call = this._requests[i];\n            batch_request.push(call.request);\n\n            // If the request has an id, it should handle returns (otherwise it's a notify).\n            if ('id' in call.request) {\n                handlers[call.request.id] = {\n                    success_cb : call.success_cb,\n                    error_cb   : call.error_cb\n                };\n            }\n        }\n\n        success_cb = function(data) { self._batchCb(data, handlers, self.all_done_cb); };\n\n        // No WebSocket, and no HTTP backend?  This won't work.\n        if (self.jsonrpcclient.options.ajaxUrl === null) {\n            throw \"$.JsonRpcClient.batch used with no websocket and no http endpoint.\";\n        }\n\n        // Send request\n        $.ajax({\n            url      : self.jsonrpcclient.options.ajaxUrl,\n            data     : $.toJSON(batch_request),\n            dataType : 'json',\n            cache    : false,\n            type     : 'POST',\n\n            // Batch-requests should always return 200\n            error    : function(jqXHR, textStatus, errorThrown) {\n                self.error_cb(jqXHR, textStatus, errorThrown);\n            },\n            success  : success_cb\n        });\n    };\n\n    /**\n     * Internal helper to match the result array from a batch call to their respective callbacks.\n     *\n     * @fn _batchCb\n     * @memberof $.JsonRpcClient\n     */\n    $.JsonRpcClient._batchObject.prototype._batchCb = function(result, handlers, all_done_cb) {\n        for (var i = 0; i < result.length; i++) {\n            var response = result[i];\n\n            // Handle error\n            if ('error' in response) {\n                if (response.id === null || !(response.id in handlers)) {\n                    // An error on a notify?  Just log it to the console.\n                    if ('console' in window) console.log(response);\n                } else {\n                    handlers[response.id].error_cb(response.error, this);\n                }\n            } else {\n                // Here we should always have a correct id and no error.\n                if (!(response.id in handlers) && 'console' in window) {\n                    console.log(response);\n                } else {\n                    handlers[response.id].success_cb(response.result, this);\n                }\n            }\n        }\n\n        if (typeof all_done_cb === 'function') all_done_cb(result);\n    };\n\n})(jQuery);\n\n/*\n * Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\n * Copyright (C) 2005-2014, Anthony Minessale II <anthm@freeswitch.org>\n *\n * Version: MPL 1.1\n *\n * The contents of this file are subject to the Mozilla Public License Version\n * 1.1 (the \"License\"); you may not use this file except in compliance with\n * the License. You may obtain a copy of the License at\n * http://www.mozilla.org/MPL/\n *\n * Software distributed under the License is distributed on an \"AS IS\" basis,\n * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n * for the specific language governing rights and limitations under the\n * License.\n *\n * The Original Code is Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\n *\n * The Initial Developer of the Original Code is\n * Anthony Minessale II <anthm@freeswitch.org>\n * Portions created by the Initial Developer are Copyright (C)\n * the Initial Developer. All Rights Reserved.\n *\n * Contributor(s):\n *\n * Anthony Minessale II <anthm@freeswitch.org>\n *\n * jquery.FSRTC.js - WebRTC Glue code\n *\n */\n\n(function($) {\n\n    // Find the line in sdpLines that starts with |prefix|, and, if specified,\n    // contains |substr| (case-insensitive search).\n    function findLine(sdpLines, prefix, substr) {\n        return findLineInRange(sdpLines, 0, -1, prefix, substr);\n    }\n\n    // Find the line in sdpLines[startLine...endLine - 1] that starts with |prefix|\n    // and, if specified, contains |substr| (case-insensitive search).\n    function findLineInRange(sdpLines, startLine, endLine, prefix, substr) {\n        var realEndLine = (endLine != -1) ? endLine : sdpLines.length;\n        for (var i = startLine; i < realEndLine; ++i) {\n            if (sdpLines[i].indexOf(prefix) === 0) {\n                if (!substr || sdpLines[i].toLowerCase().indexOf(substr.toLowerCase()) !== -1) {\n                    return i;\n                }\n            }\n        }\n        return null;\n    }\n\n    // Gets the codec payload type from an a=rtpmap:X line.\n    function getCodecPayloadType(sdpLine) {\n        var pattern = new RegExp('a=rtpmap:(\\\\d+) \\\\w+\\\\/\\\\d+');\n        var result = sdpLine.match(pattern);\n        return (result && result.length == 2) ? result[1] : null;\n    }\n\n    // Returns a new m= line with the specified codec as the first one.\n    function setDefaultCodec(mLine, payload) {\n        var elements = mLine.split(' ');\n        var newLine = [];\n        var index = 0;\n        for (var i = 0; i < elements.length; i++) {\n            if (index === 3) { // Format of media starts from the fourth.\n                newLine[index++] = payload; // Put target payload to the first.\n            }\n            if (elements[i] !== payload) newLine[index++] = elements[i];\n        }\n        return newLine.join(' ');\n    }\n\n    $.FSRTC = function(options) {\n        this.options = $.extend({\n            useVideo: null,\n            useStereo: false,\n            userData: null,\n\t    localVideo: null,\n\t    screenShare: false,\n\t    useCamera: \"any\",\n            iceServers: false,\n            videoParams: {},\n            audioParams: {},\n            callbacks: {\n                onICEComplete: function() {},\n                onICE: function() {},\n                onOfferSDP: function() {}\n            },\n      useStream: null,\n        }, options);\n\n\tthis.audioEnabled = true;\n\tthis.videoEnabled = true;\n\n\n        this.mediaData = {\n            SDP: null,\n            profile: {},\n            candidateList: []\n        };\n\n\tthis.constraints = {\n\t    offerToReceiveAudio: this.options.useSpeak === \"none\" ? false : true,\n\t    offerToReceiveVideo: this.options.useVideo ? true : false,\n\t};\n\n        if (self.options.useVideo) {\n            self.options.useVideo.style.display = 'none';\n        }\n\n        setCompat();\n        checkCompat();\n    };\n\n    $.FSRTC.validRes = [];\n\n    $.FSRTC.prototype.useVideo = function(obj, local) {\n        var self = this;\n\n        if (obj) {\n            self.options.useVideo = obj;\n\t    self.options.localVideo = local;\n\t    self.constraints.offerToReceiveVideo = true;\n        } else {\n            self.options.useVideo = null;\n\t    self.options.localVideo = null;\n\t    self.constraints.offerToReceiveVideo = false;\n        }\n\n        if (self.options.useVideo) {\n            self.options.useVideo.style.display = 'none';\n        }\n    };\n\n    $.FSRTC.prototype.useStereo = function(on) {\n        var self = this;\n        self.options.useStereo = on;\n    };\n\n    // Sets Opus in stereo if stereo is enabled, by adding the stereo=1 fmtp param.\n    $.FSRTC.prototype.stereoHack = function(sdp) {\n        var self = this;\n\n        if (!self.options.useStereo) {\n            return sdp;\n        }\n\n        var sdpLines = sdp.split('\\r\\n');\n\n        // Find opus payload.\n        var opusIndex = findLine(sdpLines, 'a=rtpmap', 'opus/48000'), opusPayload;\n\n        if (!opusIndex) {\n\t    return sdp;\n\t} else {\n            opusPayload = getCodecPayloadType(sdpLines[opusIndex]);\n        }\n\n        // Find the payload in fmtp line.\n        var fmtpLineIndex = findLine(sdpLines, 'a=fmtp:' + opusPayload.toString());\n\n        if (fmtpLineIndex === null) {\n\t    // create an fmtp line\n\t    sdpLines[opusIndex] = sdpLines[opusIndex] + '\\r\\na=fmtp:' + opusPayload.toString() + \" stereo=1; sprop-stereo=1\"\n\t} else {\n            // Append stereo=1 to fmtp line.\n            sdpLines[fmtpLineIndex] = sdpLines[fmtpLineIndex].concat('; stereo=1; sprop-stereo=1');\n\t}\n\n        sdp = sdpLines.join('\\r\\n');\n        return sdp;\n    };\n\n    function setCompat() {\n    }\n\n    function checkCompat() {\n        return true;\n    }\n\n    function onStreamError(self, e) {\n        console.log('There has been a problem retrieving the streams - did you allow access? Check Device Resolution', e);\n        doCallback(self, \"onError\", e);\n    }\n\n    function onStreamSuccess(self, stream) {\n        console.log(\"Stream Success\");\n        doCallback(self, \"onStream\", stream);\n    }\n\n    function onRemoteStreamSuccess(self, stream) {\n      console.log(\"Remote Stream Success\");\n      doCallback(self, \"onRemoteStream\", stream);\n    }\n\n    function onICE(self, candidate) {\n        self.mediaData.candidate = candidate;\n        self.mediaData.candidateList.push(self.mediaData.candidate);\n\n        doCallback(self, \"onICE\");\n    }\n\n    function doCallback(self, func, arg) {\n        if (func in self.options.callbacks) {\n            self.options.callbacks[func](self, arg);\n        }\n    }\n\n    function onICEComplete(self, candidate) {\n        console.log(\"ICE Complete\");\n        doCallback(self, \"onICEComplete\");\n    }\n\n    function onChannelError(self, e) {\n        console.error(\"Channel Error\", e);\n        doCallback(self, \"onError\", e);\n    }\n\n    function onICESDP(self, sdp) {\n        self.mediaData.SDP = self.stereoHack(sdp.sdp);\n        console.log(\"ICE SDP\");\n        doCallback(self, \"onICESDP\");\n    }\n\n    function onAnswerSDP(self, sdp) {\n        self.answer.SDP = self.stereoHack(sdp.sdp);\n        console.log(\"ICE ANSWER SDP\");\n        doCallback(self, \"onAnswerSDP\", self.answer.SDP);\n    }\n\n    function onMessage(self, msg) {\n        console.log(\"Message\");\n        doCallback(self, \"onICESDP\", msg);\n    }\n\n    FSRTCattachMediaStream = function(element, stream) {\n        if (typeof element.srcObject !== 'undefined') {\n\t    element.srcObject = stream;\n\t} else {\n\t    console.error('Error attaching stream to element.');\n\t}\n    }\n\n    function onRemoteStream(self, stream) {\n        if (self.options.useVideo) {\n            self.options.useVideo.style.display = 'block';\n\n\t    // Hacks for Mobile Safari\n\t    var iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;\n\n\t    if (iOS) {\n\t\tself.options.useVideo.setAttribute(\"playsinline\", true);\n\t    }\n        }\n\n        var element = self.options.useAudio;\n        console.log(\"REMOTE STREAM\", stream, element);\n\n\tFSRTCattachMediaStream(element, stream);\n\n\n\n        //self.options.useAudio.play();\n        self.remoteStream = stream;\n        onRemoteStreamSuccess(self, stream);\n    }\n\n    function onOfferSDP(self, sdp) {\n        self.mediaData.SDP = self.stereoHack(sdp.sdp);\n        console.log(\"Offer SDP\");\n        doCallback(self, \"onOfferSDP\");\n    }\n\n    $.FSRTC.prototype.answer = function(sdp, onSuccess, onError) {\n        this.peer.addAnswerSDP({\n            type: \"answer\",\n            sdp: sdp\n        },\n        onSuccess, onError);\n    };\n\n    $.FSRTC.prototype.stopPeer = function() {\n        if (self.peer) {\n            console.log(\"stopping peer\");\n            self.peer.stop();\n        }\n    }\n\n    $.FSRTC.prototype.stop = function() {\n        var self = this;\n\n        if (self.options.useVideo) {\n            self.options.useVideo.style.display = 'none';\n            self.options.useVideo['src'] = '';\n        }\n\n        if (self.localStream && !self.options.useStream) {\n            var tracks = self.localStream.getTracks();\n            console.log(\"Stopping localStream tracks:\", tracks);\n            tracks.forEach(function(track){ track.stop() })\n            self.localStream = null;\n        }\n\n        if (self.options.localVideo) {\n            deactivateLocalVideo(self.options.localVideo);\n        }\n\n        if (self.options.localVideoStream && !self.options.useStream) {\n            var tracks = self.options.localVideoStream.getTracks();\n            console.log(\"Stopping localVideoStream tracks:\", tracks);\n            tracks.forEach(function(track){ track.stop() })\n        }\n\n        if (self.peer) {\n            console.log(\"stopping peer\");\n            self.peer.stop();\n        }\n    };\n\n    $.FSRTC.prototype.getMute = function() {\n\tvar self = this;\n\treturn self.audioEnabled;\n    }\n\n    $.FSRTC.prototype.setMute = function(what) {\n\tvar self = this;\n    if (!self.localStream) {\n        return false;\n    }\n\tvar audioTracks = self.localStream.getAudioTracks();\n\n\tfor (var i = 0, len = audioTracks.length; i < len; i++ ) {\n\t    switch(what) {\n\t    case \"on\":\n\t\taudioTracks[i].enabled = true;\n\t\tbreak;\n\t    case \"off\":\n\t\taudioTracks[i].enabled = false;\n\t\tbreak;\n\t    case \"toggle\":\n\t\taudioTracks[i].enabled = !audioTracks[i].enabled;\n\t    default:\n\t\tbreak;\n\t    }\n\n\t    self.audioEnabled = audioTracks[i].enabled;\n\t}\n\n\treturn !self.audioEnabled;\n    }\n\n    $.FSRTC.prototype.getVideoMute = function() {\n\tvar self = this;\n\treturn self.videoEnabled;\n    }\n\n    $.FSRTC.prototype.setVideoMute = function(what) {\n\tvar self = this;\n    if (!self.localStream) {\n        return false;\n    }\n\tvar videoTracks = self.localStream.getVideoTracks();\n\n\tfor (var i = 0, len = videoTracks.length; i < len; i++ ) {\n\t    switch(what) {\n\t    case \"on\":\n\t\tvideoTracks[i].enabled = true;\n\t\tbreak;\n\t    case \"off\":\n\t\tvideoTracks[i].enabled = false;\n\t\tbreak;\n\t    case \"toggle\":\n\t\tvideoTracks[i].enabled = !videoTracks[i].enabled;\n\t    default:\n\t\tbreak;\n\t    }\n\n\t    self.videoEnabled = videoTracks[i].enabled;\n\t}\n\n\treturn !self.videoEnabled;\n    }\n\n    $.FSRTC.prototype.createAnswer = function(params) {\n        var self = this;\n        self.type = \"answer\";\n        self.remoteSDP = params.sdp;\n        console.debug(\"inbound sdp: \", params.sdp);\n\n        function onSuccess(stream) {\n            self.localStream = stream;\n\n            self.peer = FSRTCPeerConnection({\n                type: self.type,\n                attachStream: self.localStream,\n                onICE: function(candidate) {\n                    return onICE(self, candidate);\n                },\n                onICEComplete: function() {\n                    return onICEComplete(self);\n                },\n                onRemoteStream: function(stream) {\n                    return onRemoteStream(self, stream);\n                },\n                onICESDP: function(sdp) {\n                    return onICESDP(self, sdp);\n                },\n                onChannelError: function(e) {\n                    return onChannelError(self, e);\n                },\n                constraints: self.constraints,\n                iceServers: self.options.iceServers,\n                offerSDP: {\n                    type: \"offer\",\n                    sdp: self.remoteSDP\n                },\n                turnServer: self.options.turnServer\n            });\n\n            onStreamSuccess(self, stream);\n        }\n\n        function onError(e) {\n            onStreamError(self, e);\n        }\n\n\tvar mediaParams = getMediaParams(self);\n\n\tconsole.log(\"Audio constraints\", mediaParams.audio);\n\tconsole.log(\"Video constraints\", mediaParams.video);\n\n    if (self.options.useVideo && self.options.localVideo && !self.options.useStream) {\n            getUserMedia({\n\t\tconstraints: {\n                    audio: false,\n                    video: { deviceId: params.useCamera },\n\t\t},\n        localVideo: self.options.localVideo,\n        useCameraLabel: self.options.useCameraLabel,\n        useMicLabel: self.options.useMicLabel,\n\t\tonsuccess: function(e) {self.options.localVideoStream = e; console.log(\"local video ready\");},\n\t\tonerror: function(e) {console.error(\"local video error!\", e);}\n            });\n\t}\n\n    if (self.options.useStream) {\n      if (self.options.useVideo) {\n        self.options.localVideoStream = self.options.useStream;\n        if (self.options.localVideo) {\n          activateLocalVideo(self.options.localVideo, self.options.useStream);\n        }\n      }\n      onSuccess(self.options.useStream);\n    }\n    else {\n      getUserMedia({\n        constraints: {\n          audio: mediaParams.audio,\n          video: mediaParams.video\n        },\n        video: mediaParams.useVideo,\n        useCameraLabel: self.options.useCameraLabel,\n        useMicLabel: self.options.useMicLabel,\n        onsuccess: onSuccess,\n        onerror: onError\n      });\n    }\n\n    };\n\n    function getMediaParams(obj) {\n\n\tvar audio;\n\n\tif (obj.options.useMic && obj.options.useMic === \"none\") {\n\t    console.log(\"Microphone Disabled\");\n\t    audio = false;\n\t} else if (obj.options.videoParams && obj.options.screenShare) {//obj.options.videoParams.chromeMediaSource == 'desktop') {\n\t    console.error(\"SCREEN SHARE\", obj.options.videoParams);\n\t    audio = false;\n\t} else {\n\t    audio = {\n\t    };\n\n\t    if (obj.options.audioParams) {\n\t        audio = obj.options.audioParams;\n            }\n\n\t    if (obj.options.useMic !== \"any\") {\n\t\t//audio.optional = [{sourceId: obj.options.useMic}];\n\t\taudio.deviceId = assignMediaIdToConstraint(obj.options.useMic);\n\t    }\n\t}\n\n    if (obj.options.useVideo && obj.options.localVideo && !obj.options.useStream) {\n            getUserMedia({\n\t\tconstraints: {\n                    audio: false,\n                    video: { deviceId: obj.options.useCamera },\n\t\t},\n        localVideo: obj.options.localVideo,\n        useCameraLabel: obj.options.useCameraLabel,\n        useMicLabel: obj.options.useMicLabel,\n\t\tonsuccess: function(e) {obj.options.localVideoStream = e; console.log(\"local video ready\");},\n\t\tonerror: function(e) {console.error(\"local video error!\", e); }\n            });\n\t}\n\n\tvar video = {};\n\tvar bestFrameRate = obj.options.videoParams.vertoBestFrameRate;\n\tvar minFrameRate = obj.options.videoParams.minFrameRate || 15;\n\tdelete obj.options.videoParams.vertoBestFrameRate;\n\n\tif (obj.options.screenShare) {\n\t    if (!obj.options.useCamera && !!navigator.mozGetUserMedia) {\n\t\t//This is an issue, only FireFox needs to ask this additional question if its screen or window we need a better way\n\t\tvar dowin = window.confirm(\"Do you want to share an application window?  If not you can share an entire screen.\");\n\n\t\tvideo = {\n\t\t    width: {min: obj.options.videoParams.minWidth, max: obj.options.videoParams.maxWidth},\n\t\t    height: {min: obj.options.videoParams.minHeight, max: obj.options.videoParams.maxHeight},\n\t\t    mediaSource: dowin ? \"window\" : \"screen\"\n\t\t}\n\t    } else {\n\t\tvar opt = [];\n\t\tif (obj.options.useCamera) {\n\t\t    opt.push({sourceId: obj.options.useCamera});\n\t\t}\n\n\t\tif (bestFrameRate) {\n\t\t    opt.push({minFrameRate: bestFrameRate});\n\t\t    opt.push({maxFrameRate: bestFrameRate});\n\t\t}\n\n\t\tvideo = {\n\t\t    mandatory: obj.options.videoParams,\n\t\t    optional: opt\n\t\t};\n\t    }\n\t} else {\n\n\t    video = {\n\t\t//mandatory: obj.options.videoParams,\n\t\twidth: {min: obj.options.videoParams.minWidth, max: obj.options.videoParams.maxWidth},\n\t\theight: {min: obj.options.videoParams.minHeight, max: obj.options.videoParams.maxHeight}\n\t    };\n\n\n\n\t    var useVideo = obj.options.useVideo;\n\n\t    if (useVideo && obj.options.useCamera && obj.options.useCamera !== \"none\") {\n\t\t//if (!video.optional) {\n\t\t//video.optional = [];\n\t\t//}\n\n\n\t\tif (obj.options.useCamera !== \"any\") {\n\t\t    //video.optional.push({sourceId: obj.options.useCamera});\n        video = assignMediaIdToConstraint(obj.options.useCamera, video);\n\t\t}\n\n\t\tif (bestFrameRate) {\n\t\t    //video.optional.push({minFrameRate: bestFrameRate});\n\t\t    //video.optional.push({maxFrameRate: bestFrameRate});\n\t\t    video.frameRate = {ideal: bestFrameRate, min: minFrameRate, max: 30};\n\t\t}\n\n\t    } else {\n\t\tconsole.log(\"Camera Disabled\");\n\t\tvideo = false;\n\t\tuseVideo = false;\n\t    }\n\t}\n\n\treturn {audio: audio, video: video, useVideo: useVideo};\n    }\n\n    $.FSRTC.prototype.call = function(profile) {\n        checkCompat();\n\n        var self = this;\n\tvar screen = false;\n\n        self.type = \"offer\";\n\n\tif (self.options.videoParams && self.options.screenShare) { //self.options.videoParams.chromeMediaSource == 'desktop') {\n\t    screen = true;\n\t}\n\n        function onSuccess(stream) {\n\t    self.localStream = stream;\n\n\t    if (screen) {\n\t\tself.constraints.offerToReceiveVideo = false;\n\t\tself.constraints.offerToReceiveAudio = false;\n\t\tself.constraints.offerToSendAudio = false;\n\t    }\n\n            self.peer = FSRTCPeerConnection({\n                type: self.type,\n                attachStream: self.localStream,\n                onICE: function(candidate) {\n                    return onICE(self, candidate);\n                },\n                onICEComplete: function() {\n                    return onICEComplete(self);\n                },\n                onRemoteStream: screen ? function(stream) {} : function(stream) {\n                    return onRemoteStream(self, stream);\n                },\n                onOfferSDP: function(sdp) {\n                    return onOfferSDP(self, sdp);\n                },\n                onICESDP: function(sdp) {\n                    return onICESDP(self, sdp);\n                },\n                onChannelError: function(e) {\n                    return onChannelError(self, e);\n                },\n                constraints: self.constraints,\n                iceServers: self.options.iceServers,\n                turnServer: self.options.turnServer\n            });\n\n            onStreamSuccess(self, stream);\n        }\n\n        function onError(e) {\n            onStreamError(self, e);\n        }\n\n\tvar mediaParams = getMediaParams(self);\n\n\tconsole.log(\"Audio constraints\", mediaParams.audio);\n\tconsole.log(\"Video constraints\", mediaParams.video);\n\n    if (self.options.useStream) {\n      if (self.options.useVideo) {\n        self.options.localVideoStream = self.options.useStream;\n        if (self.options.localVideo) {\n          activateLocalVideo(self.options.localVideo, self.options.useStream);\n        }\n      }\n      onSuccess(self.options.useStream);\n    }\n    else if (mediaParams.audio || mediaParams.video) {\n            getUserMedia({\n\t\tconstraints: {\n                    audio: mediaParams.audio,\n                    video: mediaParams.video\n\t\t},\n\t\tvideo: mediaParams.useVideo,\n\t\tonsuccess: onSuccess,\n        onerror: onError,\n        useCameraLabel: self.options.useCameraLabel,\n        useMicLabel: self.options.useMicLabel,\n            });\n\n\t} else {\n\t    onSuccess(null);\n\t}\n\n\n\n        /*\n        navigator.getUserMedia({\n            video: self.options.useVideo,\n            audio: true\n        }, onSuccess, onError);\n        */\n\n    };\n\n    // DERIVED from RTCPeerConnection-v1.5\n    // 2013, @muazkh - github.com/muaz-khan\n    // MIT License - https://www.webrtc-experiment.com/licence/\n    // Documentation - https://github.com/muaz-khan/WebRTC-Experiment/tree/master/RTCPeerConnection\n\n    function FSRTCPeerConnection(options) {\n\tvar gathering = false, done = false;\n\tvar config = {};\n        var default_ice = [{ urls: ['stun:stun.l.google.com:19302'] }];\n\n        if (self.options.turnServer) {\n          default_ice.push(self.options.turnServer)\n        }\n\n        if (options.iceServers) {\n            if (typeof(options.iceServers) === \"boolean\") {\n\t\tconfig.iceServers = default_ice;\n            } else {\n\t\tconfig.iceServers = options.iceServers;\n\t    }\n        }\n\n\tconfig.bundlePolicy = \"max-compat\";\n\tconfig.sdpSemantics = \"plan-b\";\n\n        var peer = new window.RTCPeerConnection(config);\n\n        openOffererChannel();\n        var x = 0;\n\n\tfunction ice_handler() {\n\n\t    done = true;\n\t    gathering = null;\n\n            if (options.onICEComplete) {\n                options.onICEComplete();\n            }\n\n            if (options.type == \"offer\") {\n                options.onICESDP(peer.localDescription);\n            } else {\n                if (!x && options.onICESDP) {\n                    options.onICESDP(peer.localDescription);\n                }\n            }\n        }\n\n        peer.onicecandidate = function(event) {\n\n\t    if (done) {\n\t\treturn;\n\t    }\n\n\t    if (!gathering) {\n\t\tgathering = setTimeout(ice_handler, 1000);\n\t    }\n\n\t    if (event) {\n\t\tif (event.candidate) {\n\t\t    options.onICE(event.candidate);\n\t\t}\n\t    } else {\n\t\tdone = true;\n\n\t\tif (gathering) {\n\t\t    clearTimeout(gathering);\n\t\t    gathering = null;\n\t\t}\n\n\t\tice_handler();\n\t    }\n        };\n\n        // attachStream = MediaStream;\n        if (options.attachStream) {\n          // FreeSWITCH currently orders its answer SDP such that audio m-lines\n          // always come first, adding the tracks to the peer in that order\n          // prevents possible m-line ordering validation errors on the client.\n          options.attachStream.getAudioTracks().forEach(function(track) { peer.addTrack(track, options.attachStream) });\n          options.attachStream.getVideoTracks().forEach(function(track) { peer.addTrack(track, options.attachStream) });\n        }\n\n        // attachStreams[0] = audio-stream;\n        // attachStreams[1] = video-stream;\n        // attachStreams[2] = screen-capturing-stream;\n        if (options.attachStreams && options.attachStreams.length) {\n            var streams = options.attachStreams;\n            for (var i = 0; i < streams.length; i++) {\n                peer.addStream(streams[i]);\n            }\n        }\n\n        // peer.onaddstream = function(event) { // OLD API\n        peer.ontrack = function(event) {\n            console.log('Peer Track', event)\n            // var remoteMediaStream = event.stream;\n            var remoteMediaStream = event.streams[0];\n\n            remoteMediaStream.oninactive = function () {\n                if (options.onRemoteStreamEnded) options.onRemoteStreamEnded(remoteMediaStream);\n            };\n\n            if (options.onRemoteStream) options.onRemoteStream(remoteMediaStream);\n        };\n\n        //var constraints = options.constraints || {\n\t  //  offerToReceiveAudio: true,\n\t    //offerToReceiveVideo: true\n        //};\n\n        // onOfferSDP(RTCSessionDescription)\n        function createOffer() {\n            if (!options.onOfferSDP) return;\n\n            peer.createOffer(function(sessionDescription) {\n                sessionDescription.sdp = serializeSdp(sessionDescription.sdp);\n                peer.setLocalDescription(sessionDescription);\n                options.onOfferSDP(sessionDescription);\n            },\n\t\t\t\tonSdpError, options.constraints);\n        }\n\n        // onAnswerSDP(RTCSessionDescription)\n        function createAnswer() {\n            if (options.type != \"answer\") return;\n\n            //options.offerSDP.sdp = addStereo(options.offerSDP.sdp);\n            peer.setRemoteDescription(new window.RTCSessionDescription(options.offerSDP), onSdpSuccess, onSdpError);\n            peer.createAnswer(function(sessionDescription) {\n                sessionDescription.sdp = serializeSdp(sessionDescription.sdp);\n                peer.setLocalDescription(sessionDescription);\n                if (options.onAnswerSDP) {\n                    options.onAnswerSDP(sessionDescription);\n                }\n            },\n            onSdpError);\n        }\n\n\n        if ((options.onChannelMessage) || !options.onChannelMessage) {\n            createOffer();\n            createAnswer();\n        }\n\n        // DataChannel Bandwidth\n        function setBandwidth(sdp) {\n            // remove existing bandwidth lines\n            sdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\n            sdp = sdp.replace(/a=mid:data\\r\\n/g, 'a=mid:data\\r\\nb=AS:1638400\\r\\n');\n\n            return sdp;\n        }\n\n        // old: FF<>Chrome interoperability management\n        function getInteropSDP(sdp) {\n            var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''),\n            extractedChars = '';\n\n            function getChars() {\n                extractedChars += chars[parseInt(Math.random() * 40)] || '';\n                if (extractedChars.length < 40) getChars();\n\n                return extractedChars;\n            }\n\n            // usually audio-only streaming failure occurs out of audio-specific crypto line\n            // a=crypto:1 AES_CM_128_HMAC_SHA1_32 --------- kAttributeCryptoVoice\n            if (options.onAnswerSDP) sdp = sdp.replace(/(a=crypto:0 AES_CM_128_HMAC_SHA1_32)(.*?)(\\r\\n)/g, '');\n\n            // video-specific crypto line i.e. SHA1_80\n            // a=crypto:1 AES_CM_128_HMAC_SHA1_80 --------- kAttributeCryptoVideo\n            var inline = getChars() + '\\r\\n' + (extractedChars = '');\n            sdp = sdp.indexOf('a=crypto') == -1 ? sdp.replace(/c=IN/g, 'a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:' + inline + 'c=IN') : sdp;\n\n            return sdp;\n        }\n\n        function serializeSdp(sdp) {\n            return sdp;\n        }\n\n        // DataChannel management\n        var channel;\n\n        function openOffererChannel() {\n            if (!options.onChannelMessage) return;\n\n            _openOffererChannel();\n\n            return;\n        }\n\n        function _openOffererChannel() {\n            channel = peer.createDataChannel(options.channel || 'RTCDataChannel', {\n                reliable: false\n            });\n\n            setChannelEvents();\n        }\n\n        function setChannelEvents() {\n            channel.onmessage = function(event) {\n                if (options.onChannelMessage) options.onChannelMessage(event);\n            };\n\n            channel.onopen = function() {\n                if (options.onChannelOpened) options.onChannelOpened(channel);\n            };\n            channel.onclose = function(event) {\n                if (options.onChannelClosed) options.onChannelClosed(event);\n\n                console.warn('WebRTC DataChannel closed', event);\n            };\n            channel.onerror = function(event) {\n                if (options.onChannelError) options.onChannelError(event);\n\n                console.error('WebRTC DataChannel error', event);\n            };\n        }\n\n        function openAnswererChannel() {\n            peer.ondatachannel = function(event) {\n                channel = event.channel;\n                channel.binaryType = 'blob';\n                setChannelEvents();\n            };\n\n            return;\n        }\n\n        // fake:true is also available on chrome under a flag!\n        function useless() {\n            log('Error in fake:true');\n        }\n\n        function onSdpSuccess() {}\n\n        function onSdpError(e) {\n            if (options.onChannelError) {\n                options.onChannelError(e);\n            }\n            console.error('sdp error:', e);\n        }\n\n        return {\n            addAnswerSDP: function(sdp, cbSuccess, cbError) {\n\n                peer.setRemoteDescription(new window.RTCSessionDescription(sdp), cbSuccess ? cbSuccess : onSdpSuccess, cbError ? cbError : onSdpError);\n            },\n            addICE: function(candidate) {\n                peer.addIceCandidate(new window.RTCIceCandidate({\n                    sdpMLineIndex: candidate.sdpMLineIndex,\n                    candidate: candidate.candidate\n                }));\n            },\n\n            peer: peer,\n            channel: channel,\n            sendData: function(message) {\n                if (channel) {\n                    channel.send(message);\n                }\n            },\n\n            stop: function() {\n                if (options.attachStream instanceof MediaStream) {\n                    var tracks = options.attachStream.getTracks();\n                    tracks.forEach(function(track){ track.stop() })\n                    options.attachStream = null\n                }\n                peer.close();\n            }\n        };\n    }\n\n    // getUserMedia\n    var video_constraints = {\n        //mandatory: {},\n        //optional: []\n    };\n\n  function activateLocalVideo(el, stream) {\n    el.srcObject = stream;\n    el.style.display = 'block';\n  }\n\n  function deactivateLocalVideo(el) {\n    el.srcObject = null;\n    el.style.display = 'none';\n  }\n\n    function assureConstraintByLabel(constraint, fallbackLabel) {\n        if (fallbackLabel === undefined && constraint === undefined) {\n            return Promise.resolve(constraint);\n        }\n\n        if (typeof(assureMediaInputId) !== 'function') {\n            console.warn('Tried to use constraint fallbacks but did not found vendor function `assureMediaInputId` on window scope. Did you forget to import `vendor/media-device-id.js` before Verto?');\n            return Promise.resolve(constraint);\n        }\n\n        if (typeof(constraint) === 'object' && !constraint.deviceId) {\n            return Promise.resolve(constraint);\n        }\n\n        if (constraint.deviceId) {\n            if (typeof(constraint.deviceId) === 'string') {\n                return new Promise(function(resolve) {\n                    assureMediaInputId(fallbackLabel, constraint.deviceId).then(function(id) {\n                        resolve(Object.assign({}, constraint, { deviceId: id }));\n                    }).catch(function() {\n                        resolve(constraint);\n                    });\n                });\n            }\n\n            if (typeof(constraint.deviceId) === 'object' && typeof(constraint.deviceId.exact) === 'string') {\n                return new Promise(function(resolve) {\n                    assureMediaInputId(fallbackLabel, constraint.deviceId.exact).then(function(id) {\n                        resolve(assignMediaIdToConstraint(id, constraint));\n                    }).catch(function() {\n                        resolve(constraint);\n                    });\n                });\n            }\n        }\n\n        return Promise.resolve(constraint);\n    }\n\n    function trustyGetUserMedia(options, constraints) {\n        navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {\n            if (options.localVideo) {\n                activateLocalVideo(options.localVideo, stream);\n            }\n\n            if (options.onsuccess) {\n                options.onsuccess(stream);\n            }\n        }).catch(options.onerror || function(e) {\n            console.error(e);\n        });\n    }\n\n    function assignMediaIdToConstraint(mediaId, rest) {\n        return Object.assign({}, rest || {}, { deviceId: { exact: mediaId } });\n    }\n\n    function getUserMedia(options) {\n        var constraints = options.constraints || {\n            audio: true,\n            video: video_constraints,\n        };\n\n        Promise.all([\n            assureConstraintByLabel(constraints.audio, options.useMicLabel),\n            assureConstraintByLabel(constraints.video, options.useCameraLabel),\n        ]).then(function(assurances) {\n            trustyGetUserMedia(options, { audio: assurances[0], video: assurances[1] });\n        }).catch(function(error) {\n            console.error('Unexpected error on media id assurance attempts:', error, 'Options:', options);\n        });\n    }\n    $.FSRTC.resSupported = function(w, h) {\n\tfor (var i in $.FSRTC.validRes) {\n\t    if ($.FSRTC.validRes[i][0] == w && $.FSRTC.validRes[i][1] == h) {\n\t\treturn true;\n\t    }\n\t}\n\n\treturn false;\n    }\n\n    $.FSRTC.bestResSupported = function() {\n\tvar w = 0, h = 0;\n\n\tfor (var i in $.FSRTC.validRes) {\n\t    if ($.FSRTC.validRes[i][0] >= w && $.FSRTC.validRes[i][1] >= h) {\n\t\tw = $.FSRTC.validRes[i][0];\n\t\th = $.FSRTC.validRes[i][1];\n\t    }\n\t}\n\n\treturn [w, h];\n    }\n\n    var resList = [[160, 120], [320, 180], [320, 240], [640, 360], [640, 480], [1280, 720], [1920, 1080]];\n    var resI = 0;\n    var ttl = 0;\n\n    var checkRes = function (cam, func) {\n\n\tif (resI >= resList.length) {\n            var res = {\n               'validRes': $.FSRTC.validRes,\n               'bestResSupported': $.FSRTC.bestResSupported()\n            };\n\n\t    localStorage.setItem(\"res_\" + cam, $.toJSON(res));\n\n\t    if (func) return func(res);\n\t    return;\n\t}\n\n\tw = resList[resI][0];\n\th = resList[resI][1];\n\tresI++;\n\n\tvar video = {\n\t    width: {exact: w},\n\t    height: {exact: h}\n\t};\n\n  if (cam !== \"any\") {\n    video = assignMediaIdToConstraint(cam, video);\n  }\n\n\t    getUserMedia({\n\t    constraints: { audio: ttl++ == 0, video: video },\n\t    onsuccess: function(e) {\n            e.getTracks().forEach(function(track) { track.stop() });\n            console.info(w + \"x\" + h + \" supported.\"); $.FSRTC.validRes.push([w, h]); checkRes(cam, func);\n        },\n\t    onerror: function(e) {console.warn( w + \"x\" + h + \" not supported.\"); checkRes(cam, func);}\n        });\n    }\n\n\n    $.FSRTC.getValidRes = function (cam, func) {\n\tvar used = [];\n\tvar cached = localStorage.getItem(\"res_\" + cam);\n\n\tif (cached) {\n\t    var cache = $.parseJSON(cached);\n\n\t    if (cache) {\n\t\t$.FSRTC.validRes = cache.validRes;\n\t\tconsole.log(\"CACHED RES FOR CAM \" + cam, cache);\n\t    } else {\n\t\tconsole.error(\"INVALID CACHE\");\n\t    }\n\t    return func ? func(cache) : null;\n\t}\n\n\n\t$.FSRTC.validRes = [];\n\tresI = 0;\n\n\tcheckRes(cam, func);\n    }\n\n    $.FSRTC.checkPerms = function (runtime, check_audio, check_video) {\n        getUserMedia({\n            constraints: { audio: check_audio, video: check_video },\n            onsuccess: function(e) {\n                e.getTracks().forEach(function(track) { track.stop() });\n                console.info(\"media perm init complete\");\n                if (runtime) {\n                    setTimeout(runtime, 100, true);\n                }\n            },\n            onerror: function(e) {\n                if (check_video && check_audio) {\n                    console.error(\"error, retesting with audio params only\");\n                    return $.FSRTC.checkPerms(runtime, check_audio, false);\n                }\n                console.error(\"media perm init error\");\n                if (runtime) {\n                    runtime(false)\n                }\n            }\n        });\n    }\n\n})(jQuery);\n\n\n/*\n * Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\n * Copyright (C) 2005-2014, Anthony Minessale II <anthm@freeswitch.org>\n *\n * Version: MPL 1.1\n *\n * The contents of this file are subject to the Mozilla Public License Version\n * 1.1 (the \"License\"); you may not use this file except in compliance with\n * the License. You may obtain a copy of the License at\n * http://www.mozilla.org/MPL/\n *\n * Software distributed under the License is distributed on an \"AS IS\" basis,\n * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n * for the specific language governing rights and limitations under the\n * License.\n *\n * The Original Code is Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\n *\n * The Initial Developer of the Original Code is\n * Anthony Minessale II <anthm@freeswitch.org>\n * Portions created by the Initial Developer are Copyright (C)\n * the Initial Developer. All Rights Reserved.\n *\n * Contributor(s):\n *\n * Anthony Minessale II <anthm@freeswitch.org>\n *\n * jquery.verto.js - Main interface\n *\n */\n\n(function($) {\n    var sources = [];\n\n    var generateGUID = (typeof(window.crypto) !== 'undefined' && typeof(window.crypto.getRandomValues) !== 'undefined') ?\n    function() {\n        // If we have a cryptographically secure PRNG, use that\n        // http://stackoverflow.com/questions/6906916/collisions-when-generating-uuids-in-javascript\n        var buf = new Uint16Array(8);\n        window.crypto.getRandomValues(buf);\n        var S4 = function(num) {\n            var ret = num.toString(16);\n            while (ret.length < 4) {\n                ret = \"0\" + ret;\n            }\n            return ret;\n        };\n        return (S4(buf[0]) + S4(buf[1]) + \"-\" + S4(buf[2]) + \"-\" + S4(buf[3]) + \"-\" + S4(buf[4]) + \"-\" + S4(buf[5]) + S4(buf[6]) + S4(buf[7]));\n    }\n\n    :\n\n    function() {\n        // Otherwise, just use Math.random\n        // http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n            var r = Math.random() * 16 | 0,\n            v = c == 'x' ? r : (r & 0x3 | 0x8);\n            return v.toString(16);\n        });\n    };\n\n    /// MASTER OBJ\n    $.verto = function(options, callbacks) {\n        var verto = this;\n\n        $.verto.saved.push(verto);\n\n        verto.options = $.extend({\n            login: null,\n            passwd: null,\n            socketUrl: null,\n            tag: null,\n\t    localTag: null,\n            videoParams: {},\n            audioParams: {},\n\t    loginParams: {},\n\t    deviceParams: {onResCheck: null},\n\t    userVariables: {},\n            iceServers: false,\n            ringSleep: 6000,\n      sessid: null,\n      useStream: null\n        }, options);\n\n\tif (verto.options.deviceParams.useCamera) {\n\t    $.FSRTC.getValidRes(verto.options.deviceParams.useCamera, verto.options.deviceParams.onResCheck);\n\t}\n\n\tif (!verto.options.deviceParams.useMic) {\n\t    verto.options.deviceParams.useMic = \"any\";\n\t}\n\n\tif (!verto.options.deviceParams.useSpeak) {\n\t    verto.options.deviceParams.useSpeak = \"any\";\n\t}\n\n\tif (verto.options.sessid) {\n\t    verto.sessid = verto.options.sessid;\n\t} else {\n            verto.sessid = localStorage.getItem(\"verto_session_uuid\") || generateGUID();\n\t    localStorage.setItem(\"verto_session_uuid\", verto.sessid);\n\t}\n\n        verto.dialogs = {};\n        verto.callbacks = callbacks || {};\n        verto.eventSUBS = {};\n\n        verto.rpcClient = new $.JsonRpcClient({\n            login: verto.options.login,\n            passwd: verto.options.passwd,\n            socketUrl: verto.options.socketUrl,\n            wsFallbackURL: verto.options.wsFallbackURL,\n            turnServer: verto.options.turnServer,\n\t    loginParams: verto.options.loginParams,\n\t    userVariables: verto.options.userVariables,\n            sessid: verto.sessid,\n            onmessage: function(e) {\n                return verto.handleMessage(e.eventData);\n            },\n            onWSConnect: function(o) {\n                o.call('login', {});\n            },\n            onWSLogin: function(success) {\n                if (verto.callbacks.onWSLogin) {\n                    verto.callbacks.onWSLogin(verto, success);\n                }\n            },\n            onWSClose: function(success) {\n                if (verto.callbacks.onWSClose) {\n                    verto.callbacks.onWSClose(verto, success);\n                }\n                verto.purge();\n            }\n        });\n\n        var tag = verto.options.tag;\n        if (typeof(tag) === \"function\") {\n          tag = tag();\n        }\n\n        if (verto.options.ringFile && verto.options.tag) {\n            verto.ringer = $(\"#\" + tag);\n        }\n\n        verto.rpcClient.call('login', {});\n\n    };\n\n\n    $.verto.prototype.deviceParams = function(obj) {\n        var verto = this;\n\n\tfor (var i in obj) {\n            verto.options.deviceParams[i] = obj[i];\n\t}\n\n\tif (obj.useCamera) {\n\t    $.FSRTC.getValidRes(verto.options.deviceParams.useCamera, obj ? obj.onResCheck : undefined);\n\t}\n    };\n\n    $.verto.prototype.videoParams = function(obj) {\n        var verto = this;\n\n\tfor (var i in obj) {\n            verto.options.videoParams[i] = obj[i];\n\t}\n    };\n\n    $.verto.prototype.iceServers = function(obj) {\n        var verto = this;\n        verto.options.iceServers = obj;\n    };\n\n    $.verto.prototype.loginData = function(params) {\n\tvar verto = this;\n        verto.options.login = params.login;\n        verto.options.passwd = params.passwd;\n        verto.rpcClient.loginData(params);\n    };\n\n    $.verto.prototype.logout = function(msg) {\n        var verto = this;\n        verto.rpcClient.closeSocket();\n        if (verto.callbacks.onWSClose) {\n            verto.callbacks.onWSClose(verto, false);\n        }\n        verto.purge();\n    };\n\n    $.verto.prototype.login = function(msg) {\n        var verto = this;\n        verto.logout();\n        verto.rpcClient.call('login', {});\n    };\n\n    $.verto.prototype.message = function(msg) {\n        var verto = this;\n        var err = 0;\n\n        if (!msg.to) {\n            console.error(\"Missing To\");\n            err++;\n        }\n\n        if (!msg.body) {\n            console.error(\"Missing Body\");\n            err++;\n        }\n\n        if (err) {\n            return false;\n        }\n\n        verto.sendMethod(\"verto.info\", {\n            msg: msg\n        });\n\n        return true;\n    };\n\n    $.verto.prototype.processReply = function(method, success, e) {\n        var verto = this;\n        var i;\n\n        //console.log(\"Response: \" + method, success, e);\n\n        switch (method) {\n        case \"verto.subscribe\":\n            for (i in e.unauthorizedChannels) {\n                drop_bad(verto, e.unauthorizedChannels[i]);\n            }\n            for (i in e.subscribedChannels) {\n                mark_ready(verto, e.subscribedChannels[i]);\n            }\n\n            break;\n        case \"verto.unsubscribe\":\n            //console.error(e);\n            break;\n        }\n    };\n\n    $.verto.prototype.sendMethod = function(method, params) {\n        var verto = this;\n\n        verto.rpcClient.call(method, params,\n\n        function(e) {\n            /* Success */\n            verto.processReply(method, true, e);\n        },\n\n        function(e) {\n            /* Error */\n            verto.processReply(method, false, e);\n        });\n    };\n\n    function do_sub(verto, channel, obj) {\n\n    }\n\n    function drop_bad(verto, channel) {\n        console.error(\"drop unauthorized channel: \" + channel);\n        delete verto.eventSUBS[channel];\n    }\n\n    function mark_ready(verto, channel) {\n        for (var j in verto.eventSUBS[channel]) {\n            verto.eventSUBS[channel][j].ready = true;\n            console.log(\"subscribed to channel: \" + channel);\n            if (verto.eventSUBS[channel][j].readyHandler) {\n                verto.eventSUBS[channel][j].readyHandler(verto, channel);\n            }\n        }\n    }\n\n    var SERNO = 1;\n\n    function do_subscribe(verto, channel, subChannels, sparams) {\n        var params = sparams || {};\n\n        var local = params.local;\n\n        var obj = {\n            eventChannel: channel,\n            userData: params.userData,\n            handler: params.handler,\n            ready: false,\n            readyHandler: params.readyHandler,\n            serno: SERNO++\n        };\n\n        var isnew = false;\n\n        if (!verto.eventSUBS[channel]) {\n            verto.eventSUBS[channel] = [];\n            subChannels.push(channel);\n            isnew = true;\n        }\n\n        verto.eventSUBS[channel].push(obj);\n\n        if (local) {\n            obj.ready = true;\n            obj.local = true;\n        }\n\n        if (!isnew && verto.eventSUBS[channel][0].ready) {\n            obj.ready = true;\n            if (obj.readyHandler) {\n                obj.readyHandler(verto, channel);\n            }\n        }\n\n        return {\n            serno: obj.serno,\n            eventChannel: channel\n        };\n\n    }\n\n    $.verto.prototype.subscribe = function(channel, sparams) {\n        var verto = this;\n        var r = [];\n        var subChannels = [];\n        var params = sparams || {};\n\n        if (typeof(channel) === \"string\") {\n            r.push(do_subscribe(verto, channel, subChannels, params));\n        } else {\n            for (var i in channel) {\n                r.push(do_subscribe(verto, channel, subChannels, params));\n            }\n        }\n\n        if (subChannels.length) {\n            verto.sendMethod(\"verto.subscribe\", {\n                eventChannel: subChannels.length == 1 ? subChannels[0] : subChannels,\n                subParams: params.subParams\n            });\n        }\n\n        return r;\n    };\n\n    $.verto.prototype.unsubscribe = function(handle) {\n        var verto = this;\n        var i;\n\n        if (!handle) {\n            for (i in verto.eventSUBS) {\n                if (verto.eventSUBS[i]) {\n                    verto.unsubscribe(verto.eventSUBS[i]);\n                }\n            }\n        } else {\n            var unsubChannels = {};\n            var sendChannels = [];\n            var channel;\n\n            if (typeof(handle) == \"string\") {\n                delete verto.eventSUBS[handle];\n                unsubChannels[handle]++;\n            } else {\n                for (i in handle) {\n                    if (typeof(handle[i]) == \"string\") {\n                        channel = handle[i];\n                        delete verto.eventSUBS[channel];\n                        unsubChannels[channel]++;\n                    } else {\n                        var repl = [];\n                        channel = handle[i].eventChannel;\n\n                        for (var j in verto.eventSUBS[channel]) {\n                            if (verto.eventSUBS[channel][j].serno == handle[i].serno) {} else {\n                                repl.push(verto.eventSUBS[channel][j]);\n                            }\n                        }\n\n                        verto.eventSUBS[channel] = repl;\n\n                        if (verto.eventSUBS[channel].length === 0) {\n                            delete verto.eventSUBS[channel];\n                            unsubChannels[channel]++;\n                        }\n                    }\n                }\n            }\n\n            for (var u in unsubChannels) {\n                console.log(\"Sending Unsubscribe for: \", u);\n                sendChannels.push(u);\n            }\n\n            if (sendChannels.length) {\n                verto.sendMethod(\"verto.unsubscribe\", {\n                    eventChannel: sendChannels.length == 1 ? sendChannels[0] : sendChannels\n                });\n            }\n        }\n    };\n\n    $.verto.prototype.broadcast = function(channel, params) {\n        var verto = this;\n        var msg = {\n            eventChannel: channel,\n            data: {}\n        };\n        for (var i in params) {\n            msg.data[i] = params[i];\n        }\n        verto.sendMethod(\"verto.broadcast\", msg);\n    };\n\n    $.verto.prototype.purge = function(callID) {\n        var verto = this;\n        var x = 0;\n        var i;\n\n        for (i in verto.dialogs) {\n            if (!x) {\n                console.log(\"purging dialogs\");\n            }\n            x++;\n            verto.dialogs[i].setState($.verto.enum.state.purge);\n        }\n\n        for (i in verto.eventSUBS) {\n            if (verto.eventSUBS[i]) {\n                console.log(\"purging subscription: \" + i);\n                delete verto.eventSUBS[i];\n            }\n        }\n    };\n\n    $.verto.prototype.hangup = function(callID) {\n        var verto = this;\n        if (callID) {\n            var dialog = verto.dialogs[callID];\n\n            if (dialog) {\n                dialog.hangup();\n            }\n        } else {\n            for (var i in verto.dialogs) {\n                verto.dialogs[i].hangup();\n            }\n        }\n    };\n\n    $.verto.prototype.newCall = function(args, callbacks) {\n        var verto = this;\n\n        if (!verto.rpcClient.socketReady()) {\n            console.error(\"Not Connected...\");\n            return;\n        }\n\n        if (args[\"useCamera\"]) {\n            verto.options.deviceParams[\"useCamera\"] = args[\"useCamera\"];\n            verto.options.deviceParams[\"useCameraLabel\"] = args[\"useCameraLabel\"];\n        }\n\n        var dialog = new $.verto.dialog($.verto.enum.direction.outbound, this, args);\n\n        if (callbacks) {\n            dialog.callbacks = callbacks;\n        }\n\n        dialog.invite();\n\n        return dialog;\n    };\n\n    $.verto.prototype.handleMessage = function(data) {\n        var verto = this;\n\n        if (!(data && data.method)) {\n            console.error(\"Invalid Data\", data);\n            return;\n        }\n\n        if (data.params.callID) {\n            var dialog = verto.dialogs[data.params.callID];\n\t    \n\t    if (data.method === \"verto.attach\" && dialog) {\n\t\tdelete dialog.verto.dialogs[dialog.callID];\n\t\tdialog.rtc.stop();\n\t\tdialog = null;\n\t    }\n\n            if (dialog) {\n\n                switch (data.method) {\n                case 'verto.bye':\n                    dialog.hangup(data.params);\n                    break;\n                case 'verto.answer':\n                    dialog.handleAnswer(data.params);\n                    break;\n                case 'verto.media':\n                    dialog.handleMedia(data.params);\n                    break;\n                case 'verto.display':\n                    dialog.handleDisplay(data.params);\n                    break;\n                case 'verto.info':\n                    dialog.handleInfo(data.params);\n                    break;\n                default:\n                    console.debug(\"INVALID METHOD OR NON-EXISTANT CALL REFERENCE IGNORED\", dialog, data.method);\n                    break;\n                }\n            } else {\n\n                switch (data.method) {\n                case 'verto.attach':\n                    data.params.attach = true;\n\n                    if (data.params.sdp && data.params.sdp.indexOf(\"m=video\") > 0) {\n                        data.params.useVideo = true;\n                    }\n\n                    if (data.params.sdp && data.params.sdp.indexOf(\"stereo=1\") > 0) {\n                        data.params.useStereo = true;\n                    }\n\n                    dialog = new $.verto.dialog($.verto.enum.direction.inbound, verto, data.params);\n                    dialog.setState($.verto.enum.state.recovering);\n\n                    break;\n                case 'verto.invite':\n\n                    if (data.params.sdp && data.params.sdp.indexOf(\"m=video\") > 0) {\n                        data.params.wantVideo = true;\n                    }\n\n                    if (data.params.sdp && data.params.sdp.indexOf(\"stereo=1\") > 0) {\n                        data.params.useStereo = true;\n                    }\n\n                    dialog = new $.verto.dialog($.verto.enum.direction.inbound, verto, data.params);\n                    break;\n                default:\n                    console.debug(\"INVALID METHOD OR NON-EXISTANT CALL REFERENCE IGNORED\");\n                    break;\n                }\n            }\n\n            return {\n                method: data.method\n            };\n        } else {\n            switch (data.method) {\n            case 'verto.punt':\n                verto.purge();\n\t\tverto.logout();\n\t\tbreak;\n            case 'verto.event':\n                var list = null;\n                var key = null;\n\n                if (data.params) {\n                    key = data.params.eventChannel;\n                }\n\n                if (key) {\n                    list = verto.eventSUBS[key];\n\n                    if (!list) {\n                        list = verto.eventSUBS[key.split(\".\")[0]];\n                    }\n                }\n\n                if (!list && key && key === verto.sessid) {\n                    if (verto.callbacks.onMessage) {\n                        verto.callbacks.onMessage(verto, null, $.verto.enum.message.pvtEvent, data.params);\n                    }\n                } else if (!list && key && verto.dialogs[key]) {\n                    verto.dialogs[key].sendMessage($.verto.enum.message.pvtEvent, data.params);\n                } else if (!list) {\n                    if (!key) {\n                        key = \"UNDEFINED\";\n                    }\n                    console.error(\"UNSUBBED or invalid EVENT \" + key + \" IGNORED\");\n                } else {\n                    for (var i in list) {\n                        var sub = list[i];\n\n                        if (!sub || !sub.ready) {\n                            console.error(\"invalid EVENT for \" + key + \" IGNORED\");\n                        } else if (sub.handler) {\n                            sub.handler(verto, data.params, sub.userData);\n                        } else if (verto.callbacks.onEvent) {\n                            verto.callbacks.onEvent(verto, data.params, sub.userData);\n                        } else {\n                            console.log(\"EVENT:\", data.params);\n                        }\n                    }\n                }\n\n                break;\n\n            case \"verto.info\":\n                if (verto.callbacks.onMessage) {\n                    verto.callbacks.onMessage(verto, null, $.verto.enum.message.info, data.params.msg);\n                }\n                //console.error(data);\n                console.debug(\"MESSAGE from: \" + data.params.msg.from, data.params.msg.body);\n\n                break;\n\n            case 'verto.clientReady':\n                if (verto.callbacks.onMessage) {\n                    verto.callbacks.onMessage(verto, null, $.verto.enum.message.clientReady, data.params);\n                }\n                console.debug(\"CLIENT READY\", data.params);\n                break;\n\n            default:\n                console.error(\"INVALID METHOD OR NON-EXISTANT CALL REFERENCE IGNORED\", data.method);\n                break;\n            }\n        }\n    };\n\n    var del_array = function(array, name) {\n        var r = [];\n        var len = array.length;\n\n        for (var i = 0; i < len; i++) {\n            if (array[i] != name) {\n                r.push(array[i]);\n            }\n        }\n\n        return r;\n    };\n\n    var hashArray = function() {\n        var vha = this;\n\n        var hash = {};\n        var array = [];\n\n        vha.reorder = function(a) {\n            array = a;\n            var h = hash;\n            hash = {};\n\n            var len = array.length;\n\n            for (var i = 0; i < len; i++) {\n                var key = array[i];\n                if (h[key]) {\n                    hash[key] = h[key];\n                    delete h[key];\n                }\n            }\n            h = undefined;\n        };\n\n        vha.clear = function() {\n            hash = undefined;\n            array = undefined;\n            hash = {};\n            array = [];\n        };\n\n        vha.add = function(name, val, insertAt) {\n            var redraw = false;\n\n            if (!hash[name]) {\n                if (insertAt === undefined || insertAt < 0 || insertAt >= array.length) {\n                    array.push(name);\n                } else {\n                    var x = 0;\n                    var n = [];\n                    var len = array.length;\n\n                    for (var i = 0; i < len; i++) {\n                        if (x++==insertAt) {\n                            n.push(name);\n                        }\n                        n.push(array[i]);\n                    }\n\n                    array = undefined;\n                    array = n;\n                    n = undefined;\n                    redraw = true;\n                }\n            }\n\n            hash[name] = val;\n\n            return redraw;\n        };\n\n        vha.del = function(name) {\n            var r = false;\n\n            if (hash[name]) {\n                array = del_array(array, name);\n                delete hash[name];\n                r = true;\n            } else {\n                console.error(\"can't del nonexistant key \" + name);\n            }\n\n            return r;\n        };\n\n        vha.get = function(name) {\n            return hash[name];\n        };\n\n        vha.order = function() {\n            return array;\n        };\n\n        vha.hash = function() {\n            return hash;\n        };\n\n        vha.indexOf = function(name) {\n            var len = array.length;\n\n            for (var i = 0; i < len; i++) {\n                if (array[i] == name) {\n                    return i;\n                }\n            }\n        };\n\n        vha.arrayLen = function() {\n            return array.length;\n        };\n\n        vha.asArray = function() {\n            var r = [];\n\n            var len = array.length;\n\n            for (var i = 0; i < len; i++) {\n                var key = array[i];\n                r.push(hash[key]);\n            }\n\n            return r;\n        };\n\n        vha.each = function(cb) {\n            var len = array.length;\n\n            for (var i = 0; i < len; i++) {\n                cb(array[i], hash[array[i]]);\n            }\n        };\n\n        vha.dump = function(html) {\n            var str = \"\";\n\n            vha.each(function(name, val) {\n                str += \"name: \" + name + \" val: \" + JSON.stringify(val) + (html ? \"<br>\" : \"\\n\");\n            });\n\n            return str;\n        };\n\n    };\n\n    $.verto.liveArray = function(verto, context, name, config) {\n        var la = this;\n        var lastSerno = 0;\n        var binding = null;\n        var user_obj = config.userObj;\n        var local = false;\n\n        // Inherit methods of hashArray\n        hashArray.call(la);\n\n        // Save the hashArray add, del, reorder, clear methods so we can make our own.\n        la._add = la.add;\n        la._del = la.del;\n        la._reorder = la.reorder;\n        la._clear = la.clear;\n\n        la.context = context;\n        la.name = name;\n        la.user_obj = user_obj;\n\n        la.verto = verto;\n        la.broadcast = function(channel, obj) {\n            verto.broadcast(channel, obj);\n        };\n        la.errs = 0;\n\n        la.clear = function() {\n            la._clear();\n            lastSerno = 0;\n\n            if (la.onChange) {\n                la.onChange(la, {\n                    action: \"clear\"\n                });\n            }\n        };\n\n        la.checkSerno = function(serno) {\n            if (serno < 0) {\n                return true;\n            }\n\n            if (lastSerno > 0 && serno != (lastSerno + 1)) {\n                if (la.onErr) {\n                    la.onErr(la, {\n                        lastSerno: lastSerno,\n                        serno: serno\n                    });\n                }\n                la.errs++;\n                console.debug(la.errs);\n                if (la.errs < 3) {\n                    la.bootstrap(la.user_obj);\n                }\n                return false;\n            } else {\n                lastSerno = serno;\n                return true;\n            }\n        };\n\n        la.reorder = function(serno, a) {\n            if (la.checkSerno(serno)) {\n                la._reorder(a);\n                if (la.onChange) {\n                    la.onChange(la, {\n                        serno: serno,\n                        action: \"reorder\"\n                    });\n                }\n            }\n        };\n\n        la.init = function(serno, val, key, index) {\n            if (key === null || key === undefined) {\n                key = serno;\n            }\n            if (la.checkSerno(serno)) {\n                if (la.onChange) {\n                    la.onChange(la, {\n                        serno: serno,\n                        action: \"init\",\n                        index: index,\n                        key: key,\n                        data: val\n                    });\n                }\n            }\n        };\n\n        la.bootObj = function(serno, val) {\n            if (la.checkSerno(serno)) {\n\n                //la.clear();\n                for (var i in val) {\n                    la._add(val[i][0], val[i][1]);\n                }\n\n                if (la.onChange) {\n                    la.onChange(la, {\n                        serno: serno,\n                        action: \"bootObj\",\n                        data: val,\n                        redraw: true\n                    });\n                }\n            }\n        };\n\n        // @param serno  La is the serial number for la particular request.\n        // @param key    If looking at it as a hash table, la represents the key in the hashArray object where you want to store the val object.\n        // @param index  If looking at it as an array, la represents the position in the array where you want to store the val object.\n        // @param val    La is the object you want to store at the key or index location in the hash table / array.\n        la.add = function(serno, val, key, index) {\n            if (key === null || key === undefined) {\n                key = serno;\n            }\n            if (la.checkSerno(serno)) {\n                var redraw = la._add(key, val, index);\n                if (la.onChange) {\n                    la.onChange(la, {\n                        serno: serno,\n                        action: \"add\",\n                        index: index,\n                        key: key,\n                        data: val,\n                        redraw: redraw\n                    });\n                }\n            }\n        };\n\n        la.modify = function(serno, val, key, index) {\n            if (key === null || key === undefined) {\n                key = serno;\n            }\n            if (la.checkSerno(serno)) {\n                la._add(key, val, index);\n                if (la.onChange) {\n                    la.onChange(la, {\n                        serno: serno,\n                        action: \"modify\",\n                        key: key,\n                        data: val,\n                        index: index\n                    });\n                }\n            }\n        };\n\n        la.del = function(serno, key, index) {\n            if (key === null || key === undefined) {\n                key = serno;\n            }\n            if (la.checkSerno(serno)) {\n                if (index === null || index < 0 || index === undefined) {\n                    index = la.indexOf(key);\n                }\n                var ok = la._del(key);\n\n                if (ok && la.onChange) {\n                    la.onChange(la, {\n                        serno: serno,\n                        action: \"del\",\n                        key: key,\n                        index: index\n                    });\n                }\n            }\n        };\n\n        var eventHandler = function(v, e, la) {\n            var packet = e.data;\n\n            //console.error(\"READ:\", packet);\n\n            if (packet.name != la.name) {\n                return;\n            }\n\n            switch (packet.action) {\n\n            case \"init\":\n                la.init(packet.wireSerno, packet.data, packet.hashKey, packet.arrIndex);\n                break;\n\n            case \"bootObj\":\n                la.bootObj(packet.wireSerno, packet.data);\n                break;\n            case \"add\":\n                la.add(packet.wireSerno, packet.data, packet.hashKey, packet.arrIndex);\n                break;\n\n            case \"modify\":\n                if (! (packet.arrIndex || packet.hashKey)) {\n                    console.error(\"Invalid Packet\", packet);\n                } else {\n                    la.modify(packet.wireSerno, packet.data, packet.hashKey, packet.arrIndex);\n                }\n                break;\n            case \"del\":\n                if (! (packet.arrIndex || packet.hashKey)) {\n                    console.error(\"Invalid Packet\", packet);\n                } else {\n                    la.del(packet.wireSerno, packet.hashKey, packet.arrIndex);\n                }\n                break;\n\n            case \"clear\":\n                la.clear();\n                break;\n\n            case \"reorder\":\n                la.reorder(packet.wireSerno, packet.order);\n                break;\n\n            default:\n                if (la.checkSerno(packet.wireSerno)) {\n                    if (la.onChange) {\n                        la.onChange(la, {\n                            serno: packet.wireSerno,\n                            action: packet.action,\n                            data: packet.data\n                        });\n                    }\n                }\n                break;\n            }\n        };\n\n        if (la.context) {\n            binding = la.verto.subscribe(la.context, {\n                handler: eventHandler,\n                userData: la,\n                subParams: config.subParams\n            });\n        }\n\n        la.destroy = function() {\n            la._clear();\n            la.verto.unsubscribe(binding);\n        };\n\n        la.sendCommand = function(cmd, obj) {\n            var self = la;\n            self.broadcast(self.context, {\n                liveArray: {\n                    command: cmd,\n                    context: self.context,\n                    name: self.name,\n                    obj: obj\n                }\n            });\n        };\n\n        la.bootstrap = function(obj) {\n            var self = la;\n            la.sendCommand(\"bootstrap\", obj);\n            //self.heartbeat();\n        };\n\n        la.changepage = function(obj) {\n            var self = la;\n            self.clear();\n            self.broadcast(self.context, {\n                liveArray: {\n                    command: \"changepage\",\n                    context: la.context,\n                    name: la.name,\n                    obj: obj\n                }\n            });\n        };\n\n        la.heartbeat = function(obj) {\n            var self = la;\n\n            var callback = function() {\n                self.heartbeat.call(self, obj);\n            };\n            self.broadcast(self.context, {\n                liveArray: {\n                    command: \"heartbeat\",\n                    context: self.context,\n                    name: self.name,\n                    obj: obj\n                }\n            });\n            self.hb_pid = setTimeout(callback, 30000);\n        };\n\n        la.bootstrap(la.user_obj);\n    };\n\n    $.verto.liveTable = function(verto, context, name, jq, config) {\n        var dt;\n        var la = new $.verto.liveArray(verto, context, name, {\n            subParams: config.subParams\n        });\n        var lt = this;\n\n        lt.liveArray = la;\n        lt.dataTable = dt;\n        lt.verto = verto;\n\n        lt.destroy = function() {\n            if (dt) {\n                dt.fnDestroy();\n            }\n            if (la) {\n                la.destroy();\n            }\n\n            dt = null;\n            la = null;\n        };\n\n        la.onErr = function(obj, args) {\n            console.error(\"Error: \", obj, args);\n        };\n\n\t/* back compat so jsonstatus can always be enabled */\n\tfunction genRow(data) {\n\t    if (typeof(data[4]) === \"string\" && data[4].indexOf(\"{\") > -1) {\n\t\tvar tmp = $.parseJSON(data[4]);\n\t\tdata[4] = tmp.oldStatus;\n\t\tdata[5] = null;\n\t    }\n\t    return data;\n\t}\n\n\tfunction genArray(obj) {\n\t    var data = obj.asArray();\n\n            for (var i in data) {\n\t\tdata[i] = genRow(data[i]);\n\t    }\n\n\t    return data;\n\t}\n\n\n        la.onChange = function(obj, args) {\n            var index = 0;\n            var iserr = 0;\n\n            if (!dt) {\n                if (!config.aoColumns) {\n                    if (args.action != \"init\") {\n                        return;\n                    }\n\n                    config.aoColumns = [];\n\n                    for (var i in args.data) {\n                        config.aoColumns.push({\n                            \"sTitle\": args.data[i]\n                        });\n                    }\n                }\n\n                dt = jq.dataTable(config);\n            }\n\n            if (dt && (args.action == \"del\" || args.action == \"modify\")) {\n                index = args.index;\n\n                if (index === undefined && args.key) {\n                    index = la.indexOf(args.key);\n                }\n\n                if (index === undefined) {\n                    console.error(\"INVALID PACKET Missing INDEX\\n\", args);\n                    return;\n                }\n            }\n\n            if (config.onChange) {\n                config.onChange(obj, args);\n            }\n\n            try {\n                switch (args.action) {\n                case \"bootObj\":\n                    if (!args.data) {\n                        console.error(\"missing data\");\n                        return;\n                    }\n                    dt.fnClearTable();\n                    dt.fnAddData(genArray(obj));\n                    dt.fnAdjustColumnSizing();\n                    break;\n                case \"add\":\n                    if (!args.data) {\n                        console.error(\"missing data\");\n                        return;\n                    }\n                    if (args.redraw > -1) {\n                        // specific position, more costly\n                        dt.fnClearTable();\n                        dt.fnAddData(genArray(obj));\n                    } else {\n                        dt.fnAddData(genRow(args.data));\n                    }\n                    dt.fnAdjustColumnSizing();\n                    break;\n                case \"modify\":\n                    if (!args.data) {\n                        return;\n                    }\n                    //console.debug(args, index);\n                    dt.fnUpdate(genRow(args.data), index);\n                    dt.fnAdjustColumnSizing();\n                    break;\n                case \"del\":\n                    dt.fnDeleteRow(index);\n                    dt.fnAdjustColumnSizing();\n                    break;\n                case \"clear\":\n                    dt.fnClearTable();\n                    break;\n                case \"reorder\":\n                    // specific position, more costly\n                    dt.fnClearTable();\n                    dt.fnAddData(genArray(obj));\n                    break;\n                case \"hide\":\n                    jq.hide();\n                    break;\n\n                case \"show\":\n                    jq.show();\n                    break;\n\n                }\n            } catch(err) {\n                console.error(\"ERROR: \" + err);\n                iserr++;\n            }\n\n            if (iserr) {\n                obj.errs++;\n                if (obj.errs < 3) {\n                    obj.bootstrap(obj.user_obj);\n                }\n            } else {\n                obj.errs = 0;\n            }\n\n        };\n\n        la.onChange(la, {\n            action: \"init\"\n        });\n\n    };\n\n    var CONFMAN_SERNO = 1;\n\n    /*\n        Conference Manager without jQuery table.\n     */\n\n    $.verto.conf = function(verto, params) {\n        var conf = this;\n\n        conf.params = $.extend({\n            dialog: null,\n            hasVid: false,\n            laData: null,\n            onBroadcast: null,\n            onLaChange: null,\n            onLaRow: null\n        }, params);\n\n        conf.verto = verto;\n        conf.serno = CONFMAN_SERNO++;\n\n        createMainModeratorMethods();\n\n        verto.subscribe(conf.params.laData.modChannel, {\n            handler: function(v, e) {\n                if (conf.params.onBroadcast) {\n                    conf.params.onBroadcast(verto, conf, e.data);\n                }\n            }\n        });\n\n        verto.subscribe(conf.params.laData.infoChannel, {\n            handler: function(v, e) {\n                if (typeof(conf.params.infoCallback) === \"function\") {\n                    conf.params.infoCallback(v,e);\n                }\n            }\n        });\n\n        verto.subscribe(conf.params.laData.chatChannel, {\n            handler: function(v, e) {\n                if (typeof(conf.params.chatCallback) === \"function\") {\n                    conf.params.chatCallback(v,e);\n                }\n            }\n        });\n    };\n\n    $.verto.conf.prototype.modCommand = function(cmd, id, value) {\n        var conf = this;\n\n        conf.verto.rpcClient.call(\"verto.broadcast\", {\n            \"eventChannel\": conf.params.laData.modChannel,\n            \"data\": {\n                \"application\": \"conf-control\",\n                \"command\": cmd,\n                \"id\": id,\n                \"value\": value\n            }\n        });\n    };\n\n    $.verto.conf.prototype.destroy = function() {\n        var conf = this;\n\n        conf.destroyed = true;\n        conf.params.onBroadcast(conf.verto, conf, 'destroy');\n\n        if (conf.params.laData.modChannel) {\n            conf.verto.unsubscribe(conf.params.laData.modChannel);\n        }\n\n        if (conf.params.laData.chatChannel) {\n            conf.verto.unsubscribe(conf.params.laData.chatChannel);\n        }\n\n        if (conf.params.laData.infoChannel) {\n            conf.verto.unsubscribe(conf.params.laData.infoChannel);\n        }\n    };\n\n    function createMainModeratorMethods() {\n        $.verto.conf.prototype.listVideoLayouts = function() {\n            this.modCommand(\"list-videoLayouts\", null, null);\n        };\n\n        $.verto.conf.prototype.play = function(file) {\n            this.modCommand(\"play\", null, file);\n        };\n\n        $.verto.conf.prototype.stop = function() {\n            this.modCommand(\"stop\", null, \"all\");\n        };\n\n        $.verto.conf.prototype.deaf = function(memberID) {\n            this.modCommand(\"deaf\", parseInt(memberID));\n        };\n\n        $.verto.conf.prototype.undeaf = function(memberID) {\n            this.modCommand(\"undeaf\", parseInt(memberID));\n        };\n\n        $.verto.conf.prototype.record = function(file) {\n            this.modCommand(\"recording\", null, [\"start\", file]);\n        };\n\n        $.verto.conf.prototype.stopRecord = function() {\n            this.modCommand(\"recording\", null, [\"stop\", \"all\"]);\n        };\n\n        $.verto.conf.prototype.snapshot = function(file) {\n            if (!this.params.hasVid) {\n                throw 'Conference has no video';\n            }\n            this.modCommand(\"vid-write-png\", null, file);\n        };\n\n        $.verto.conf.prototype.setVideoLayout = function(layout, canvasID) {\n            if (!this.params.hasVid) {\n                throw 'Conference has no video';\n            }\n\t    if (canvasID) {\n\t\tthis.modCommand(\"vid-layout\", null, [layout, canvasID]);\n\t    } else {\n\t\tthis.modCommand(\"vid-layout\", null, layout);\n\t    }\n        };\n\n        $.verto.conf.prototype.kick = function(memberID) {\n            this.modCommand(\"kick\", parseInt(memberID));\n        };\n\n        $.verto.conf.prototype.muteMic = function(memberID) {\n            this.modCommand(\"tmute\", parseInt(memberID));\n        };\n\n        $.verto.conf.prototype.muteVideo = function(memberID) {\n            if (!this.params.hasVid) {\n                throw 'Conference has no video';\n            }\n            this.modCommand(\"tvmute\", parseInt(memberID));\n        };\n\n        $.verto.conf.prototype.presenter = function(memberID) {\n            if (!this.params.hasVid) {\n                throw 'Conference has no video';\n            }\n            this.modCommand(\"vid-res-id\", parseInt(memberID), \"presenter\");\n        };\n\n        $.verto.conf.prototype.videoFloor = function(memberID) {\n            if (!this.params.hasVid) {\n                throw 'Conference has no video';\n            }\n            this.modCommand(\"vid-floor\", parseInt(memberID), \"force\");\n        };\n\n        $.verto.conf.prototype.banner = function(memberID, text) {\n            if (!this.params.hasVid) {\n                throw 'Conference has no video';\n            }\n            this.modCommand(\"vid-banner\", parseInt(memberID), escape(text));\n        };\n\n        $.verto.conf.prototype.volumeDown = function(memberID) {\n            this.modCommand(\"volume_out\", parseInt(memberID), \"down\");\n        };\n\n        $.verto.conf.prototype.volumeUp = function(memberID) {\n            this.modCommand(\"volume_out\", parseInt(memberID), \"up\");\n        };\n\n        $.verto.conf.prototype.gainDown = function(memberID) {\n            this.modCommand(\"volume_in\", parseInt(memberID), \"down\");\n        };\n\n        $.verto.conf.prototype.gainUp = function(memberID) {\n            this.modCommand(\"volume_in\", parseInt(memberID), \"up\");\n        };\n\n        $.verto.conf.prototype.transfer = function(memberID, exten) {\n            this.modCommand(\"transfer\", parseInt(memberID), exten);\n        };\n\n        $.verto.conf.prototype.sendChat = function(message, type) {\n            var conf = this;\n            conf.verto.rpcClient.call(\"verto.broadcast\", {\n                \"eventChannel\": conf.params.laData.chatChannel,\n                \"data\": {\n                    \"action\": \"send\",\n                    \"message\": message,\n                    \"type\": type\n                }\n            });\n        };\n            \n    }\n\n    $.verto.modfuncs = {};\n\n    $.verto.confMan = function(verto, params) {\n        var confMan = this;\n\n        confMan.params = $.extend({\n            tableID: null,\n            statusID: null,\n            mainModID: null,\n            dialog: null,\n            hasVid: false,\n            laData: null,\n            onBroadcast: null,\n            onLaChange: null,\n            onLaRow: null\n        }, params);\n\n        confMan.verto = verto;\n        confMan.serno = CONFMAN_SERNO++;\n\tconfMan.canvasCount = confMan.params.laData.canvasCount;\n\t\n        function genMainMod(jq) {\n            var play_id = \"play_\" + confMan.serno;\n            var stop_id = \"stop_\" + confMan.serno;\n            var recording_id = \"recording_\" + confMan.serno;\n            var snapshot_id = \"snapshot_\" + confMan.serno;\n            var rec_stop_id = \"recording_stop\" + confMan.serno;\n            var div_id = \"confman_\" + confMan.serno;\n\n            var html =  \"<div id='\" + div_id + \"'><br>\" +\n\t\t\"<button class='ctlbtn' id='\" + play_id + \"'>Play</button>\" +\n\t\t\"<button class='ctlbtn' id='\" + stop_id + \"'>Stop</button>\" +\n\t\t\"<button class='ctlbtn' id='\" + recording_id + \"'>Record</button>\" +\n\t\t\"<button class='ctlbtn' id='\" + rec_stop_id + \"'>Record Stop</button>\" +\n\t\t(confMan.params.hasVid ? \"<button class='ctlbtn' id='\" + snapshot_id + \"'>PNG Snapshot</button>\" : \"\") +\n\t\t\"<br><br></div>\";\n\n            jq.html(html);\n\n\t    $.verto.modfuncs.change_video_layout = function(id, canvas_id) {\t    \n\t\tvar val = $(\"#\" + id + \" option:selected\").text();\n\t\tif (val !== \"none\") {\n                    confMan.modCommand(\"vid-layout\", null, [val, canvas_id]);\n\t\t}\n\t    };\n\n\t    if (confMan.params.hasVid) {\n\t\tfor (var j = 0; j < confMan.canvasCount; j++) {\n\t\t    var vlayout_id = \"confman_vid_layout_\" + j + \"_\" + confMan.serno;\n\t\t    var vlselect_id = \"confman_vl_select_\" + j + \"_\" + confMan.serno;\n\t\t\n\n\t\t    var vlhtml =  \"<div id='\" + vlayout_id + \"'><br>\" +\n\t\t\t\"<b>Video Layout Canvas \" + (j+1) + \n\t\t\t\"</b> <select onChange='$.verto.modfuncs.change_video_layout(\\\"\" + vlayout_id + \"\\\", \\\"\" + (j+1) + \"\\\")' id='\" + vlselect_id + \"'></select> \" +\n\t\t\t\"<br><br></div>\";\n\t\t    jq.append(vlhtml);\n\t\t}\n\n\t\t$(\"#\" + snapshot_id).click(function() {\n                    var file = prompt(\"Please enter file name\", \"\");\n\t\t    if (file) {\n\t\t\tconfMan.modCommand(\"vid-write-png\", null, file);\n\t\t    }\n\t\t});\n\t    }\n\n            $(\"#\" + play_id).click(function() {\n                var file = prompt(\"Please enter file name\", \"\");\n\t\tif (file) {\n                    confMan.modCommand(\"play\", null, file);\n\t\t}\n            });\n\n            $(\"#\" + stop_id).click(function() {\n                confMan.modCommand(\"stop\", null, \"all\");\n            });\n\n            $(\"#\" + recording_id).click(function() {\n                var file = prompt(\"Please enter file name\", \"\");\n\t\tif (file) {\n                    confMan.modCommand(\"recording\", null, [\"start\", file]);\n\t\t}\n            });\n\n            $(\"#\" + rec_stop_id).click(function() {\n                confMan.modCommand(\"recording\", null, [\"stop\", \"all\"]);\n            });\n\n        }\n\n        function genControls(jq, rowid) {\n            var x = parseInt(rowid);\n            var kick_id = \"kick_\" + x;\n            var canvas_in_next_id = \"canvas_in_next_\" + x;\n            var canvas_in_prev_id = \"canvas_in_prev_\" + x;\n            var canvas_out_next_id = \"canvas_out_next_\" + x;\n            var canvas_out_prev_id = \"canvas_out_prev_\" + x;\n\n            var canvas_in_set_id = \"canvas_in_set_\" + x;\n            var canvas_out_set_id = \"canvas_out_set_\" + x;\n\n            var layer_set_id = \"layer_set_\" + x;\n            var layer_next_id = \"layer_next_\" + x;\n            var layer_prev_id = \"layer_prev_\" + x;\n\t    \n            var tmute_id = \"tmute_\" + x;\n            var tvmute_id = \"tvmute_\" + x;\n            var vbanner_id = \"vbanner_\" + x;\n            var tvpresenter_id = \"tvpresenter_\" + x;\n            var tvfloor_id = \"tvfloor_\" + x;\n            var box_id = \"box_\" + x;\n            var gainup_id = \"gain_in_up\" + x;\n            var gaindn_id = \"gain_in_dn\" + x;\n            var volup_id = \"vol_in_up\" + x;\n            var voldn_id = \"vol_in_dn\" + x;\n            var transfer_id = \"transfer\" + x;\n\t    \n\n            var html = \"<div id='\" + box_id + \"'>\";\n\n\t    html += \"<b>General Controls</b><hr noshade>\";\n\n            html += \"<button class='ctlbtn' id='\" + kick_id + \"'>Kick</button>\" +\n                \"<button class='ctlbtn' id='\" + tmute_id + \"'>Mute</button>\" +\n                \"<button class='ctlbtn' id='\" + gainup_id + \"'>Gain -</button>\" +\n                \"<button class='ctlbtn' id='\" + gaindn_id + \"'>Gain +</button>\" +\n                \"<button class='ctlbtn' id='\" + voldn_id + \"'>Vol -</button>\" +\n                \"<button class='ctlbtn' id='\" + volup_id + \"'>Vol +</button>\" +\n                \"<button class='ctlbtn' id='\" + transfer_id + \"'>Transfer</button>\";\n\t\t\n\t    if (confMan.params.hasVid) {\n\t\thtml += \"<br><br><b>Video Controls</b><hr noshade>\";\n\n\n                html += \"<button class='ctlbtn' id='\" + tvmute_id + \"'>VMute</button>\" +\n                    \"<button class='ctlbtn' id='\" + tvpresenter_id + \"'>Presenter</button>\" +\n                    \"<button class='ctlbtn' id='\" + tvfloor_id + \"'>Vid Floor</button>\" +\n                    \"<button class='ctlbtn' id='\" + vbanner_id + \"'>Banner</button>\";\n\n\t\tif (confMan.canvasCount > 1) {\n                    html += \"<br><br><b>Canvas Controls</b><hr noshade>\" +\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_in_set_id + \"'>Set Input Canvas</button>\" +\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_in_prev_id + \"'>Prev Input Canvas</button>\" +\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_in_next_id + \"'>Next Input Canvas</button>\" +\n\t\t\t\n\t\t    \"<br>\" +\n\t\t\t\n\t\t    \"<button class='ctlbtn' id='\" + canvas_out_set_id + \"'>Set Watching Canvas</button>\" +\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_out_prev_id + \"'>Prev Watching Canvas</button>\" +\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_out_next_id + \"'>Next Watching Canvas</button>\";\n\t\t}\n\t\t\n\t\thtml += \"<br>\" +\n\n                \"<button class='ctlbtn' id='\" + layer_set_id + \"'>Set Layer</button>\" +\n                    \"<button class='ctlbtn' id='\" + layer_prev_id + \"'>Prev Layer</button>\" +\n                    \"<button class='ctlbtn' id='\" + layer_next_id + \"'>Next Layer</button>\" +\n\n\n\n                    \"</div>\";\n            }\n\n            jq.html(html);\n\n\n            if (!jq.data(\"mouse\")) {\n                $(\"#\" + box_id).hide();\n            }\n\n            jq.mouseover(function(e) {\n                jq.data({\"mouse\": true});\n                $(\"#\" + box_id).show();\n            });\n\n            jq.mouseout(function(e) {\n                jq.data({\"mouse\": false});\n                $(\"#\" + box_id).hide();\n            });\n\n            $(\"#\" + transfer_id).click(function() {\n                var xten = prompt(\"Enter Extension\");\n\t\tif (xten) {\n                    confMan.modCommand(\"transfer\", x, xten);\n\t\t}\n            });\n\n            $(\"#\" + kick_id).click(function() {\n                confMan.modCommand(\"kick\", x);\n            });\n\n\n            $(\"#\" + layer_set_id).click(function() {\n                var cid = prompt(\"Please enter layer ID\", \"\");\n\t\tif (cid) {\n                    confMan.modCommand(\"vid-layer\", x, cid);\n\t\t}\n            });\n\n            $(\"#\" + layer_next_id).click(function() {\n                confMan.modCommand(\"vid-layer\", x, \"next\");\n            });\n            $(\"#\" + layer_prev_id).click(function() {\n                confMan.modCommand(\"vid-layer\", x, \"prev\");\n            });\n\n            $(\"#\" + canvas_in_set_id).click(function() {\n                var cid = prompt(\"Please enter canvas ID\", \"\");\n\t\tif (cid) {\n                    confMan.modCommand(\"vid-canvas\", x, cid);\n\t\t}\n            });\n\n            $(\"#\" + canvas_out_set_id).click(function() {\n                var cid = prompt(\"Please enter canvas ID\", \"\");\n\t\tif (cid) {\n                    confMan.modCommand(\"vid-watching-canvas\", x, cid);\n\t\t}\n            });\n\n            $(\"#\" + canvas_in_next_id).click(function() {\n                confMan.modCommand(\"vid-canvas\", x, \"next\");\n            });\n            $(\"#\" + canvas_in_prev_id).click(function() {\n                confMan.modCommand(\"vid-canvas\", x, \"prev\");\n            });\n\n\n            $(\"#\" + canvas_out_next_id).click(function() {\n                confMan.modCommand(\"vid-watching-canvas\", x, \"next\");\n            });\n            $(\"#\" + canvas_out_prev_id).click(function() {\n                confMan.modCommand(\"vid-watching-canvas\", x, \"prev\");\n            });\n\t    \n            $(\"#\" + tmute_id).click(function() {\n                confMan.modCommand(\"tmute\", x);\n            });\n\n\t    if (confMan.params.hasVid) {\n\t\t$(\"#\" + tvmute_id).click(function() {\n                    confMan.modCommand(\"tvmute\", x);\n\t\t});\n\t\t$(\"#\" + tvpresenter_id).click(function() {\n                    confMan.modCommand(\"vid-res-id\", x, \"presenter\");\n\t\t});\n\t\t$(\"#\" + tvfloor_id).click(function() {\n                    confMan.modCommand(\"vid-floor\", x, \"force\");\n\t\t});\n\t\t$(\"#\" + vbanner_id).click(function() {\n                    var text = prompt(\"Please enter text\", \"\");\n\t\t    if (text) {\n\t\t\tconfMan.modCommand(\"vid-banner\", x, escape(text));\n\t\t    }\n\t\t});\n\t    }\n\n            $(\"#\" + gainup_id).click(function() {\n                confMan.modCommand(\"volume_in\", x, \"up\");\n            });\n\n            $(\"#\" + gaindn_id).click(function() {\n                confMan.modCommand(\"volume_in\", x, \"down\");\n            });\n\n            $(\"#\" + volup_id).click(function() {\n                confMan.modCommand(\"volume_out\", x, \"up\");\n            });\n\n            $(\"#\" + voldn_id).click(function() {\n                confMan.modCommand(\"volume_out\", x, \"down\");\n            });\n\n            return html;\n        }\n\n        var atitle = \"\";\n        var awidth = 0;\n\n        //$(\".jsDataTable\").width(confMan.params.hasVid ? \"900px\" : \"800px\");\n\n        verto.subscribe(confMan.params.laData.infoChannel, {\n            handler: function(v, e) {\n                if (typeof(confMan.params.infoCallback) === \"function\") {\n                    confMan.params.infoCallback(v,e);\n                }\n            }\n        });\n\n\tverto.subscribe(confMan.params.laData.chatChannel, {\n\t    handler: function(v, e) {\n\t\tif (typeof(confMan.params.chatCallback) === \"function\") {\n\t\t    confMan.params.chatCallback(v,e);\n\t\t}\n\t    }\n\t});\n\n        if (confMan.params.laData.role === \"moderator\") {\n            atitle = \"Action\";\n            awidth = 600;\n\n            if (confMan.params.mainModID) {\n                genMainMod($(confMan.params.mainModID));\n                $(confMan.params.displayID).html(\"Moderator Controls Ready<br><br>\");\n            } else {\n                $(confMan.params.mainModID).html(\"\");\n            }\n\n            verto.subscribe(confMan.params.laData.modChannel, {\n                handler: function(v, e) {\n                    //console.error(\"MODDATA:\", e.data);\n                    if (confMan.params.onBroadcast) {\n                        confMan.params.onBroadcast(verto, confMan, e.data);\n                    }\n\n\t\t    if (e.data[\"conf-command\"] === \"list-videoLayouts\") {\n\t\t\tfor (var j = 0; j < confMan.canvasCount; j++) {\n\t\t\t    var vlselect_id = \"#confman_vl_select_\" + j + \"_\" + confMan.serno;\n\t\t\t    var vlayout_id = \"#confman_vid_layout_\" + j + \"_\" + confMan.serno;\n\t\t\t    \n\t\t\t    var x = 0;\n\t\t\t    var options;\n\t\t\t    \n\t\t\t    $(vlselect_id).selectmenu({});\n\t\t\t    $(vlselect_id).selectmenu(\"enable\");\n\t\t\t    $(vlselect_id).empty();\n\t\t\t    \n\t\t\t    $(vlselect_id).append(new Option(\"Choose a Layout\", \"none\"));\n\n\t\t\t    if (e.data.responseData) {\n\t\t\t\tvar rdata = [];\n\n\t\t\t\tfor (var i in e.data.responseData) {\n\t\t\t\t    rdata.push(e.data.responseData[i].name);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\toptions = rdata.sort(function(a, b) {\n\t\t\t\t    var ga = a.substring(0, 6) == \"group:\" ? true : false;\n\t\t\t\t    var gb = b.substring(0, 6) == \"group:\" ? true : false;\n\t\t\t\t    \n\t\t\t\t    if ((ga || gb) && ga != gb) {\n\t\t\t\t\treturn ga ? -1 : 1;\n\t\t\t\t    }\n\t\t\t\t    \n\t\t\t\t    return ( ( a == b ) ? 0 : ( ( a > b ) ? 1 : -1 ) );\n\t\t\t\t});\n\n\t\t\t\tfor (var i in options) {\n\t\t\t\t    $(vlselect_id).append(new Option(options[i], options[i]));\n\t\t\t\t    x++;\n\t\t\t\t}\n\t\t\t    }\n\n\t\t\t    if (x) {\n\t\t\t\t$(vlselect_id).selectmenu('refresh', true);\n\t\t\t    } else {\n\t\t\t\t$(vlayout_id).hide();\n\t\t\t    }\n\t\t\t}\n\t\t    } else {\n\n\t\t\tif (!confMan.destroyed && confMan.params.displayID) {\n                            $(confMan.params.displayID).html(e.data.response + \"<br><br>\");\n                            if (confMan.lastTimeout) {\n\t\t\t\tclearTimeout(confMan.lastTimeout);\n\t\t\t\tconfMan.lastTimeout = 0;\n                            }\n                            confMan.lastTimeout = setTimeout(function() { $(confMan.params.displayID).html(confMan.destroyed ? \"\" : \"Moderator Controls Ready<br><br>\");}, 4000);\n\t\t\t}\n\t\t    }\n                }\n            });\n\n\n\t    if (confMan.params.hasVid) {\n\t\tconfMan.modCommand(\"list-videoLayouts\", null, null);\n\t    }\n        }\n\n        var row_callback = null;\n\n        if (confMan.params.laData.role === \"moderator\") {\n            row_callback = function(nRow, aData, iDisplayIndex, iDisplayIndexFull) {\n                if (!aData[5]) {\n                    var $row = $('td:eq(5)', nRow);\n                    genControls($row, aData);\n\n                    if (confMan.params.onLaRow) {\n                        confMan.params.onLaRow(verto, confMan, $row, aData);\n                    }\n                }\n            };\n        }\n\n        confMan.lt = new $.verto.liveTable(verto, confMan.params.laData.laChannel, confMan.params.laData.laName, $(confMan.params.tableID), {\n            subParams: {\n                callID: confMan.params.dialog ? confMan.params.dialog.callID : null\n            },\n\n            \"onChange\": function(obj, args) {\n                $(confMan.params.statusID).text(\"Conference Members: \" + \" (\" + obj.arrayLen() + \" Total)\");\n                if (confMan.params.onLaChange) {\n                    confMan.params.onLaChange(verto, confMan, $.verto.enum.confEvent.laChange, obj, args);\n                }\n            },\n\n            \"aaData\": [],\n            \"aoColumns\": [\n                {\n                    \"sTitle\": \"ID\",\n                    \"sWidth\": \"50\"\n                },\n                {\n                    \"sTitle\": \"Number\",\n\t\t    \"sWidth\": \"250\"\n                },\n                {\n                    \"sTitle\": \"Name\",\n\t\t    \"sWidth\": \"250\"\n                },\n                {\n                    \"sTitle\": \"Codec\",\n                    \"sWidth\": \"100\"\n                },\n                {\n                    \"sTitle\": \"Status\",\n                    \"sWidth\": confMan.params.hasVid ? \"200px\" : \"150px\"\n                },\n                {\n                    \"sTitle\": atitle,\n                    \"sWidth\": awidth,\n                }\n            ],\n            \"bAutoWidth\": true,\n            \"bDestroy\": true,\n            \"bSort\": false,\n            \"bInfo\": false,\n            \"bFilter\": false,\n            \"bLengthChange\": false,\n            \"bPaginate\": false,\n            \"iDisplayLength\": 1400,\n\n            \"oLanguage\": {\n                \"sEmptyTable\": \"The Conference is Empty.....\"\n            },\n\n            \"fnRowCallback\": row_callback\n\n        });\n    };\n\n    $.verto.confMan.prototype.modCommand = function(cmd, id, value) {\n        var confMan = this;\n\n        confMan.verto.rpcClient.call(\"verto.broadcast\", {\n            \"eventChannel\": confMan.params.laData.modChannel,\n            \"data\": {\n\t\t\"application\": \"conf-control\",\n\t\t\"command\": cmd,\n\t\t\"id\": id,\n\t\t\"value\": value\n            }\n\t});\n    };\n\n    $.verto.confMan.prototype.sendChat = function(message, type) {\n        var confMan = this;\n        confMan.verto.rpcClient.call(\"verto.broadcast\", {\n            \"eventChannel\": confMan.params.laData.chatChannel,\n            \"data\": {\n\t\t\"action\": \"send\",\n\t\t\"message\": message,\n\t\t\"type\": type\n            }\n\t});\n    };\n\n\n    $.verto.confMan.prototype.destroy = function() {\n        var confMan = this;\n\n        confMan.destroyed = true;\n\n        if (confMan.lt) {\n            confMan.lt.destroy();\n        }\n\n        if (confMan.params.laData.chatChannel) {\n            confMan.verto.unsubscribe(confMan.params.laData.chatChannel);\n        }\n\n        if (confMan.params.laData.modChannel) {\n            confMan.verto.unsubscribe(confMan.params.laData.modChannel);\n        }\n\n        if (confMan.params.mainModID) {\n            $(confMan.params.mainModID).html(\"\");\n        }\n    };\n\n    $.verto.dialog = function(direction, verto, params) {\n        var dialog = this;\n\n        dialog.params = $.extend({\n            useVideo: verto.options.useVideo,\n            useStereo: verto.options.useStereo,\n\t    screenShare: false,\n\t    useCamera: false,\n\t    useMic: verto.options.deviceParams.useMic,\n\t    useMicLabel: verto.options.deviceParams.useMicLabel,\n\t    useSpeak: verto.options.deviceParams.useSpeak,\n            tag: verto.options.tag,\n            localTag: verto.options.localTag,\n            login: verto.options.login,\n      videoParams: verto.options.videoParams,\n      useStream: verto.options.useStream,\n        }, params);\n\t\n\n\tif (!dialog.params.screenShare) {\n\t    dialog.params.useCamera = verto.options.deviceParams.useCamera;\n\t    dialog.params.useCameraLabel = verto.options.deviceParams.useCameraLabel;\n\t}\n\n        dialog.verto = verto;\n        dialog.direction = direction;\n        dialog.lastState = null;\n        dialog.state = dialog.lastState = $.verto.enum.state.new;\n        dialog.callbacks = verto.callbacks;\n        dialog.answered = false;\n        dialog.attach = params.attach || false;\n\tdialog.screenShare = params.screenShare || false;\n\tdialog.useCamera = dialog.params.useCamera;\n\tdialog.useCameraLabel = dialog.params.useCameraLabel;\n\tdialog.useMic = dialog.params.useMic;\n\tdialog.useMicLabel = dialog.params.useMicLabel;\n\tdialog.useSpeak = dialog.params.useSpeak;\n\t\n        if (dialog.params.callID) {\n            dialog.callID = dialog.params.callID;\n        } else {\n            dialog.callID = dialog.params.callID = generateGUID();\n        }\n\n\tif (typeof(dialog.params.tag) === \"function\") {\n\t\tdialog.params.tag = dialog.params.tag();\n\t}\n\t\n        if (dialog.params.tag) {\n            dialog.audioStream = document.getElementById(dialog.params.tag);\n\n            if (dialog.params.useVideo) {\n                dialog.videoStream = dialog.audioStream;\n            }\n        } //else conjure one TBD\n\n        if (dialog.params.localTag) {\n\t    dialog.localVideo = document.getElementById(dialog.params.localTag);\n\t}\n\n        dialog.verto.dialogs[dialog.callID] = dialog;\n\n        var RTCcallbacks = {};\n\n        if (dialog.direction == $.verto.enum.direction.inbound) {\n            if (dialog.params.display_direction === \"outbound\") {\n                dialog.params.remote_caller_id_name = dialog.params.caller_id_name;\n                dialog.params.remote_caller_id_number = dialog.params.caller_id_number;\n            } else {\n                dialog.params.remote_caller_id_name = dialog.params.callee_id_name;\n                dialog.params.remote_caller_id_number = dialog.params.callee_id_number;\n            }\n\n            if (!dialog.params.remote_caller_id_name) {\n                dialog.params.remote_caller_id_name = \"Nobody\";\n            }\n\n            if (!dialog.params.remote_caller_id_number) {\n                dialog.params.remote_caller_id_number = \"UNKNOWN\";\n            }\n\n            RTCcallbacks.onMessage = function(rtc, msg) {\n                console.debug(msg);\n            };\n\n            RTCcallbacks.onAnswerSDP = function(rtc, sdp) {\n                console.error(\"answer sdp\", sdp);\n            };\n        } else {\n            dialog.params.remote_caller_id_name = \"Outbound Call\";\n            dialog.params.remote_caller_id_number = dialog.params.destination_number;\n        }\n\n        RTCcallbacks.onICESDP = function(rtc) {\n            console.log(\"RECV \" + rtc.type + \" SDP\", rtc.mediaData.SDP);\n\n\t    if (dialog.state == $.verto.enum.state.requesting || dialog.state == $.verto.enum.state.answering || dialog.state == $.verto.enum.state.active) {\n\t\tlocation.reload();\n\t\treturn;\n\t    }\n\n            if (rtc.type == \"offer\") {\n\t\tif (dialog.state == $.verto.enum.state.active) {\n                    dialog.setState($.verto.enum.state.requesting);\n\t\t    dialog.sendMethod(\"verto.attach\", {\n\t\t\tsdp: rtc.mediaData.SDP\n                    });\n\t\t} else {\n                    dialog.setState($.verto.enum.state.requesting);\n\t\t    \n                    dialog.sendMethod(\"verto.invite\", {\n\t\t\tsdp: rtc.mediaData.SDP\n                    });\n\t\t}\n            } else { //answer\n                dialog.setState($.verto.enum.state.answering);\n\n                dialog.sendMethod(dialog.attach ? \"verto.attach\" : \"verto.answer\", {\n                    sdp: dialog.rtc.mediaData.SDP\n                });\n            }\n        };\n\n        RTCcallbacks.onICE = function(rtc) {\n            //console.log(\"cand\", rtc.mediaData.candidate);\n            if (rtc.type == \"offer\") {\n                console.log(\"offer\", rtc.mediaData.candidate);\n                return;\n            }\n        };\n\n        RTCcallbacks.onStream = function(rtc, stream) {\n            if (dialog.callbacks.permissionCallback &&\n                typeof dialog.callbacks.permissionCallback.onGranted === 'function') {\n                dialog.callbacks.permissionCallback.onGranted(stream);\n            }\n            else if (dialog.verto.options.permissionCallback &&\n                typeof dialog.verto.options.permissionCallback.onGranted === 'function'){\n                dialog.verto.options.permissionCallback.onGranted(stream);\n            }\n            console.log(\"stream started\");\n        };\n\n        RTCcallbacks.onRemoteStream = function(rtc, stream) {\n          if (typeof dialog.callbacks.onRemoteStream === 'function') {\n            dialog.callbacks.onRemoteStream(stream, dialog);\n          }\n          console.log(\"remote stream started\");\n        };\n\n        RTCcallbacks.onError = function(e) {\n            if (dialog.callbacks.permissionCallback &&\n                typeof dialog.callbacks.permissionCallback.onDenied === 'function') {\n                dialog.callbacks.permissionCallback.onDenied();\n            }\n            else if (dialog.verto.options.permissionCallback &&\n                typeof dialog.verto.options.permissionCallback.onDenied === 'function'){\n                dialog.verto.options.permissionCallback.onDenied();\n            }\n            console.error(\"ERROR:\", e);\n            dialog.hangup({cause: \"Device or Permission Error\"});\n        };\n\n        dialog.rtc = new $.FSRTC({\n            callbacks: RTCcallbacks,\n\t    localVideo: dialog.screenShare ? null : dialog.localVideo,\n            useVideo: dialog.params.useVideo ? dialog.videoStream : null,\n            useAudio: dialog.audioStream,\n            useStereo: dialog.params.useStereo,\n            videoParams: dialog.params.videoParams,\n            audioParams: verto.options.audioParams,\n            iceServers: verto.options.iceServers,\n            screenShare: dialog.screenShare,\n            useCamera: dialog.useCamera,\n            useCameraLabel: dialog.useCameraLabel,\n            useMic: dialog.useMic,\n            useMicLabel: dialog.useMicLabel,\n            useSpeak: dialog.useSpeak,\n      turnServer: verto.options.turnServer,\n      useStream: dialog.params.useStream\n        });\n\n        dialog.rtc.verto = dialog.verto;\n\n        if (dialog.direction == $.verto.enum.direction.inbound) {\n            if (dialog.attach) {\n                dialog.answer();\n            } else {\n                dialog.ring();\n            }\n        }\n    };\n\n    $.verto.dialog.prototype.invite = function() {\n        var dialog = this;\n        dialog.rtc.call();\n    };\n\n    $.verto.dialog.prototype.sendMethod = function(method, obj) {\n        var dialog = this;\n        obj.dialogParams = {};\n\n        for (var i in dialog.params) {\n\t    if (i == \"sdp\" && method != \"verto.invite\" && method != \"verto.attach\") {\n                continue;\n\t    }\n\t    \n\t    if ((obj.noDialogParams && i != \"callID\")) {\n\t\tcontinue;\n\t    }\n\n\t    obj.dialogParams[i] = dialog.params[i];\n        }\n\t\n\tdelete obj.noDialogParams;\n\n        dialog.verto.rpcClient.call(method, obj,\n\n        function(e) {\n            /* Success */\n            dialog.processReply(method, true, e);\n        },\n\n        function(e) {\n            /* Error */\n            dialog.processReply(method, false, e);\n        });\n    };\n\n    function checkStateChange(oldS, newS) {\n\n        if (newS == $.verto.enum.state.purge || $.verto.enum.states[oldS.name][newS.name]) {\n            return true;\n        }\n\n        return false;\n    }\n\n\n    // Attach audio output device to video element using device/sink ID.                                                                                           \n    function find_name(id) {\n\tfor (var i in $.verto.audioOutDevices) {\n\t    var source = $.verto.audioOutDevices[i];\n\t    if (source.id === id) {\n\t\treturn(source.label);\n\t    }\n\t}\n\n\treturn id;\n    }\n\n    $.verto.dialog.prototype.setAudioPlaybackDevice = function(sinkId, callback, arg) {\n\tvar dialog = this;\n\tvar element = dialog.audioStream;\n\n\tif (typeof element.sinkId !== 'undefined') {\n\t    var devname = find_name(sinkId);\n\t    console.info(\"Dialog: \" + dialog.callID + \" Setting speaker:\", element, devname);\n\n\t    element.setSinkId(sinkId)\n\t\t.then(function() {\n\t\t    console.log(\"Dialog: \" + dialog.callID + ' Success, audio output device attached: ' + sinkId);\n\t\t    if (callback) {\n\t\t\tcallback(true, devname, arg);\n\t\t    }\n\t\t})\n\t\t.catch(function(error) {\n\t\t    var errorMessage = error;\n\t\t    if (error.name === 'SecurityError') {\n\t\t\terrorMessage = \"Dialog: \" + dialog.callID + ' You need to use HTTPS for selecting audio output ' +\n\t\t\t    'device: ' + error;\n\t\t    }\n\t\t    if (callback) {\n\t\t\tcallback(false, null, arg);\n\t\t    }\n\t\t    console.error(errorMessage);\n\t\t});\n\t} else {\n\t    console.warn(\"Dialog: \" + dialog.callID + ' Browser does not support output device selection.');\n\t    if (callback) {\n\t\tcallback(false, null, arg);\n\t    }\n\t}\n    }\n\n    $.verto.dialog.prototype.setState = function(state) {\n        var dialog = this;\n\n        if (dialog.state == $.verto.enum.state.ringing) {\n            dialog.stopRinging();\n        }\n\n        if (dialog.state == state || !checkStateChange(dialog.state, state)) {\n            console.error(\"Dialog \" + dialog.callID + \": INVALID state change from \" + dialog.state.name + \" to \" + state.name);\n            dialog.hangup();\n            return false;\n        }\n\n        console.log(\"Dialog \" + dialog.callID + \": state change from \" + dialog.state.name + \" to \" + state.name);\n\n        dialog.lastState = dialog.state;\n        dialog.state = state;\n\n        if (dialog.callbacks.onDialogState) {\n            dialog.callbacks.onDialogState(this);\n        }\n\n        switch (dialog.state) {\n\n        case $.verto.enum.state.early:\n        case $.verto.enum.state.active:\n\n\t    var speaker = dialog.useSpeak;\n\t    console.info(\"Using Speaker: \", speaker);\n\n\t    if (speaker && speaker !== \"any\" && speaker !== \"none\") {\n\t\tsetTimeout(function() {\n\t\t    dialog.setAudioPlaybackDevice(speaker);\n\t\t}, 500);\n\t    }\n\n\t    break;\n\n        case $.verto.enum.state.trying:\n            setTimeout(function() {\n                if (dialog.state == $.verto.enum.state.trying) {\n                    dialog.setState($.verto.enum.state.hangup);\n                }\n            }, 30000);\n            break;\n        case $.verto.enum.state.purge:\n            dialog.setState($.verto.enum.state.destroy);\n            break;\n        case $.verto.enum.state.hangup:\n\n            if (dialog.lastState.val > $.verto.enum.state.requesting.val && dialog.lastState.val < $.verto.enum.state.hangup.val) {\n                dialog.sendMethod(\"verto.bye\", {});\n            }\n\n            dialog.setState($.verto.enum.state.destroy);\n            break;\n        case $.verto.enum.state.destroy:\n\n            if (typeof(dialog.verto.options.tag) === \"function\") {\n              $('#' + dialog.params.tag).remove();\n            }\n\n            delete dialog.verto.dialogs[dialog.callID];\n\t    if (dialog.params.screenShare) {\n\t\tdialog.rtc.stopPeer();\n\t    } else {\n\t\tdialog.rtc.stop();\n\t    }\n            break;\n        }\n\n        return true;\n    };\n\n    $.verto.dialog.prototype.processReply = function(method, success, e) {\n        var dialog = this;\n\n        //console.log(\"Response: \" + method + \" State:\" + dialog.state.name, success, e);\n\n        switch (method) {\n\n        case \"verto.answer\":\n        case \"verto.attach\":\n            if (success) {\n                dialog.setState($.verto.enum.state.active);\n            } else {\n                dialog.hangup();\n            }\n            break;\n        case \"verto.invite\":\n            if (success) {\n                dialog.setState($.verto.enum.state.trying);\n            } else {\n                dialog.setState($.verto.enum.state.destroy);\n            }\n            break;\n\n        case \"verto.bye\":\n            dialog.hangup();\n            break;\n\n        case \"verto.modify\":\n            if (e.holdState) {\n                if (e.holdState == \"held\") {\n                    if (dialog.state != $.verto.enum.state.held) {\n                        dialog.setState($.verto.enum.state.held);\n                    }\n                } else if (e.holdState == \"active\") {\n                    if (dialog.state != $.verto.enum.state.active) {\n                        dialog.setState($.verto.enum.state.active);\n                    }\n                }\n            }\n\n            if (success) {}\n\n            break;\n\n        default:\n            break;\n        }\n\n    };\n\n    $.verto.dialog.prototype.hangup = function(params) {\n        var dialog = this;\n\n        if (params) {\n            if (params.causeCode) {\n\t\tdialog.causeCode = params.causeCode;\n            }\n\n            if (params.cause) {\n\t\tdialog.cause = params.cause;\n            }\n        }\n\n\tif (!dialog.cause && !dialog.causeCode) {\n\t    dialog.cause = \"NORMAL_CLEARING\";\n\t}\n\n        if (dialog.state.val >= $.verto.enum.state.new.val && dialog.state.val < $.verto.enum.state.hangup.val) {\n            dialog.setState($.verto.enum.state.hangup);\n        } else if (dialog.state.val < $.verto.enum.state.destroy) {\n            dialog.setState($.verto.enum.state.destroy);\n        }\n    };\n\n    $.verto.dialog.prototype.stopRinging = function() {\n        var dialog = this;\n        if (dialog.verto.ringer) {\n            dialog.verto.ringer.stop();\n        }\n    };\n\n    $.verto.dialog.prototype.indicateRing = function() {\n        var dialog = this;\n\n        if (dialog.verto.ringer) {\n            dialog.verto.ringer.attr(\"src\", dialog.verto.options.ringFile)[0].play();\n\n            setTimeout(function() {\n                dialog.stopRinging();\n                if (dialog.state == $.verto.enum.state.ringing) {\n                    dialog.indicateRing();\n                }\n            },\n            dialog.verto.options.ringSleep);\n        }\n    };\n\n    $.verto.dialog.prototype.ring = function() {\n        var dialog = this;\n\n        dialog.setState($.verto.enum.state.ringing);\n        dialog.indicateRing();\n    };\n\n    $.verto.dialog.prototype.useVideo = function(on) {\n        var dialog = this;\n\n        dialog.params.useVideo = on;\n\n        if (on) {\n            dialog.videoStream = dialog.audioStream;\n        } else {\n            dialog.videoStream = null;\n        }\n\n        dialog.rtc.useVideo(dialog.videoStream, dialog.localVideo);\n\n    };\n\n    $.verto.dialog.prototype.setMute = function(what) {\n\tvar dialog = this;\n\treturn dialog.rtc.setMute(what);\n    };\n\n    $.verto.dialog.prototype.getMute = function() {\n\tvar dialog = this; \n\treturn dialog.rtc.getMute();\n    };\n\n    $.verto.dialog.prototype.setVideoMute = function(what) {\n\tvar dialog = this;\n\treturn dialog.rtc.setVideoMute(what);\n    };\n\n    $.verto.dialog.prototype.getVideoMute = function() {\n\tvar dialog = this; \n\treturn dialog.rtc.getVideoMute();\n    };\n\n    $.verto.dialog.prototype.useStereo = function(on) {\n        var dialog = this;\n\n        dialog.params.useStereo = on;\n        dialog.rtc.useStereo(on);\n    };\n\n    $.verto.dialog.prototype.dtmf = function(digits) {\n        var dialog = this;\n        if (digits) {\n            dialog.sendMethod(\"verto.info\", {\n                dtmf: digits\n            });\n        }\n    };\n\n    $.verto.dialog.prototype.rtt = function(obj) {\n        var dialog = this;\n\tvar pobj = {};\n\n\tif (!obj) {\n\t    return false;\n\t}\n\n\tpobj.code = obj.code;\n\tpobj.chars = obj.chars;\n\n\n        if (pobj.chars || pobj.code) {\n            dialog.sendMethod(\"verto.info\", {\n                txt: obj,\n\t\tnoDialogParams: true\n            });\n        }\n    };\n\n    $.verto.dialog.prototype.transfer = function(dest, params) {\n        var dialog = this;\n        if (dest) {\n            dialog.sendMethod(\"verto.modify\", {\n                action: \"transfer\",\n                destination: dest,\n                params: params\n            });\n        }\n    };\n\n    $.verto.dialog.prototype.replace = function(replaceCallID, params) {\n        var dialog = this;\n        if (replaceCallID) {\n            dialog.sendMethod(\"verto.modify\", {\n                action: \"replace\",\n                replaceCallID: replaceCallID,\n                params: params\n            });\n        }\n    };\n\n    $.verto.dialog.prototype.hold = function(params) {\n        var dialog = this;\n\n        dialog.sendMethod(\"verto.modify\", {\n            action: \"hold\",\n            params: params\n        });\n    };\n\n    $.verto.dialog.prototype.unhold = function(params) {\n        var dialog = this;\n\n        dialog.sendMethod(\"verto.modify\", {\n            action: \"unhold\",\n            params: params\n        });\n    };\n\n    $.verto.dialog.prototype.toggleHold = function(params) {\n        var dialog = this;\n\n        dialog.sendMethod(\"verto.modify\", {\n            action: \"toggleHold\",\n            params: params\n        });\n    };\n\n    $.verto.dialog.prototype.message = function(msg) {\n        var dialog = this;\n        var err = 0;\n\n        msg.from = dialog.params.login;\n\n        if (!msg.to) {\n            console.error(\"Missing To\");\n            err++;\n        }\n\n        if (!msg.body) {\n            console.error(\"Missing Body\");\n            err++;\n        }\n\n        if (err) {\n            return false;\n        }\n\n        dialog.sendMethod(\"verto.info\", {\n            msg: msg\n        });\n\n        return true;\n    };\n\n    $.verto.dialog.prototype.answer = function(params) {\n        var dialog = this;\n\t\n        if (!dialog.answered) {\n\t    if (!params) {\n\t\tparams = {};\n\t    }\n\n\t    params.sdp = dialog.params.sdp;\n\n            if (params) {\n                if (params.useVideo) {\n                    dialog.useVideo(true);\n                }\n\t\tdialog.params.callee_id_name = params.callee_id_name;\n\t\tdialog.params.callee_id_number = params.callee_id_number;\n\n\t\tif (params.useCamera) {\n            dialog.useCamera = params.useCamera;\n            dialog.useCameraLabel = params.useCameraLabel;\n\t\t}\n\n\t\tif (params.useMic) {\n            dialog.useMic = params.useMic;\n            dialog.useMic = params.useMicLabel;\n\t\t}\n\n\t\tif (params.useSpeak) {\n\t\t    dialog.useSpeak = params.useSpeak;\n\t\t}\n            }\n\t    \n            dialog.rtc.createAnswer(params);\n            dialog.answered = true;\n        }\n    };\n\n    $.verto.dialog.prototype.handleAnswer = function(params) {\n        var dialog = this;\n\n        dialog.gotAnswer = true;\n\n        if (dialog.state.val >= $.verto.enum.state.active.val) {\n            return;\n        }\n\n        if (dialog.state.val >= $.verto.enum.state.early.val) {\n            dialog.setState($.verto.enum.state.active);\n        } else {\n            if (dialog.gotEarly) {\n                console.log(\"Dialog \" + dialog.callID + \" Got answer while still establishing early media, delaying...\");\n            } else {\n                console.log(\"Dialog \" + dialog.callID + \" Answering Channel\");\n                dialog.rtc.answer(params.sdp, function() {\n                    dialog.setState($.verto.enum.state.active);\n                }, function(e) {\n                    console.error(e);\n                    dialog.hangup();\n                });\n                console.log(\"Dialog \" + dialog.callID + \"ANSWER SDP\", params.sdp);\n            }\n        }\n\n\n    };\n\n    $.verto.dialog.prototype.cidString = function(enc) {\n        var dialog = this;\n        var party = dialog.params.remote_caller_id_name + (enc ? \" &lt;\" : \" <\") + dialog.params.remote_caller_id_number + (enc ? \"&gt;\" : \">\");\n        return party;\n    };\n\n    $.verto.dialog.prototype.sendMessage = function(msg, params) {\n        var dialog = this;\n\n        if (dialog.callbacks.onMessage) {\n            dialog.callbacks.onMessage(dialog.verto, dialog, msg, params);\n        }\n    };\n\n    $.verto.dialog.prototype.handleInfo = function(params) {\n        var dialog = this;\n\n        dialog.sendMessage($.verto.enum.message.info, params);\n\n    };\n\n    $.verto.dialog.prototype.handleDisplay = function(params) {\n        var dialog = this;\n\n        if (params.display_name) {\n            dialog.params.remote_caller_id_name = params.display_name;\n        }\n        if (params.display_number) {\n            dialog.params.remote_caller_id_number = params.display_number;\n        }\n\n        dialog.sendMessage($.verto.enum.message.display, {});\n    };\n\n    $.verto.dialog.prototype.handleMedia = function(params) {\n        var dialog = this;\n\n        if (dialog.state.val >= $.verto.enum.state.early.val) {\n            return;\n        }\n\n        dialog.gotEarly = true;\n\n        dialog.rtc.answer(params.sdp, function() {\n            console.log(\"Dialog \" + dialog.callID + \"Establishing early media\");\n            dialog.setState($.verto.enum.state.early);\n\n            if (dialog.gotAnswer) {\n                console.log(\"Dialog \" + dialog.callID + \"Answering Channel\");\n                dialog.setState($.verto.enum.state.active);\n            }\n        }, function(e) {\n            console.error(e);\n            dialog.hangup();\n        });\n        console.log(\"Dialog \" + dialog.callID + \"EARLY SDP\", params.sdp);\n    };\n\n    $.verto.ENUM = function(s) {\n        var i = 0,\n        o = {};\n        s.split(\" \").map(function(x) {\n            o[x] = {\n                name: x,\n                val: i++\n            };\n        });\n        return Object.freeze(o);\n    };\n\n    $.verto.enum = {};\n\n    $.verto.enum.states = Object.freeze({\n        new: {\n            requesting: 1,\n            recovering: 1,\n            ringing: 1,\n            destroy: 1,\n            answering: 1,\n\t    hangup: 1\n        },\n        requesting: {\n            trying: 1,\n            hangup: 1,\n\t    active: 1\n        },\n        recovering: {\n            answering: 1,\n            hangup: 1\n        },\n        trying: {\n            active: 1,\n            early: 1,\n            hangup: 1\n        },\n        ringing: {\n            answering: 1,\n            hangup: 1\n        },\n        answering: {\n            active: 1,\n            hangup: 1\n        },\n        active: {\n            answering: 1,\n            requesting: 1,\n            hangup: 1,\n            held: 1\n        },\n        held: {\n            hangup: 1,\n            active: 1\n        },\n        early: {\n            hangup: 1,\n            active: 1\n        },\n        hangup: {\n            destroy: 1\n        },\n        destroy: {},\n        purge: {\n            destroy: 1\n        }\n    });\n\n    $.verto.enum.state = $.verto.ENUM(\"new requesting trying recovering ringing answering early active held hangup destroy purge\");\n    $.verto.enum.direction = $.verto.ENUM(\"inbound outbound\");\n    $.verto.enum.message = $.verto.ENUM(\"display info pvtEvent clientReady\");\n\n    $.verto.enum = Object.freeze($.verto.enum);\n\n    $.verto.saved = [];\n    \n    $.verto.unloadJobs = [];\n\n    var unloadEventName = 'beforeunload';\n    // Hacks for Mobile Safari\n    var iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;\n    if (iOS) {\n      unloadEventName = 'pagehide';\n    }\n\n    $(window).bind(unloadEventName, function() {\n        for (var f in $.verto.unloadJobs) {\n          $.verto.unloadJobs[f]();\n        }\n\n        if ($.verto.haltClosure)\n          return $.verto.haltClosure();\n\n        for (var i in $.verto.saved) {\n            var verto = $.verto.saved[i];\n            if (verto) {\n                verto.purge();\n                verto.logout();\n            }\n        }\n\n        return $.verto.warnOnUnload;\n    });\n\n    $.verto.videoDevices = [];\n    $.verto.audioInDevices = [];\n    $.verto.audioOutDevices = [];\n\n    var checkDevices = function(runtime) {\n\tconsole.info(\"enumerating devices\");\n\tvar aud_in = [], aud_out = [], vid = [];\t\n\tvar has_video = 0, has_audio = 0;\n\tvar Xstream;\n\n\tfunction gotDevices(deviceInfos) {\n\t      // Handles being called several times to update labels. Preserve values.\n\t    for (var i = 0; i !== deviceInfos.length; ++i) {\n\t\tvar deviceInfo = deviceInfos[i];\n\t\tvar text = \"\";\n\n\t\tconsole.log(deviceInfo);\n\t\tconsole.log(deviceInfo.kind + \": \" + deviceInfo.label + \" id = \" + deviceInfo.deviceId);\n\n\t\tif (deviceInfo.kind === 'audioinput') {\n\t\t    text = deviceInfo.label || 'microphone ' + (aud_in.length + 1);\n\t\t    aud_in.push({id: deviceInfo.deviceId, kind: \"audio_in\", label: text});\n\t\t} else if (deviceInfo.kind === 'audiooutput') {\n\t\t    text = deviceInfo.label || 'speaker ' + (aud_out.length + 1);\n\t\t    aud_out.push({id: deviceInfo.deviceId, kind: \"audio_out\", label: text});\n\t\t} else if (deviceInfo.kind === 'videoinput') {\n\t\t    text = deviceInfo.label || 'camera ' + (vid.length + 1);\n\t\t    vid.push({id: deviceInfo.deviceId, kind: \"video\", label: text});\n\t\t} else {\n\t\t    console.log('Some other kind of source/device: ', deviceInfo);\n\t\t}\n\t    }\n\n\n\t    $.verto.videoDevices = vid;\n\t    $.verto.audioInDevices = aud_in;\n\t    $.verto.audioOutDevices = aud_out;\n\t    \n\t    console.info(\"Audio IN Devices\", $.verto.audioInDevices);\n\t    console.info(\"Audio Out Devices\", $.verto.audioOutDevices);\n\t    console.info(\"Video Devices\", $.verto.videoDevices);\n\n\t    if (Xstream) {\n\t\tXstream.getTracks().forEach(function(track) {track.stop();});\n\t    }\n\n\t    if (runtime) {\n\t\truntime(true);\n\t    }\n\t}\n\n\n\t\n\n\tfunction handleError(error) {\n\t    console.log('device enumeration error: ', error);\n\t    if (runtime) runtime(false);\n\t}\n\n\n\tfunction checkTypes(devs) {\n\t    for (var i = 0; i !== devs.length; ++i) {\n\n\t\tif (devs[i].kind === 'audioinput') {\n\t\t    has_audio++;\n\t\t} else if (devs[i].kind === 'videoinput') {\n\t\t    has_video++;\n\t\t}\n\t    }\n\t    navigator.mediaDevices.getUserMedia({ audio: (has_audio > 0 ? true : false), video: (has_video > 0 ? true : false)})\n                .then(function(stream) {\n                        Xstream = stream;\n                        navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(handleError);\n           })\n           .catch(function(err) {\n                console.log(\"The following error occurred: \" + err.name);\n          });\n\n\t}\n\n\tnavigator.mediaDevices.enumerateDevices().then(checkTypes).catch(handleError);\n\n  };\n\n    $.verto.refreshDevices = function(runtime) {\n\tcheckDevices(runtime);\n    }\n\n    $.verto.init = function(obj, runtime) {\n\tif (!obj) {\n\t    obj = {};\n\t}\n\n\tif (!obj.skipPermCheck && !obj.skipDeviceCheck) {\n\t    $.FSRTC.checkPerms(function(status) {\n\t\tcheckDevices(runtime);\n\t    }, true, true);\n\t} else if (obj.skipPermCheck && !obj.skipDeviceCheck) {\n\t    checkDevices(runtime);\n\t} else if (!obj.skipPermCheck && obj.skipDeviceCheck) {\n\t    $.FSRTC.checkPerms(function(status) {\n\t\truntime(status);\n\t    }, true, true);\n\t} else {\n\t    runtime(null);\n\t}\n\n    }\n\n    $.verto.genUUID = function () {\n\treturn generateGUID();\n    }\n\n\n})(jQuery);\n\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.adapter = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nvar _adapter_factory = require('./adapter_factory.js');\n\nvar adapter = (0, _adapter_factory.adapterFactory)({ window: window });\nmodule.exports = adapter; // this is the difference from adapter_core.\n\n},{\"./adapter_factory.js\":2}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.adapterFactory = adapterFactory;\n\nvar _utils = require('./utils');\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _chrome_shim = require('./chrome/chrome_shim');\n\nvar chromeShim = _interopRequireWildcard(_chrome_shim);\n\nvar _edge_shim = require('./edge/edge_shim');\n\nvar edgeShim = _interopRequireWildcard(_edge_shim);\n\nvar _firefox_shim = require('./firefox/firefox_shim');\n\nvar firefoxShim = _interopRequireWildcard(_firefox_shim);\n\nvar _safari_shim = require('./safari/safari_shim');\n\nvar safariShim = _interopRequireWildcard(_safari_shim);\n\nvar _common_shim = require('./common_shim');\n\nvar commonShim = _interopRequireWildcard(_common_shim);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n// Shimming starts here.\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nfunction adapterFactory() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      window = _ref.window;\n\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    shimChrome: true,\n    shimFirefox: true,\n    shimEdge: true,\n    shimSafari: true\n  };\n\n  // Utils.\n  var logging = utils.log;\n  var browserDetails = utils.detectBrowser(window);\n\n  var adapter = {\n    browserDetails: browserDetails,\n    commonShim: commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection || !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n      chromeShim.shimSenderReceiverGetStats(window);\n      chromeShim.fixNegotiationNeeded(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection || !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n      firefoxShim.shimSenderGetStats(window);\n      firefoxShim.shimReceiverGetStats(window);\n      firefoxShim.shimRTCDataChannel(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimGetDisplayMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCreateOfferLegacy(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n\n// Browser shims.\n\n},{\"./chrome/chrome_shim\":3,\"./common_shim\":6,\"./edge/edge_shim\":7,\"./firefox/firefox_shim\":11,\"./safari/safari_shim\":14,\"./utils\":15}],3:[function(require,module,exports){\n\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _getusermedia = require('./getusermedia');\n\nObject.defineProperty(exports, 'shimGetUserMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getusermedia.shimGetUserMedia;\n  }\n});\n\nvar _getdisplaymedia = require('./getdisplaymedia');\n\nObject.defineProperty(exports, 'shimGetDisplayMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getdisplaymedia.shimGetDisplayMedia;\n  }\n});\nexports.shimMediaStream = shimMediaStream;\nexports.shimOnTrack = shimOnTrack;\nexports.shimGetSendersWithDtmf = shimGetSendersWithDtmf;\nexports.shimSenderReceiverGetStats = shimSenderReceiverGetStats;\nexports.shimAddTrackRemoveTrackWithNative = shimAddTrackRemoveTrackWithNative;\nexports.shimAddTrackRemoveTrack = shimAddTrackRemoveTrack;\nexports.shimPeerConnection = shimPeerConnection;\nexports.fixNegotiationNeeded = fixNegotiationNeeded;\n\nvar _utils = require('../utils.js');\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/* iterates the stats graph recursively. */\nfunction walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(function (name) {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(function (id) {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nfunction filterStats(result, track, outbound) {\n  var streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  var filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  var trackStats = [];\n  result.forEach(function (value) {\n    if (value.type === 'track' && value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(function (trackStat) {\n    result.forEach(function (stats) {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\nfunction shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nfunction shimOnTrack(window) {\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('ontrack' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get: function get() {\n        return this._ontrack;\n      },\n      set: function set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n\n      enumerable: true,\n      configurable: true\n    });\n    var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription = function () {\n      var _this = this;\n\n      if (!this._ontrackpoly) {\n        this._ontrackpoly = function (e) {\n          // onaddstream does not fire when a track is added to an existing\n          // stream. But stream.onaddtrack is implemented so we use that.\n          e.stream.addEventListener('addtrack', function (te) {\n            var receiver = void 0;\n            if (window.RTCPeerConnection.prototype.getReceivers) {\n              receiver = _this.getReceivers().find(function (r) {\n                return r.track && r.track.id === te.track.id;\n              });\n            } else {\n              receiver = { track: te.track };\n            }\n\n            var event = new Event('track');\n            event.track = te.track;\n            event.receiver = receiver;\n            event.transceiver = { receiver: receiver };\n            event.streams = [e.stream];\n            _this.dispatchEvent(event);\n          });\n          e.stream.getTracks().forEach(function (track) {\n            var receiver = void 0;\n            if (window.RTCPeerConnection.prototype.getReceivers) {\n              receiver = _this.getReceivers().find(function (r) {\n                return r.track && r.track.id === track.id;\n              });\n            } else {\n              receiver = { track: track };\n            }\n            var event = new Event('track');\n            event.track = track;\n            event.receiver = receiver;\n            event.transceiver = { receiver: receiver };\n            event.streams = [e.stream];\n            _this.dispatchEvent(event);\n          });\n        };\n        this.addEventListener('addstream', this._ontrackpoly);\n      }\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', function (e) {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver', { value: { receiver: e.receiver } });\n      }\n      return e;\n    });\n  }\n}\n\nfunction shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('getSenders' in window.RTCPeerConnection.prototype) && 'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    var shimSenderWithDtmf = function shimSenderWithDtmf(pc, track) {\n      return {\n        track: track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function () {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack = function (track, stream) {\n        var sender = origAddTrack.apply(this, arguments);\n        if (!sender) {\n          sender = shimSenderWithDtmf(this, track);\n          this._senders.push(sender);\n        }\n        return sender;\n      };\n\n      var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack = function (sender) {\n        origRemoveTrack.apply(this, arguments);\n        var idx = this._senders.indexOf(sender);\n        if (idx !== -1) {\n          this._senders.splice(idx, 1);\n        }\n      };\n    }\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function (stream) {\n      var _this2 = this;\n\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(function (track) {\n        _this2._senders.push(shimSenderWithDtmf(_this2, track));\n      });\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function (stream) {\n      var _this3 = this;\n\n      this._senders = this._senders || [];\n      origRemoveStream.apply(this, [stream]);\n\n      stream.getTracks().forEach(function (track) {\n        var sender = _this3._senders.find(function (s) {\n          return s.track === track;\n        });\n        if (sender) {\n          // remove sender\n          _this3._senders.splice(_this3._senders.indexOf(sender), 1);\n        }\n      });\n    };\n  } else if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && 'getSenders' in window.RTCPeerConnection.prototype && 'createDTMFSender' in window.RTCPeerConnection.prototype && window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function () {\n      var _this4 = this;\n\n      var senders = origGetSenders.apply(this, []);\n      senders.forEach(function (sender) {\n        return sender._pc = _this4;\n      });\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get: function get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nfunction shimSenderReceiverGetStats(window) {\n  if (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function () {\n        var _this5 = this;\n\n        var senders = origGetSenders.apply(this, []);\n        senders.forEach(function (sender) {\n          return sender._pc = _this5;\n        });\n        return senders;\n      };\n    }\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function () {\n        var sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function () {\n      var sender = this;\n      return this._pc.getStats().then(function (result) {\n        return (\n          /* Note: this will include stats of all senders that\n           *   send a track with the same id as sender.track as\n           *   it is not possible to identify the RTCRtpSender.\n           */\n          filterStats(result, sender.track, true)\n        );\n      });\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers = function () {\n        var _this6 = this;\n\n        var receivers = origGetReceivers.apply(this, []);\n        receivers.forEach(function (receiver) {\n          return receiver._pc = _this6;\n        });\n        return receivers;\n      };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', function (e) {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function () {\n      var receiver = this;\n      return this._pc.getStats().then(function (result) {\n        return filterStats(result, receiver.track, false);\n      });\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype && 'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  var origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function () {\n    if (arguments.length > 0 && arguments[0] instanceof window.MediaStreamTrack) {\n      var track = arguments[0];\n      var sender = void 0;\n      var receiver = void 0;\n      var err = void 0;\n      this.getSenders().forEach(function (s) {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(function (r) {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || sender && receiver) {\n        return Promise.reject(new DOMException('There are more than one sender or receiver for the track.', 'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException('There is no sender or receiver for the track.', 'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nfunction shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams = function () {\n    var _this7 = this;\n\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    return Object.keys(this._shimmedLocalStreams).map(function (streamId) {\n      return _this7._shimmedLocalStreams[streamId][0];\n    });\n  };\n\n  var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack = function (track, stream) {\n    if (!stream) {\n      return origAddTrack.apply(this, arguments);\n    }\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    var sender = origAddTrack.apply(this, arguments);\n    if (!this._shimmedLocalStreams[stream.id]) {\n      this._shimmedLocalStreams[stream.id] = [stream, sender];\n    } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n      this._shimmedLocalStreams[stream.id].push(sender);\n    }\n    return sender;\n  };\n\n  var origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function (stream) {\n    var _this8 = this;\n\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(function (track) {\n      var alreadyExists = _this8.getSenders().find(function (s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.', 'InvalidAccessError');\n      }\n    });\n    var existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    var newSenders = this.getSenders().filter(function (newSender) {\n      return existingSenders.indexOf(newSender) === -1;\n    });\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream = function (stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    delete this._shimmedLocalStreams[stream.id];\n    return origRemoveStream.apply(this, arguments);\n  };\n\n  var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack = function (sender) {\n    var _this9 = this;\n\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n    if (sender) {\n      Object.keys(this._shimmedLocalStreams).forEach(function (streamId) {\n        var idx = _this9._shimmedLocalStreams[streamId].indexOf(sender);\n        if (idx !== -1) {\n          _this9._shimmedLocalStreams[streamId].splice(idx, 1);\n        }\n        if (_this9._shimmedLocalStreams[streamId].length === 1) {\n          delete _this9._shimmedLocalStreams[streamId];\n        }\n      });\n    }\n    return origRemoveTrack.apply(this, arguments);\n  };\n}\n\nfunction shimAddTrackRemoveTrack(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var browserDetails = utils.detectBrowser(window);\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack && browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  var origGetLocalStreams = window.RTCPeerConnection.prototype.getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams = function () {\n    var _this10 = this;\n\n    var nativeStreams = origGetLocalStreams.apply(this);\n    this._reverseStreams = this._reverseStreams || {};\n    return nativeStreams.map(function (stream) {\n      return _this10._reverseStreams[stream.id];\n    });\n  };\n\n  var origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function (stream) {\n    var _this11 = this;\n\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(function (track) {\n      var alreadyExists = _this11.getSenders().find(function (s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.', 'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      var newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream = function (stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    origRemoveStream.apply(this, [this._streams[stream.id] || stream]);\n    delete this._reverseStreams[this._streams[stream.id] ? this._streams[stream.id].id : stream.id];\n    delete this._streams[stream.id];\n  };\n\n  window.RTCPeerConnection.prototype.addTrack = function (track, stream) {\n    var _this12 = this;\n\n    if (this.signalingState === 'closed') {\n      throw new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\n    }\n    var streams = [].slice.call(arguments, 1);\n    if (streams.length !== 1 || !streams[0].getTracks().find(function (t) {\n      return t === track;\n    })) {\n      // this is not fully correct but all we can manage without\n      // [[associated MediaStreams]] internal slot.\n      throw new DOMException('The adapter.js addTrack polyfill only supports a single ' + ' stream which is associated with the specified track.', 'NotSupportedError');\n    }\n\n    var alreadyExists = this.getSenders().find(function (s) {\n      return s.track === track;\n    });\n    if (alreadyExists) {\n      throw new DOMException('Track already exists.', 'InvalidAccessError');\n    }\n\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n    var oldStream = this._streams[stream.id];\n    if (oldStream) {\n      // this is using odd Chrome behaviour, use with caution:\n      // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n      // Note: we rely on the high-level addTrack/dtmf shim to\n      // create the sender with a dtmf sender.\n      oldStream.addTrack(track);\n\n      // Trigger ONN async.\n      Promise.resolve().then(function () {\n        _this12.dispatchEvent(new Event('negotiationneeded'));\n      });\n    } else {\n      var newStream = new window.MediaStream([track]);\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      this.addStream(newStream);\n    }\n    return this.getSenders().find(function (s) {\n      return s.track === track;\n    });\n  };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    var sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(function (internalId) {\n      var externalStream = pc._reverseStreams[internalId];\n      var internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'), externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp: sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    var sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(function (internalId) {\n      var externalStream = pc._reverseStreams[internalId];\n      var internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'), internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp: sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function (method) {\n    var nativeMethod = window.RTCPeerConnection.prototype[method];\n    window.RTCPeerConnection.prototype[method] = function () {\n      var _this13 = this;\n\n      var args = arguments;\n      var isLegacyCall = arguments.length && typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [function (description) {\n          var desc = replaceInternalStreamId(_this13, description);\n          args[0].apply(null, [desc]);\n        }, function (err) {\n          if (args[1]) {\n            args[1].apply(null, err);\n          }\n        }, arguments[2]]);\n      }\n      return nativeMethod.apply(this, arguments).then(function (description) {\n        return replaceInternalStreamId(_this13, description);\n      });\n    };\n  });\n\n  var origSetLocalDescription = window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription = function () {\n    if (!arguments.length || !arguments[0].type) {\n      return origSetLocalDescription.apply(this, arguments);\n    }\n    arguments[0] = replaceExternalStreamId(this, arguments[0]);\n    return origSetLocalDescription.apply(this, arguments);\n  };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  var origLocalDescription = Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype, 'localDescription', {\n    get: function get() {\n      var description = origLocalDescription.get.apply(this);\n      if (description.type === '') {\n        return description;\n      }\n      return replaceInternalStreamId(this, description);\n    }\n  });\n\n  window.RTCPeerConnection.prototype.removeTrack = function (sender) {\n    var _this14 = this;\n\n    if (this.signalingState === 'closed') {\n      throw new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\n    }\n    // We can not yet check for sender instanceof RTCRtpSender\n    // since we shim RTPSender. So we check if sender._pc is set.\n    if (!sender._pc) {\n      throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' + 'does not implement interface RTCRtpSender.', 'TypeError');\n    }\n    var isLocal = sender._pc === this;\n    if (!isLocal) {\n      throw new DOMException('Sender was not created by this connection.', 'InvalidAccessError');\n    }\n\n    // Search for the native stream the senders track belongs to.\n    this._streams = this._streams || {};\n    var stream = void 0;\n    Object.keys(this._streams).forEach(function (streamid) {\n      var hasTrack = _this14._streams[streamid].getTracks().find(function (track) {\n        return sender.track === track;\n      });\n      if (hasTrack) {\n        stream = _this14._streams[streamid];\n      }\n    });\n\n    if (stream) {\n      if (stream.getTracks().length === 1) {\n        // if this is the last track of the stream, remove the stream. This\n        // takes care of any shimmed _senders.\n        this.removeStream(this._reverseStreams[stream.id]);\n      } else {\n        // relying on the same odd chrome behaviour as above.\n        stream.removeTrack(sender.track);\n      }\n      this.dispatchEvent(new Event('negotiationneeded'));\n    }\n  };\n}\n\nfunction shimPeerConnection(window) {\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  var origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function (selector, successCallback, errorCallback) {\n    var _this15 = this;\n\n    var args = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 || typeof arguments[0] !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    var fixChromeStats_ = function fixChromeStats_(response) {\n      var standardReport = {};\n      var reports = response.result();\n      reports.forEach(function (report) {\n        var standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(function (name) {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function makeMapStats(stats) {\n      return new Map(Object.keys(stats).map(function (key) {\n        return [key, stats[key]];\n      }));\n    };\n\n    if (arguments.length >= 2) {\n      var successCallbackWrapper_ = function successCallbackWrapper_(response) {\n        args[1](makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_, arguments[0]]);\n    }\n\n    // promise-support\n    return new Promise(function (resolve, reject) {\n      origGetStats.apply(_this15, [function (response) {\n        resolve(makeMapStats(fixChromeStats_(response)));\n      }, reject]);\n    }).then(successCallback, errorCallback);\n  };\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\n    var nativeMethod = window.RTCPeerConnection.prototype[method];\n    window.RTCPeerConnection.prototype[method] = function () {\n      arguments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // support for addIceCandidate(null or undefined)\n  var nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;\n  window.RTCPeerConnection.prototype.addIceCandidate = function () {\n    if (!arguments[0]) {\n      if (arguments[1]) {\n        arguments[1].apply(null);\n      }\n      return Promise.resolve();\n    }\n    return nativeAddIceCandidate.apply(this, arguments);\n  };\n}\n\nfunction fixNegotiationNeeded(window) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', function (e) {\n    var pc = e.target;\n    if (pc.signalingState !== 'stable') {\n      return;\n    }\n    return e;\n  });\n}\n\n},{\"../utils.js\":15,\"./getdisplaymedia\":4,\"./getusermedia\":5}],4:[function(require,module,exports){\n/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shimGetDisplayMedia = shimGetDisplayMedia;\nfunction shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!window.navigator.mediaDevices) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' + 'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia = function (constraints) {\n    return getSourceId(constraints).then(function (sourceId) {\n      var widthSpecified = constraints.video && constraints.video.width;\n      var heightSpecified = constraints.video && constraints.video.height;\n      var frameRateSpecified = constraints.video && constraints.video.frameRate;\n      constraints.video = {\n        mandatory: {\n          chromeMediaSource: 'desktop',\n          chromeMediaSourceId: sourceId,\n          maxFrameRate: frameRateSpecified || 3\n        }\n      };\n      if (widthSpecified) {\n        constraints.video.mandatory.maxWidth = widthSpecified;\n      }\n      if (heightSpecified) {\n        constraints.video.mandatory.maxHeight = heightSpecified;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    });\n  };\n}\n\n},{}],5:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nexports.shimGetUserMedia = shimGetUserMedia;\n\nvar _utils = require('../utils.js');\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nvar logging = utils.log;\n\nfunction shimGetUserMedia(window) {\n  var navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  var browserDetails = utils.detectBrowser(window);\n\n  var constraintsToChrome_ = function constraintsToChrome_(c) {\n    if ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function (key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = _typeof(c[key]) === 'object' ? c[key] : { ideal: c[key] };\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function oldname_(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return name === 'deviceId' ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function (mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var shimConstraints_ = function shimConstraints_(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && _typeof(constraints.audio) === 'object') {\n      var remap = function remap(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && _typeof(constraints.video) === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      var face = constraints.video.facingMode;\n      face = face && ((typeof face === 'undefined' ? 'undefined' : _typeof(face)) === 'object' ? face : { ideal: face });\n      var getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if (face && (face.exact === 'user' || face.exact === 'environment' || face.ideal === 'user' || face.ideal === 'environment') && !(navigator.mediaDevices.getSupportedConstraints && navigator.mediaDevices.getSupportedConstraints().facingMode && !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        var matches = void 0;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices().then(function (devices) {\n            devices = devices.filter(function (d) {\n              return d.kind === 'videoinput';\n            });\n            var dev = devices.find(function (d) {\n              return matches.some(function (match) {\n                return d.label.toLowerCase().includes(match);\n              });\n            });\n            if (!dev && devices.length && matches.includes('back')) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? { exact: dev.deviceId } : { ideal: dev.deviceId };\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  var shimError_ = function shimError_(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString: function toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  var getUserMedia_ = function getUserMedia_(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, function (c) {\n      navigator.webkitGetUserMedia(c, onSuccess, function (e) {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function (cs) {\n    return shimConstraints_(cs, function (c) {\n      return origGetUserMedia(c).then(function (stream) {\n        if (c.audio && !stream.getAudioTracks().length || c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function (track) {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, function (e) {\n        return Promise.reject(shimError_(e));\n      });\n    });\n  };\n}\n\n},{\"../utils.js\":15}],6:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nexports.shimRTCIceCandidate = shimRTCIceCandidate;\nexports.shimMaxMessageSize = shimMaxMessageSize;\nexports.shimSendThrowTypeError = shimSendThrowTypeError;\nexports.shimConnectionState = shimConnectionState;\nexports.removeAllowExtmapMixed = removeAllowExtmapMixed;\n\nvar _sdp = require('sdp');\n\nvar _sdp2 = _interopRequireDefault(_sdp);\n\nvar _utils = require('./utils');\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || window.RTCIceCandidate && 'foundation' in window.RTCIceCandidate.prototype) {\n    return;\n  }\n\n  var NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function (args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if ((typeof args === 'undefined' ? 'undefined' : _typeof(args)) === 'object' && args.candidate && args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substr(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      var nativeCandidate = new NativeRTCIceCandidate(args);\n      var parsedCandidate = _sdp2.default.parseCandidate(args.candidate);\n      var augmentedCandidate = Object.assign(nativeCandidate, parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function () {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment\n        };\n      };\n      return augmentedCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', function (e) {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nfunction shimMaxMessageSize(window) {\n  if (window.RTCSctpTransport || !window.RTCPeerConnection) {\n    return;\n  }\n  var browserDetails = utils.detectBrowser(window);\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get: function get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  var sctpInDescription = function sctpInDescription(description) {\n    var sections = _sdp2.default.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(function (mediaSection) {\n      var mLine = _sdp2.default.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application' && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  var getRemoteFirefoxVersion = function getRemoteFirefoxVersion(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    var match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    var version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  var getCanSendMaxMessageSize = function getCanSendMaxMessageSize(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    var canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize = browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  var getMaxMessageSize = function getMaxMessageSize(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    var maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox' && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    var match = _sdp2.default.matchPrefix(description.sdp, 'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substr(19), 10);\n    } else if (browserDetails.browser === 'firefox' && remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription = function () {\n    this._sctp = null;\n\n    if (sctpInDescription(arguments[0])) {\n      // Check if the remote is FF.\n      var isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n      // Get the maximum message size the local peer is capable of sending\n      var canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n      // Get the maximum message size of the remote peer.\n      var remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n      // Determine final maximum message size\n      var maxMessageSize = void 0;\n      if (canSendMMS === 0 && remoteMMS === 0) {\n        maxMessageSize = Number.POSITIVE_INFINITY;\n      } else if (canSendMMS === 0 || remoteMMS === 0) {\n        maxMessageSize = Math.max(canSendMMS, remoteMMS);\n      } else {\n        maxMessageSize = Math.min(canSendMMS, remoteMMS);\n      }\n\n      // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n      // attribute.\n      var sctp = {};\n      Object.defineProperty(sctp, 'maxMessageSize', {\n        get: function get() {\n          return maxMessageSize;\n        }\n      });\n      this._sctp = sctp;\n    }\n\n    return origSetRemoteDescription.apply(this, arguments);\n  };\n}\n\nfunction shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection && 'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    var origDataChannelSend = dc.send;\n    dc.send = function () {\n      var data = arguments[0];\n      var length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' && pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' + pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  var origCreateDataChannel = window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel = function () {\n    var dataChannel = origCreateDataChannel.apply(this, arguments);\n    wrapDcSend(dataChannel, this);\n    return dataChannel;\n  };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', function (e) {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nfunction shimConnectionState(window) {\n  if (!window.RTCPeerConnection || 'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  var proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get: function get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get: function get() {\n      return this._onconnectionstatechange || null;\n    },\n    set: function set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange', this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange', this._onconnectionstatechange = cb);\n      }\n    },\n\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach(function (method) {\n    var origMethod = proto[method];\n    proto[method] = function () {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = function (e) {\n          var pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            var newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange', this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nfunction removeAllowExtmapMixed(window) {\n  /* remove a=extmap-allow-mixed for Chrome < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var browserDetails = utils.detectBrowser(window);\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  var nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription = function (desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      desc.sdp = desc.sdp.split('\\n').filter(function (line) {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n\n},{\"./utils\":15,\"sdp\":17}],7:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\n\nvar _getusermedia = require('./getusermedia');\n\nObject.defineProperty(exports, 'shimGetUserMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getusermedia.shimGetUserMedia;\n  }\n});\n\nvar _getdisplaymedia = require('./getdisplaymedia');\n\nObject.defineProperty(exports, 'shimGetDisplayMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getdisplaymedia.shimGetDisplayMedia;\n  }\n});\nexports.shimPeerConnection = shimPeerConnection;\nexports.shimReplaceTrack = shimReplaceTrack;\n\nvar _utils = require('../utils');\n\nvar utils = _interopRequireWildcard(_utils);\n\nvar _filtericeservers = require('./filtericeservers');\n\nvar _rtcpeerconnectionShim = require('rtcpeerconnection-shim');\n\nvar _rtcpeerconnectionShim2 = _interopRequireDefault(_rtcpeerconnectionShim);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction shimPeerConnection(window) {\n  var browserDetails = utils.detectBrowser(window);\n\n  if (window.RTCIceGatherer) {\n    if (!window.RTCIceCandidate) {\n      window.RTCIceCandidate = function (args) {\n        return args;\n      };\n    }\n    if (!window.RTCSessionDescription) {\n      window.RTCSessionDescription = function (args) {\n        return args;\n      };\n    }\n    // this adds an additional event listener to MediaStrackTrack that signals\n    // when a tracks enabled property was changed. Workaround for a bug in\n    // addStream, see below. No longer required in 15025+\n    if (browserDetails.version < 15025) {\n      var origMSTEnabled = Object.getOwnPropertyDescriptor(window.MediaStreamTrack.prototype, 'enabled');\n      Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n        set: function set(value) {\n          origMSTEnabled.set.call(this, value);\n          var ev = new Event('enabled');\n          ev.enabled = value;\n          this.dispatchEvent(ev);\n        }\n      });\n    }\n  }\n\n  // ORTC defines the DTMF sender a bit different.\n  // https://github.com/w3c/ortc/issues/714\n  if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get: function get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = new window.RTCDtmfSender(this);\n          } else if (this.track.kind === 'video') {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n  // Edge currently only implements the RTCDtmfSender, not the\n  // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\n  if (window.RTCDtmfSender && !window.RTCDTMFSender) {\n    window.RTCDTMFSender = window.RTCDtmfSender;\n  }\n\n  var RTCPeerConnectionShim = (0, _rtcpeerconnectionShim2.default)(window, browserDetails.version);\n  window.RTCPeerConnection = function (config) {\n    if (config && config.iceServers) {\n      config.iceServers = (0, _filtericeservers.filterIceServers)(config.iceServers, browserDetails.version);\n      utils.log('ICE servers after filtering:', config.iceServers);\n    }\n    return new RTCPeerConnectionShim(config);\n  };\n  window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\n}\n\nfunction shimReplaceTrack(window) {\n  // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n  if (window.RTCRtpSender && !('replaceTrack' in window.RTCRtpSender.prototype)) {\n    window.RTCRtpSender.prototype.replaceTrack = window.RTCRtpSender.prototype.setTrack;\n  }\n}\n\n},{\"../utils\":15,\"./filtericeservers\":8,\"./getdisplaymedia\":9,\"./getusermedia\":10,\"rtcpeerconnection-shim\":16}],8:[function(require,module,exports){\n/*\n *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.filterIceServers = filterIceServers;\n\nvar _utils = require('../utils');\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function (server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function (url) {\n        // filter STUN unconditionally.\n        if (url.indexOf('stun:') === 0) {\n          return false;\n        }\n\n        var validTurn = url.startsWith('turn') && !url.startsWith('turn:[') && url.includes('transport=udp');\n        if (validTurn && !hasTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return validTurn && !hasTurn;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n},{\"../utils\":15}],9:[function(require,module,exports){\n/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shimGetDisplayMedia = shimGetDisplayMedia;\nfunction shimGetDisplayMedia(window) {\n  if (!('getDisplayMedia' in window.navigator)) {\n    return;\n  }\n  if (!window.navigator.mediaDevices) {\n    return;\n  }\n  if (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia = window.navigator.getDisplayMedia.bind(window.navigator.mediaDevices);\n}\n\n},{}],10:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shimGetUserMedia = shimGetUserMedia;\nfunction shimGetUserMedia(window) {\n  var navigator = window && window.navigator;\n\n  var shimError_ = function shimError_(e) {\n    return {\n      name: { PermissionDeniedError: 'NotAllowedError' }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString: function toString() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function (c) {\n    return origGetUserMedia(c).catch(function (e) {\n      return Promise.reject(shimError_(e));\n    });\n  };\n}\n\n},{}],11:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _getusermedia = require('./getusermedia');\n\nObject.defineProperty(exports, 'shimGetUserMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getusermedia.shimGetUserMedia;\n  }\n});\n\nvar _getdisplaymedia = require('./getdisplaymedia');\n\nObject.defineProperty(exports, 'shimGetDisplayMedia', {\n  enumerable: true,\n  get: function get() {\n    return _getdisplaymedia.shimGetDisplayMedia;\n  }\n});\nexports.shimOnTrack = shimOnTrack;\nexports.shimPeerConnection = shimPeerConnection;\nexports.shimSenderGetStats = shimSenderGetStats;\nexports.shimReceiverGetStats = shimReceiverGetStats;\nexports.shimRemoveStream = shimRemoveStream;\nexports.shimRTCDataChannel = shimRTCDataChannel;\n\nvar _utils = require('../utils');\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction shimOnTrack(window) {\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get: function get() {\n        return { receiver: this.receiver };\n      }\n    });\n  }\n}\n\nfunction shimPeerConnection(window) {\n  var browserDetails = utils.detectBrowser(window);\n\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n  ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\n    var nativeMethod = window.RTCPeerConnection.prototype[method];\n    window.RTCPeerConnection.prototype[method] = function () {\n      arguments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // support for addIceCandidate(null or undefined)\n  var nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;\n  window.RTCPeerConnection.prototype.addIceCandidate = function () {\n    if (!arguments[0]) {\n      if (arguments[1]) {\n        arguments[1].apply(null);\n      }\n      return Promise.resolve();\n    }\n    return nativeAddIceCandidate.apply(this, arguments);\n  };\n\n  var modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function (selector, onSucc, onErr) {\n    return nativeGetStats.apply(this, [selector || null]).then(function (stats) {\n      if (browserDetails.version < 53 && !onSucc) {\n        // Shim only promise getStats with spec-hyphens in type names\n        // Leave callback version alone; misc old uses of forEach before Map\n        try {\n          stats.forEach(function (stat) {\n            stat.type = modernStatsTypes[stat.type] || stat.type;\n          });\n        } catch (e) {\n          if (e.name !== 'TypeError') {\n            throw e;\n          }\n          // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n          stats.forEach(function (stat, i) {\n            stats.set(i, Object.assign({}, stat, {\n              type: modernStatsTypes[stat.type] || stat.type\n            }));\n          });\n        }\n      }\n      return stats;\n    }).then(onSucc, onErr);\n  };\n}\n\nfunction shimSenderGetStats(window) {\n  if (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function () {\n      var _this = this;\n\n      var senders = origGetSenders.apply(this, []);\n      senders.forEach(function (sender) {\n        return sender._pc = _this;\n      });\n      return senders;\n    };\n  }\n\n  var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function () {\n      var sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function () {\n    return this.track ? this._pc.getStats(this.track) : Promise.resolve(new Map());\n  };\n}\n\nfunction shimReceiverGetStats(window) {\n  if (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function () {\n      var _this2 = this;\n\n      var receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(function (receiver) {\n        return receiver._pc = _this2;\n      });\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', function (e) {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function () {\n    return this._pc.getStats(this.track);\n  };\n}\n\nfunction shimRemoveStream(window) {\n  if (!window.RTCPeerConnection || 'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream = function (stream) {\n    var _this3 = this;\n\n    utils.deprecated('removeStream', 'removeTrack');\n    this.getSenders().forEach(function (sender) {\n      if (sender.track && stream.getTracks().includes(sender.track)) {\n        _this3.removeTrack(sender);\n      }\n    });\n  };\n}\n\nfunction shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\n},{\"../utils\":15,\"./getdisplaymedia\":12,\"./getusermedia\":13}],12:[function(require,module,exports){\n/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shimGetDisplayMedia = shimGetDisplayMedia;\nfunction shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!window.navigator.mediaDevices) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia = function (constraints) {\n    if (!(constraints && constraints.video)) {\n      var err = new DOMException('getDisplayMedia without video ' + 'constraints is undefined');\n      err.name = 'NotFoundError';\n      // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n      err.code = 8;\n      return Promise.reject(err);\n    }\n    if (constraints.video === true) {\n      constraints.video = { mediaSource: preferredMediaSource };\n    } else {\n      constraints.video.mediaSource = preferredMediaSource;\n    }\n    return window.navigator.mediaDevices.getUserMedia(constraints);\n  };\n}\n\n},{}],13:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nexports.shimGetUserMedia = shimGetUserMedia;\n\nvar _utils = require('../utils');\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction shimGetUserMedia(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function (constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia', 'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 && 'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function remap(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function (c) {\n      if ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) === 'object' && _typeof(c.audio) === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function () {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function (c) {\n        if (this.kind === 'audio' && (typeof c === 'undefined' ? 'undefined' : _typeof(c)) === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n\n},{\"../utils\":15}],14:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nexports.shimLocalStreamsAPI = shimLocalStreamsAPI;\nexports.shimRemoteStreamsAPI = shimRemoteStreamsAPI;\nexports.shimCallbacksAPI = shimCallbacksAPI;\nexports.shimGetUserMedia = shimGetUserMedia;\nexports.shimConstraints = shimConstraints;\nexports.shimRTCIceServerUrls = shimRTCIceServerUrls;\nexports.shimTrackEventTransceiver = shimTrackEventTransceiver;\nexports.shimCreateOfferLegacy = shimCreateOfferLegacy;\n\nvar _utils = require('../utils');\n\nvar utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction shimLocalStreamsAPI(window) {\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams = function () {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      return this._localStreams;\n    };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function (stream) {\n      var _this = this;\n\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      stream.getTracks().forEach(function (track) {\n        return _addTrack.call(_this, track, stream);\n      });\n    };\n\n    window.RTCPeerConnection.prototype.addTrack = function (track, stream) {\n      if (stream) {\n        if (!this._localStreams) {\n          this._localStreams = [stream];\n        } else if (!this._localStreams.includes(stream)) {\n          this._localStreams.push(stream);\n        }\n      }\n      return _addTrack.call(this, track, stream);\n    };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream = function (stream) {\n      var _this2 = this;\n\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      var index = this._localStreams.indexOf(stream);\n      if (index === -1) {\n        return;\n      }\n      this._localStreams.splice(index, 1);\n      var tracks = stream.getTracks();\n      this.getSenders().forEach(function (sender) {\n        if (tracks.includes(sender.track)) {\n          _this2.removeTrack(sender);\n        }\n      });\n    };\n  }\n}\n\nfunction shimRemoteStreamsAPI(window) {\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams = function () {\n      return this._remoteStreams ? this._remoteStreams : [];\n    };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get: function get() {\n        return this._onaddstream;\n      },\n      set: function set(f) {\n        var _this3 = this;\n\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = function (e) {\n          e.streams.forEach(function (stream) {\n            if (!_this3._remoteStreams) {\n              _this3._remoteStreams = [];\n            }\n            if (_this3._remoteStreams.includes(stream)) {\n              return;\n            }\n            _this3._remoteStreams.push(stream);\n            var event = new Event('addstream');\n            event.stream = stream;\n            _this3.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription = function () {\n      var pc = this;\n      if (!this._onaddstreampoly) {\n        this.addEventListener('track', this._onaddstreampoly = function (e) {\n          e.streams.forEach(function (stream) {\n            if (!pc._remoteStreams) {\n              pc._remoteStreams = [];\n            }\n            if (pc._remoteStreams.indexOf(stream) >= 0) {\n              return;\n            }\n            pc._remoteStreams.push(stream);\n            var event = new Event('addstream');\n            event.stream = stream;\n            pc.dispatchEvent(event);\n          });\n        });\n      }\n      return origSetRemoteDescription.apply(pc, arguments);\n    };\n  }\n}\n\nfunction shimCallbacksAPI(window) {\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  var prototype = window.RTCPeerConnection.prototype;\n  var createOffer = prototype.createOffer;\n  var createAnswer = prototype.createAnswer;\n  var setLocalDescription = prototype.setLocalDescription;\n  var setRemoteDescription = prototype.setRemoteDescription;\n  var addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer = function (successCallback, failureCallback) {\n    var options = arguments.length >= 2 ? arguments[2] : arguments[0];\n    var promise = createOffer.apply(this, [options]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n\n  prototype.createAnswer = function (successCallback, failureCallback) {\n    var options = arguments.length >= 2 ? arguments[2] : arguments[0];\n    var promise = createAnswer.apply(this, [options]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n\n  var withCallback = function withCallback(description, successCallback, failureCallback) {\n    var promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function withCallback(description, successCallback, failureCallback) {\n    var promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function withCallback(candidate, successCallback, failureCallback) {\n    var promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nfunction shimGetUserMedia(window) {\n  var navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    var mediaDevices = navigator.mediaDevices;\n    var _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = function (constraints) {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function (constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints).then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nfunction shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({}, constraints, { video: utils.compactObject(constraints.video) });\n  }\n\n  return constraints;\n}\n\nfunction shimRTCIceServerUrls(window) {\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  var OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection = function (pcConfig, pcConstraints) {\n    if (pcConfig && pcConfig.iceServers) {\n      var newIceServers = [];\n      for (var i = 0; i < pcConfig.iceServers.length; i++) {\n        var server = pcConfig.iceServers[i];\n        if (!server.hasOwnProperty('urls') && server.hasOwnProperty('url')) {\n          utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n          server = JSON.parse(JSON.stringify(server));\n          server.urls = server.url;\n          delete server.url;\n          newIceServers.push(server);\n        } else {\n          newIceServers.push(pcConfig.iceServers[i]);\n        }\n      }\n      pcConfig.iceServers = newIceServers;\n    }\n    return new OrigPeerConnection(pcConfig, pcConstraints);\n  };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in window.RTCPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get: function get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nfunction shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && 'receiver' in window.RTCTrackEvent.prototype &&\n  // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n  // defined for some reason even when window.RTCTransceiver is not.\n  !window.RTCTransceiver) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get: function get() {\n        return { receiver: this.receiver };\n      }\n    });\n  }\n}\n\nfunction shimCreateOfferLegacy(window) {\n  var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function (offerOptions) {\n    if (offerOptions) {\n      if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n        // support bit values\n        offerOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;\n      }\n      var audioTransceiver = this.getTransceivers().find(function (transceiver) {\n        return transceiver.sender.track && transceiver.sender.track.kind === 'audio';\n      });\n      if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n        if (audioTransceiver.direction === 'sendrecv') {\n          if (audioTransceiver.setDirection) {\n            audioTransceiver.setDirection('sendonly');\n          } else {\n            audioTransceiver.direction = 'sendonly';\n          }\n        } else if (audioTransceiver.direction === 'recvonly') {\n          if (audioTransceiver.setDirection) {\n            audioTransceiver.setDirection('inactive');\n          } else {\n            audioTransceiver.direction = 'inactive';\n          }\n        }\n      } else if (offerOptions.offerToReceiveAudio === true && !audioTransceiver) {\n        this.addTransceiver('audio');\n      }\n\n      if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n        // support bit values\n        offerOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;\n      }\n      var videoTransceiver = this.getTransceivers().find(function (transceiver) {\n        return transceiver.sender.track && transceiver.sender.track.kind === 'video';\n      });\n      if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n        if (videoTransceiver.direction === 'sendrecv') {\n          if (videoTransceiver.setDirection) {\n            videoTransceiver.setDirection('sendonly');\n          } else {\n            videoTransceiver.direction = 'sendonly';\n          }\n        } else if (videoTransceiver.direction === 'recvonly') {\n          if (videoTransceiver.setDirection) {\n            videoTransceiver.setDirection('inactive');\n          } else {\n            videoTransceiver.direction = 'inactive';\n          }\n        }\n      } else if (offerOptions.offerToReceiveVideo === true && !videoTransceiver) {\n        this.addTransceiver('video');\n      }\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\n},{\"../utils\":15}],15:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nexports.extractVersion = extractVersion;\nexports.wrapPeerConnectionEvent = wrapPeerConnectionEvent;\nexports.disableLog = disableLog;\nexports.disableWarnings = disableWarnings;\nexports.log = log;\nexports.deprecated = deprecated;\nexports.detectBrowser = detectBrowser;\nexports.compactObject = compactObject;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar logDisabled_ = true;\nvar deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nfunction extractVersion(uastring, expr, pos) {\n  var match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var proto = window.RTCPeerConnection.prototype;\n  var nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function (nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    var wrappedCallback = function wrappedCallback(e) {\n      var modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        cb(modifiedEvent);\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName, wrappedCallback]);\n  };\n\n  var nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function (nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    var unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName, unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get: function get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set: function set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap, this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap, this['_on' + eventNameToWrap] = cb);\n      }\n    },\n\n    enumerable: true,\n    configurable: true\n  });\n}\n\nfunction disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + (typeof bool === 'undefined' ? 'undefined' : _typeof(bool)) + '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return bool ? 'adapter.js logging disabled' : 'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nfunction disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + (typeof bool === 'undefined' ? 'undefined' : _typeof(bool)) + '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nfunction log() {\n  if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nfunction deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod + ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nfunction detectBrowser(window) {\n  var navigator = window.navigator;\n\n  // Returned result object.\n\n  var result = { browser: null, version: null };\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  if (navigator.mozGetUserMedia) {\n    // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent, /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent, /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (navigator.mediaDevices && navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) {\n    // Edge.\n    result.browser = 'edge';\n    result.version = extractVersion(navigator.userAgent, /Edge\\/(\\d+).(\\d+)$/, 2);\n  } else if (window.RTCPeerConnection && navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\n    // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent, /AppleWebKit\\/(\\d+)\\./, 1);\n  } else {\n    // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nfunction compactObject(data) {\n  if ((typeof data === 'undefined' ? 'undefined' : _typeof(data)) !== 'object') {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function (accumulator, key) {\n    var isObject = _typeof(data[key]) === 'object';\n    var value = isObject ? compactObject(data[key]) : data[key];\n    var isEmptyObject = isObject && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n\n    return Object.assign(accumulator, _defineProperty({}, key, value));\n  }, {});\n}\n\n},{}],16:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction fixStatsType(stat) {\n  return {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  }[stat.type] || stat.type;\n}\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    var trackId = transceiver.rtpSender._initialTrackId ||\n        transceiver.rtpSender.track.id;\n    transceiver.rtpSender._initialTrackId = trackId;\n    // spec.\n    var msid = 'msid:' + (stream ? stream.id : '-') + ' ' +\n        trackId + '\\r\\n';\n    sdp += 'a=' + msid;\n    // for Chrome. Legacy should no longer be required.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n\n    // RTX\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all field are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  // legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\n  e.code = {\n    NotSupportedError: 9,\n    InvalidStateError: 11,\n    InvalidAccessError: 15,\n    TypeError: undefined,\n    OperationError: undefined\n  }[name];\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  // https://w3c.github.io/mediacapture-main/#mediastream\n  // Helper function to add the track to the stream and\n  // dispatch the event ourselves.\n  function addTrackToStreamAndFireEvent(track, stream) {\n    stream.addTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\n        {track: track}));\n  }\n\n  function removeTrackFromStreamAndFireEvent(track, stream) {\n    stream.removeTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\n        {track: track}));\n  }\n\n  function fireAddTrack(pc, track, receiver, streams) {\n    var trackEvent = new Event('track');\n    trackEvent.track = track;\n    trackEvent.receiver = receiver;\n    trackEvent.transceiver = {receiver: receiver};\n    trackEvent.streams = streams;\n    window.setTimeout(function() {\n      pc._dispatchEvent('track', trackEvent);\n    });\n  }\n\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this._localDescription = null;\n    this._remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.connectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers.push(new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        }));\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  Object.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\n    configurable: true,\n    get: function() {\n      return this._localDescription;\n    }\n  });\n  Object.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\n    configurable: true,\n    get: function() {\n      return this._remoteDescription;\n    }\n  });\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (which is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    if (!doNotAdd) {\n      this.transceivers.push(transceiver);\n    }\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call removeTrack on a closed peerconnection.');\n    }\n\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\n        pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var bufferedCandidateEvents =\n      this.transceivers[sdpMLineIndex].bufferedCandidateEvents;\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // dpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        // also the usernameFragment. TODO: update SDP to take both variants.\n        cand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\n\n        var serializedCandidate = SDPUtils.writeCandidate(cand);\n        event.candidate = Object.assign(event.candidate,\n            SDPUtils.parseCandidate(serializedCandidate));\n\n        event.candidate.candidate = serializedCandidate;\n        event.candidate.toJSON = function() {\n          return {\n            candidate: event.candidate.candidate,\n            sdpMid: event.candidate.sdpMid,\n            sdpMLineIndex: event.candidate.sdpMLineIndex,\n            usernameFragment: event.candidate.usernameFragment\n          };\n        };\n      }\n\n      // update local description.\n      var sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc._localDescription.sdp =\n          SDPUtils.getDescription(pc._localDescription.sdp) +\n          sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      bufferedCandidateEvents.forEach(function(e) {\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateIceConnectionState();\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itself.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      } else {\n        params.encodings = [{}];\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc._remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.rejected) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    pc._localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-local-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    pc.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    pc.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      pc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      pc.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\n          protocol === 'UDP/DTLS/SCTP'))) {\n        // TODO: this is dangerous in the case where a non-rejected m-line\n        //     becomes rejected.\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          kind: kind,\n          protocol: protocol,\n          rejected: true\n        };\n        return;\n      }\n\n      if (!rejected && pc.transceivers[sdpMLineIndex] &&\n          pc.transceivers[sdpMLineIndex].rejected) {\n        // recycle a rejected transceiver.\n        pc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        // If the offer contained RTX but the answer did not,\n        // remove RTX from sendEncodingParameters.\n        var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n        var hasRtx = commonCapabilities.codecs.filter(function(c) {\n          return c.name.toLowerCase() === 'rtx';\n        }).length;\n        if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n          delete transceiver.sendEncodingParameters[0].rtx;\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (pc._dtlsRole === undefined) {\n      pc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    pc._remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-remote-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation) {\n        pc.needNegotiation = false;\n        var event = new Event('negotiationneeded');\n        pc._dispatchEvent('negotiationneeded', event);\n      }\n    }, 0);\n  };\n\n  // Update the ice connection state.\n  RTCPeerConnection.prototype._updateIceConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n      }\n    });\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.checking > 0) {\n      newState = 'checking';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    } else if (states.completed > 0) {\n      newState = 'completed';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && transceiver.dtlsTransport &&\n          !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n        states[transceiver.dtlsTransport.state]++;\n      }\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.connectionState) {\n      this.connectionState = newState;\n      var event = new Event('connectionstatechange');\n      this._dispatchEvent('connectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    pc.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        pc._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        pc._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = transceiver.mid || SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n\n        // for subsequent offers, we might have to re-use the payload\n        // type of the last offer.\n        if (transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.codecs) {\n          transceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {\n            if (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\n                codec.clockRate === remoteCodec.clockRate) {\n              codec.preferredPayloadType = remoteCodec.payloadType;\n            }\n          });\n        }\n      });\n      localCapabilities.headerExtensions.forEach(function(hdrExt) {\n        var remoteExtensions = transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.headerExtensions || [];\n        remoteExtensions.forEach(function(rHdrExt) {\n          if (hdrExt.uri === rHdrExt.uri) {\n            hdrExt.id = rHdrExt.id;\n          }\n        });\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (pc._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    if (!(pc.signalingState === 'have-remote-offer' ||\n        pc.signalingState === 'have-local-pranswer')) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer in signalingState ' + pc.signalingState));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    if (pc.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    var mediaSectionsInOffer = SDPUtils.getMediaSections(\n        pc._remoteDescription.sdp).length;\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.rejected) {\n        if (transceiver.kind === 'application') {\n          if (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\n            sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\n          } else {\n            sdp += 'm=application 0 ' + transceiver.protocol +\n                ' webrtc-datachannel\\r\\n';\n          }\n        } else if (transceiver.kind === 'audio') {\n          sdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\n              'a=rtpmap:0 PCMU/8000\\r\\n';\n        } else if (transceiver.kind === 'video') {\n          sdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\n              'a=rtpmap:120 VP8/90000\\r\\n';\n        }\n        sdp += 'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=inactive\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var pc = this;\n    var sections;\n    if (candidate && !(candidate.sdpMLineIndex !== undefined ||\n        candidate.sdpMid)) {\n      return Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\n    }\n\n    // TODO: needs to go into ops queue.\n    return new Promise(function(resolve, reject) {\n      if (!pc._remoteDescription) {\n        return reject(makeError('InvalidStateError',\n            'Can not add ICE candidate without a remote description'));\n      } else if (!candidate || candidate.candidate === '') {\n        for (var j = 0; j < pc.transceivers.length; j++) {\n          if (pc.transceivers[j].rejected) {\n            continue;\n          }\n          pc.transceivers[j].iceTransport.addRemoteCandidate({});\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[j] += 'a=end-of-candidates\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n          if (pc.usingBundle) {\n            break;\n          }\n        }\n      } else {\n        var sdpMLineIndex = candidate.sdpMLineIndex;\n        if (candidate.sdpMid) {\n          for (var i = 0; i < pc.transceivers.length; i++) {\n            if (pc.transceivers[i].mid === candidate.sdpMid) {\n              sdpMLineIndex = i;\n              break;\n            }\n          }\n        }\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        if (transceiver) {\n          if (transceiver.rejected) {\n            return resolve();\n          }\n          var cand = Object.keys(candidate.candidate).length > 0 ?\n              SDPUtils.parseCandidate(candidate.candidate) : {};\n          // Ignore Chrome's invalid candidates since Edge does not like them.\n          if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n            return resolve();\n          }\n          // Ignore RTCP candidates, we assume RTCP-MUX.\n          if (cand.component && cand.component !== 1) {\n            return resolve();\n          }\n          // when using bundle, avoid adding candidates to the wrong\n          // ice transport. And avoid adding candidates added in the SDP.\n          if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n              transceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\n            if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n              return reject(makeError('OperationError',\n                  'Can not add ICE candidate'));\n            }\n          }\n\n          // update the remoteDescription.\n          var candidateString = candidate.candidate.trim();\n          if (candidateString.indexOf('a=') === 0) {\n            candidateString = candidateString.substr(2);\n          }\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[sdpMLineIndex] += 'a=' +\n              (cand.type ? candidateString : 'end-of-candidates')\n              + '\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n        } else {\n          return reject(makeError('OperationError',\n              'Can not add ICE candidate'));\n        }\n      }\n      resolve();\n    });\n  };\n\n  RTCPeerConnection.prototype.getStats = function(selector) {\n    if (selector && selector instanceof window.MediaStreamTrack) {\n      var senderOrReceiver = null;\n      this.transceivers.forEach(function(transceiver) {\n        if (transceiver.rtpSender &&\n            transceiver.rtpSender.track === selector) {\n          senderOrReceiver = transceiver.rtpSender;\n        } else if (transceiver.rtpReceiver &&\n            transceiver.rtpReceiver.track === selector) {\n          senderOrReceiver = transceiver.rtpReceiver;\n        }\n      });\n      if (!senderOrReceiver) {\n        throw makeError('InvalidAccessError', 'Invalid selector.');\n      }\n      return senderOrReceiver.getStats();\n    }\n\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    return Promise.all(promises).then(function(allStats) {\n      var results = new Map();\n      allStats.forEach(function(stats) {\n        stats.forEach(function(stat) {\n          results.set(stat.id, stat);\n        });\n      });\n      return results;\n    });\n  };\n\n  // fix low-level stat names and return Map instead of object.\n  var ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',\n    'RTCIceTransport', 'RTCDtlsTransport'];\n  ortcObjects.forEach(function(ortcObjectName) {\n    var obj = window[ortcObjectName];\n    if (obj && obj.prototype && obj.prototype.getStats) {\n      var nativeGetstats = obj.prototype.getStats;\n      obj.prototype.getStats = function() {\n        return nativeGetstats.apply(this)\n        .then(function(nativeStats) {\n          var mapStats = new Map();\n          Object.keys(nativeStats).forEach(function(id) {\n            nativeStats[id].type = fixStatsType(nativeStats[id]);\n            mapStats.set(id, nativeStats[id]);\n          });\n          return mapStats;\n        });\n      };\n    }\n  });\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n\n},{\"sdp\":17}],17:[function(require,module,exports){\n /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n          ? '/' + headerExtension.direction\n          : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\nSDPUtils.parseSsrcGroup = function(line) {\n  var parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(function(ssrc) {\n      return parseInt(ssrc, 10);\n    })\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n      'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.substr(17).split(' ');\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10)\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  // Gets the first SSRC. Note tha with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n      .map(function(line) {\n        return SDPUtils.parseSsrcMedia(line);\n      })\n      .filter(function(obj) {\n        return obj.attribute === 'cname';\n      })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(msidParts) {\n    return msidParts.attribute === 'msid';\n  });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  var user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5]\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  var lines = SDPUtils.splitLines(blob);\n  for (var i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n\n},{}]},{},[1])(1)\n});\n\n// Last time updated at Oct 24, 2015, 08:32:23\n\n// Latest file can be found here: https://cdn.webrtc-experiment.com/getScreenId.js\n\n// Muaz Khan         - www.MuazKhan.com\n// MIT License       - www.WebRTC-Experiment.com/licence\n// Documentation     - https://github.com/muaz-khan/getScreenId.\n\n// ______________\n// getScreenId.js\n\n/*\ngetScreenId(function (error, sourceId, screen_constraints) {\n    // error    == null || 'permission-denied' || 'not-installed' || 'installed-disabled' || 'not-chrome'\n    // sourceId == null || 'string' || 'firefox'\n\n    if(sourceId == 'firefox') {\n        navigator.mozGetUserMedia(screen_constraints, onSuccess, onFailure);\n    }\n    else navigator.webkitGetUserMedia(screen_constraints, onSuccess, onFailure);\n});\n*/\n\n(function() {\n    window.getScreenId = function(callback) {\n        // for Firefox:\n        // sourceId == 'firefox'\n        // screen_constraints = {...}\n        if (!!navigator.mozGetUserMedia) {\n            callback(null, 'firefox', {\n                video: {\n                    mozMediaSource: 'window',\n                    mediaSource: 'window'\n                }\n            });\n            return;\n        }\n\n        postMessage();\n\n        window.addEventListener('message', onIFrameCallback);\n\n        function onIFrameCallback(event) {\n            if (!event.data) return;\n\n            if (event.data.chromeMediaSourceId) {\n                if (event.data.chromeMediaSourceId === 'PermissionDeniedError') {\n                    callback('permission-denied');\n                } else callback(null, event.data.chromeMediaSourceId, getScreenConstraints(null, event.data.chromeMediaSourceId));\n            }\n\n            if (event.data.chromeExtensionStatus) {\n                callback(event.data.chromeExtensionStatus, null, getScreenConstraints(event.data.chromeExtensionStatus));\n            }\n\n            // this event listener is no more needed\n            window.removeEventListener('message', onIFrameCallback);\n        }\n    };\n\n    function getScreenConstraints(error, sourceId) {\n        var screen_constraints = {\n            audio: false,\n            video: {\n                mandatory: {\n                    chromeMediaSource: error ? 'screen' : 'desktop',\n                    maxWidth: window.screen.width > 1920 ? window.screen.width : 1920,\n                    maxHeight: window.screen.height > 1080 ? window.screen.height : 1080\n                },\n                optional: []\n            }\n        };\n\n        if (sourceId) {\n            screen_constraints.video.mandatory.chromeMediaSourceId = sourceId;\n        }\n\n        return screen_constraints;\n    }\n\n    function postMessage() {\n        if (!iframe) {\n            loadIFrame(postMessage);\n            return;\n        }\n\n        if (!iframe.isLoaded) {\n            setTimeout(postMessage, 100);\n            return;\n        }\n\n        iframe.contentWindow.postMessage({\n            captureSourceId: true\n        }, '*');\n    }\n\n    function loadIFrame(loadCallback) {\n        if (iframe) {\n            loadCallback();\n            return;\n        }\n\n        iframe = document.createElement('iframe');\n        iframe.onload = function() {\n            iframe.isLoaded = true;\n\n            loadCallback();\n        };\n        iframe.src = 'https://www.webrtc-experiment.com/getSourceId/'; // https://wwww.yourdomain.com/getScreenId.html\n        iframe.style.display = 'none';\n        (document.body || document.documentElement).appendChild(iframe);\n    }\n\n    var iframe;\n\n    // this function is used in v3.0\n    window.getScreenConstraints = function(callback) {\n        loadIFrame(function() {\n            getScreenId(function(error, sourceId, screen_constraints) {\n                callback(error, screen_constraints.video);\n            });\n        });\n    };\n})();\n\n(function() {\n    if(document.domain.indexOf('webrtc-experiment.com') === -1) {\n        return;\n    }\n\n    window.getScreenId = function(callback) {\n        // for Firefox:\n        // sourceId == 'firefox'\n        // screen_constraints = {...}\n        if (!!navigator.mozGetUserMedia) {\n            callback(null, 'firefox', {\n                video: {\n                    mozMediaSource: 'window',\n                    mediaSource: 'window'\n                }\n            });\n            return;\n        }\n\n        postMessage();\n\n        window.addEventListener('message', onIFrameCallback);\n\n        function onIFrameCallback(event) {\n            if (!event.data) return;\n\n            if (event.data.chromeMediaSourceId) {\n                if (event.data.chromeMediaSourceId === 'PermissionDeniedError') {\n                    callback('permission-denied');\n                } else callback(null, event.data.chromeMediaSourceId, getScreenConstraints(null, event.data.chromeMediaSourceId));\n            }\n\n            if (event.data.chromeExtensionStatus) {\n                callback(event.data.chromeExtensionStatus, null, getScreenConstraints(event.data.chromeExtensionStatus));\n            }\n\n            // this event listener is no more needed\n            window.removeEventListener('message', onIFrameCallback);\n        }\n    };\n\n    function getScreenConstraints(error, sourceId) {\n        var screen_constraints = {\n            audio: false,\n            video: {\n                mandatory: {\n                    chromeMediaSource: error ? 'screen' : 'desktop',\n                    maxWidth: window.screen.width > 1920 ? window.screen.width : 1920,\n                    maxHeight: window.screen.height > 1080 ? window.screen.height : 1080\n                },\n                optional: []\n            }\n        };\n\n        if (sourceId) {\n            screen_constraints.video.mandatory.chromeMediaSourceId = sourceId;\n        }\n\n        return screen_constraints;\n    }\n\n    function postMessage() {\n        if (!iframe) {\n            loadIFrame(postMessage);\n            return;\n        }\n\n        if (!iframe.isLoaded) {\n            setTimeout(postMessage, 100);\n            return;\n        }\n\n        iframe.contentWindow.postMessage({\n            captureSourceId: true\n        }, '*');\n    }\n\n    function loadIFrame(loadCallback) {\n        if (iframe) {\n            loadCallback();\n            return;\n        }\n\n        iframe = document.createElement('iframe');\n        iframe.onload = function() {\n            iframe.isLoaded = true;\n\n            loadCallback();\n        };\n        iframe.src = 'https://www.webrtc-experiment.com/getSourceId/'; // https://wwww.yourdomain.com/getScreenId.html\n        iframe.style.display = 'none';\n        (document.body || document.documentElement).appendChild(iframe);\n    }\n\n    var iframe;\n\n    // this function is used in v3.0\n    window.getScreenConstraints = function(callback) {\n        loadIFrame(function() {\n            getScreenId(function(error, sourceId, screen_constraints) {\n                callback(error, screen_constraints.video);\n            });\n        });\n    };\n})();\n\n/*\n * JavaScript MD5 1.0.1\n * https://github.com/blueimp/JavaScript-MD5\n *\n * Copyright 2011, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * http://www.opensource.org/licenses/MIT\n *\n * Based on\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Digest Algorithm, as defined in RFC 1321.\n * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for more info.\n */\n!function(a){\"use strict\";function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c=\"\";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d=\"0123456789abcdef\",e=\"\";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}\"function\"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(this);\n/*\nThe MIT License (MIT)\n\nCopyright (c) 2014 Chris Wilson\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n/*\n\nUsage:\naudioNode = createAudioMeter(audioContext,clipLevel,averaging,clipLag);\n\naudioContext: the AudioContext you're using.\nclipLevel: the level (0 to 1) that you would consider \"clipping\".\n   Defaults to 0.98.\naveraging: how \"smoothed\" you would like the meter to be over time.\n   Should be between 0 and less than 1.  Defaults to 0.95.\nclipLag: how long you would like the \"clipping\" indicator to show\n   after clipping has occured, in milliseconds.  Defaults to 750ms.\n\nAccess the clipping through node.checkClipping(); use node.shutdown to get rid of it.\n*/\n\nfunction createAudioMeter(audioContext,clipLevel,averaging,clipLag) {\n\tvar processor = audioContext.createScriptProcessor(512);\n\tprocessor.onaudioprocess = volumeAudioProcess;\n\tprocessor.clipping = false;\n\tprocessor.lastClip = 0;\n\tprocessor.volume = 0;\n\tprocessor.clipLevel = clipLevel || 0.98;\n\tprocessor.averaging = averaging || 0.95;\n\tprocessor.clipLag = clipLag || 750;\n\n\t// this will have no effect, since we don't copy the input to the output,\n\t// but works around a current Chrome bug.\n\tprocessor.connect(audioContext.destination);\n\n\tprocessor.checkClipping =\n\t\tfunction(){\n\t\t\tif (!this.clipping)\n\t\t\t\treturn false;\n\t\t\tif ((this.lastClip + this.clipLag) < window.performance.now())\n\t\t\t\tthis.clipping = false;\n\t\t\treturn this.clipping;\n\t\t};\n\n\tprocessor.shutdown =\n\t\tfunction(){\n\t\t\tthis.disconnect();\n\t\t\tthis.onaudioprocess = null;\n\t\t};\n\n\treturn processor;\n}\n\nfunction volumeAudioProcess( event ) {\n\tvar buf = event.inputBuffer.getChannelData(0);\n    var bufLength = buf.length;\n\tvar sum = 0;\n    var x;\n\n\t// Do a root-mean-square on the samples: sum up the squares...\n    for (var i=0; i<bufLength; i++) {\n    \tx = buf[i];\n    \tif (Math.abs(x)>=this.clipLevel) {\n    \t\tthis.clipping = true;\n    \t\tthis.lastClip = window.performance.now();\n    \t}\n    \tsum += x * x;\n    }\n\n    // ... then take the square root of the sum.\n    var rms =  Math.sqrt(sum / bufLength);\n\n    // Now smooth this out with the averaging factor applied\n    // to the previous sample - take the max here because we\n    // want \"fast attack, slow release.\"\n    this.volume = Math.max(rms, this.volume*this.averaging);\n}\n\n(function() {\n  'use strict';\n\n  var vertoApp = angular.module('vertoApp', [\n    'timer',\n    'ngRoute',\n    'vertoControllers',\n    'vertoDirectives',\n    'vertoFilters',\n    'ngStorage',\n    'ngAnimate',\n    'ngSanitize',\n    'toastr',\n    'FBAngular',\n    'cgPrompt',\n    '720kb.tooltips',\n    'ui.gravatar',\n    'ui.bootstrap',\n    'directive.g+signin',\n    'pascalprecht.translate',\n    'angular-click-outside',\n  ]);\n\n  vertoApp.constant('configLanguages', {\n    'languages' : [\n         {id: 'en', name: 'English'},\n         {id: 'it', name: 'Italiano'},\n         {id: 'fr', name: 'Franais'},\n         {id: 'de', name: 'Deutsch'},\n         {id: 'pt', name: 'Portugus'},\n         {id: 'pl', name: 'Polski'},\n         {id: 'zh', name: ''},\n         {id: 'ru', name: 'P'},\n         {id: 'sv', name: 'Svenska'},\n         {id: 'da', name: 'Dansk'},\n         {id: 'es', name: 'Espaol'},\n         {id: 'id', name: 'Indonesia'}\n    ],\n\n    'dialects' : {\n        'en': 'en',\n        'en_GB': 'en',\n        'en_US': 'en',\n        'it': 'it',\n        'it_IT': 'it',\n        'fr': 'fr',\n        'fr_FR': 'fr',\n        'fr_CA': 'fr',\n        'pt': 'pt',\n        'pt_BR': 'pt',\n        'pt_PT': 'pt',\n        'de': 'de',\n        'de_DE': 'de',\n        'es': 'es',\n        'es_ES': 'es',\n        'pl': 'pl',\n        'pl_PL': 'pl',\n        'ru': 'ru',\n        'ru_RU': 'ru',\n        'sv': 'sv',\n        'sv_SV': 'sv',\n        'sv_FI': 'sv',\n        'da': 'da',\n        'da_DK': 'da',\n        'id': 'id',\n        'id_ID': 'id',\n        'zh': 'zh',\n        'zh_CN': 'zh',\n        'zh_TW': 'zh',\n        'zh_HK': 'zh'\n    }\n  });\n\n  vertoApp.config(['$routeProvider', 'gravatarServiceProvider', '$translateProvider', 'configLanguages',\n    function($routeProvider, gravatarServiceProvider, $translateProvider, configLanguages) {\n      $routeProvider.\n      when('/', {\n        title: 'Loading',\n        templateUrl: 'partials/splash_screen.html',\n        controller: 'SplashScreenController'\n      }).\n      when('/login', {\n        title: 'Login',\n        templateUrl: 'partials/login.html',\n        controller: 'LoginController'\n      }).\n      when('/dialpad', {\n        title: 'Dialpad',\n        templateUrl: 'partials/dialpad.html',\n        controller: 'DialPadController'\n      }).\n      when('/incall', {\n          title: 'In a Call',\n          templateUrl: 'partials/incall.html',\n          controller: 'InCallController'\n        }).\n      when('/loading', {\n        title: 'Loading Verto Communicator',\n        templateUrl: 'partials/loading.html',\n        controller: 'LoadingController'\n      }).\n      when('/preview', {\n        title: 'Preview Video',\n        templateUrl: 'partials/preview.html',\n        controller: 'PreviewController'\n      }).\n      when('/browser-upgrade', {\n        title: '',\n        templateUrl: 'partials/browser_upgrade.html',\n        controller: 'BrowserUpgradeController'\n      }).\n      otherwise({\n        redirectTo: '/'\n      });\n\n      gravatarServiceProvider.defaults = {\n        default: 'mm'  // Mystery man as default for missing avatars\n      };\n\n      var reg_langs = [];\n      angular.forEach(configLanguages.languages, function(value, key) {\n        reg_langs.push(value.id);\n      });\n\n      $translateProvider\n      .useStaticFilesLoader({\n        prefix: 'locales/locale-',\n        suffix: '.json'\n      })\n      .registerAvailableLanguageKeys(reg_langs, configLanguages.dialects)\n      .preferredLanguage('en')\n      .determinePreferredLanguage()\n      .fallbackLanguage('en')\n      .useSanitizeValueStrategy(null);\n    }\n  ]);\n\n  vertoApp.run(['$rootScope', '$location', 'toastr', 'prompt', 'verto',\n    function($rootScope, $location, toastr, prompt, verto) {\n\n      $rootScope.$on( \"$routeChangeStart\", function(event, next, current) {\n        if (!verto.data.connected) {\n          if ( next.templateUrl === \"partials/login.html\") {\n            // pass\n          } else {\n            $location.path(\"/\");\n          }\n        }\n      });\n\n      $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {\n        $rootScope.title = current.$$route.title;\n      });\n\n      $rootScope.safeProtocol = false;\n\n      if (window.location.protocol == 'https:') {\n        $rootScope.safeProtocol = true;\n      }\n\n\n      $rootScope.promptInput = function(title, message, label, callback) {\n        var ret = prompt({\n          title: title,\n          message: message,\n          input: true,\n          label: label\n        }).then(function(ret) {\n          if (angular.isFunction(callback)) {\n            callback(ret);\n          }\n        }, function() {\n\n        });\n\n      };\n\n    }\n  ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  var vertoControllers = angular.module('vertoControllers', [\n    'ui.bootstrap',\n    'vertoService',\n    'storageService',\n    'ui.gravatar'\n  ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n  .module('vertoControllers')\n  .controller('SplashScreenController', ['$scope', '$rootScope', '$location', '$timeout', 'storage', 'splashscreen', 'prompt', 'verto',\n    function($scope, $rootScope, $location, $timeout, storage, splashscreen, prompt, verto) {\n      console.debug('Executing SplashScreenController.');\n\n      $scope.progress_percentage = splashscreen.progress_percentage;\n      $scope.message = '';\n      $scope.interrupt_next = false;\n      $scope.errors = [];\n\n      var redirectTo = function(link, activity) {\n        if(activity) {\n          if(activity == 'browser-upgrade') {\n            link = activity;\n          }\n        }\n\n        $location.path(link);\n      }\n\n      var checkProgressState = function(current_progress, status, promise, activity, soft, interrupt, message) {\n        $scope.progress_percentage = splashscreen.calculate(current_progress);\n        $scope.message = message;\n\n        if(interrupt && status == 'error') {\n          $scope.errors.push(message);\n          if(!soft) {\n            redirectTo('', activity);\n            return;\n          } else {\n            message = message + '. Continue?';\n          };\n\n          if(!confirm(message)) {\n            $scope.interrupt_next = true;\n          };\n        };\n\n        if($scope.interrupt_next) {\n          return;\n        };\n\n        $scope.message = splashscreen.getProgressMessage(current_progress+1);\n\n        return true;\n      };\n\n      $rootScope.$on('progress.next', function(ev, current_progress, status, promise, activity, soft, interrupt, message) {\n        $timeout(function() {\n          if(promise) {\n            promise.then(function(response) {\n              message = response['message'];\n              status = response['status'];\n              if(checkProgressState(current_progress, status, promise, activity, soft, interrupt, message)) {\n                splashscreen.next();\n              };\n            });\n\n            return;\n          }\n\n          if(!checkProgressState(current_progress, status, promise, activity, soft, interrupt, message)) {\n            return;\n          }\n\n          splashscreen.next();\n        }, 400);\n      });\n\n      $rootScope.$on('progress.complete', function(ev, current_progress) {\n        $scope.message = 'Complete';\n        if(verto.data.connected) {\n          if (0 && storage.data.preview) {\n            $location.path('/preview');\n          }\n          else {\n            $location.path('/dialpad');\n          }\n        } else {\n          redirectTo('/login');\n          $location.path('/login');\n        }\n      });\n\n      splashscreen.next();\n\n    }]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('BrowserUpgradeController', ['$scope', '$http',\n      '$location', 'verto', 'storage', 'Fullscreen',\n      function($scope, $http, $location, verto, storage, Fullscreen) {\n        console.debug('Executing BrowserUpgradeController.');\n\n      }\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n  .module('vertoControllers')\n  .controller('ChatController', ['$scope', '$rootScope', '$http',\n    '$location', '$anchorScroll', '$timeout', 'verto', 'prompt', '$translate',\n    function($scope, $rootScope, $http, $location, $anchorScroll, $timeout,\n      verto, prompt, $translate) {\n      console.debug('Executing ChatController.');\n\n      function scrollToChatBottom() {\n        // Going to the bottom of chat messages.\n        var obj = document.querySelector('.chat-messages');\n        obj.scrollTop = obj.scrollHeight;\n        //var chat_messages_top = jQuery('.chat-messages').scrollTop();\n        //var marker_position = jQuery('#chat-message-bottom').position().top;\n        //jQuery('.chat-messages').scrollTop(chat_messages_top + marker_position);\n      }\n\n      var CLEAN_MESSAGE = '';\n\n      function clearConferenceChat() {\n        $scope.members = [];\n        $scope.messages = [];\n        $scope.message = CLEAN_MESSAGE;\n      }\n      clearConferenceChat();\n\n      $scope.$watch('activePane', function() {\n        if ($scope.activePane == 'chat') {\n          $rootScope.chat_counter = 0;\n        }\n        $rootScope.activePane = $scope.activePane;\n      });\n\n      $rootScope.$on('chat.newMessage', function(event, data) {\n        data.created_at = new Date();\n        console.log('chat.newMessage', data);\n        $scope.$apply(function() {\n          $scope.messages.push(data);\n          if (data.from != verto.data.name &&\n              (!$scope.chatStatus && $scope.activePane != 'chat')) {\n            ++$rootScope.chat_counter;\n          }\n          $timeout(function() {\n            scrollToChatBottom();\n          }, 300);\n        });\n      });\n\n      $rootScope.$on('call.conference', function(event, data) {\n        $timeout(function() {\n          $scope.conf = verto.data.conf.params.laData;\n        });\n      });\n\n      $rootScope.$on('changedVideoLayout', function(event, layout) {\n        $scope.resIDs = getResByLayout(layout);\n\n        // remove resIDs param to clear every members resID.\n        // passing $scope.resIDs results in preserving resIDs compatible\n        // with the current layout\n        clearMembersResID($scope.resIDs);\n      });\n\n      $rootScope.$on('conference.canvasInfo', function(event, data) {\n        $scope.currentLayout = data[0].layoutName;\n        $scope.resIDs = getResByLayout($scope.currentLayout);\n      });\n\n      function getResByLayout(layout) {\n        var layoutsData = verto.data.confLayoutsData;\n        for (var i = 0; i < layoutsData.length; i++) {\n          if (layoutsData[i].name === layout) {\n            return layoutsData[i].resIDS;\n          }\n        }\n      }\n\n      // @preserve - a array of values to be preserved\n      function clearMembersResID(preserve) {\n        $scope.members.forEach(function(member) {\n          var resID = member.status.video.reservationID;\n          console.debug(\"resID to clear: \" + resID);\n          if (resID && preserve && preserve.indexOf(resID) !== -1) return;\n          if (resID){\n            console.debug(\"clearing resid [\" + resID + \"] from [\" + member.id + \"]\");\n            $scope.confResID(member.id, resID);\n          }\n        });\n      };\n\n      function findMemberByUUID(uuid) {\n        var found = false;\n        for (var idx in $scope.members) {\n          var member = $scope.members[idx];\n          if (member.uuid == uuid) {\n            found = true;\n            break;\n          }\n        }\n        if (found) {\n          return idx;\n        } else {\n          return -1;\n        }\n      }\n\n      function translateMember(member) {\n        return {\n          'uuid': member[0],\n          'id': member[1][0],\n          'number': member[1][1],\n          'name': member[1][2],\n          'codec': member[1][3],\n          'status': JSON.parse(member[1][4]),\n          'email': member[1][5].email\n        };\n      }\n\n      function addMember(member) {\n        $scope.members.push(translateMember(member));\n      }\n\n      $rootScope.$on('hangupCall', function() {\n        $scope.openId = null;\n      });\n\n      $rootScope.$on('members.boot', function(event, members) {\n        $scope.$apply(function() {\n          clearConferenceChat();\n          for (var idx in members) {\n            var member = members[idx];\n            addMember(member);\n          }\n        })\n      });\n\n      $rootScope.$on('members.add', function(event, member) {\n        $scope.$apply(function() {\n          addMember(member);\n        });\n      });\n\n      $rootScope.$on('members.del', function(event, uuid) {\n        if ($rootScope.watcher && $rootScope.master === uuid) {\n          verto.hangup();\n          window.close();\n        }\n\n        $scope.$apply(function() {\n          var memberIdx = findMemberByUUID(uuid);\n          if (memberIdx != -1) {\n            // Removing the member.\n            $scope.members.splice(memberIdx, 1);\n          }\n        });\n      });\n\n      $rootScope.$on('members.update', function(event, member) {\n        member = translateMember(member);\n        var memberIdx = findMemberByUUID(member.uuid);\n        if (memberIdx < 0) {\n          console.log('Didn\\'t find the member uuid ' + member.uuid);\n        } else {\n          $scope.$apply(function() {\n            // console.log('Updating', memberIdx, ' <', $scope.members[memberIdx],\n              // '> with <', member, '>');\n            // Checking if it's me\n            if (parseInt(member.id) == parseInt(verto.data.conferenceMemberID)) {\n              verto.data.mutedMic = member.status.audio.muted;\n              verto.data.mutedVideo = member.status.video.muted;\n\t\t\t  verto.data.call.setMute(member.status.audio.muted ? \"off\" : \"on\");\n\t\t\t  verto.data.call.setVideoMute(member.status.video.muted ? \"off\" : \"on\");\n            }\n            angular.extend($scope.members[memberIdx], member);\n          });\n        }\n      });\n\n      $rootScope.$on('members.clear', function(event) {\n        $scope.$applyAsync(function() {\n          clearConferenceChat();\n          $scope.closeChat();\n        });\n      });\n\n      /**\n       * Public methods.\n       */\n\n      $scope.toggleModMenu = function(index) {\n        if (verto.data.confRole != 'moderator') return;\n        $scope.openId = $scope.openId == index ? null : index;\n      };\n\n      $scope.send = function(event) {\n        // Only conferencing chat is supported for now\n        // but still calling method with the conference prefix\n        // so we know that explicitly.\n        if (event && event.type == 'keydown') {\n          event.preventDefault();\n        }\n        verto.sendConferenceChat($scope.message);\n        $scope.message = CLEAN_MESSAGE;\n      };\n\n      // Participants moderation.\n      $scope.confKick = function(memberID) {\n        console.log('$scope.confKick');\n        verto.data.conf.kick(memberID);\n      };\n\n      $scope.confMuteMic = function(memberID) {\n        if(verto.data.confRole == 'moderator') {\n          console.log('$scope.confMuteMic');\n          verto.data.conf.muteMic(memberID);\n        }\n      };\n\n      $scope.confMuteVideo = function(memberID) {\n        if(verto.data.confRole == 'moderator') {\n          console.log('$scope.confMuteVideo');\n          verto.data.conf.muteVideo(memberID);\n        }\n      };\n\n      $scope.confPresenter = function(memberID) {\n        console.log('$scope.confPresenter');\n        verto.data.conf.presenter(memberID);\n      };\n\n      $scope.confResID = function(memberID, resID) {\n        console.log('Set', memberID, 'to', resID);\n        verto.setResevartionId(memberID, resID);\n      };\n\n      $scope.confVideoFloor = function(memberID) {\n        console.log('$scope.confVideoFloor');\n        verto.data.conf.videoFloor(memberID);\n      };\n\n      $scope.confBanner = function(memberID) {\n        console.log('$scope.confBanner');\n\n        prompt({\n          title: $translate.instant('TITLE_INSERT_BANNER'),\n          input: true,\n          label: '',\n          value: '',\n        }).then(function(text) {\n          if (text) {\n            verto.data.conf.banner(memberID, text);\n          }\n        });\n      };\n\n      $scope.confCanvasIn = function(memberID, canvasID) {\n        if (canvasID) {\n          verto.setCanvasIn(memberID, canvasID);\n          return;\n        }\n\n        shortPrompt($translate.instant('TITLE_INSERT_CANVAS_ID'), function(canvasID) {\n          console.log(memberID, canvasID);\n          verto.setCanvasIn(memberID, canvasID);\n        });\n\n      };\n\n      $scope.confCanvasOut = function(memberID, canvasID) {\n        if (canvasID) {\n          verto.setCanvasOut(memberID, canvasID);\n          return;\n        }\n\n        shortPrompt($translate.instant('TITLE_INSERT_CANVAS_ID'), function(canvasID) {\n          verto.setCanvasOut(memberID, canvasID);\n        });\n      };\n\n      $scope.confLayer = function(memberID, canvasID) {\n        if (canvasID) {\n          verto.setLayer(memberID, canvasID);\n          return;\n        }\n\n        shortPrompt($translate.instant('TITLE_INSERT_LAYER'), function(canvasID) {\n          verto.setLayer(memberID, canvasID);\n        });\n      };\n\n      $scope.confResetBanner = function(memberID) {\n        console.log('$scope.confResetBanner');\n        var text = 'reset';\n        verto.data.conf.banner(memberID, text);\n      };\n\n      $scope.confVolumeDown = function(memberID) {\n        console.log('$scope.confVolumeDown');\n        verto.data.conf.volumeDown(memberID);\n      };\n\n      $scope.confVolumeUp = function(memberID) {\n        console.log('$scope.confVolumeUp');\n        verto.data.conf.volumeUp(memberID);\n      };\n\n      $scope.confGainDown = function(memberID) {\n        console.log('$scope.confGainDown');\n        verto.data.conf.gainDown(memberID);\n      };\n\n      $scope.confGainUp = function(memberID) {\n        console.log('$scope.confGainUp');\n        verto.data.conf.gainUp(memberID);\n      };\n\n      $scope.confTransfer = function(memberID) {\n        console.log('$scope.confTransfer');\n        $rootScope.disableOnKeydownDtmf();\n        prompt({\n          title: $translate.instant('TITLE_TRANSFER'),\n          message: $translate.instant('MESSAGE_TRANSFER'),\n          input: true,\n          label: $translate.instant('LABEL_TRANSFER'),\n          value: '',\n        }).then(function(exten) {\n          $rootScope.enableOnKeydownDtmf();\n          if (exten) {\n            verto.data.conf.transfer(memberID, exten);\n          }\n        }).catch(function(){\n          $rootScope.enableOnKeydownDtmf();\n        });\n\n      };\n\n      $scope.confToggleDeaf = function(member) {\n        if(verto.data.confRole == 'moderator') {\n          console.log('$scope.confToggleDeaf');\n\n          if (member.status.audio.deaf) {\n            verto.data.conf.undeaf(member.id);\n          } else {\n            verto.data.conf.deaf(member.id);\n          }\n        }\n      };\n\n      function shortPrompt(text, cb) {\n        prompt({\n          title: text,\n          input: true,\n          label: '',\n          value: '',\n        }).then(function(val) {\n          if (val && cb) {\n            cb(val);\n          }\n        });\n      }\n    }\n  ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('ContributorsController', ['$scope', '$http',\n      'toastr',\n      function($scope, $http, toastr) {\n        var url = window.location.origin + window.location.pathname;\n        $http.get(url + 'contributors.txt')\n          .success(function(data) {\n\n            var contributors = [];\n\n            angular.forEach(data, function(value, key) {\n              var re = /(.*) <(.*)>/;\n              var name = value.replace(re, \"$1\");\n              var email = value.replace(re, \"$2\");\n\n              this.push({\n                'name': name,\n                'email': email\n              });\n            }, contributors);\n\n            $scope.contributors = contributors;\n          })\n          .error(function() {\n            toastr.error('contributors not found.');\n          });\n      }\n    ]);\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('AboutController', ['$scope', '$http',\n      'toastr',\n      function($scope, $http, toastr) {\n\t    var githash = '25569c1631' || 'something is not right';\n            $scope.githash = githash;\n\n\t/* leave this here for later, but its not needed right now\n        $http.get(window.location.pathname + '/contributors.txt')\n          .success(function(data) {\n\n          })\n          .error(function() {\n            toastr.error('contributors not found.');\n          });\n\t */\n      }\n    ]);\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('DialPadController', ['$rootScope', '$scope',\n      '$http', '$location', 'toastr', 'verto', 'storage', 'CallHistory', 'eventQueue', '$timeout',\n      function($rootScope, $scope, $http, $location, toastr, verto, storage, CallHistory, eventQueue, $timeout) {\n        console.debug('Executing DialPadController.');\n\n        eventQueue.process();\n\n        if ($location.search().autocall) {\n            $rootScope.dialpadNumber = $location.search().autocall;\n            delete $location.search().autocall;\n            call($rootScope.dialpadNumber);\n            if($rootScope.watcher) {\n              return;\n            }\n        }\n\n        $scope.call_history = CallHistory.all();\n        $scope.history_control = CallHistory.all_control();\n        $scope.has_history = Object.keys($scope.call_history).length;\n        storage.data.videoCall = false;\n        storage.data.userStatus = 'connecting';\n        storage.data.calling = false;\n\n        $scope.clearCallHistory = function() {\n          CallHistory.clear();\n          $scope.call_history = CallHistory.all();\n          $scope.history_control = CallHistory.all_control();\n          $scope.has_history = Object.keys($scope.call_history).length;\n          return $scope.history_control;\n        };\n\n        $scope.viewCallsList = function(calls) {\n          return $scope.call_list = calls;\n        };\n\n        /**\n         * fill dialpad via querystring [?autocall=\\d+]\n         */\n\n\t/**\n\t * fill in dialpad via config.json\n\t */\n        if ('autocall' in verto.data) {\n          $rootScope.dialpadNumber = verto.data.autocall;\n\t  delete verto.data.autocall;\n          call($rootScope.dialpadNumber);\n        }\n\n        /**\n         * used to bind click on number in call history to fill dialpad\n         * 'cause inside a ng-repeat the angular isnt in ctrl scope\n         */\n        $scope.fillDialpadNumber = function(number) {\n          $rootScope.dialpadNumber = number;\n        };\n\n        $scope.preview = function() {\n          $location.path('/preview');\n        };\n\n        $rootScope.transfer = function() {\n          if (!$rootScope.dialpadNumber) {\n            return false;\n          }\n          verto.data.call.transfer($rootScope.dialpadNumber);\n        };\n\n        function call(extension) {\n          storage.data.onHold = false;\n          storage.data.cur_call = 0;\n          $rootScope.dialpadNumber = extension;\n          if (!$rootScope.dialpadNumber && storage.data.called_number) {\n            $rootScope.dialpadNumber = storage.data.called_number;\n            return false;\n          } else if (!$rootScope.dialpadNumber && !storage.data.called_number) {\n            toastr.warning('Enter an extension, please.');\n            return false;\n          }\n\n          if (verto.data.call) {\n            console.debug('A call is already in progress.');\n            return false;\n          }\n\n          if (extension.indexOf('-canvas-') != -1) {\n            $rootScope.watcher = true;\n            verto.call($rootScope.dialpadNumber, null,\n              {\n                useCamera: \"none\",\n                useMic: \"none\",\n                useSpeak: \"none\",\n                caller_id_name: null,\n                userVariables: {},\n                caller_id_number: null,\n                mirrorInput: false\n              }\n            );\n            $location.path('/incall');\n            return;\n          }\n\n          storage.data.mutedVideo = false;\n          storage.data.mutedMic = false;\n\n          storage.data.videoCall = false;\n          verto.call($rootScope.dialpadNumber);\n\n          storage.data.called_number = $rootScope.dialpadNumber;\n          CallHistory.add($rootScope.dialpadNumber, 'outbound');\n          $location.path('/incall');\n        }\n\n        /**\n         * Call to the number in the $rootScope.dialpadNumber.\n         */\n        $scope.loading = false;\n        $scope.cancelled = false;\n        $rootScope.call = function(extension) {\n          if (!storage.data.testSpeedJoin || !$rootScope.dialpadNumber) {\n            return call(extension);\n          }\n          $scope.loading = true;\n\n          verto.testSpeed(function() {\n            if ($scope.cancelled) {\n              $scope.cancelled = false;\n              $scope.loading = false;\n              return;\n            } else {\n              call(extension);\n            }\n          });\n        }\n\n        $rootScope.cancel = function() {\n          $scope.cancelled = true;\n        }\n      }\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('InCallController', ['$rootScope', '$scope',\n      '$http', '$location', '$modal', '$timeout', 'toastr', 'verto', 'storage', 'prompt', 'Fullscreen', '$translate',\n      function($rootScope, $scope, $http, $location, $modal, $timeout, toastr,\n        verto, storage, prompt, Fullscreen, $translate) {\n\n        console.debug('Executing InCallController.');\n        $scope.layout = null;\n        $rootScope.dialpadNumber = '';\n        $scope.callTemplate = 'partials/phone_call.html';\n        $scope.dialpadTemplate = '';\n        $scope.incall = true;\n\n        if (storage.data.videoCall) {\n          $scope.callTemplate = 'partials/video_call.html';\n        }\n\n        $rootScope.$on('call.conference', function(event, data) {\n          $timeout(function() {\n            if($scope.chatStatus) {\n              $scope.openChat();\n            }\n            buildCanvasesData();\n          });\n        });\n\n        $rootScope.$on('call.video', function(event, data) {\n          $timeout(function() {\n            $scope.callTemplate = 'partials/video_call.html';\n          });\n        });\n\n        /**\n         * toggle dialpad in incall page\n         */\n        $scope.toggleDialpad = function() {\n          $scope.openModal('partials/dialpad_widget.html',\n            'ModalDialpadController');\n\n          /*\n          if(!$scope.dialpadTemplate) {\n            $scope.dialpadTemplate = 'partials/dialpad_widget.html';\n          } else {\n            $scope.dialpadTemplate = '';\n          }\n          */\n        }\n\n        /**\n         * TODO: useless?\n         */\n        $scope.videoCall = function() {\n          prompt({\n            title: $translate.instant('TITLE_ENABLE_VIDEO'),\n            message: $translate.instant('MESSAGE_ENABLE_VIDEO')\n          }).then(function() {\n            storage.data.videoCall = true;\n            $scope.callTemplate = 'partials/video_call.html';\n          });\n        };\n\n        $scope.cbMuteVideo = function(event, data) {\n          storage.data.mutedVideo = !storage.data.mutedVideo;\n        }\n\n        $scope.cbMuteMic = function(event, data) {\n          storage.data.mutedMic = !storage.data.mutedMic;\n        }\n\n        $scope.confChangeVideoLayout = function(layout, canvasID) {\n          verto.data.conf.setVideoLayout(layout, canvasID);\n          $scope.videoLayout = layout;\n          $rootScope.$emit('changedVideoLayout', layout);\n        };\n\n        $scope.confChangeSpeaker = function(speakerId) {\n          storage.data.selectedSpeaker = speakerId;\n          $rootScope.$emit('changedSpeaker', speakerId);\n        };\n\n        $scope.confPopup = function(canvas_id) {\n          var video = document.getElementById('webcam');\n          var s = window.location.href;\n          var curCall = verto.data.call.callID;\n          var extension = verto.data.call.params.remote_caller_id_number;\n          var width = webcam.offsetWidth;\n          var height = webcam.offsetHeight + 100;\n          var x = (screen.width - width)/2\n          var y = (screen.height - height)/2\n\n          s = s.replace(/\\#.*/, '');\n          s += \"#/?sessid=random&master=\" + curCall + \"&watcher=true&extension=\" + extension+ \"&canvas_id=\" + canvas_id;\n\n          console.log(\"opening new window to \" + s);\n          var popup = window.open(s, \"canvas_window_\" + canvas_id, \"toolbar=0,location=0,menubar=0,directories=0,width=\" + width + \",height=\" + height, + ',left=' + x + ',top=' + y);\n          popup.moveTo(x, y);\n        };\n\n        $scope.screenshare = function() {\n          if(verto.data.shareCall) {\n            verto.screenshareHangup();\n            return false;\n          }\n          if (verto.data.conf) {\n            console.log('Screenshare inside conferece: ', verto.data.conf);\n            // Setting the destination of the screenshare call as the conference\n            // number we last joined\n            verto.screenshare(verto.data.conf.params.laData.laName);\n          }\n          else {\n            verto.screenshare(storage.data.called_number);\n          }\n        };\n\n        function buildCanvasesData() {\n          $scope.conf = verto.data.conf.params.laData;\n          $scope.canvases = [{ id: 1, name: 'Super Canvas' }];\n          for (var i = 1; i < $scope.conf.canvasCount; i++) {\n            $scope.canvases.push({ id: i+1, name: 'Canvas ' + (i+1) });\n          }\n        }\n\n        $scope.muteMic = verto.muteMic;\n        $scope.muteVideo = verto.muteVideo;\n\n        $rootScope.$on('ScreenShareExtensionStatus', function(event, error) {\n          var pluginUrl = 'https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk';\n          switch(error) {\n            case 'permission-denied':\n              toastr.info('Please allow the plugin in order to use Screen Share', 'Error'); break;\n            case 'not-installed':\n              toastr.warning('Please <a target=\"_blank\" class=\"install\" href=\"'+ pluginUrl +'\">install</a> the plugin in order to use Screen Share', 'Warning', { allowHtml: true }); break;\n            case 'installed-disabled':\n              toastr.info('Please enable the plugin in order to use Screen Share', 'Error'); break;\n            // case 'not-chrome'\n            //   toastr.info('Chrome', 'Error');\n          }\n        });\n\n        $timeout(function() {\n          console.log('broadcast time-start incall');\n          $scope.$broadcast('timer-start');\n        }, 1000);\n\n      }\n    ]);\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('LoginController', ['$scope', '$http', '$location', 'verto', \n      function($scope, $http, $location, verto) {\n        var preRoute = function() {\n          if(verto.data.connected) {\n            $location.path('/dialpad');\n          }\n        }\n        preRoute();\n\n        var name = $location.search().name;\n        var email = $location.search().email;\n        var skipPreview = $location.search().skipPreview;\n\n        if (name && email) {\n          verto.data.name = name;\n          verto.data.email = email;\n          $scope.login(true, skipPreview);\n          return;\n        }\n\n        verto.data.name = $scope.storage.data.name;\n        verto.data.email = $scope.storage.data.email;\n\n        console.debug('Executing LoginController.');\n      }\n    ]);\n\n})();\n\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('MainController',\n      [\"$scope\", \"$rootScope\", \"$location\", \"$modal\", \"$timeout\", \"$q\", \"verto\", \"storage\", \"CallHistory\", \"toastr\", \"Fullscreen\", \"prompt\", \"eventQueue\", \"$translate\", \"$window\", function($scope, $rootScope, $location, $modal, $timeout, $q, verto, storage, CallHistory, toastr, Fullscreen, prompt, eventQueue, $translate, $window) {\n\n      console.debug('Executing MainController.');\n      $rootScope.dtmfHistory = { value: '' };\n      $rootScope.onKeydownDtmfEnabled = true;\n\n      $.verto.haltClosure = function() {\n        if (verto.data.callState == 'active') {\n          return true;\n        }\n      };\n\n      if (storage.data.language && storage.data.language !== 'browser') {\n        $translate.use(storage.data.language);\n      } else {\n        storage.data.language = 'browser';\n      }\n\n      $rootScope.master = $location.search().master;\n      if ($location.search().watcher === 'true') {\n        $rootScope.watcher = true;\n        angular.element(document.body).addClass('watcher');\n        var dialpad;\n        var extension = dialpad = $location.search().extension;\n        var canvasID = $location.search().canvas_id;\n\n        if (dialpad) {\n          if (canvasID) {\n            dialpad += '-canvas-' + canvasID;\n          }\n          $rootScope.extension = extension;\n          $rootScope.canvasID = canvasID;\n          $location.search().autocall = dialpad;\n        }\n      }\n\n      var myVideo = document.getElementById(\"webcam\");\n      $scope.verto = verto;\n      $scope.storage = storage;\n      $scope.call_history = angular.element(\"#call_history\").hasClass('active');\n      $rootScope.chatStatus = angular.element('#wrapper').hasClass('toggled');\n      $scope.showReconnectModal = true;\n      /**\n       * (explanation) scope in another controller extends rootScope (singleton)\n       */\n      $rootScope.chat_counter = 0;\n      $rootScope.activePane = 'members';\n      /**\n       * The number that will be called.\n       * @type {string}\n       */\n      $rootScope.dialpadNumber = '';\n\n      // If verto is not connected, redirects to login page.\n      if (!verto.data.connected) {\n        console.debug('MainController: WebSocket not connected. Redirecting to login.');\n        $location.path('/');\n      }\n\n      $rootScope.$on('config.http.success', function(ev) {\n        $scope.login(false);\n      });\n\n      $rootScope.$on('changedSpeaker', function(event, speakerId) {\n        if (verto.data.call) {\n          verto.data.call.setAudioPlaybackDevice(speakerId, sinkIdCallback);\n        }\n      });\n\n      /**\n       * Login the user to verto server and\n       * redirects him to dialpad page.\n       */\n      $rootScope.login = function(redirect, skipPreview) {\n        if(redirect == undefined) {\n          redirect = true;\n        }\n\n        if(skipPreview == undefined) {\n          skipPreview = false;\n        }\n\n        var connectCallback = function(v, connected) {\n          $scope.$apply(function() {\n          verto.data.connecting = false;\n          if (connected) {\n            storage.data.hostname = verto.data.hostname;\n            storage.data.wsURL = verto.data.wsURL;\n            storage.data.ui_connected = verto.data.connected;\n            storage.data.ws_connected = verto.data.connected;\n            storage.data.name = verto.data.name;\n            storage.data.email = verto.data.email;\n            storage.data.login = verto.data.login;\n            storage.data.password = verto.data.password;\n            if (storage.data.autoBand) {\n              verto.testSpeed();\n            }\n\n            if (redirect && storage.data.preview && !skipPreview) {\n              $location.path('/loading');\n            } else if (redirect) {\n              $location.path('/dialpad');\n            }\n          }\n          });\n        };\n\n        verto.data.connecting = true;\n        verto.connect(connectCallback);\n      };\n\n      /**\n       * Logout the user from verto server and\n       * redirects him to login page.\n       */\n      $rootScope.logout = function() {\n        var disconnect = function() {\n          var disconnectCallback = function(v, connected) {\n            console.debug('Redirecting to login page.');\n            storage.reset();\n\t\t\tif (typeof gapi !== 'undefined'){\n\t\t\t\tconsole.debug(gapi);\n\t\t\t\tgapi.auth.signOut();\n\t\t\t}\n            $location.path('/login');\n          };\n\n          if (verto.data.call) {\n            verto.hangup();\n          }\n\n          $scope.closeChat();\n          $scope.showReconnectModal = false;\n          verto.disconnect(disconnectCallback);\n\n          verto.hangup();\n        };\n\n        if (verto.data.call) {\n          prompt({\n            title: $translate.instant('TITLE_ACTIVE_CALL'),\n            message: $translate.instant('MESSAGE_ACTIVE_CALL_HANGUP')\n          }).then(function() {\n            disconnect();\n          });\n        } else {\n          disconnect();\n        }\n\n      };\n\n      /**\n       * Shows a modal with the settings.\n       */\n      $scope.openModalSettings = function() {\n        var modalInstance = $modal.open({\n          animation: $scope.animationsEnabled,\n          templateUrl: 'partials/modal_settings.html',\n          controller: 'ModalSettingsController',\n        });\n\n        modalInstance.result.then(\n          function(result) {\n            console.log(result);\n          },\n          function() {\n            console.info('Modal dismissed at: ' + new Date());\n          }\n        );\n\n        modalInstance.rendered.then(\n          function() {\n            jQuery.material.init();\n          }\n        );\n      };\n\n      $rootScope.openModal = function(templateUrl, controller, _options) {\n        var options = {\n          animation: $scope.animationsEnabled,\n          templateUrl: templateUrl,\n          controller: controller,\n        };\n\n        angular.extend(options, _options);\n\n        var modalInstance = $modal.open(options);\n\n        modalInstance.result.then(\n          function(result) {\n            console.log(result);\n          },\n          function() {\n            console.info('Modal dismissed at: ' + new Date());\n          }\n        );\n\n        modalInstance.rendered.then(\n          function() {\n            jQuery.material.init();\n          }\n        );\n\n        return modalInstance;\n      };\n\n      $rootScope.$on('ws.close', onWSClose);\n      $rootScope.$on('ws.login', onWSLogin);\n\n      $rootScope.ws_modalInstance;\n\n      function onWSClose(ev, data) {\n        if($rootScope.ws_modalInstance) {\n          return;\n        };\n        var options = {\n          backdrop: 'static',\n          keyboard: false\n        };\n          if ($scope.showReconnectModal) {\n            $rootScope.ws_modalInstance = $scope.openModal('partials/ws_reconnect.html', 'ModalWsReconnectController', options);\n          };\n      };\n\n      function onWSLogin(ev, data) {\n        if(storage.data.autoBand) {\n          verto.testSpeed();\n        }\n        if(!$rootScope.ws_modalInstance) {\n          return;\n        };\n\n        $rootScope.ws_modalInstance.close();\n        $rootScope.ws_modalInstance = null;\n      };\n\n      $scope.showAbout = function() {\n        $scope.openModal('partials/about.html', 'AboutController');\n      };\n\n      $scope.showContributors = function() {\n        $scope.openModal('partials/contributors.html', 'ContributorsController');\n      };\n\n      /**\n       * Updates the display adding the new number touched.\n       *\n       * @param {String} number - New touched number.\n       */\n      $rootScope.dtmf = function(number) {\n        console.log('dtmf', number);\n        $rootScope.dialpadNumber = $rootScope.dialpadNumber + number;\n        if (verto.data.call) {\n          verto.dtmf(number);\n        }\n      };\n\n      /**\n       * Removes the last character from the number.\n       */\n      $rootScope.backspace = function() {\n        var number = $rootScope.dialpadNumber;\n        var len = number.length;\n        $rootScope.dialpadNumber = number.substring(0, len - 1);\n      };\n\n\n      $scope.toggleCallHistory = function() {\n        if (!$scope.call_history) {\n          angular.element(\"#call_history\").addClass('active');\n          angular.element(\"#call-history-wrapper\").addClass('active');\n        } else {\n          angular.element(\"#call_history\").removeClass('active');\n          angular.element(\"#call-history-wrapper\").removeClass('active');\n        }\n        $scope.call_history = angular.element(\"#call_history\").hasClass('active');\n      };\n\n      $scope.toggleChat = function() {\n        if ($rootScope.chatStatus && $rootScope.activePane === 'chat') {\n          $rootScope.chat_counter = 0;\n        }\n        angular.element('#wrapper').toggleClass('toggled');\n        $rootScope.chatStatus = angular.element('#wrapper').hasClass('toggled');\n        updateVideoSize();\n      };\n\n      $rootScope.openChat = function() {\n        $rootScope.chatStatus = false;\n        angular.element('#wrapper').removeClass('toggled');\n      };\n\n      $scope.closeChat = function() {\n        $rootScope.chatStatus = true;\n        angular.element('#wrapper').addClass('toggled');\n      };\n\n      $scope.toggleSettings = function() {\n        var settingsEl = angular.element(document.querySelector('#settings'));\n        settingsEl.toggleClass('toggled');\n        $rootScope.$emit('toggledSettings', settingsEl.hasClass('toggled'));\n      };\n\n      $scope.closeSettings = function() {\n        var settingsEl = angular.element(document.querySelector('#settings'));\n        if (settingsEl.hasClass('toggled')) {\n          settingsEl.removeClass('toggled');\n          $rootScope.$emit('toggledSettings', settingsEl.hasClass('toggled'));\n        }\n      };\n\n      $scope.goFullscreen = function() {\n        if (storage.data.userStatus !== 'connected') {\n          return;\n        }\n        $rootScope.fullscreenEnabled = !Fullscreen.isEnabled();\n        if (Fullscreen.isEnabled()) {\n          Fullscreen.cancel();\n        } else {\n          Fullscreen.enable(document.getElementsByTagName('body')[0]);\n        }\n      };\n\n      $rootScope.$on('call.video', function(event) {\n        storage.data.videoCall = true;\n      });\n\n      $rootScope.$on('call.hangup', function(event, data) {\n        if (Fullscreen.isEnabled()) {\n          Fullscreen.cancel();\n        }\n\n        if (!$rootScope.chatStatus) {\n          angular.element('#wrapper').toggleClass('toggled');\n          $rootScope.chatStatus = angular.element('#wrapper').hasClass('toggled');\n        }\n\n        $rootScope.dialpadNumber = '';\n        console.debug('Redirecting to dialpad page.');\n        $location.path('/dialpad');\n\n        try {\n          $rootScope.$digest();\n        } catch (e) {\n          console.log('not digest');\n        }\n      });\n\n      $rootScope.$on('page.incall', function(event, data) {\n        var page_incall = function() {\n          return $q(function(resolve, reject) {\n            if (storage.data.askRecoverCall) {\n              prompt({\n                title: $translate.instant('TITLE_ACTIVE_CALL'),\n                message: $translate.instant('MESSAGE_ACTIVE_CALL_BACK')\n              }).then(function() {\n                console.log('redirect to incall page');\n                $location.path('/incall');\n              }, function() {\n                storage.data.userStatus = 'connecting';\n                verto.hangup();\n              });\n            } else {\n              console.log('redirect to incall page');\n              $location.path('/incall');\n            }\n            resolve();\n          });\n        };\n        eventQueue.events.push(page_incall);\n      });\n\n      $scope.$on('event:google-plus-signin-success', function (event,authResult) {\n        // Send login to server or save into cookie\n        console.log('Google+ Login Success');\n\tconsole.log(authResult);\n\tgapi.client.load('plus', 'v1', gapiClientLoaded);\n      });\n\n      function gapiClientLoaded() {\n\tgapi.client.plus.people.get({userId: 'me'}).execute(handleEmailResponse);\n      }\n\n      function handleEmailResponse(resp){\n        var primaryEmail;\n\tfor (var i=0; i < resp.emails.length; i++) {\n\t  if (resp.emails[i].type === 'account') primaryEmail = resp.emails[i].value;\n        }\n\tconsole.debug(\"Primary Email: \" + primaryEmail );\n\tconsole.debug(\"display name: \" + resp.displayName);\n\tconsole.debug(\"imageurl: \" + resp.image.url);\n\tconsole.debug(resp);\n\tconsole.debug(verto.data);\n\tverto.data.email = primaryEmail;\n\tverto.data.name = resp.displayName;\n\tstorage.data.name = verto.data.name;\n\tstorage.data.email = verto.data.email;\n\n\t$scope.login();\n      }\n\n      $scope.$on('event:google-plus-signin-failure', function (event,authResult) {\n        // Auth failure or signout detected\n        console.log('Google+ Login Failure');\n      });\n\n      $rootScope.callActive = function(data, params) {\n        verto.data.mutedMic = storage.data.mutedMic;\n        verto.data.mutedVideo = storage.data.mutedVideo;\n\n        if (!storage.data.cur_call) {\n          storage.data.call_start = new Date();\n        }\n        storage.data.userStatus = 'connected';\n        var call_start = new Date(storage.data.call_start);\n        $rootScope.start_time = call_start;\n\n        $timeout(function() {\n          $scope.$broadcast('timer-start');\n        });\n        myVideo.play();\n        storage.data.calling = false;\n\n        storage.data.cur_call = 1;\n\n        $location.path('/incall');\n\n        if(params.useVideo) {\n          $rootScope.$emit('call.video', 'video');\n        }\n      };\n\n      $rootScope.$on('call.active', function(event, data, params) {\n        $rootScope.callActive(data, params);\n      });\n\n      $rootScope.$on('call.calling', function(event, data) {\n        storage.data.calling = true;\n      });\n\n      $rootScope.$on('call.incoming', function(event, data) {\n        console.log('Incoming call from: ' + data);\n\n        storage.data.cur_call = 0;\n        $scope.incomingCall = true;\n        storage.data.videoCall = false;\n        storage.data.mutedVideo = false;\n        storage.data.mutedMic = false;\n\n        prompt({\n          title: $translate.instant('TITLE_INCOMING_CALL'),\n          message: $translate.instant('MESSAGE_INCOMING_CALL') + data\n        }).then(function() {\n          var call_start = new Date(storage.data.call_start);\n          $rootScope.start_time = call_start;\n          console.log($rootScope.start_time);\n\n          $scope.answerCall();\n          storage.data.called_number = data;\n          CallHistory.add(data, 'inbound', true);\n          $location.path('/incall');\n        }, function() {\n          $scope.declineCall();\n          CallHistory.add(data, 'inbound', false);\n        });\n      });\n\n      $scope.hold = function() {\n        storage.data.onHold = !storage.data.onHold;\n        verto.data.call.toggleHold();\n      };\n\n      /**\n       * Hangup the current call.\n       */\n      $scope.hangup = function() {\n        if (!verto.data.call) {\n          toastr.warning($translate.instant('MESSAGE_NO_HANGUP_CALL'));\n          $location.path('/dialpad');\n          return;\n        }\n\n        if ($rootScope.watcher) {\n          window.close();\n          return;\n        }\n\n        //var hangupCallback = function(v, hangup) {\n        //  if (hangup) {\n        //    $location.path('/dialpad');\n        //  } else {\n        //    console.debug('The call could not be hangup.');\n        //  }\n        //};\n        //\n        //verto.hangup(hangupCallback);\n        if (verto.data.shareCall) {\n          verto.screenshareHangup();\n        }\n\n        verto.hangup();\n\n        $rootScope.$emit('hangupCall');\n        $location.path('/dialpad');\n      };\n\n      $scope.answerCall = function() {\n        storage.data.onHold = false;\n\n        verto.data.call.answer({\n          useStereo: storage.data.useStereo,\n          useCamera: storage.data.selectedVideo,\n          useVideo: storage.data.useVideo,\n          useMic: storage.data.useMic,\n          callee_id_name: verto.data.name,\n          callee_id_number: verto.data.login\n        });\n\n\n        $location.path('/incall');\n      };\n\n      $scope.declineCall = function() {\n        $scope.hangup();\n        $scope.incomingCall = false;\n      };\n\n      $scope.play = function() {\n        var file = $scope.promptInput($translate.instant('MESSAGE_ENTER_FILENAME'), '', 'File',\n          function(file) {\n            verto.data.conf.play(file);\n            console.log('play file :', file);\n          });\n\n      };\n\n      $scope.stop = function() {\n        verto.data.conf.stop();\n      };\n\n      $scope.record = function() {\n        var file = $scope.promptInput($translate.instant('MESSAGE_ENTER_FILENAME'), '', 'File',\n          function(file) {\n            verto.data.conf.record(file);\n            console.log('recording file :', file);\n          });\n      };\n\n      $scope.stopRecord = function() {\n        verto.data.conf.stopRecord();\n      };\n\n      $scope.snapshot = function() {\n        var file = $scope.promptInput($translate.instant('MESSAGE_ENTER_FILENAME'), '', 'File',\n          function(file) {\n            verto.data.conf.snapshot(file);\n            console.log('snapshot file :', file);\n          });\n      };\n\n      function sinkIdCallback(success, deviceName) {\n        if (success) {\n          toastr.info('Speaker is now <span class=\"install\">' + deviceName + '</a>', 'Success', { allowHtml: true });\n        } else {\n          toastr.error('Your browser doesn\\'t seem to support this feature', 'Error');\n        }\n      }\n\n      $rootScope.dtmfWidget = function(number) {\n        $rootScope.dtmfHistory.value = $rootScope.dtmfHistory.value + number;\n        if (verto.data.call) {\n          verto.dtmf(number);\n        }\n      }\n\n      $rootScope.disableOnKeydownDtmf = function() {\n        $rootScope.onKeydownDtmfEnabled = false;\n      };\n\n      $rootScope.enableOnKeydownDtmf = function() {\n        $rootScope.onKeydownDtmfEnabled = true;\n      };\n\n      $rootScope.$on(\"$routeChangeStart\", function(event, next, current) {\n        if (next.$$route.originalPath === '/incall') {\n          $rootScope.dtmfHistory.value = '';\n          angular.element($window).bind('keydown', onKeydownDtmfHistory);\n        } else {\n          angular.element($window).unbind('keydown', onKeydownDtmfHistory);\n        }\n      });\n\n      function onKeydownDtmfHistory(event) {\n        var caracter = event.key;\n        if ($rootScope.onKeydownDtmfEnabled && caracter.match(/^(\\*|\\#|[0-9a-dA-D])$/g)) {\n          $rootScope.dtmfWidget(caracter);\n          $scope.$applyAsync();\n        }\n      }\n\n    }]\n  );\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n\t.controller('MenuController', ['$scope', '$http', '$location',\n\t  'verto', 'storage', '$rootScope',\n\t  function($scope, $http, $location, verto, storage, $rootScope) {\n\t    console.debug('Executing MenuController.');\n      $scope.storage = storage;\n\n      $rootScope.$on('testSpeed', function(e, data) {\n        var vidQual = storage.data.vidQual;\n\tvar bwp = 4;\n\n        $scope.bandDown = data.downKPS;\n        $scope.bandUp = data.upKPS;\n\n        if (data.downKPS < 2000) {\n          bwp--;\n        }\n\n        if (data.upKPS < 2000) {\n           bwp--;\n        }\n\n        $scope.iconClass = 'mdi-device-signal-wifi-4-bar green';                      \n\n        if (bwp < 4) {\n           $scope.iconClass = 'mdi-device-signal-wifi-3-bar yellow';\n        } else if (bwp < 2) {\n           $scope.iconClass = 'mdi-device-signal-wifi-1-bar red';\n        }\n\n        verto.videoQuality.forEach(function(vid) {\n          if (vid.id == vidQual){\n            $scope.vidRes = vid.label;\n          }\n        });\n\n        $scope.$apply();\n      });\n    }\n\t]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('ModalDialpadController', ['$scope',\n      '$modalInstance',\n      function($scope, $modalInstance) {\n\n        $scope.ok = function() {\n          $modalInstance.close('Ok.');\n        };\n\n        $scope.cancel = function() {\n          $modalInstance.dismiss('cancel');\n        };\n\n      }\n    ]);\n})();\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('ModalWsReconnectController', ModalWsReconnectController);\n\n    ModalWsReconnectController.$inject = ['$rootScope', '$scope', 'storage', 'verto'];\n\n    function ModalWsReconnectController($rootScope, $scope, storage, verto) {\n      console.debug('Executing ModalWsReconnectController'); \n\n      $scope.closeReconnect = closeReconnect;\n\n      function closeReconnect() {\n        if ($rootScope.ws_modalInstance && verto.data.instance) {\n          verto.data.instance.rpcClient.stopRetrying();\n          $rootScope.ws_modalInstance.close();\n          delete verto.data.instance;\n        }\n      };\n    };\n                \n                \n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('ModalLoginInformationController', ['$scope',\n      '$http', '$location', '$modalInstance', 'verto', 'storage',\n      function($scope, $http, $location, $modalInstance, verto, storage) {\n        console.debug('Executing ModalLoginInformationController.');\n\n        $scope.verto = verto;\n        $scope.storage = storage;\n\n        $scope.ok = function() {\n          $modalInstance.close('Ok.');\n        };\n\n        $scope.cancel = function() {\n          $modalInstance.dismiss('cancel');\n        };\n\n        verto.data.name = storage.data.name;\n        verto.data.email = storage.data.email;\n\n      }\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('SettingsController', ['$scope', '$http',\n      '$location', '$rootScope', 'storage', 'verto', '$translate', 'toastr', 'configLanguages',\n      function($scope, $http, $location, $rootScope, storage, verto, $translate, toastr, configLanguages) {\n        console.debug('Executing ModalSettingsController.');\n\n        $.material.init();\n\n        $scope.speakerFeature = typeof document.getElementById('webcam').sinkId !== 'undefined';\n        $scope.storage = storage;\n        $scope.verto = verto;\n        $scope.mydata = angular.copy(storage.data);\n        $scope.languages = configLanguages.languages;\n        $scope.languages.unshift({id: 'browser', name : $translate.instant('BROWSER_LANGUAGE')});\n        $scope.mydata.language = storage.data.language || 'browser';\n\n        $rootScope.$on('$translateChangeSuccess', function () {\n          $translate('BROWSER_LANGUAGE').then(function (translation) {\n          $scope.languages[0].name = translation;\n          });\n        });\n\n        $rootScope.$on('toggledSettings', function(e, status) {\n          if (status) {\n            $scope.mydata = angular.copy(storage.data);\n          } else {\n            $scope.ok();\n          }\n        });\n\n        $scope.ok = function() {\n          console.log('Camera Selected is', $scope.mydata.selectedVideo, $scope.verto.data.videoDevices);\n\n          angular.forEach(verto.data.videoDevices, function(video) {\n            console.log('checking video ', video);\n            if (video.id == $scope.mydata.selectedVideo) {\n              $scope.mydata.selectedVideoName = video.label;\n              console.log('Setting selectedVideoName to ', video.label);\n            }\n          })\n          if ($scope.mydata.selectedSpeaker != storage.data.selectedSpeaker) {\n            $rootScope.$emit('changedSpeaker', $scope.mydata.selectedSpeaker);\n          }\n          storage.changeData($scope.mydata);\n          verto.data.instance.iceServers(storage.data.useSTUN);\n\n          if (storage.data.autoBand) {\n            $scope.testSpeed();\n          }\n\n          var audioParams = {\n            googEchoCancellation: storage.data.googEchoCancellation === undefined ? true : storage.data.googEchoCancellation,\n            googNoiseSuppression: storage.data.googNoiseSuppression === undefined ? true : storage.data.googNoiseSuppression,\n            googHighpassFilter: storage.data.googHighpassFilter === undefined ? true : storage.data.googHighpassFilter,\n            googAutoGainControl: storage.data.googAutoGainControl === undefined ? true : storage.data.googAutoGainControl,\n            googAutoGainControl2: storage.data.googAutoGainControl === undefined ? true : storage.data.googAutoGainControl\n          };\n          verto.data.instance.options.audioParams = audioParams;\n\n        };\n\n        $scope.changedLanguage = function(langKey){\n          if (langKey === 'browser'){\n           storage.data.language = 'browser';\n            var browserlang = $translate.preferredLanguage();\n            $translate.use(browserlang).then(\n              function(lang) {}, function(fail_lang) {\n                $translate.use('en');\n               });\n          } else {\n            $translate.use(langKey);\n            storage.data.language = langKey;\n          }\n        };\n\n        $scope.refreshDeviceList = function() {\n          return verto.refreshDevices();\n        };\n\n        $scope.showPreview = function() {\n          var settingsEl = angular.element(document.querySelector('#settings'));\n          settingsEl.toggleClass('toggled');\n          if (!verto.data.call) {\n            $location.path('/preview');\n            return;\n          }\n          else {\n            toastr.warning($translate.instant('MESSAGE_DISPLAY_SETTINGS'));\n          }\n        };\n\n        $scope.testSpeed = function() {\n          $scope.isTestingSpeed = true;\n          return verto.testSpeed(cb);\n\n          function cb(data) {\n            $scope.mydata.vidQual = storage.data.vidQual;\n            $scope.speedMsg = 'Up: ' + data.upKPS + ' Down: ' + data.downKPS;\n            $scope.isTestingSpeed = false;\n            $scope.$apply();\n          }\n        };\n\n        $scope.resetSettings = function() {\n\t  if (confirm('Factory Reset Settings?')) {\n            storage.factoryReset();\n            $scope.logout();\n\t    window.location.reload();\n\t  };\n        };\n\n        $scope.checkAutoBand = function(option) {\n          $scope.mydata.useDedenc = false;\n          var bestres = videoQuality[videoQuality.length-1];\n          $scope.mydata.vidQual = bestres.id;\n          storage.data.vidQual = bestres.id;\n          verto.data.instance.videoParams({\n            minWidth: bestres.width,\n            minHeight: bestres.height,\n            maxWidth: bestres.width,\n            maxHeight: bestres.height,\n            minFrameRate: 15,\n            vertoBestFrameRate: storage.data.bestFrameRate\n          });\n          storage.data.vidQual = bestres.id;\n          if (!option) {\n            $scope.mydata.outgoingBandwidth = 'default';\n            $scope.mydata.incomingBandwidth = 'default';\n            $scope.mydata.testSpeedJoin = false;\n\n          } else {\n            $scope.mydata.testSpeedJoin = true;\n          }\n        };\n\n        $scope.checkUseDedRemoteEncoder = function(option) {\n          if (['0', 'default', '5120'].indexOf(option) != -1) {\n            $scope.mydata.useDedenc = false;\n          } else {\n            $scope.mydata.useDedenc = true;\n          }\n        };\n\n        $scope.checkVideoQuality = function(resolution) {\n          var w = videoResolution[resolution]['width'];\n          var h = videoResolution[resolution]['height'];\n          storage.data.vidQual = resolution;\n          verto.data.instance.videoParams({\n            minWidth: w,\n            minHeight: h,\n            maxWidth: w,\n            maxHeight: h,\n            minFrameRate: 15,\n            vertoBestFrameRate: storage.data.bestFrameRate\n          });\n\n        };\n\n      }\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('vertoControllers')\n    .controller('PreviewController', ['$rootScope', '$scope',\n      '$http', '$location', '$modal', '$timeout', 'toastr', 'verto', 'storage', 'prompt', 'Fullscreen', '$translate',\n      function($rootScope, $scope, $http, $location, $modal, $timeout, toastr,\n        verto, storage, prompt, Fullscreen, $translate) {\n\n        $scope.storage = storage;\n        console.debug('Executing PreviewController.');\n        var localVideo = document.getElementById('videopreview');\n        var volumes = document.querySelector('#mic-meter .volumes');\n        if (volumes) {\n          volumes = volumes.children;\n        }\n\n        $scope.localVideo = function() {\n          var constraints = {\n            mirrored: true,\n            audio: {\n              optional: [{ sourceId: storage.data.selectedAudio }]\n            }\n          };\n\n          var newDevice = verto.data.videoDevices.find(function(device) {\n            return device.id == storage.data.selectedVideo;\n          });\n\n          storage.data.selectedVideo = newDevice.id;\n          storage.data.selectedVideoName = newDevice.label;\n\n          if (newDevice.id !== 'none') {\n            constraints.video = {\n              optional: [{ sourceId: newDevice.id }]\n            };\n          }\n\n          navigator.getUserMedia(constraints, handleMedia, function(err, data) {\n\n          });\n        };\n        var audioContext = null;\n        if (typeof AudioContext !== \"undefined\") {\n          audioContext = new AudioContext();\n        }\n\n        var mediaStreamSource = null;\n        var meter = null;\n        var streamObj = {};\n\n        function stopMedia(stream) {\n          if (typeof stream == 'function') {\n            stream.stop();\n          } else {\n            if (stream.active) {\n              var tracks = stream.getTracks();\n              tracks.forEach(function(track, index) {\n                track.stop();\n              })\n            }\n          }\n        }\n        function handleMedia(stream) {\n          if (streamObj) {\n            stopMedia(streamObj);\n          }\n\n          streamObj = stream;\n          FSRTCattachMediaStream(localVideo, stream);\n          if (audioContext) {\n            mediaStreamSource = audioContext.createMediaStreamSource(stream);\n            meter = createAudioMeter(audioContext);\n            mediaStreamSource.connect(meter);\n          };\n        }\n\n        function renderMic() {\n          // meter.volume;\n          var n = Math.round(meter.volume * 25);\n          for(var i = volumes.length -1, j = 0; i >= 0; i--, j++) {\n            var el = angular.element(volumes[j]);\n            if (i >= n) el.removeClass('active');\n            else        el.addClass('active');\n          }\n\n          if(!verto.data.call) {\n            window.requestAnimationFrame(renderMic);\n          }\n        }\n        /**\n         * TODO: useless?\n         */\n\n        $scope.refreshDeviceList = function() {\n         return verto.refreshDevices();\n        };\n\n        $scope.videoCall = function() {\n          prompt({\n            title: $translate.instant('TITLE_ENABLE_VIDEO'),\n            message: $translate.instant('MESSAGE_ENABLE_VIDEO')\n          }).then(function() {\n            storage.data.videoCall = true;\n            $scope.callTemplate = 'partials/video_call.html';\n          });\n        };\n\n        $scope.cbMuteVideo = function(event, data) {\n          storage.data.mutedVideo = !storage.data.mutedVideo;\n        }\n\n        $scope.cbMuteMic = function(event, data) {\n          storage.data.mutedMic = !storage.data.mutedMic;\n        }\n\n        $scope.confChangeVideoLayout = function(layout) {\n          verto.data.conf.setVideoLayout(layout);\n        };\n\n        $scope.endPreview = function() {\n          localVideo.src = null;\n          if (audioContext) {\n            meter.shutdown();\n            meter.onaudioprocess = null;\n          };\n          stopMedia(streamObj);\n          $location.path('/dialpad');\n          storage.data.preview = false;\n        };\n\n        $scope.localVideo();\n      }\n    ]);\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('vertoControllers')\n        .controller('LoadingController', ['$rootScope', '$scope', '$location', '$interval', 'verto',\n            function($rootScope, $scope, $location, $interval, verto) {\n                console.log('Loading controller');\n                var int_id;\n\n                $scope.stopInterval = function() {\n                    $interval.cancel(int_id);\n                };\n\n                int_id = $interval(function() {\n                  if (verto.data.resCheckEnded) {\n                    $scope.stopInterval();\n                    $location.path('/preview');\n                  }\n                }, 1000);\n\n            }\n        ]);\n})();\n\n(function() {\n  'use strict';\n  var vertoDirectives = angular.module('vertoDirectives', []);\n})();\n\n/*\nSometimes autofocus HTML5 directive just isn't enough with SPAs.\nThis directive will force autofocus to work properly under those circumstances.\n*/\n(function () {\n  'use strict';\n\n  angular\n  .module('vertoDirectives')\n  .directive('autofocus', ['$timeout',\n    function ($timeout) {\n      return {\n        restrict: 'A',\n        link: function ($scope, $element) {\n          $timeout(function () {\n            $element[0].focus();\n          });\n        }\n      };\n    }\n  ]);\n})();\n(function () {\n  'use strict';\n\n  angular\n  .module('vertoDirectives')\n  .directive('showControls',\n  [\"Fullscreen\", function(Fullscreen) {\n    var link = function(scope, element, attrs) {\n      var i = null;\n      jQuery('.video-footer').fadeIn('slow');\n      jQuery('.video-hover-buttons').fadeIn('slow');\n      element.parent().bind('mousemove', function() {\n        if (Fullscreen.isEnabled()) {\n          clearTimeout(i);\n          jQuery('.video-footer').fadeIn('slow');\n          jQuery('.video-hover-buttons').fadeIn(500);\n          i = setTimeout(function() {\n            if (Fullscreen.isEnabled()) {\n              jQuery('.video-footer').fadeOut('slow');\n              jQuery('.video-hover-buttons').fadeOut(500);\n            }\n          }, 3000);\n        }\n      });\n      element.parent().bind('mouseleave', function() {\n        jQuery('.video-footer').fadeIn();\n        jQuery('.video-hover-buttons').fadeIn();\n      });\n    }\n\n\n    return {\n      link: link\n    };\n  }]);\n\n})();\n(function () {\n  'use strict';\n\n  angular\n  .module('vertoDirectives').directive('userStatus',\n  function() {\n    var link = function(scope, element, attrs) {\n      scope.$watch('condition', function(condition) {\n        element.removeClass('connected');\n        element.removeClass('disconnected');\n        element.removeClass('connecting');\n\n        element.addClass(condition);\n\n      });\n    }\n\n    return {\n      scope: {\n        'condition': '='\n      },\n      link: link\n    };\n\n  });\n\n})();\n/**\n * To RTC work properly we need to give a <video> tag as soon as possible\n * because it needs to attach the video and audio stream to the tag.\n *\n * This directive is responsible for moving the video tag from the body to\n * the right place when a call start and move back to the body when the\n * call ends. It also hides and display the tag when its convenient.\n */\n(function () {\n  'use strict';\n\n  angular\n  .module('vertoDirectives')\n  .directive('videoTag',\n  function() {\n\n    function link(scope, element, attrs) {\n      // Moving the video tag to the new place inside the incall page.\n      console.log('Moving the video to element.');\n      var videoElem = jQuery('#webcam');\n\n      var newParent = document.getElementsByClassName('video-tag-wrapper');\n\tnewParent[0].appendChild(document.getElementById('webcam'));\n\n\t$(\"#webcam\").resize(function() {\n\t    updateVideoSize();\n\t});\n\n\t$(window).resize(function() {\n\t    updateVideoSize();\n\t});\n\n\tupdateVideoSize();\n\t\n\tvideoElem.removeClass('hide');\n\tvideoElem.css('display', 'block');\n\n      scope.callActive(\"\", {useVideo: true});\n\n      element.on('$destroy', function() {\n        // Move the video back to the body.\n        console.log('Moving the video back to body.');\n        videoElem.addClass('hide').appendTo(jQuery('body'));\n        $(window).unbind('resize');\n      });\n    }\n\n    return {\n      link: link\n    }\n  });\n\n})();\n\n(function() {\n  'use strict';\n  var vertoFilters = angular.module('vertoFilters', []);\n})();\n\n(function () {\n  'use strict';\n\n  angular\n  .module('vertoFilters')\n  .filter('picturify', function() {\n    var regex = /<a (|target=\"\\s*\\S*\" )href=\"(\\s*\\S*.(png|jpg|svg|gif|webp|bmp))\">\\s*\\S*<\\/a>/i;\n    var regex64 = /data:image\\/(\\s*\\S*);base64,((?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\\/]{3}=))/g;\n\n    return function (text, width, n) {\n      var i = 0;\n      width = width || 150; //default width\n      if(regex64.test(text)) {\n        text = text.replace(regex64, '<a href=\"$1\" target=\"_blank\"><img class=\"chat-img\" width=\"'+ width +'\" src=\"data:image/png;base64,$2\"/></a>')\n      }\n\n      do {\n        text = text.replace(regex, '<a $1href=\"$2\"><img class=\"chat-img\" width=\"'+ width +'\" src=\"$2\"/></a>');\n      } while((!n || (n && i++ < n)) && regex.test(text));\n\n      return text;\n    }\n\n  });\n\n})();\n\n(function() {\n  'use strict';\n  var vertoService = angular.module('vertoService', []);\n})();\n\n'use strict';\n\n/* Controllers */\nvar videoQuality = [];\nvar videoQualitySource = [{\n  id: 'qqvga',\n  label: 'QQVGA 160x120',\n  width: 160,\n  height: 120\n}, {\n  id: 'qvga',\n  label: 'QVGA 320x240',\n  width: 320,\n  height: 240\n}, {\n  id: 'vga',\n  label: 'VGA 640x480',\n  width: 640,\n  height: 480\n}, {\n  id: 'qvga_wide',\n  label: 'QVGA WIDE 320x180',\n  width: 320,\n  height: 180\n}, {\n  id: 'vga_wide',\n  label: 'VGA WIDE 640x360',\n  width: 640,\n  height: 360\n}, {\n  id: 'hd',\n  label: 'HD 1280x720',\n  width: 1280,\n  height: 720\n}, {\n  id: 'hhd',\n  label: 'HHD 1920x1080',\n  width: 1920,\n  height: 1080\n}, ];\n\nvar videoResolution = {\n  qqvga: {\n    width: 160,\n    height: 120\n  },\n  qvga: {\n    width: 320,\n    height: 240\n  },\n  vga: {\n    width: 640,\n    height: 480\n  },\n  qvga_wide: {\n    width: 320,\n    height: 180\n  },\n  vga_wide: {\n    width: 640,\n    height: 360\n  },\n  hd: {\n    width: 1280,\n    height: 720\n  },\n  hhd: {\n    width: 1920,\n    height: 1080\n  },\n};\n\nvar bandwidth = [{\n  id: '250',\n  label: '250kb'\n}, {\n  id: '500',\n  label: '500kb'\n}, {\n  id: '1024',\n  label: '1mb'\n}, {\n  id: '1536',\n  label: '1.5mb'\n}, {\n  id: '2048',\n  label: '2mb'\n}, {\n  id: '3196',\n  label: '3mb'\n}, {\n  id: '4192',\n  label: '4mb'\n}, {\n  id: '5120',\n  label: '5mb'\n}, {\n  id: '0',\n  label: 'No Limit'\n}, {\n  id: 'default',\n  label: 'Server Default'\n}, ];\n\nvar framerate = [{\n  id: '15',\n  label: '15 FPS'\n}, {\n  id: '20',\n  label: '20 FPS'\n}, {\n  id: '30',\n  label: '30 FPS'\n}, ];\n\nvar updateReq;\n\nvar updateVideoSize = function(ms) {\n    if (!ms) ms = 500;\n\n    clearTimeout(updateReq);\n    updateReq = setTimeout(function () {\n        var videoElem = jQuery('#webcam');\n        videoElem.width(\"\");\n        videoElem.height(\"\");\n\n        var w = videoElem.width();\n        var h = videoElem.height();\n        var new_w, new_h;\n        var aspect = w / h;\n        var videoContainer = jQuery('div.video-wrapper');\n        if (w > h) {\n            new_w = videoContainer.width();\n            new_h = Math.round(videoContainer.width() / aspect);\n        } else {\n            new_h = videoContainer.height();\n            new_w = Math.round(videoContainer.height() / aspect);\n        }\n        videoElem.width(new_w);\n        videoElem.height(new_h);\n        console.log('Setting video size to ' + new_w + '/' + new_h);\n    }, ms);\n}\n\nvar vertoService = angular.module('vertoService', ['ngCookies']);\n\nvertoService.service('verto', ['$rootScope', '$cookieStore', '$location', 'storage',\n  function($rootScope, $cookieStore, $location, storage) {\n    var data = {\n      // Connection data.\n      instance: null,\n      connected: false,\n\n      // Call data.\n      call: null,\n      shareCall: null,\n      callState: null,\n      conf: null,\n      confLayouts: [],\n      confRole: null,\n      chattingWith: null,\n      liveArray: null,\n\n      // Settings data.\n      videoDevices: [],\n      audioDevices: [],\n      shareDevices: [],\n      videoQuality: [],\n      extension: $cookieStore.get('verto_demo_ext'),\n      name: $cookieStore.get('verto_demo_name'),\n      email: $cookieStore.get('verto_demo_email'),\n      cid: $cookieStore.get('verto_demo_cid'),\n      textTo: $cookieStore.get('verto_demo_textto') || \"1000\",\n      login: $cookieStore.get('verto_demo_login') || \"1008\",\n      password: $cookieStore.get('verto_demo_passwd') || \"1234\",\n      hostname: window.location.hostname,\n      wsURL: (\"wss://\" + window.location.hostname + \":8082\"),\n      wsFallbackURL: null,\n      turnServer: null,\n      resCheckEnded: false\n    };\n\n    function cleanShareCall(that) {\n      data.shareCall = null;\n      data.callState = 'active';\n      that.refreshDevices();\n    }\n\n    function cleanCall() {\n      data.call = null;\n      data.callState = null;\n      data.conf = null;\n      data.confLayouts = [];\n      data.confRole = null;\n      data.chattingWith = null;\n\n      $rootScope.$emit('call.hangup', 'hangup');\n    }\n\n    function inCall() {\n      $rootScope.$emit('page.incall', 'call');\n    }\n\n    function callActive(last_state, params) {\n      $rootScope.$emit('call.active', last_state, params);\n    }\n\n    function calling() {\n      $rootScope.$emit('call.calling', 'calling');\n    }\n\n    function incomingCall(number) {\n      $rootScope.$emit('call.incoming', number);\n    }\n\n    function updateResolutions(supportedResolutions) {\n      console.debug('Attempting to sync supported and available resolutions');\n\n      //var removed = 0;\n\n      console.debug(\"VQ length: \" + videoQualitySource.length);\n      console.debug(supportedResolutions);\n\n      angular.forEach(videoQualitySource, function(resolution, id) {\n        angular.forEach(supportedResolutions, function(res) {\n          var width = res[0];\n          var height = res[1];\n\n          if(resolution.width == width && resolution.height == height) {\n            videoQuality.push(resolution);\n          }\n        });\n      });\n\n      // videoQuality.length = videoQuality.length - removed;\n      console.debug(\"VQ length 2: \" + videoQuality.length);\n      data.videoQuality = videoQuality;\n      console.debug(videoQuality);\n      data.vidQual = (videoQuality.length > 0) ? videoQuality[videoQuality.length - 1].id : null;\n      console.debug(data.vidQual);\n\n      return videoQuality;\n    };\n\n    var callState = {\n      muteMic: false,\n      muteVideo: false\n    };\n\n    return {\n      data: data,\n      callState: callState,\n\n      // Options to compose the interface.\n      videoQuality: videoQuality,\n      videoResolution: videoResolution,\n      bandwidth: bandwidth,\n      framerate: framerate,\n\n      refreshDevicesCallback : function refreshDevicesCallback(callback) {\n        data.videoDevices = [{\n          id: 'none',\n          label: 'No Camera'\n        }];\n        data.shareDevices = [{\n          id: 'screen',\n          label: 'Screen'\n        }];\n        data.audioDevices = [{\n          id: 'any',\n          label: 'Default Microphone'\n\t},\n\t{\n\t    id: 'none',\n\t    label: 'No Microphone'\n        }];\n        data.speakerDevices = [{\n\t    id: 'any',\n\t    label: 'Default Speaker'\n\t}];\n\n        if(!storage.data.selectedShare) {\n          storage.data.selectedShare = data.shareDevices[0]['id'];\n        }\n\n        for (var i in jQuery.verto.videoDevices) {\n          var device = jQuery.verto.videoDevices[i];\n          if (!device.label) {\n            data.videoDevices.push({\n              id: 'Camera ' + i,\n              label: 'Camera ' + i\n            });\n          } else {\n            data.videoDevices.push({\n              id: device.id,\n              label: device.label || device.id\n            });\n          }\n\n          // Selecting the first source.\n          if (i == 0 && !storage.data.selectedVideo) {\n            storage.data.selectedVideo = device.id;\n          }\n\n          if (!device.label) {\n            data.shareDevices.push({\n              id: 'Share Device ' + i,\n              label: 'Share Device ' + i\n            });\n            continue;\n          }\n\n          data.shareDevices.push({\n            id: device.id,\n            label: device.label || device.id\n          });\n        }\n\n        for (var i in jQuery.verto.audioInDevices) {\n          var device = jQuery.verto.audioInDevices[i];\n          // Selecting the first source.\n          if (i == 0 && !storage.data.selectedAudio) {\n            storage.data.selectedAudio = device.id;\n          }\n\n          if (!device.label) {\n            data.audioDevices.push({\n              id: 'Microphone ' + i,\n              label: 'Microphone ' + i\n            });\n            continue;\n          }\n          data.audioDevices.push({\n            id: device.id,\n            label: device.label || device.id\n          });\n        }\n\n        for (var i in jQuery.verto.audioOutDevices) {\n          var device = jQuery.verto.audioOutDevices[i];\n          // Selecting the first source.\n          if (i == 0 && !storage.data.selectedSpeaker) {\n            storage.data.selectedSpeaker = device.id;\n          }\n\n          if (!device.label) {\n            data.speakerDevices.push({\n              id: 'Speaker ' + i,\n              label: 'Speaker ' + i\n            });\n            continue;\n          }\n          data.speakerDevices.push({\n            id: device.id,\n            label: device.label || device.id\n          });\n        }\n        console.debug('Devices were refreshed, checking that we have cameras.');\n\n        // Verify if selected devices are valid\n        var videoFlag = data.videoDevices.some(function(device) {\n          console.log('Evaluating device ', device);\n          if (device.label == storage.data.selectedVideoName) {\n            console.log('Matched video selection by name: ', device.label);\n            storage.data.selectedVideo = device.id;\n            return true;\n          }\n          return device.id == storage.data.selectedVideo && storage.data.selectedVideo !== \"none\";\n        });\n\n        var shareFlag = data.shareDevices.some(function(device) {\n          return device.id == storage.data.selectedShare;\n        });\n\n        var audioFlag = data.audioDevices.some(function(device) {\n          return device.id == storage.data.selectedAudio;\n        });\n\n        var speakerFlag = data.speakerDevices.some(function(device) {\n          return device.id == storage.data.selectedSpeaker;\n        });\n\n        console.log('Storage Video: ', storage.data.selectedVideo);\n        console.log('Video Flag: ', videoFlag)\n\n        if (!videoFlag) storage.data.selectedVideo = data.videoDevices[data.videoDevices.length - 1].id;\n        if (!shareFlag) storage.data.selectedShare = data.shareDevices[0].id;\n        if (!audioFlag) storage.data.selectedAudio = data.audioDevices[0].id;\n        if (!speakerFlag && data.speakerDevices.length > 0) storage.data.selectedSpeaker = data.speakerDevices[0].id;\n\n        // This means that we cannot use video!\n        if (data.videoDevices.length === 0) {\n          console.log('No camera, disabling video.');\n          data.canVideo = false;\n          data.videoDevices.push({\n            id: 'none',\n            label: 'No camera'\n          });\n        } else {\n          data.canVideo = true;\n        }\n\n        if(angular.isFunction(callback)) {\n          callback();\n        }\n      },\n\n      refreshDevices: function(callback) {\n        console.debug('Attempting to refresh the devices.');\n        if(callback) {\n          jQuery.verto.refreshDevices(callback);\n        } else {\n          jQuery.verto.refreshDevices(this.refreshDevicesCallback);\n        }\n      },\n\n      /**\n       * Updates the video resolutions based on settings.\n       */\n      refreshVideoResolution: function(resolutions) {\n        console.debug('Attempting to refresh video resolutions.');\n\n        if (data.instance) {\n          var w = resolutions['bestResSupported'][0];\n          var h = resolutions['bestResSupported'][1];\n\n          if (h === 1080) {\n            w = 1280;\n            h = 720;\n          }\n\n          updateResolutions(resolutions['validRes']);\n          /* Do not touch video device resolution if autoBand is off and we have selected a vidQual */\n          if (!storage.data.autoBand && storage.data.vidQual) {\n            w = videoResolution[storage.data.vidQual].width;\n            h = videoResolution[storage.data.vidQual].height;\n          }\n          data.instance.videoParams({\n            minWidth: w,\n            minHeight: h,\n            maxWidth: w,\n            maxHeight: h,\n            minFrameRate: 15,\n            vertoBestFrameRate: storage.data.bestFrameRate\n          });\n          videoQuality.forEach(function(qual){\n            if (w === qual.width && h === qual.height) {\n              if (storage.data.vidQual !== qual.id || storage.data.vidQual === undefined) {\n                storage.data.vidQual = qual.id;\n              }\n            }\n\n          });\n          data.resCheckEnded = true;\n\n        } else {\n          console.debug('There is no instance of verto.');\n        }\n      },\n\n      /**\n       * Connects to the verto server. Automatically calls `onWSLogin`\n       * callback set in the verto object.\n       *\n       * @param callback\n       */\n      connect: function(callback) {\n        console.debug('Attempting to connect to verto.');\n        var that = this;\n\n        function startConference(v, dialog, pvtData) {\n          $rootScope.$emit('call.video', 'video');\n          $rootScope.$emit('call.conference', 'conference');\n          data.chattingWith = pvtData.chatID;\n          data.confRole = pvtData.role;\n          data.conferenceMemberID = pvtData.conferenceMemberID;\n          var conf = new $.verto.conf(v, {\n            dialog: dialog,\n            hasVid: storage.data.useVideo,\n            laData: pvtData,\n            chatCallback: function(v, e) {\n              var from = e.data.fromDisplay || e.data.from || \"Unknown\";\n              var message = e.data.message || \"\";\n              $rootScope.$emit('chat.newMessage', {\n                from: from,\n                body: message\n              });\n            },\n            onBroadcast: function(v, conf, message) {\n              console.log('>>> conf.onBroadcast:', arguments);\n              if (message.action == 'response') {\n                // This is a response with the video layouts list.\n                if (message['conf-command'] == 'list-videoLayouts') {\n                  var rdata = [];\n\n                  for (var i in message.responseData) {\n                    rdata.push(message.responseData[i].name);\n                  }\n\n                  var options = rdata.sort(function(a, b) {\n                    var ga = a.substring(0, 6) == \"group:\" ? true : false;\n                    var gb = b.substring(0, 6) == \"group:\" ? true : false;\n\n                    if ((ga || gb) && ga != gb) {\n                      return ga ? -1 : 1;\n                    }\n\n                    return ( ( a == b ) ? 0 : ( ( a > b ) ? 1 : -1 ) );\n                  });\n                  data.confLayoutsData = message.responseData;\n                  data.confLayouts = options;\n                } else if (message['conf-command'] == 'canvasInfo') {\n                  data.canvasInfo = message.responseData;\n                  $rootScope.$emit('conference.canvasInfo', message.responseData);\n                } else {\n                  $rootScope.$emit('conference.broadcast', message);\n                }\n              }\n            }\n          });\n\n          if (data.confRole == \"moderator\") {\n            console.log('>>> conf.listVideoLayouts();');\n            conf.listVideoLayouts();\n            conf.modCommand('canvasInfo');\n          }\n\n          data.conf = conf;\n\n          data.liveArray = new $.verto.liveArray(\n            data.instance, pvtData.laChannel,\n            pvtData.laName, {\n              subParams: {\n                callID: dialog ? dialog.callID : null\n              }\n            });\n\n          data.liveArray.onErr = function(obj, args) {\n            console.log('liveArray.onErr', obj, args);\n          };\n\n          data.liveArray.onChange = function(obj, args) {\n            // console.log('liveArray.onChange', obj, args);\n            switch (args.action) {\n              case 'bootObj':\n                $rootScope.$emit('members.boot', args.data);\n                args.data.forEach(function(member){\n                  var callId = member[0];\n                  var status = angular.fromJson(member[1][4]);\n                  if (callId === data.call.callID) {\n                    $rootScope.$apply(function(){\n                      data.mutedMic = status.audio.muted;\n                      data.mutedVideo = status.video.muted;\n                    });\n                  }\n                });\n                break;\n              case 'add':\n                var member = [args.key, args.data];\n                $rootScope.$emit('members.add', member);\n                break;\n              case 'del':\n                var uuid = args.key;\n                $rootScope.$emit('members.del', uuid);\n                break;\n              case 'clear':\n                $rootScope.$emit('members.clear');\n                break;\n              case 'modify':\n                var member = [args.key, args.data];\n                $rootScope.$emit('members.update', member);\n                break;\n              default:\n                console.log('NotImplemented', args.action);\n            }\n          };\n        }\n\n        function stopConference() {\n          console.log('stopConference()');\n          if (data.liveArray) {\n            data.liveArray.destroy();\n            console.log('Has data.liveArray.');\n            $rootScope.$emit('members.clear');\n            data.liveArray = null;\n          } else {\n            console.log('Doesn\\'t found data.liveArray.');\n          }\n\n          if (data.conf) {\n            data.conf.destroy();\n            data.conf = null;\n          }\n        }\n\n        var callbacks = {\n          onWSLogin: function(v, success) {\n            data.connected = success;\n            $rootScope.loginFailed = !success;\n            $rootScope.$emit('ws.login', success);\n            console.debug('Connected to verto server:', success);\n\n            if (angular.isFunction(callback)) {\n              callback(v, success);\n            }\n          },\n\n          onMessage: function(v, dialog, msg, params) {\n            console.debug('onMessage:', v, dialog, msg, params);\n\n            switch (msg) {\n              case $.verto.enum.message.pvtEvent:\n                if (params.pvtData) {\n                  switch (params.pvtData.action) {\n                    case \"conference-liveArray-join\":\n\t\t      if (!params.pvtData.screenShare && !params.pvtData.videoOnly) {\n\t\t\t  console.log(\"conference-liveArray-join\");\n\t\t\t  stopConference();\n\t\t\t  startConference(v, dialog, params.pvtData);\n\t\t\t  updateVideoSize();\n\t\t      }\n                      break;\n                    case \"conference-liveArray-part\":\n\t\t      if (!params.pvtData.screenShare && !params.pvtData.videoOnly) {\n\t\t\t  console.log(\"conference-liveArray-part\");\n\t\t\t  stopConference();\n\t\t      }\n                      break;\n                  }\n                }\n                break;\n              /**\n                * This is not being used for conferencing chat\n                * anymore (see conf.chatCallback for that).\n                */\n              case $.verto.enum.message.info:\n                var body = params.body;\n                var from = params.from_msg_name || params.from;\n                if (!body) {\n                  console.log('Received an empty body: ', params);\n                  return;\n                }\n                $rootScope.$emit('chat.newMessage', {\n                  from: from,\n                  body: body\n                });\n                break;\n              case $.verto.enum.message.display:\n                    $rootScope.$apply(function() {});\n                    break;\n              case $.verto.enum.message.clientReady:\n                    $rootScope.$emit('clientReady', {\n                      reattached_sessions: params.reattached_sessions,\n                    });\n                    break;\n              default:\n                console.warn('Got a not implemented message:', msg, dialog, params);\n                break;\n            }\n          },\n\n          onDialogState: function(d) {\n            if (!data.call) {\n              data.call = d;\n\n            }\n\n            console.debug('onDialogState:', d);\n            switch (d.state.name) {\n              case \"ringing\":\n                incomingCall(d.params.caller_id_number);\n                break;\n              case \"trying\":\n                console.debug('Calling:', d.cidString());\n                data.callState = 'trying';\n                break;\n              case \"early\":\n                console.debug('Talking to:', d.cidString());\n                data.callState = 'active';\n                calling();\n                break;\n              case \"active\":\n                console.debug('Talking to:', d.cidString());\n                data.callState = 'active';\n                callActive(d.lastState.name, d.params);\n\t\tupdateVideoSize();\n                break;\n              case \"hangup\":\n                console.debug('Call ended with cause: ' + d.cause);\n                data.callState = 'hangup';\n                break;\n              case \"destroy\":\n                console.debug('Destroying: ' + d.cause);\n                if (d.params.screenShare) {\n                  cleanShareCall(that);\n                } else {\n                  stopConference();\n                  if (!that.reloaded) {\n                    cleanCall();\n                  }\n                }\n                break;\n              default:\n                console.warn('Got a not implemented state:', d);\n                break;\n            }\n          },\n\n          onWSClose: function(v, success) {\n            console.debug('onWSClose:', success);\n            $rootScope.$emit('ws.close', success);\n          },\n\n          onEvent: function(v, e) {\n            console.debug('onEvent:', e);\n          }\n        };\n\n        var that = this;\n        function ourBootstrap() {\n          var sessid = $location.search().sessid;\n          if (sessid === 'random') {\n            sessid = $.verto.genUUID();\n            $location.search().sessid = sessid;\n          }\n          // Checking if we have a failed connection attempt before\n          // connecting again.\n          if (data.instance && !data.instance.rpcClient.socketReady()) {\n            data.instance.rpcClient.stopRetrying();\n            data.instance.logout();\n            data.instance.login();\n            return;\n          };\n          data.instance = new jQuery.verto({\n            login: data.login + '@' + data.hostname,\n            passwd: data.password,\n            socketUrl: data.wsURL,\n            wsFallbackURL: data.wsFallbackURL,\n            turnServer: data.turnServer,\n            tag: \"webcam\",\n            ringFile: \"sounds/bell_ring2.wav\",\n            audioParams: {\n                googEchoCancellation: storage.data.googEchoCancellation === undefined ? true : storage.data.googEchoCancellation,\n                googNoiseSuppression: storage.data.googNoiseSuppression === undefined ? true : storage.data.googNoiseSuppression,\n                googHighpassFilter: storage.data.googHighpassFilter === undefined ? true : storage.data.googHighpassFilter,\n                googAutoGainControl: storage.data.googAutoGainControl === undefined ? true : storage.data.googAutoGainControl,\n                googAutoGainControl2: storage.data.googAutoGainControl === undefined ? true : storage.data.googAutoGainControl\n            },\n            sessid: sessid,\n            iceServers: storage.data.useSTUN\n          }, callbacks);\n\n          // We need to know when user reloaded page and not react to\n          // verto events in order to not stop the reload and redirect user back\n          // to the dialpad.\n          that.reloaded = false;\n          jQuery.verto.unloadJobs.push(function() {\n            that.reloaded = true;\n          });\n\n          data.instance.deviceParams({\n            useCamera: storage.data.selectedVideo,\n            useSpeak: storage.data.selectedSpeaker,\n            useMic: storage.data.selectedAudio,\n            onResCheck: that.refreshVideoResolution\n          });\n        }\n        if (data.mediaPerm) {\n          ourBootstrap();\n        } else {\n          $.FSRTC.checkPerms(ourBootstrap, true, true);\n        }\n      },\n\n      mediaPerm: function(callback) {\n        $.FSRTC.checkPerms(callback, true, true);\n      },\n\n      /**\n       * Login the client.\n       *\n       * @param callback\n       */\n      login: function(callback) {\n        data.instance.loginData({\n          login: data.login + '@' + data.hostname,\n          passwd: data.password\n        });\n        data.instance.login();\n\n        if (angular.isFunction(callback)) {\n          callback(data.instance, true);\n        }\n      },\n\n      /**\n       * Disconnects from the verto server. Automatically calls `onWSClose`\n       * callback set in the verto object.\n       *\n       * @param callback\n       */\n      disconnect: function(callback) {\n        console.debug('Attempting to disconnect to verto.');\n\n        data.instance.logout();\n        data.connected = false;\n\n        console.debug('Disconnected from verto server.');\n\n        if (angular.isFunction(callback)) {\n          callback(data.instance, data.connected);\n        }\n      },\n\n      /**\n       * Make a call.\n       *\n       * @param callback\n       */\n      call: function(destination, callback, custom) {\n        console.debug('Attempting to call destination ' + destination + '.');\n\n        var call = data.instance.newCall(angular.extend({\n          destination_number: destination,\n          caller_id_name: data.name,\n          caller_id_number: data.callerid ? data.callerid : data.email,\n          outgoingBandwidth: storage.data.outgoingBandwidth,\n          incomingBandwidth: storage.data.incomingBandwidth,\n          useVideo: storage.data.useVideo,\n          useStereo: storage.data.useStereo,\n          useCamera: storage.data.selectedVideo,\n          useSpeak: storage.data.selectedSpeaker,\n          useMic: storage.data.selectedAudio,\n          dedEnc: storage.data.useDedenc,\n          mirrorInput: storage.data.mirrorInput,\n          userVariables: {\n            email : storage.data.email,\n            avatar: \"http://gravatar.com/avatar/\" + md5(storage.data.email) + \".png?s=600\"\n          }\n        }, custom));\n\n        data.call = call;\n\n        data.mutedMic = false;\n        data.mutedVideo = false;\n\n        if (angular.isFunction(callback)) {\n          callback(data.instance, call);\n        }\n      },\n\n      screenshare: function(destination, callback) {\n\n\n          var that = this;\n\n\t  if (storage.data.selectedShare !== \"screen\") {\n\n              console.log('share screen from device ' + storage.data.selectedShare);\n\n\t      var call = data.instance.newCall({\n\t\t  destination_number: destination + \"-screen\",\n\t\t  caller_id_name: data.name + \" (Screen)\",\n\t\t  caller_id_number: data.login + \" (screen)\",\n\t\t  outgoingBandwidth: storage.data.outgoingBandwidth,\n\t\t  incomingBandwidth: storage.data.incomingBandwidth,\n\t\t  useCamera: storage.data.selectedShare,\n\t\t  useVideo: true,\n\t\t  screenShare: true,\n\t\t  dedEnc: storage.data.useDedenc,\n\t\t  mirrorInput: storage.data.mirrorInput,\n\t\t  userVariables: {\n\t\t      email : storage.data.email,\n\t\t      avatar: \"http://gravatar.com/avatar/\" + md5(storage.data.email) + \".png?s=600\"\n\t\t  }\n\t      });\n\n              // Override onStream callback in $.FSRTC instance\n              call.rtc.options.callbacks.onStream = function(rtc, stream) {\n\t\t  if(stream) {\n\t\t      var StreamTrack = stream.getVideoTracks()[0];\n\t\t      StreamTrack.addEventListener('ended', stopSharing);\n\t\t      // (stream.getVideoTracks()[0]).onended = stopSharing;\n\t\t  }\n\n\t\t  console.log(\"screenshare started\");\n\n\t\t  function stopSharing() {\n\t\t      if(that.data.shareCall) {\n\t\t\t  that.screenshareHangup();\n\t\t\t  console.log(\"screenshare ended\");\n\t\t      }\n\t\t  }\n              };\n\n              data.shareCall = call;\n\n              console.log('shareCall', data);\n\n              data.mutedMic = false;\n              data.mutedVideo = false;\n\n              that.refreshDevices();\n\n\t      return;\n\t  }\n\n\n        console.log('share screen from plugin ' + storage.data.selectedShare);\n\n        var screenfunc = function(error, sourceId, screen_constraints) {\n\n          if(error) {\n            $rootScope.$emit('ScreenShareExtensionStatus', error);\n            return;\n          }\n\n          var share_call = data.instance.newCall({\n            destination_number: destination + '-screen',\n            caller_id_name: data.name + ' (Screen)',\n            caller_id_number: data.login + ' (Screen)',\n            outgoingBandwidth: storage.data.outgoingBandwidth,\n            incomingBandwidth: storage.data.incomingBandwidth,\n            videoParams: screen_constraints ? screen_constraints.video.mandatory : {},\n            useVideo: true,\n            screenShare: true,\n            dedEnc: storage.data.useDedenc,\n            mirrorInput: storage.data.mirrorInput,\n            userVariables: {\n              email : storage.data.email,\n              avatar: \"http://gravatar.com/avatar/\" + md5(storage.data.email) + \".png?s=600\"\n            }\n          });\n\n          // Override onStream callback in $.FSRTC instance\n          share_call.rtc.options.callbacks.onStream = function(rtc, stream) {\n            if(stream) {\n              var StreamTrack = stream.getVideoTracks()[0];\n              StreamTrack.addEventListener('ended', stopSharing);\n              // (stream.getVideoTracks()[0]).onended = stopSharing;\n            }\n\n            console.log(\"screenshare started\");\n\n            function stopSharing() {\n              if(that.data.shareCall) {\n                that.screenshareHangup();\n                console.log(\"screenshare ended\");\n              }\n            }\n          };\n\n          data.shareCall = share_call;\n\n          console.log('shareCall', data);\n\n          data.mutedMic = false;\n          data.mutedVideo = false;\n        };\n\n\t  if (!!navigator.mozGetUserMedia) {\n\t      screenfunc();\n\t  } else {\n              getScreenId(screenfunc);\n\t  }\n\n      },\n\n      screenshareHangup: function() {\n        if (!data.shareCall) {\n          console.debug('There is no call to hangup.');\n          return false;\n        }\n\n        console.log('shareCall End', data.shareCall);\n        data.shareCall.hangup();\n\n        console.debug('The screencall was hangup.');\n\n      },\n\n      /**\n       * Hangup the current call.\n       *\n       * @param callback\n       */\n      hangup: function(callback) {\n        console.debug('Attempting to hangup the current call.');\n\n        if (!data.call) {\n          console.debug('There is no call to hangup.');\n          return false;\n        }\n\n        data.call.hangup();\n\n        if (data.conf) {\n          data.conf.destroy();\n          data.conf = null;\n        }\n\n        console.debug('The call was hangup.');\n\n        if (angular.isFunction(callback)) {\n          callback(data.instance, true);\n        }\n      },\n\n      /**\n       * Send a DTMF to the current call.\n       *\n       * @param {string|integer} number\n       * @param callback\n       */\n      dtmf: function(number, callback) {\n        console.debug('Attempting to send DTMF \"' + number + '\".');\n\n        if (!data.call) {\n          console.debug('There is no call to send DTMF.');\n          return false;\n        }\n\n        data.call.dtmf(number.toString());\n        console.debug('The DTMF was sent for the call.');\n\n        if (angular.isFunction(callback)) {\n          callback(data.instance, true);\n        }\n      },\n\n      /**\n       * Do speed test.\n       *\n       * @param callback\n       */\n      testSpeed: function(cb) {\n\n        data.instance.rpcClient.speedTest(1024 * 256, function(e, data) {\n          var upBand = Math.ceil(data.upKPS * .75),\n              downBand = Math.ceil(data.downKPS * .75);\n\n\n          if (storage.data.autoBand) {\n            storage.data.incomingBandwidth = downBand;\n            storage.data.outgoingBandwidth = upBand;\n            storage.data.useDedenc = false;\n            storage.data.vidQual = 'hd';\n\n            if (upBand < 256) {\n              storage.data.vidQual = 'qqvga';\n            }\n            else if (upBand < 512) {\n              storage.data.vidQual = 'qvga';\n            }\n            else if (upBand < 1024) {\n              storage.data.vidQual = 'vga';\n            }\n          }\n\n          if(cb) {\n            cb(data);\n          }\n\n          $rootScope.$emit('testSpeed', data);\n        });\n      },\n      /**\n       * Mute the microphone for the current call.\n       *\n       * @param callback\n       */\n      muteMic: function(callback) {\n        console.debug('Attempting to mute mic for the current call.');\n\n        if (!data.call) {\n          console.debug('There is no call to mute.');\n          return false;\n        }\n\n        data.call.dtmf('0');\n        data.mutedMic = !data.mutedMic;\n        console.debug('The mic was muted for the call.');\n\n        if (angular.isFunction(callback)) {\n          callback(data.instance, true);\n        }\n      },\n\n      /**\n       * Mute the video for the current call.\n       *\n       * @param callback\n       */\n      muteVideo: function(callback) {\n        console.debug('Attempting to mute video for the current call.');\n\n        if (!data.call) {\n          console.debug('There is no call to mute.');\n          return false;\n        }\n\n        data.call.dtmf('*0');\n        data.mutedVideo = !data.mutedVideo;\n        console.debug('The video was muted for the call.');\n\n        if (angular.isFunction(callback)) {\n          callback(data.instance, true);\n        }\n      },\n      /*\n      * Method is used to send conference chats ONLY.\n      */\n      sendConferenceChat: function(message) {\n        data.conf.sendChat(message, \"message\");\n      },\n      setCanvasIn: function(memberID, canvasID) {\n        data.conf.modCommand('vid-canvas', memberID, canvasID);\n      },\n      setCanvasOut: function(memberID, canvasID) {\n        data.conf.modCommand('vid-watching-canvas', memberID, canvasID);\n      },\n      setLayer: function(memberID, canvasID) {\n        data.conf.modCommand('vid-layer', memberID, canvasID);\n      },\n      /*\n      * Method is used to set a member's resevartion Id.\n      */\n      setResevartionId: function(memberID, resID) {\n        data.conf.modCommand('vid-res-id', memberID, resID);\n      },\n      /*\n      * Method is used to send user2user chats.\n      * VC does not yet support that.\n      */\n      sendMessage: function(body, callback) {\n        data.call.message({\n          to: data.chattingWith,\n          body: body,\n          from_msg_name: data.name,\n          from_msg_number: data.cid\n        });\n\n        if (angular.isFunction(callback)) {\n          callback(data.instance, true);\n        }\n      }\n    };\n  }\n]);\n\n'use strict';\n\nvar vertoService = angular.module('vertoService');\n\nvertoService.service('config', ['$rootScope', '$http', '$location', 'storage', 'verto',\n  function($rootScope, $http, $location, storage, verto) {\n    var configure = function() {\n      /**\n       * Load stored user info into verto service\n       */\n      if(storage.data.name) {\n        verto.data.name = storage.data.name;\n      }\n      if(storage.data.email) {\n        verto.data.email = storage.data.email;\n      }\n      if(storage.data.login) {\n        verto.data.login = storage.data.login;\n      }\n      if(storage.data.password) {\n        verto.data.password = storage.data.password;\n      }\n\n      /*\n       * Load the Configs before logging in\n       * with cache buster\n       */\n      var url = window.location.origin + window.location.pathname;\n      var httpRequest = $http.get(url + 'config.json?cachebuster=' + Math.floor((Math.random()*1000000)+1));\n\n      var httpReturn = httpRequest.then(function(response) {\n        var data = response.data;\n\n        /* save these for later as we're about to possibly over write them */\n        var name = verto.data.name;\n        var email = verto.data.email;\n\n        console.debug(\"googlelogin: \" + data.googlelogin);\n        if (data.googlelogin){\n          verto.data.googlelogin = data.googlelogin;\n          verto.data.googleclientid = data.googleclientid;\n        }\n\n        if (data.wsFallbackURL) {\n          verto.data.wsFallbackURL = data.wsFallbackURL;\n        }\n\n        if (data.turnServer) {\n          verto.data.turnServer = data.turnServer;\n        }\n\n        angular.extend(verto.data, data);\n\n        /**\n         * use stored data (localStorage) for login, allow config.json to take precedence\n         */\n\n        if (name != '' && data.name == '') {\n          verto.data.name = name;\n        }\n        if (email != '' && data.email == '') {\n          verto.data.email = email;\n        }\n        if (verto.data.login == '' && verto.data.password == '' && storage.data.login != '' && storage.data.password != '') {\n          verto.data.login = storage.data.login;\n          verto.data.password = storage.data.password;\n        }\n\n        if (verto.data.autologin == \"true\" && !verto.data.autologin_done) {\n          console.debug(\"auto login per config.json\");\n          verto.data.autologin_done = true;\n        }\n\n        if(verto.data.autologin && storage.data.name.length && storage.data.email.length && storage.data.login.length && storage.data.password.length) {\n          $rootScope.$emit('config.http.success', data);\n        };\n        return response;\n      }, function(response) {\n        $rootScope.$emit('config.http.error', response);\n        return response;\n      });\n\n      return httpReturn;\n    };\n\n    return {\n      'configure': configure\n    };\n  }]);\n\n'use strict';\n\n  angular\n    .module('vertoService')\n    .service('eventQueue', ['$rootScope', '$q', 'storage', 'verto',\n      function($rootScope, $q, storage, verto) {\n        \n        var events = [];\n        \n        var next = function() {\n          var fn, fn_return;\n          \n          fn = events.shift();\n          \n          if (fn == undefined) {\n            $rootScope.$emit('eventqueue.complete');\n            return;\n          }\n          fn_return = fn();\n\n          var emitNextProgress = function() {\n            $rootScope.$emit('eventqueue.next');\n          };\n\n          fn_return.then(\n            function() {\n              emitNextProgress();\n            }, \n            function() {\n              emitNextProgress();\n            }\n          );\n        };\n\n        var process = function() {\n          $rootScope.$on('eventqueue.next', function (ev){\n            next();\n          });\n          \n          next(); \n        };\n\n        return {\n          'next': next,\n          'process': process,\n          'events': events\n        };\n\n      }]);\n \n\n(function() {\n  'use strict';\n  var vertoService = angular.module('storageService', ['ngStorage']);\n})();\n\n'use strict';\n\n  angular\n  .module('storageService')\n  .service('storage', ['$rootScope', '$localStorage',\n  function($rootScope, $localStorage) {\n    var data = $localStorage,\n\tdefaultSettings = {\n\t  ui_connected: false,\n          ws_connected: false,\n          cur_call: 0,\n          called_number: '',\n          useVideo: true,\n          call_history: {},\n          history_control: [],\n          call_start: false,\n          name: '',\n          email: '',\n          login: '',\n          password: '',\n          userStatus: 'disconnected',\n          mutedVideo: false,\n          mutedMic: false,\n          preview: true,\n          selectedVideo: null,\n          selectedVideoName: null,\n          selectedAudio: null,\n          selectedShare: null,\n          selectedSpeaker: null,\n          useStereo: true,\n          useSTUN: true,\n          useDedenc: false,\n          mirrorInput: false,\n          outgoingBandwidth: 'default',\n          incomingBandwidth: 'default',\n          vidQual: undefined,\n          askRecoverCall: false,\n          googNoiseSuppression: true,\n          googHighpassFilter: true,\n          googEchoCancellation: true,\n          googAutoGainControl: true,\n          autoBand: true,\n          testSpeedJoin: true,\n          bestFrameRate: \"15\",\n          language: undefined\n       };\n\n    data.$default(defaultSettings);\n\n    function changeData(verto_data) {\n      jQuery.extend(true, data, verto_data);\n    }\n\n    return {\n      data: data,\n      changeData: changeData,\n      reset: function() {\n        data.ui_connected = false;\n        data.ws_connected = false;\n        data.cur_call = 0;\n        data.userStatus = 'disconnected';\n      },\n      factoryReset: function() {\n        localStorage.clear();\n        // set defaultSettings again\n        data.$reset(defaultSettings);\n      },\n    };\n  }\n]);\n\n'use strict';\n\n  angular\n  .module('storageService')\n  .factory('CallHistory', [\"storage\", function(storage) {\n\n    var history = storage.data.call_history;\n    var history_control = storage.data.history_control;\n\n    var addCallToHistory = function(number, direction, status) {\n      if(history[number] == undefined) {\n        history[number] = [];\n      }\n\n      history[number].unshift({\n        'number': number,\n        'direction': direction,\n        'status': status,\n        'call_start': Date()\n      });\n\n      var index = history_control.indexOf(number);\n      console.log(index);\n      if(index > -1) {\n        history_control.splice(index, 1);\n      }\n\n      history_control.unshift(number);\n\n    };\n\n    var getCallsFromHistory = function(number) {\n      return history[number];\n    };\n\n    return {\n      all: function() {\n        return history;\n      },\n      all_control: function() {\n        return history_control;\n      },\n      get: function(number) {\n        return getCallsFromHistory(number);\n      },\n      add: function(number, direction, status) {\n        return addCallToHistory(number, direction, status);\n      },\n      clear: function() {\n        storage.data.call_history = {};\n        storage.data.history_control = [];\n        history = storage.data.call_history;\n        history_control = storage.data.history_control;\n        return history_control;\n      }\n    }\n}]);\n\n'use strict';\n\n  angular\n    .module('storageService')\n    .service('splashscreen', ['$rootScope', '$q', 'storage', 'config', 'verto', '$translate',\n      function($rootScope, $q, storage, config, verto, $translate) {\n\n        var checkBrowser = function() {\n          return $q(function(resolve, reject) {\n            var activity = 'browser-upgrade';\n            var result = {\n              'activity': activity,\n              'soft': false,\n              'status': 'success',\n              'message': $translate.instant('BROWSER_COMPATIBILITY')\n            };\n            if (!navigator.mediaDevices.getUserMedia) {\n              result['status'] = 'error';\n              result['message'] = $translate.instant('BROWSER_WITHOUT_WEBRTC');\n              reject(result);\n            }\n\n            resolve(result);\n\n          });\n        };\n\n        var checkMediaPerm = function() {\n          return $q(function(resolve, reject) {\n            var activity = 'media-perm';\n            var result = {\n              'activity': activity,\n              'soft': false,\n              'status': 'success',\n              'message': $translate.instant('CHECK_PERMISSION_MEDIA')\n            };\n\n            verto.mediaPerm(function(status) {\n              if(!status) {\n                result['status'] = 'error';\n                result['message'] = $translate.instant('ERROR_PERMISSION_MEDIA');\n                verto.data.mediaPerm = false;\n                reject(result);\n              }\n              verto.data.mediaPerm = true;\n              resolve(result);\n            });\n          });\n        };\n\n        var refreshMediaDevices = function() {\n          return $q(function(resolve, reject) {\n            var activity = 'refresh-devices';\n            var result = {\n              'status': 'success',\n              'soft': true,\n              'activity': activity,\n              'message': $translate.instant('REFRESH_MEDIA_DEVICES')\n            };\n\n            verto.refreshDevices(function(status) {\n              verto.refreshDevicesCallback(function() {\n                resolve(result);\n              });\n            });\n\n          });\n        };\n\n        var checkConnectionSpeed = function() {\n          return $q(function(resolve, reject) {\n            var activity = 'check-connection-speed';\n            var result = {\n              'status': 'success',\n              'soft': true,\n              'activity': activity,\n              'message': $translate.instant('CHECK_CONNECTION_SPEED')\n            };\n\n            if (storage.data.autoBand && verto.data.instance) {\n              verto.testSpeed(cb);\n            } else {\n              resolve(result);\n            }\n\n            function cb(data) {\n              resolve(result);\n            }\n          });\n        };\n\n        var provisionConfig = function() {\n          return $q(function(resolve, reject) {\n            var activity = 'provision-config';\n            var result = {\n              'status': 'promise',\n              'soft': true,\n              'activity': activity,\n              'message': $translate.instant('CHECK_PROVISIONING_CONF')\n            };\n\n            var configResponse = config.configure();\n\n            var configPromise = configResponse.then(\n              function(response) {\n                /**\n                 * from angular docs:\n                 * A response status code between 200 and 299 is considered a success status and will result in the success callback being called\n                 */\n                if(response.status >= 200 && response.status <= 299) {\n                  return result;\n                } else {\n                  result['status'] = 'error';\n                  result['message'] = $translate.instant('ERROR_PROVISIONING_CONF');\n                  return result;\n                }\n              });\n\n              result['promise'] = configPromise;\n\n              resolve(result);\n          });\n        };\n\n        var checkLogin = function() {\n          return $q(function(resolve, reject) {\n            var activity = 'check-login';\n            var result = {\n              'status': 'success',\n              'soft': true,\n              'activity': activity,\n              'message': $translate.instant('CHECK_LOGIN'),\n            };\n\n            if(verto.data.connecting || verto.data.connected) {\n              resolve(result);\n              return;\n            };\n\n            var checkUserStored = function() {\n              /**\n               * if user data saved, use stored data for logon and not connecting\n               * not connecting prevent two connects\n               */\n              if (storage.data.ui_connected && storage.data.ws_connected && !verto.data.connecting) {\n                verto.data.hostname = storage.data.hostname || verto.data.hostname;\n                verto.data.wsURL = storage.data.wsURL || verto.data.wsURL;\n                verto.data.name = storage.data.name;\n                verto.data.email = storage.data.email;\n                verto.data.login = storage.data.login;\n                verto.data.password = storage.data.password;\n\n                verto.data.connecting = true;\n                verto.connect(function(v, connected) {\n                  verto.data.connecting = false;\n                  resolve(result);\n                });\n              };\n            };\n\n            if(storage.data.ui_connected && storage.data.ws_connected) {\n              checkUserStored();\n            } else {\n              resolve(result);\n            };\n          });\n        };\n\n        var progress = [\n          checkBrowser,\n          checkMediaPerm,\n          refreshMediaDevices,\n          provisionConfig,\n          checkLogin,\n          checkConnectionSpeed\n        ];\n\n        var progress_message = [\n          $translate.instant('BROWSER_COMPATIBILITY'),\n          $translate.instant('CHECK_PERMISSION_MEDIA'),\n          $translate.instant('REFRESH_MEDIA_DEVICES'),\n          $translate.instant('CHECK_PROVISIONING_CONF'),\n          $translate.instant('CHECK_LOGIN'),\n          $translate.instant('CHECK_CONNECTION_SPEED'),\n        ];\n\n        var getProgressMessage = function(current_progress) {\n          if(progress_message[current_progress] != undefined) {\n            return progress_message[current_progress];\n          } else {\n            return $translate.instant('PLEASE_WAIT');\n          }\n        };\n\n        var current_progress = -1;\n        var progress_percentage = 0;\n\n        var calculateProgress = function(index) {\n          var _progress;\n\n          _progress = index + 1;\n          progress_percentage = (_progress / progress.length) * 100;\n          return progress_percentage;\n        };\n\n        var nextProgress = function() {\n          var fn, fn_return, status, interrupt, activity, soft, message, promise;\n          interrupt = false;\n          current_progress++;\n\n          if(current_progress >= progress.length) {\n            $rootScope.$emit('progress.complete', current_progress);\n            return;\n          }\n\n          fn = progress[current_progress];\n          fn_return = fn();\n\n          var emitNextProgress = function(fn_return) {\n            if(fn_return['promise'] != undefined) {\n              promise = fn_return['promise'];\n            }\n\n            status = fn_return['status'];\n            soft = fn_return['soft'];\n            activity = fn_return['activity'];\n            message = fn_return['message'];\n\n            if(status != 'success') {\n              interrupt = true;\n            }\n\n            $rootScope.$emit('progress.next', current_progress, status, promise, activity, soft, interrupt, message);\n\n          };\n\n          fn_return.then(\n            function(fn_return) {\n              emitNextProgress(fn_return);\n            },\n            function(fn_return) {\n              emitNextProgress(fn_return);\n            }\n          );\n\n        };\n\n        return {\n          'next': nextProgress,\n          'getProgressMessage': getProgressMessage,\n          'progress_percentage': progress_percentage,\n          'calculate': calculateProgress\n        };\n\n      }]);\n"]}